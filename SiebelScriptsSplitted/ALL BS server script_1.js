#include "eaisiebel.js"
function AddOneDay (Indate)
{
	
var ObjDate = new Date(Indate);

return (ObjDate.getMonth()+1) + ""/"" + (ObjDate.getDate()+1) + ""/"" + (ObjDate.getYear()+1900);

}
function GeneratePromised (Inputs, Outputs)
{
var SiebelMessage;
var ListOfHeader;
var Header;
var ListOfItems;
var SysDate = Clib.time();
var ObjDate = Date.fromSystem(SysDate);
var reqQty;
var reqDate;
var halfQty;
var rowId;
var ATPstatus;
var pATPItem;
var i =0;

if (Inputs.GetChildCount()>0)
{
	SiebelMessage = Inputs.GetChild(0);
	ListOfHeader = SiebelMessage.GetChild(0);
	Header = ListOfHeader.GetChild(0);
	Header.SetProperty(""Available Message"",""ATP Test eScript Success"");
	ListOfItems = Header.GetChild(0);
while (ListOfItems.GetChildCount() > i)
	  {
		pATPItem = ListOfItems.GetChild(i);
        ATPstatus = pATPItem.GetProperty(""ATP Action"") + ""d"";
        pATPItem.RemoveProperty(""ATP Action"");
		 while (pATPItem.GetChildCount()>0)
		 {	
		 	pATPItem.RemoveChild(0);
		 }
		 reqQty = pATPItem.GetProperty(""Requested Quantity"");
		 reqDate = pATPItem.GetProperty(""Requested Date"");	 
		 if (reqDate == """"){
			reqDate = (ObjDate.getMonth()+1) + ""/"" + ObjDate.getDate() + ""/2002"";
   		 }
   		 var reqDate1 = AddOneDay(reqDate); 
   		 halfQty = reqQty / 2;
		 halfQty = Math.ceil(halfQty);
 		 logResults (""halfQty"",halfQty);
 		 logResults (""reqDate"",reqDate);
 		 logResults (""reqDate1"",reqDate1);
		 var availList = TheApplication().NewPropertySet();
		 availList.SetType(""ListOfPromised Schedule Line"");
    	 var avail1 = TheApplication().NewPropertySet();
		 GetPromiseLine(pATPItem,halfQty,reqDate1,ATPstatus,""1"",avail1);
		 availList.AddChild(avail1);
		
		 if (reqQty > 1){
		 var avail2 = TheApplication().NewPropertySet();
		 GetPromiseLine(pATPItem,(reqQty-halfQty),reqDate1,ATPstatus,""2"",avail2);
		 availList.AddChild(avail2);
		 }
		 pATPItem.AddChild(availList);
  		 i++;
	   }
}
SiebelMessage = Inputs.GetChild(0);
Outputs.AddChild(SiebelMessage);
}
function GetPromiseLine (pATPItem,availQty,availDate,status,LineNumber,avail1)
{
var SysDate = Clib.time();
var ObjDate = Date.fromSystem(SysDate);
var rowId;
var prodId;
var prodIntId;
var dateStr = (ObjDate.getMonth()+1) + ""/"" + (ObjDate.getDate()+1) + ""/2004"";
	    //promisedLine = TheApplication().NewPropertySet();
logResults(""datestr="",dateStr);
		rowId = pATPItem.GetProperty(""Id"");
		prodId = pATPItem.GetProperty(""Product Id"");
		prodIntId = pATPItem.GetProperty(""Product Integration Id"");
		var srcInvId = pATPItem.GetProperty(""Source Inventory Loc Id"");
		var srcInvIntId = pATPItem.GetProperty(""Source Inventory Loc Integration Id"");
		var srcInvLoc = pATPItem.GetProperty(""Source Inventory Location"");
 		if (status != ""Reserved"") status = ""Available"";
		
		 avail1.SetType(""Promised Schedule Line"");
		 
		// avail1.SetProperty(""Line Row Id"",rowId);
		 avail1.SetProperty(""Id"",rowId+LineNumber);
		 avail1.SetProperty(""Line Number"",LineNumber);         
		 avail1.SetProperty(""Available Quantity"",availQty);
		 avail1.SetProperty(""Available Date"",availDate);
		 avail1.SetProperty(""Available Status"",status);
		 avail1.SetProperty(""Product Id"",prodId);
	     avail1.SetProperty(""Product Integration Id"",prodIntId);
		
		 avail1.SetProperty(""Available Status As Of Date"",dateStr);
		 avail1.SetProperty(""Source Inventory Loc Id"",srcInvId);
		 avail1.SetProperty(""Source Inventory Loc Integration Id"",srcInvIntId);
		 avail1.SetProperty(""Source Inventory Location"",srcInvLoc);
}
function GetShipmentInfo (InputPropset, OutputPropSet)
{
	
	//ThrowError(""This funtionality is not yet implemented."");
var ResponseFile;
var OutputFile;
var xmlService;
var Outdata; 
var Indata;
var psInputs2;
var psOutputs2;
var bsFILE;
var psInputs3;
var psOutputs3;
var psInputs4;
var psOutputs4;
var value2;
var child1;
var logfile;
var getType1;

ResponseFile = ""d:\\ATPResponse.xml"";
OutputFile = ""d:\\ATPOutput.xml"";

	
xmlService = TheApplication().GetService(""EAI XML Converter"");
 
psInputs2 = TheApplication().NewPropertySet();
 	child1 = InputPropset.GetChild(0);
    getType1 = child1.GetType();
    logResults(logfile, ""Output Child Type returns: "" + getType1);
    psInputs2 = InputPropset;
    psOutputs2 = TheApplication().NewPropertySet();

   
    xmlService.InvokeMethod(""PropSetToXML"", psInputs2, psOutputs2);

    value2 = psOutputs2.GetValue();
   bsFILE = TheApplication().GetService(""EAI File Transport"");
 
   psInputs3 = TheApplication().NewPropertySet();
    psOutputs3 = TheApplication().NewPropertySet();
    psInputs3.SetProperty(""FileName"", OutputFile);
    psInputs3.SetValue(value2);

    bsFILE.InvokeMethod(""Send"", psInputs3, psOutputs3);
    psInputs4 = TheApplication().NewPropertySet();
    psOutputs4 = TheApplication().NewPropertySet();
	psInputs4.SetProperty(""FileName"", ResponseFile);	
	psInputs4.SetProperty(""IsReceivingTextData"","false"");
	bsFILE.InvokeMethod(""Receive"",psInputs4,psOutputs4);
	psOutputs4.SetProperty(""StripNameSpace"","""");

	xmlService.InvokeMethod(""XMLToPropSet"", psOutputs4, OutputPropSet);
}
function RunATPTest (InputPropset, OutputPropSet)
{
var OutputFile;
var envPath;
var envSlash;

if (Clib.getenv(""OS"") == ""Windows_NT"")
{
envSlash = ""\\"";
} else
{
envSlash = ""/"";
}

envPath = Clib.getenv(""REQUEST_ASI_PATH"") + envSlash;

if ( (envPath == (""null"" + envSlash)) || (envPath == envSlash) )
{
	envPath = Clib.getenv(""SIEBEL_HOME"");
		
	if ((envPath == ""null"") || (envPath == """"))
	{
		envPath = """";
	} 
	else 
	{
		envPath = envPath + envSlash + ""bin"" + envSlash;
	}
	
}

OutputFile = envPath + ""ATPOutput.xml"";

  WriteXMLFile(InputPropset,OutputFile);
  GeneratePromised(InputPropset,OutputPropSet);
  var ResponseFile = envPath + ""ATPFinished.xml"";
  WriteXMLFile(OutputPropSet,ResponseFile);
  }
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""Execute"")
    {
    	//GetShipmentInfo (Inputs, Outputs);
    	RunATPTest (Inputs, Outputs);
    }
    
     if (MethodName == ""WriteXML"")
    {
    	//GetShipmentInfo (Inputs, Outputs);
    	WriteXMLFile (Inputs,""d:\\ATPBeforeExecute.xml"");
    }
       
    return (CancelOperation);
	
}
function WriteJunk (Inputs)
{
	
var SiebelMessage;
var ListOfHeader;
var Header;
var ListOfItems;
var Item;
var ListOfATP;
var Promised;
var data;
logResults (""jnk"",""WriteJunk"");

SiebelMessage = Inputs.GetChild(0);
data = SiebelMessage.GetType();
logResults (""SiebMes"",data);

ListOfHeader = SiebelMessage.GetChild(0);
data = ListOfHeader.GetType();
logResults (""ListOHeader"",data);

Header = ListOfHeader.GetChild(0);
data = Header.GetType();
logResults (""DaHeader"",data);

ListOfItems = Header.GetChild(0);
data = ListOfItems.GetType();
logResults (""LstOItems"",data);

Item = ListOfItems.GetChild(0);
data = Item.GetType();
logResults (""Item"",data);

ListOfATP = Item.GetChild(0);
data = ListOfATP.GetType();
logResults (""ListOAtp"",data);

Promised = ListOfATP.GetChild(0);
data = Promised.GetType();
logResults (""Promised"",data);


}
function WriteXMLFile (Inputs, fileName)
{
	
var xmlService;
var value2;
var psInputs2;
var psOutputs2;
var bsFILE;
var psInputs3;
var psOutputs3;

 psInputs2 = TheApplication().NewPropertySet();
 psInputs2 = Inputs;
 psOutputs2 = TheApplication().NewPropertySet();
 xmlService 	= TheApplication().GetService(""EAI XML Write to File"");
 psInputs2.SetProperty (""FileName"", fileName);
 xmlService.InvokeMethod(""WriteEAIMsg"", psInputs2, psOutputs2);
   
 
}
function logResults (lf,data)
{
var logfile;
 //var logfile = Clib.fopen(""craiglog.txt"", ""a"");

 //   Clib.fputs("" \n"", logfile);
 //   data = lf + "" "" + data + "" \n"";
 //   if ( !Clib.fputs(data, logfile))
 //   {
 //    Clib.ferror(logfile);
 //   }
 //   Clib.fputs("" \n"", logfile);
 //Clib.fclose(logfile);
 

}
function Execute(Inputs, Outputs)
{
var ResponseFile;
var OutputFile;
var xmlService;
var Outdata; 
var Indata;
var psInputs2;
var psOutputs2;
var bsFILE;
var psInputs3;
var psOutputs3;
var psInputs4;
var psOutputs4;
var value2;
var child1;
var logfile;
var getType1;
var envPath;
var envSlash;

if (Clib.getenv(""OS"") == ""Windows_NT"")
{
envSlash = ""\\"";
} else
{
envSlash = ""/"";
}

envPath = Clib.getenv(""REQUEST_ASI_PATH"") + envSlash;

if (envPath == (""null"" + envSlash))
{
	envPath = Clib.getenv(""SIEBEL_HOME"") + envSlash + ""bin"" + envSlash;
}

OutputFile = envPath + ""ATPOutput.xml"";

ResponseFile = envPath + ""ATPResponse.xml"";
 
 psInputs2 = TheApplication().NewPropertySet();
 psInputs2 = Inputs;
 psOutputs2 = TheApplication().NewPropertySet();
 xmlService 	= TheApplication().GetService(""EAI XML Write to File"");
 psInputs2.SetProperty (""FileName"", OutputFile);
 xmlService.InvokeMethod(""WriteEAIMsg"", psInputs2, psOutputs2);

 psInputs4 = TheApplication().NewPropertySet();
 psInputs4.SetProperty(""FileName"", ResponseFile);	
 xmlService = TheApplication().GetService(""EAI XML Read from File"");
 xmlService.InvokeMethod(""ReadEAIMsg"", psInputs4,  Outputs);	
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   var ret= CancelOperation;
   
   if (MethodName==""Execute"")
   {
      Execute(Inputs,Outputs);
   }
   else
   {
      TheApplication.ErrorText(""Invalid function name. Valid method name is 'Execute'"");
      ret=ContinueOperation;
   }
   return ret;
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function CheckSAPCustomer_CallBAPI (inputMsg, outputMsg) { 
  /*  Referenced in workflow Account - Check SAP 46C Customer
    * Input Object:
    *  Account - Send or Receive SAP 46C Customer (Siebel 77)
    *       
    *
    * Output Object's Integration Components:
    *  Account - Send or Receive SAP 46C Customer (Siebel 77)
    *   set property ""customerExists"" to true or false in outputMsg
    *  if customer does not exist, set ""EAI Sync Error Text""
    */

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
   *  temporary variables
   */
   var customerExists = false;
   var errorType;

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account
   var oAccountObj;
   var oAccountComp;
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");
   
   
   /*
   *   Create new property sets for BAPI call to SAP and create adapter bus service
   */   
   var inputBAPI = TheApplication().NewPropertySet();
   var outputBAPI = TheApplication().NewPropertySet();
   var inputBAPIMsg = EAICreateIntMsgOut (inputBAPI);
  
   
   var iBAPIObj = inputBAPIMsg.CreateIntObj (""Account - Check SAP 46C Customer Existence (BAPI Input)"");

   inputBAPIMsg.SetArgument (""OutputIntObjectName"", ""Account - Check SAP 46C Customer Existence (BAPI Output)"");
   inputBAPIMsg.SetArgument (""SAPAutoError"",""False"");

   var bapiAdapter = TheApplication().GetService(""EAI SAP BAPI Adapter"");
   
   var oBAPIObj;
   var oBAPIExportComp;
   var iBAPIImportComp;
  
    
   /*
    * create top-level integration object
    */
   
   if (iAccountObj.NextInstance ())
   {
     /*
      * Create BAPI object in output message
      */
      iBAPIObj.NewInstance ();
      

      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      iBAPIImportComp = iBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
 
       if (iAccountComp.NextRecord ())
      {
	      var IntId = iAccountComp.GetFieldValue (""Integration Id"");
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }
       /*
        * Write ""Import Parameters"" component
        */
         iBAPIImportComp.NewRecord ();
         iBAPIImportComp.SetFieldValue (""CUSTOMERNO"", IntId);
         /*
         *  Loop over sales orgs, call BAPI for each until one suceeds
         */
		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
			
		while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Copy sales org info	*/

			iBAPIImportComp.SetCopySource ( iSalesAreaAccountComp );
			iBAPIImportComp.CopyFieldValue( ""SALES_ORGANIZATION"", ""Back Office Sales Organization"");
			iBAPIImportComp.CopyFieldValue( ""DISTRIBUTION_CHANNEL"", ""Back Office Distribution Channel"");
			iBAPIImportComp.CopyFieldValue( ""DIVISION"", ""Back Office Sales Area Division Code"");
     
            // call BAPI
            bapiAdapter.InvokeMethod (""Execute"", inputBAPI, outputBAPI);
            
            // test output
           oBAPIExportComp = ((outputBAPI.GetChild(0)).GetChild(0)).GetChild(0);

           errorType = oBAPIExportComp.GetProperty (""RETURN-TYPE"");
               
           if (errorType != ""E"")
           {
              customerExists = true;
              
              break;
           }
           outputBAPI.Reset();
         
        } // endloop iSalesAreaAccountComp.NextRecord()
        
      } // endif iAccountComp.NextRecord()
   } // endif iAccountObj.NextInstance()
   
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");
   oAccountObj.NewInstance ();
   oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
   oAccountComp.NewRecord ();
   // Set ""Id"" so Siebel Adapter can synchronize
   oAccountComp.SetFieldValue (""Id"", inputId);
   
   if (customerExists)
   {
      outputMsg.SetArgument(""Customer Exists"", ""True"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"",  """");
   }
   else
   {    
      var output = LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP1"")+"" ""+  	 
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP2"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP3"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP4"");
      outputMsg.SetArgument(""Customer Exists"", ""False"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"", output);
   }
   
 } // end function"
function GetAccountName (Int_ID)
{// referenced by script ReceiveAccount_46CIDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", Int_ID);
	AccBusComp.ActivateField(""Name"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Name"");
	}
      	else
           return null;
}
function GetAccountStatus (oIntId)
{ // referenced by script ReceiveAccount_46CIDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", oIntId);
	AccBusComp.ActivateField(""Account Status"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Account Status"");
	}
      	else
           return null;
}
function GetSalesArea (SalesOrg, DistChannel, DivCode)
{ // referenced by script ReceiveAccount_46CIDOCToSiebel
	var OrgBusObject = TheApplication().GetBusObject(""PickList Generic"");
	var SABusComp = OrgBusObject.GetBusComp(""SAP Organization"");
		
	SABusComp.ClearToQuery();
//    SABusComp.SetSearchSpec(""Back Office Sales Organization"", TheApplication().InvokeMethod (""LookupValue"", ""SAP_SALES_ORG"", SalesOrg));
//    SABusComp.SetSearchSpec(""Back Office Distribution Channel"", TheApplication().InvokeMethod (""LookupValue"", ""SAP_DISTRIBUTION_CHANNEL"", DistChannel));
//    SABusComp.SetSearchSpec(""Back Office Division"", TheApplication().InvokeMethod (""LookupValue"", ""SAP_DIVN_CD"", DivCode));
      SABusComp.SetSearchSpec(""Back Office Sales Organization"", SalesOrg);
      SABusComp.SetSearchSpec(""Back Office Distribution Channel"", DistChannel);
      SABusComp.SetSearchSpec(""Back Office Division"", DivCode);

	SABusComp.ActivateField(""Organization Id"");
	
	SABusComp.ExecuteQuery();
	
	
	if(SABusComp.FirstRecord())
	{
	   return SABusComp.GetFieldValue(""Organization Id"");
	}
      else
         return null;
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function ReceiveAccount_46CIDOCToSiebel (inputMsg, outputMsg)
{ // referenced by workflow Account - Receive SAP 46C Customer
	/* Input Objects' Integration Components	
	*   Account - Send or Receive SAP 46C Customer (DEBMAS05)			
	*     E2KNA1M005, E2KNVKM, E2DNVVM005, E2KNKKM001, E2KNVPM002
	* Output Object's Integration Components:
	*  Account - Send or Receive SAP 46C Customer (Siebel 77)
	*   Account
	*   Contact
	*   Business Address
	*/

	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Inbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Inbound"");
	var defaultOrgLM = EAIGetValueMap (""Default Org"", ""Siebel Inbound"");
	var undefinedOrgLM = EAIGetValueMap (""Undefined SAP Org"", ""Siebel Inbound"");
	var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Inbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Inbound"");

	/* Set up EAI Input Message objects */
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iKNA1MComp; // IDOC Customer Header
	var iComp;      // for reading child components

	/* Set up EAI Output Message objects */
	var oAccountObj;    // Siebel Account instance
	var oAccountComp;   // Account
	var oAddrComp;      // Address
	var oContactComp;   // Contact

	var oCustAcctGrp;	// Customer Account Group
	var oIntId;			// SAP Customer Number
	var oAcctSts;		// Account Status
	var regCode;        // SAP Country + Region Code	(12-90S337)
	var sapCode;        // SAP Region Code				(12-90S337)
	var osiebReg;       // Siebel Region 				(12-90S337)
	
	var AcctIntId       // Account Integration Id for Contact (12-C34KYN)
	
	/* Find and create top-level integration object */
	iIDOCObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 46C Customer (DEBMAS05)"");
	oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");

	/* Misc set up */
//	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only

	/* Read int object instances from EAI message */
	enumObj: while (iIDOCObj.NextInstance ())
	{
		/* Read virtual root component that IDOC RFC Adapter populates */
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		if( !iIDOCComp.NextRecord() ) continue enumObj;   // TODO: Root component is missing - log an error???

		/* Read ""KNA1M"" component */
		iKNA1MComp = iIDOCComp.GetIntComp (""E2KNA1M005"");
		if( !iKNA1MComp.NextRecord() ) continue enumObj;

		/* Create ""Account"" object */
		oAccountObj.NewInstance ();

		/* Create ""Account"" component in output message */
		oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
		oAccountComp.NewRecord ();	
		oAccountComp.SetCopySource (iKNA1MComp);

		/* Set Integration Id and Name */
		oIntId = iKNA1MComp.GetFieldValue (""KUNNR"");
		
		oAccountComp.CopyFieldValue (""Integration Id"", ""KUNNR"");
		oAccountComp.CopyFieldValue (""Name"",           ""NAME1"");
		
		AcctIntId = oIntId ;  // Account Integration Id for Contact (12-C34KYN)
		
		oCustAcctGrp = acctGroupLM.Translate (iKNA1MComp.GetFieldValue (""KTOKD""));
		var AcctGrp = TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_GROUP_TYPE"", oCustAcctGrp);
		oAccountComp.SetFieldValue (""Customer Account Group"", AcctGrp);

		/* Set location to ""<City> KUNNR1"" If <City> is null, put ""No City"" */
		var location = iKNA1MComp.GetFieldValue (""ORT01"");
		if (location == null) location = ""No City"";
		location += "" "" + iKNA1MComp.GetFieldValue (""KUNNR"");
		oAccountComp.SetFieldValue (""Location"",   location);

		/* Check if customer is Marked for Deletion */
		if (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X"") 
		{
			oAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
		}
		else
		{
			oAcctSts = GetAccountStatus (oIntId);
			if (oAcctSts == ""Marked For Deletion"")
				oAccountComp.SetFieldValue (""Account Status"", ""Active"");
			else
				oAccountComp.SetFieldValue (""Account Status"", oAcctSts);
		}

		/* Set telephone numbers */
		oAccountComp.CopyFieldValue (""Main Phone Number"", ""TELF1"");
		oAccountComp.CopyFieldValue (""Main Fax Number"",   ""TELFX"");

		/* Set other fields ; Defaults from buscomp:*/
		oAccountComp.CopyFieldValue (""Row Status"", ""Y"");

		/* Set fields for SAP 4x */
		oAccountComp.CopyFieldValue (""Primary Industry Id"", ""BRSCH"");

		// Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet)
		// oAccountComp.CopyFieldValue ("""", ""STCEG"");
		
		oAccountComp.SetFieldValue (""Language Code"",languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

		/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
		// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
		// findKNRZE: while (iComp.NextRecord ())
		// {
			//oAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
			/* only get first row */
			//break findKNRZE;
		// }
			
		var timenow = Timestamp();
		var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Sync from Back Office"");
	   	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
		oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
			
		// Set operation to ""    "" since we are using the ""Execute"" method.
		oAccountComp.SetFieldValue (""operation"", ""sync"");
		
		/* Write ""Address"" component */
		oAddrComp = oAccountComp.CreateIntComp (""Account_Business Address"", false);
		oAddrComp.NewRecord ();
		oAddrComp.SetCopySource (iKNA1MComp);
		oAddrComp.CopyFieldValue (""Integration Id"", ""KUNNR"");

		// Set Street address
		var stras = iKNA1MComp.GetFieldValue (""STRAS""); // Street address
		var pfach = iKNA1MComp.GetFieldValue (""PFACH""); // PO Box
		var street;

		if (stras == """" && pfach == """") 	street = ""None"";
		else if (stras != """" && pfach == """")street = stras;
		else if (stras != """" && pfach != """")street = stras + "" P.O. Box "" + pfach;
		else if (stras == """" && pfach != """")street = ""P.O. Box "" + pfach;

		oAddrComp.SetFieldValue  (""Street Address"", street);
		oAddrComp.CopyFieldValue (""City"",    ""ORT01"", ""None"", ""None"");
		oAddrComp.SetFieldValue  (""Country"", countryLM.Translate (iKNA1MComp.GetFieldValue (""LAND1"")));
		var x = 0; x += 1; //temporarily fix until operation synchronize works
		var AddrName = street + x + ', ' + iKNA1MComp.GetFieldValue (""ORT01"") + ', ' + iKNA1MComp.GetFieldValue (""REGIO"") ;
		oAddrComp.SetFieldValue (""Address Name"", AddrName); 

// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing
		sapCode  = iKNA1MComp.GetFieldValue (""REGIO"");	//12-90S337
		regCode  = iKNA1MComp.GetFieldValue (""LAND1"");	//12-90S337
		regCode  = regCode + ""_"" + sapCode;				//12-90S337
		osiebReg = regCodeLM.Translate (regCode);		//12-90S337
		var sRegion = TheApplication().InvokeMethod (""LookupValue"", ""STATE_ABBREV"", osiebReg);	//12-90S337
		oAddrComp.SetFieldValue (""State"",    sRegion);	//12-90S337
				
		oAddrComp.CopyFieldValue (""Postal Code"", ""PSTLZ"");
		oAddrComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
		oAddrComp.SetFieldValue (""operation"", ""sync"");

		/* Read ""KNVKM"" component */
		iComp   = iKNA1MComp.GetIntComp (""E2KNVKM"");
		oContactComp = oAccountComp.CreateIntComp (""Contact"", false);
		while (iComp.NextRecord ())
		{
			/* Write ""Contact"" component */
			oContactComp.NewRecord ();
			oContactComp.SetCopySource  (iComp);
			oContactComp.CopyFieldValue (""Integration Id"", ""PARNR"");
			oContactComp.CopyFieldValue (""Employee Number"", ""PARNR"");
			
			// Set First Name
			oContactComp.CopyFieldValue (""First Name"", ""NAMEV"", ""No First Name"", ""No First Name"");
			// Set Last name
			oContactComp.CopyFieldValue (""Last Name"", ""NAME1"");

			// Set job title
			oContactComp.CopyFieldValue (""Job Title"",    ""TITEL_AP"");
			oContactComp.CopyFieldValue (""M/M"",          ""ANRED"");
			oContactComp.CopyFieldValue (""Work Phone #"", ""TELF1"");
			
			// Account Integration Id for Contact (12-C34KYN)
			oContactComp.SetFieldValue ( ""Account Integration Id"", AcctIntId );
			
			// flags
			oContactComp.CopyFieldValue (""Personal Contact"",      ""N"");
			oContactComp.CopyFieldValue (""Suppress All Mailings"", ""Y"");
			oContactComp.CopyFieldValue (""Row Status"", ""Y"");

			oContactComp.SetFieldValue (""operation"", ""sync"");
		} // while (iComp.NextRecord ())

		/* Process the Sales Area Accounts */

		var e2knvvm = iKNA1MComp.GetIntComp (""E2KNVVM005"");
		var oSalesAreaAccountComp = oAccountComp.CreateIntComp (""SAP 4x Account Sales Area"", false);

		
		enumOrg: while( e2knvvm.NextRecord() )
		{
			/* Create ""Sales Area Account"" component in output message	*/
			oSalesAreaAccountComp.NewRecord ();

			oSalesAreaAccountComp.SetCopySource (e2knvvm);

			var SalesOrg = e2knvvm.GetFieldValue(""VKORG"");
			var DistChannel= e2knvvm.GetFieldValue(""VTWEG"");
			var DivCode = e2knvvm.GetFieldValue(""SPART"");


			var OrgID = GetSalesArea(SalesOrg, DistChannel, DivCode);

			if (OrgID != null) 	
			   oSalesAreaAccountComp.SetFieldValue(""Organization Id"", OrgID);
			else
			   EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+SalesOrg+"",""+DistChannel+"",""+DivCode+""""));
		   
		   	oSalesAreaAccountComp.SetFieldValue(""Integration Id"", oIntId);

			/* Check if sales area is marked as deleted */
			if ((e2knvvm.GetFieldValue (""LOEVM"") == ""X"") || (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X""))
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
//				continue enumOrg;
			}
			else
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", """");
			}
				
			/* Set language code */
			oSalesAreaAccountComp.SetFieldValue (""Language Code"", languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms"", ""INCO1"");
			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms Info"", ""INCO2"");
			oSalesAreaAccountComp.SetFieldValue (""Type"", TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_TYPE"", e2knvvm.GetFieldValue(""KDGRP"")));
				
			oSalesAreaAccountComp.CopyFieldValue (""Primary Fulfillment InvLoc ID"", ""VWERK"");
			oSalesAreaAccountComp.CopyFieldValue (""Payment Terms"", ""ZTERM"");
			oSalesAreaAccountComp.CopyFieldValue (""Price List Type"", ""PLTYP"");
			oSalesAreaAccountComp.SetFieldValue (""Shipping Conditions"", TheApplication().InvokeMethod (""LookupValue"", ""SHIPPING_CONDITION"", e2knvvm.GetFieldValue(""VSBED"")));
			// oSalesAreaAccountComp.CopyFieldValue (""Pricing Group Code"", ""KONDA"");

			/* Set currency code */
			oSalesAreaAccountComp.SetFieldValue (""Currency Code"", currencyLM.Translate (e2knvvm.GetFieldValue (""WAERS"")));

			/* Block Credit Flag */
			var e2knkkm = iKNA1MComp.GetIntComp(""E2KNKKM001"");
			var oCrdtCtlAreaComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Credit Control Area"", false);
			while (e2knkkm.NextRecord () )
			{
				oCrdtCtlAreaComp.NewRecord ();
				oCrdtCtlAreaComp.SetCopySource (e2knkkm);
				oCrdtCtlAreaComp.CopyFieldValue (""Credit Control Area Code"", ""KKBER"");
				if (e2knkkm.GetFieldValue(""CRBLB"") == ""X"") 
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""Y"");
				else
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""N"");
				
				oCrdtCtlAreaComp.SetFieldValue (""operation"", ""upsert"");
			}

			/* Primary Partner Relationships of Sales Area Accounts  */
			var e2knvpm = e2knvvm.GetIntComp (""E2KNVPM002"");
			var oShipToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"", false);	
			var oPayerPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"", false);
			var oBillToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"", false);
			var oSoldToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"", false);

			var FirstShipTo, FirstPayer, FirstBillTo;
			FirstShipTo = true;
			FirstPayer = true;
			FirstBillTo = true;
			enumPartner: while (e2knvpm.NextRecord () )
			{
				// Default Ship To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""WE"" )
				{
					oShipToPartnerComp.NewRecord ();
					oShipToPartnerComp.SetCopySource( e2knvpm );
					oShipToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oShipToPartnerComp.SetFieldValue (""Ship To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstShipTo) {
						FirstShipTo = false;
						oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oShipToPartnerComp.SetFieldValue (""operation"", ""sync"");
				
				}	
				// Default Payer Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RG"" )
				{
					oPayerPartnerComp.NewRecord ();
					oPayerPartnerComp.SetCopySource (e2knvpm);
					oPayerPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oPayerPartnerComp.SetFieldValue (""Payer Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstPayer) {
						FirstPayer = false;
						oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oPayerPartnerComp.SetFieldValue (""operation"", ""sync"");
					
				}
				// Default Bill To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RE"" )
				{
					oBillToPartnerComp.NewRecord ();
					oBillToPartnerComp.SetCopySource (e2knvpm);
					oBillToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oBillToPartnerComp.SetFieldValue (""Bill To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstBillTo) {
						FirstBillTo = false;
						oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oBillToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
				// Sold To Partner
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""AG"" )
				{
					oSoldToPartnerComp.NewRecord ();
					oSoldToPartnerComp.SetCopySource (e2knvpm);
					oSoldToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oSoldToPartnerComp.SetFieldValue (""Sold To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oSoldToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					oSoldToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
			}

			/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
			// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
			// findKNRZE: while (iComp.NextRecord ())
			// {
				// oSalesAreaAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
				/* only get first row */
				//break findKNRZE;
			//}
		  // Set operation to ""upsert"" since we are using the ""Execute"" method
		  oSalesAreaAccountComp.SetFieldValue (""operation"", ""sync"");
		} // ... while( e2knvvm.Ne...
	} // ... while (iIDOCObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function RequestCustomerNumber_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP 46C Internal Customer Number (BAPI Output))
    *     Export Parameters (output)
    * 	    CUSTOMERID
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Send or Receive SAP 46C Customer (Siebel 77))
    *     Integration Id, Location, Sync status data (oAccount)
    */

   /*
    * Set up EAI Input Message objects
    */
   var iBAPIObj;   // BAPI object instance
   var iExportComp; // BAPI Export Parameters

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;      // Siebel Account instance
   var oAccountComp;     // Account

   /*
    * Find and create top-level integration object
    */
   iBAPIObj = inputMsg.GetIntObj (""Account - Get SAP 46C Internal Customer Number (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iBAPIObj.NextInstance ())
   {
      /*
       * Create ""Account"" object
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component in output message
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iBAPIObj.GetPrimaryIntComp (""Export Parameters"");

      if (iExportComp.NextRecord ())
      {
      	 oAccountComp.SetCopySource  (iExportComp);
      	 oAccountComp.CopyFieldValue (""EAI Sync Error Text"", ""RETURN-MESSAGE"");
      	 var ErrorType = iExportComp.GetFieldValue (""RETURN-TYPE"");
      	 
      	 if (ErrorType != ""E"")
      	 {
      	 
 		 /*
      	  * Update ""Account"" component
      	  */
        	oAccountComp.CopyFieldValue (""Integration Id"", ""CUSTOMERID"");
        	var customerno = iExportComp.GetFieldValue (""CUSTOMERID"");
        	var timenow = Timestamp();
         	var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Created in Back Office"");
	     	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
	     	oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
	     	
    	
	     	/*
	     	 *	Get Address Info to create the location field with 
	     	 *     embedded customer number
	     	 */
			var AccBusObject = TheApplication().GetBusObject(""Account"");
		 	var AccBusComp   = AccBusObject.GetBusComp(""Account"");
		 
			 // Set View Mode to 3 (or AllView)
		 	AccBusComp.SetViewMode(3);  
		 
		 	AccBusComp.ClearToQuery();
    	 	AccBusComp.SetSearchSpec(""Id"", inputId);
			AccBusComp.ActivateField(""Location"");
			
		 	AccBusComp.ExecuteQuery();
		 	if(AccBusComp.FirstRecord())
			{
	  		 var city        = AccBusComp.GetFieldValue(""City"");
	  		 var location    = AccBusComp.GetFieldValue(""Location"");
	  		 
	  		 /*
	  		  *		Site
	  		  */
	  		 if (location == """")
	  		 {
	  		 	location = AccBusComp.GetFieldValue(""City"");
	  		 }
	  		 location += "" "" + customerno;
	  		 oAccountComp.SetFieldValue (""Location"", location );
			}
			  	 
	     	   	
	     }
      }
   } //   while (iCreateAccountObj.NextInstance ())
} //function RequestCustomerNumber_BAPIToSiebel"
function RequestCustomerNumber_SiebelToBAPI (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Account Object (Account - Send or Receive SAP 46C Customer (Siebel 77))
    *     Account (Account)
    *       
    *
    * Output Object's Integration Components:
    *   Account - Get SAP 46C Internal Customer Number (BAPI Input)
    */

	/* Set up EAI Lookup maps */
    var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account

   /*
    * Set up EAI Output Message objects
    */
   var oBAPIObj;    // BAPI object instance
   var oBAPIImportComp;  // BAPI Import parameters
   

   /*
    * Find and create top-level integration object
    */
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");
   oBAPIObj = outputMsg.CreateIntObj (""Account - Get SAP 46C Internal Customer Number (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create BAPI object in output message
       */
      oBAPIObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oBAPIImportComp = oBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
      while (iAccountComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iAccountComp.GetFieldValue (""Integration Id"") != """")
	       {
			var IntId = iAccountComp.GetFieldValue (""Integration Id"");
			EAIRaiseError(LocalizeMessage(""ERR_MSG_ACCOUNT_EXISTS,""+IntId+""""));//nbc
	       }
	      /*
	       *	Validate Address
	       */
	       
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      /*
	       * Return an error if no address is found
	       */
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }

         /*
          * Write ""Import Parameters"" component
          */
         oBAPIImportComp.NewRecord ();
         oBAPIImportComp.SetFieldValue (""QUANTITY"", ""1"");
   	     var acctGroup = iAccountComp.GetFieldValue(""Customer Account Group"");
	     oBAPIImportComp.SetFieldValue (""ACCOUNTGROUP"", acctGroupLM.Translate(acctGroup));
   
      } //while (iAccountComp.NextRecord ())
   } //while (iAccountObj.NextInstance ())
} //function RequestCustomerNumber_SiebelToBAPI"
function SendAccount_SiebelToDEBMAS05 (inputMsg, outputMsg)
{
	/* Input Objects' Integration Components						
	 *   Account Object (Account - Send or Receive SAP 46C Customer (Siebel 77))
	 *
	 *	Output Object's Integration Components:
	 *			Customer IDOC (Account - Send or Receive SAP 46C Customer (DEBMAS05))
	 */
	
	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Outbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Outbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Outbound"");
	var acctGrpLM  = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Outbound"");
	
	/* Set up EAI Input Message objects */
	var iAccountObj;    // Siebel Account instance
	var iAccountComp;   // Account
	var iAddrComp;      // Address
	var iContactComp;   // Contact

	/* Set up EAI Output Message objects */
	var oIDOCObj;   // IDOC instance
	var oIDOCComp;  // top level IDOC segment
	var oKNA1MComp; // IDOC Customer Header
	var oComp;      // for reading child components

	/* Find and create top-level integration object	*/
	iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 46C Customer (Siebel 77)"");
	oIDOCObj =  outputMsg.CreateIntObj (""Account - Send or Receive SAP 46C Customer (DEBMAS05)"");

	/* Misc set up	*/
	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only
	var custAccntGrp;
    var currencyCode;
    var ctr = 0;
    var countryCode;
    var regCode;
    var sapCode;
	
	/* Read int object instances from EAI message */
	enumObj: while (iAccountObj.NextInstance ())
	{
		/* Read root Account component */
		iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
		if( !iAccountComp.NextRecord() ) continue enumObj;
		
		/*
         * Return an error if Integration Id is not null
         */
			if (iAccountComp.GetFieldValue (""Integration Id"") == """")
		    {
				var errMsg = iAccountComp.GetFieldValue (""EAI Sync Error Text"");
				EAIRaiseError ( errMsg );
	       	}

		/* Create ""IDOC"" object	*/
		oIDOCObj.NewInstance ();

		/* Create ""IDOC"" component in output message */
		oIDOCComp = oIDOCObj.CreatePrimaryIntComp (""Idoc Segments"");
		oIDOCComp.NewRecord ();
		oKNA1MComp = oIDOCComp.CreateIntComp (""E2KNA1M005"",false);
		oKNA1MComp.NewRecord ();	
		oKNA1MComp.SetCopySource (iAccountComp);

		/* Set Integration Id, Name	and Account Group*/
		oKNA1MComp.CopyFieldValue (""KUNNR"", ""Integration Id"");
		oKNA1MComp.CopyFieldValue (""NAME1"", ""Name"");
		oKNA1MComp.SetFieldValue (""KTOKD"", acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group"")));

		/* Set location	*/
		// oKNA1MComp.CopyFieldValue (""ORT01"", ""Location"");
	
		/* Account Status */
		// oKNA1MComp.CopyFieldValue (""AUFSD"", ""Account Status"" );
		oKNA1MComp.SetFieldValue (""LOEVM"", """");
		if (iAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
			oKNA1MComp.SetFieldValue (""LOEVM"", ""X""); 

		/* Primary Industry */
		// oKNA1MComp.CopyFieldValue (""BRSCH"", ""Primary Industry Id"");

		/* Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet) */
		// oKNA1MComp.CopyFieldValue (""STCEG"", """" );

		/* Search Term */
		oKNA1MComp.CopyFieldValue (""SORTL"", ""Name"");			

		/* Transportation Zone */
		// oKNA1MComp.SetFieldValue (""LZONE"", ""0000000001"");			

		/* Set language code */
		oKNA1MComp.SetFieldValue (""SPRAS"", languageLM.Translate (iAccountComp.GetFieldValue (""Language Code"")));
		
		/* Set main Phone/FAX numbers */
		oKNA1MComp.CopyFieldValue (""TELF1"", ""Main Phone Number"" );
		oKNA1MComp.CopyFieldValue (""TELFX"", ""Main Fax Number"" );
		
	
		/* Read ""KNVKM"" component */
		iContactComp = iAccountComp.GetIntComp (""Contact"");
		oComp = oKNA1MComp.CreateIntComp (""E2KNVKM"", false);
		while (iContactComp.NextRecord ())
		{
			/* Write ""Contact"" component */

			oComp.NewRecord ();
			oComp.SetCopySource  (iContactComp);
			// oComp.CopyFieldValue (""PARNR"", ""Integration Id"");
			// oComp.CopyFieldValue (""PARNR"", ""Employee Number"");

			/* Set First Name */
			oComp.CopyFieldValue (""NAMEV"", ""First Name"");

			/* Set Last name */
			oComp.CopyFieldValue (""NAME1"", ""Last Name"");

			/* Set job title */
			oComp.CopyFieldValue (""TITEL_AP"", ""Job Title"");
			oComp.CopyFieldValue (""ANRED"", ""M/M"");
			oComp.CopyFieldValue ( ""TELF1"", ""Work Phone #"");
		} // while (iContactComp.NextRecord ())

		/* Write ""Address"" component */
		iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
		while (iAddrComp.NextRecord () )
		{
			oKNA1MComp.SetCopySource(iAddrComp);
			if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
			{

			// Set telephone numbers
			// oKNA1MComp.CopyFieldValue (""TELF1"", ""Phone Number"" );
			// oKNA1MComp.CopyFieldValue (""TELFX"", ""Fax Number"" );

			// Set Street address
			oKNA1MComp.CopyFieldValue  (""STRAS"", ""Street Address"");
			oKNA1MComp.CopyFieldValue (""ORT01"", ""City"");
			countryCode = countryLM.Translate (iAddrComp.GetFieldValue (""Country""));
			oKNA1MComp.SetFieldValue (""LAND1"", countryLM.Translate (iAddrComp.GetFieldValue (""Country"")));
			
// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing 
			regCode = regCodeLM.Translate (iAddrComp.GetFieldValue (""State""));	//12-90S337
			sapCode = regCode.substring(3,5);									//12-90S337
			oKNA1MComp.SetFieldValue (""REGIO"", sapCode );						//12-90S337
	
			oKNA1MComp.CopyFieldValue (""PSTLZ"", ""Postal Code"" );
			
		// Set operation to ""upsert"" since we are using the ""Execute"" method.
			oKNA1MComp.SetFieldValue (""operation"", ""upsert"");
			}
		}
		

/* Process Sales Area Account */

		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
		var e2knvvm = oKNA1MComp.CreateIntComp (""E2KNVVM005"", false);
			
		enumOrg: while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Create ""Account"" component in output message	*/

			e2knvvm.NewRecord ();
			e2knvvm.SetCopySource ( iSalesAreaAccountComp );


			/* Set sales organization */

			e2knvvm.CopyFieldValue( ""VKORG"", ""Back Office Sales Organization"");
			e2knvvm.CopyFieldValue( ""VTWEG"", ""Back Office Distribution Channel"");
			e2knvvm.CopyFieldValue( ""SPART"", ""Back Office Sales Area Division Code"");
			
			/* Account Status (for Sales Area Accounts) */
			// e2knvvm.CopyFieldValue (""AUFSD"", ""Account Status"");
			if (iSalesAreaAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
				e2knvvm.SetFieldValue( ""LOEVM"", ""X"");

			/* Freight Terms a.k.a Incoterms 1 */
			// e2knvvm.CopyFieldValue (""INCO1"", ""Freight Terms"");

			/* Freight Terms Info a.k.a Incoterms 2 */
			// e2knvvm.CopyFieldValue (""INCO2"", ""Freight Terms Info"");

			/* Primary Fullfilment Inventory Location Id  */
			// e2knvvm.CopyFieldValue (""VWERK"", ""Primary Fulfillment InvLoc ID"");

			/* Payment Terms */
			// e2knvvm.CopyFieldValue (""ZTERM"", ""Payment Terms"");

			/* Price List Type */
			// e2knvvm.CopyFieldValue (""PLTYP"", ""Price List Type"");

			/* Account Type / Customer Group  */
               e2knvvm.SetFieldValue( ""KDGRP"", iSalesAreaAccountComp.GetFieldValue(""Type"" ));
			
			/* Customer Stats Group */
			   e2knvvm.SetFieldValue (""VERSG"", ""/"");

			// e2knvvm.SetFieldValue (""PERFK"", ""US"");

			/* Sales District Code */
			// e2knvvm.SetFieldValue (""BZIRK"", ""CENTRE"");			

			/* Pricing Group Code */
			// e2knvvm.SetFieldValue (""KONDA"", ""02"");

			/* Pricing Procedure */
 			e2knvvm.SetFieldValue (""KALKS"", ""/"");

			/* Shipping Conditions */
			var shpCond = iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions"");
			if ( shpCond == """" )
				e2knvvm.SetFieldValue (""VSBED"", ""02""); // Change Me
			else
				e2knvvm.SetFieldValue (""VSBED"", iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions""));

			/* Set currency code */
			var sCurCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
			if ( sCurCode == """")
				currencyCode = TheApplication().CurrencyCode();
			else
				currencyCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
				
			e2knvvm.SetFieldValue (""WAERS"", currencyLM.Translate (currencyCode));

			/* Set Block Credit Flag */
//			var e2knkkm = oKNA1MComp.CreateIntComp(""E2KNKKM001"",false);
//			var iCrdtCtlAreaComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Credit Control Area"");
//			while (iCrdtCtlAreaComp.NextRecord () )
//			{
//				e2knkkm.NewRecord ();
//				e2knkkm.SetCopySource (iCrdtCtlAreaComp);
//				e2knkkm.CopyFieldValue (""KKBER"", ""Credit Control Area Code"");
//				e2knkkm.CopyFieldValue (""CRBLB"", ""Block Credit Flag"");
//				e2knkkm.SetFieldValue (""operation"", ""upsert"");
//			}

			/* Tax classification */
			// var iTaxCode = e2knvvm004.CreateIntComp (""E2KNVIM"",false);
			// iTaxCode.NewRecord ();
			// iTaxCode.SetFieldValue (""TAXKD"",""0"");
			
			/* Set Primary Partner Relationships of Sales Area Accounts */
			var acctGrp = acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group""));
			var intId   = iAccountComp.GetFieldValue (""Integration Id"");
			if ( acctGrp == ""0001"" || acctGrp == ""0002"" )
			{
			
			var e2knvpm = e2knvvm.CreateIntComp (""E2KNVPM002"",false);

			var iShipToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"");	
			var iPayerPartnerComp  = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"");
			var iBillToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"");
			var iSoldToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"");

			var i = 0;
			enumShipToPartner: while (iShipToPartnerComp.NextRecord () )
			{
				// Default Ship To Partner 
				if ( iShipToPartnerComp.GetFieldValue(""Ship To Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource( iShipToPartnerComp );
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
   					e2knvpm.SetFieldValue (""PARVW"", ""WE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 )
			{
				e2knvpm.NewRecord ();
		   		e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""WE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			if ( acctGrp == ""0002"" )  goto SoldToPartner;

			i = 0;
			enumPayerPartner: while (iPayerPartnerComp.NextRecord () )
			{
				// Default Payer Partner 
				if ( iPayerPartnerComp.GetFieldValue(""Payer Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iPayerPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RG"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}
	
			i = 0;
			enumBillToPartner: while (iBillToPartnerComp.NextRecord () )
			{
				// Default Bill To Partner 
				if ( iBillToPartnerComp.GetFieldValue(""Bill To Partner Function"")  )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iBillToPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			SoldToPartner:
			i = 0;
			enumSoldToPartner: while (iSoldToPartnerComp.NextRecord () )
			{
				// Default Sold To Partner 
				if ( iSoldToPartnerComp.GetFieldValue(""Sold To Partner Function"")  )
				{
					if (( iSoldToPartnerComp.GetFieldValue(""Integration Id"") != intId )) 
					{	
						e2knvpm.NewRecord ();
						e2knvpm.SetCopySource (iSoldToPartnerComp);
						e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
						e2knvpm.SetFieldValue (""PARVW"", ""AG"");
						e2knvpm.SetFieldValue (""operation"", ""upsert"");
						i++;
					}
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""AG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			/* Set operation to ""upsert"" since we are using the ""Execute"" method. */
			e2knvvm.SetFieldValue (""operation"", ""upsert"");
			}

		} // enumOrg: while( iSalesAreaAccountComp.NextRecord() )
		/* Set Company Code & Parent Account Id	*/
		// var oCoCodeComp = oKNA1MComp.CreateIntComp (""E2KNB1M005"",false);
		// oCoCodeComp.NewRecord ();
		// oCoCodeComp.SetCopySource(iAccountComp);
		// oCoCodeComp.CopyFieldValue (""KNRZE"", ""Parent Account Integration Id"");
		// oCoCodeComp.SetFieldValue (""BUKRS"", ""0010"");
		// oCoCodeComp.SetFieldValue (""AKONT"", ""121000"");

	} // ... while (iAccountObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"
function Timestamp()
{
	var d = Date.fromSystem(Clib.time());

	// Return date in the format MM/DD/YYYY HH:MM:SS
	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
	  d.getHours(), d.getMinutes(), d.getSeconds());
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function GetSAPOrderList_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP 46C Order List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Get SAP 46C Order List (MO))
    *     Account (oAccount)
    *       Get List for Account Output
    *       Get List for Account Header
    *         Get List for Account Item
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;   // BAPI Order instance
   var iGLExportComp; // BAPI Export Parameters
   var iGLHeaderComp; // BAPI Order Header
   var iGLItemComp;   // BAPI Order Item

   // Store inputId (ROW_ID) to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;   // Siebel Order instance
   var oAccountComp;  // Account
   var oGLOutputComp; // Get List Output
   var oGLHeaderComp; // Get List Header
   var oGLItemComp;   // Get List Item

   var theApp = TheApplication();

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Get SAP 46C Order List (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Get SAP 46C Order List (MO)"");

   /*
    * Read int object instances from EAI message
    */
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Account"" object in output message
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);
      
      // Get Primary Sales Area of the account
      var SalesOrg;
      var SalesChn;
	  var SalesDiv;
	  var AccBusObj = theApp.GetBusObject(""Account"");
	  var AccBusCmp = AccBusObj.GetBusComp(""Account"");
	  
	  // Set View Mode to 3 (or AllView)	  
	  AccBusCmp.SetViewMode(3);  
		
	  AccBusCmp.ClearToQuery();
      AccBusCmp.SetSearchSpec(""Id"", inputId);
      AccBusCmp.ActivateField(""Primary Organization Id"");
            	
	  AccBusCmp.ExecuteQuery();
	  
		
	  if(AccBusCmp.FirstRecord())
	  {
	     var PrimOrg = AccBusCmp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = theApp.GetBusObject(""Organizations"");
	     var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
	     
	     
	     // Set View Mode to 3 (or AllView)		
		 OrgBusCmp.SetViewMode(3);  	
		 
	     OrgBusCmp.ClearToQuery();
         OrgBusCmp.SetSearchSpec(""Id"", PrimOrg);
         OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	     OrgBusCmp.ActivateField(""Back Office Distribution Channel"");
	     OrgBusCmp.ActivateField(""Back Office Division"");
	
	     OrgBusCmp.ExecuteQuery();
		 
		 // get saleOrg, distChnl and division of the primary SA
	     if(OrgBusCmp.FirstRecord())
	     {
		    var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
		    var SalesChn = OrgBusCmp.GetFieldValue(""Back Office Distribution Channel"");
		    var SalesDiv = OrgBusCmp.GetFieldValue(""Back Office Division"");
	     }
//	     else
//	     {
//		  	EAIRaiseError(""Unable to get sales area info for the primary organization"");
//	     }
	  }
//	  else
//	  {
//	  	EAIRaiseError(""Invalid account"");
//	  }
      

      /*
       * Read ""Export Parameters"" component
       */
      iGLExportComp = iGLOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      
      oGLOutputComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Output"", oAccountComp);
      if (iGLExportComp.NextRecord ())
      {
      	
         /*
          * Write ""Get List for Account Output"" component
          */
         oGLOutputComp.NewRecord ();
         oGLOutputComp.SetCopySource  (iGLExportComp);
         oGLOutputComp.SetFieldValue  (""Input Id"",          inputId);
         oGLOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oGLOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oGLOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");

         /*
          * Read ""Order Header"" component to 
          */
         iGLHeaderComp = iGLExportComp.GetIntComp (""Order Header"");
         oGLHeaderComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Header"", oAccountComp);
         while (iGLHeaderComp.NextRecord ())
        /* 
       	 * Validate Sales area
       	 */
      	 {
      		var iSalesOrg = iGLHeaderComp.GetFieldValue(""SALES_ORG""); 
       	 	var iSalesChn = iGLHeaderComp.GetFieldValue(""DISTR_CHAN""); 
       	 	var iSalesDiv = iGLHeaderComp.GetFieldValue(""DIVISION""); 
      
	      	if ((SalesOrg == iSalesOrg) && (SalesChn == iSalesChn) && (SalesDiv == iSalesDiv))  
			{
			   oGLHeaderComp.NewRecord ();
			   oGLHeaderComp.SetCopySource  (iGLHeaderComp);
			   oGLHeaderComp.SetFieldValue  (""Input Id"",         inputId);
			   oGLHeaderComp.CopyFieldValue (""Currency"",             ""CURRENCY"");
			   oGLHeaderComp.CopyFieldValue (""Distribution Channel"", ""DISTR_CHAN"");
			   oGLHeaderComp.CopyFieldValue (""Division"",             ""DIVISION"");
			   oGLHeaderComp.CopyFieldValue (""Order Date"",           ""DOC_DATE"");
			   oGLHeaderComp.CopyFieldValue (""Order Number"",         ""SD_DOC"");
			   oGLHeaderComp.CopyFieldValue (""Order Status"",         ""DOC_STATUS"");
			   oGLHeaderComp.CopyFieldValue (""Order Type"",           ""DOC_TYPE"");
			   oGLHeaderComp.CopyFieldValue (""Purchase Order"",       ""PURCH_NO"");
			   oGLHeaderComp.CopyFieldValue (""Sales Organization"",   ""SALES_ORG"");
			   oGLHeaderComp.CopyFieldValue (""Sold To Customer"",     ""SOLD_TO"");
	
	           /*
	            * Read the ""Order Item"" component
	            */
	           // to ""Get List for Account Item"" component
			   iGLItemComp = iGLHeaderComp.GetIntComp (""Order Item"");
			   oGLItemComp = oGLHeaderComp.CreateIntComp (""Account - Get SAP Order List Item"", oGLHeaderComp);
			   while (iGLItemComp.NextRecord ())
			   {
				  oGLItemComp.NewRecord ();
				  oGLItemComp.SetCopySource  (iGLItemComp);
				  oGLItemComp.SetFieldValue  (""Input Id"",         inputId);
				  oGLItemComp.CopyFieldValue (""Item Number"",          ""ITM_NUMBER"");
				  oGLItemComp.CopyFieldValue (""Material Part Number"", ""MATERIAL"");
				  oGLItemComp.CopyFieldValue (""Material Short Text"",  ""SHORT_TEXT"");
				  oGLItemComp.CopyFieldValue (""Net Price"",            ""NET_PRICE"");
				  oGLItemComp.CopyFieldValue (""Net Value"",            ""NET_VALUE"");
				  oGLItemComp.CopyFieldValue (""Sales Unit"",           ""SALES_UNIT"");
			   }
            }
         }
      }
   }
}
function GetSAPOrderList_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Account Object (Account - Get SAP 46C Order List (MO))
    *     Account (iAccount)
	 *       Get List for Account Header
    *
    * Output Object's Integration Components:
    *   BAPI Import (Account - Get SAP 46C Order List (BAPI Input))
    *     Import Parameters (output)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var theApp = TheApplication(); // nbc
   var iAccountObj;    // Siebel Account instance
   var iAccountComp;   // Account
	var iHeaderComp;    // Account Header

   /*
    * Set up EAI Output Message objects
    */
   var oGLObj;         // BAPI instance
   var oGLImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */

   iAccountObj = inputMsg.GetIntObj (""Account - Get SAP 46C Order List (MO)"");
   oGLObj = outputMsg.CreateIntObj (""Account - Get SAP 46C Order List (BAPI Input)"");

   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create ""Get List for Account"" object
       */
      oGLObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oGLImportComp = oGLObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iAccountComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGLImportComp.NewRecord ();
         oGLImportComp.SetCopySource  (iAccountComp);

	     var intId = iAccountComp.GetFieldValue( ""Integration Id"" );
	     var fromDate = iAccountComp.GetFieldValue( ""Back Office Order Query Start  Dt"" ); //nbc
	     var toDate = iAccountComp.GetFieldValue( ""Back Office Order Query End  Dt"" ); //nbc

         oGLImportComp.SetFieldValue  (""CUSTOMER_NUMBER"",intId );
         oGLImportComp.SetFieldValue  (""MATERIAL"", """");
         oGLImportComp.SetFieldValue  (""TRANSACTION_GROUP"", ""0"");
         oGLImportComp.SetFieldValue  (""PURCHASE_ORDER"", """"); // ""Peter 1"";
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE"", fromDate );    // Empty string means ""00000000""
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE_TO"",  toDate ); // Empty string means ""00000000""

		 // Read the primary sales area
	     var primOrgId = iAccountComp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = TheApplication().GetBusObject(""Organizations"");
		 var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
		 
		 // Set View Mode to 3 (or AllView)
		 OrgBusCmp.SetViewMode(3);  
		 
		 OrgBusCmp.ClearToQuery();
    	 OrgBusCmp.SetSearchSpec(""Id"", primOrgId);
    	 OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	 
	
		 OrgBusCmp.ExecuteQuery();
		 if(OrgBusCmp.FirstRecord())
		 {
	  		 var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
	  		 // Write ""Import Parameters"" component
			 oGLImportComp.SetFieldValue( ""SALES_ORGANIZATION"", SalesOrg );
		 }
		}
   }
}
function ImportSAPOrder_GetSAPOrderListToSiebelOrder (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Import Get List for Account (Account - Import SAP 46C Order (Get SAP Order List) (MO))
    *     Get List for Account Header
    *
    * Output Object's Integration Components:
    *   Import (Account - Import SAP 46C Order (Siebel Order) (MO))
    *     Order (oOrder)
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;  // Get List instance
   var iGLOrderComp; // Get List Order

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oOrderOrgComp;  // Order Organization

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Import SAP 46C Order (Get SAP Order List) (MO)"");
   oOrderObj = outputMsg.CreateIntObj (""Account - Import SAP 46C Order (Siebel Order) (MO)"");

   /*
    * Read int object instances from EAI message
    */
    
   
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();
            	
      /*
       * Read ""Get List Order"" component
       */
      iGLOrderComp = iGLOrderObj.GetPrimaryIntComp (""Get List for Account Header"");
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      
      while (iGLOrderComp.NextRecord ())
      {
         /*
          * Write ""Order"" component
          */
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iGLOrderComp);
         
         var SiebOrdNo = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         if (SiebOrdNo == """")												//xx
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue(""Order Number"");		//xx
         }																	//xx
         else
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         }																	//xx
 		 
 		 oOrderComp.SetFieldValue (""Order Number"",               OrdNumber);//xx
 		             
 		 var oTypeSAP = orderTypeLM.Translate (iGLOrderComp.GetFieldValue (""Order Type""));
		 var oType    = TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_TYPE"", oTypeSAP);
		 oOrderComp.SetFieldValue  (""Order Type"",              oType);
         oOrderComp.CopyFieldValue (""Order Date"",             ""Order Date"");
         oOrderComp.CopyFieldValue (""Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Integration Id"",         ""Order Number"");
 		 oOrderOrgComp = oOrderComp.CreateIntComp(""Order Entry - Orders_Organization"");

	 	oOrderOrgComp.NewRecord();
	 	oOrderOrgComp.SetCopySource  (iGLOrderComp);
		
	 	oOrderOrgComp.SetFieldValue ( ""IsPrimaryMVG"",			""Y"");
        oOrderOrgComp.CopyFieldValue ( ""Organization Id"",		""SAP Organization Id (MO)"");
		
			
		
      }
   }
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var result = EAIExecuteMap (MethodName, Inputs, Outputs);

	return result;
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function CheckSAPCustomer_CallBAPI (inputMsg, outputMsg) { 
  /*  Referenced in workflow Account - Check SAP 46C Customer
    * Input Object:
    *  Account - Send or Receive SAP 47 Customer (Siebel 77)
    *       
    *
    * Output Object's Integration Components:
    *  Account - Send or Receive SAP 47 Customer (Siebel 77)
    *   set property ""customerExists"" to true or false in outputMsg
    *  if customer does not exist, set ""EAI Sync Error Text""
    */

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
   *  temporary variables
   */
   var customerExists = false;
   var errorType;

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account
   var oAccountObj;
   var oAccountComp;
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");
   
   
   /*
   *   Create new property sets for BAPI call to SAP and create adapter bus service
   */   
   var inputBAPI = TheApplication().NewPropertySet();
   var outputBAPI = TheApplication().NewPropertySet();
   var inputBAPIMsg = EAICreateIntMsgOut (inputBAPI);
  
   
   var iBAPIObj = inputBAPIMsg.CreateIntObj (""Account - Check SAP 47 Customer Existence (BAPI Input)"");

   inputBAPIMsg.SetArgument (""OutputIntObjectName"", ""Account - Check SAP 47 Customer Existence (BAPI Output)"");
   inputBAPIMsg.SetArgument (""SAPAutoError"",""False"");

   var bapiAdapter = TheApplication().GetService(""EAI SAP BAPI Adapter"");
   
   var oBAPIObj;
   var oBAPIExportComp;
   var iBAPIImportComp;
  
    
   /*
    * create top-level integration object
    */
   
   if (iAccountObj.NextInstance ())
   {
     /*
      * Create BAPI object in output message
      */
      iBAPIObj.NewInstance ();
      

      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      iBAPIImportComp = iBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
 
       if (iAccountComp.NextRecord ())
      {
	      var IntId = iAccountComp.GetFieldValue (""Integration Id"");
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }
       /*
        * Write ""Import Parameters"" component
        */
         iBAPIImportComp.NewRecord ();
         iBAPIImportComp.SetFieldValue (""CUSTOMERNO"", IntId);
         /*
         *  Loop over sales orgs, call BAPI for each until one suceeds
         */
		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
			
		while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Copy sales org info	*/

			iBAPIImportComp.SetCopySource ( iSalesAreaAccountComp );
			iBAPIImportComp.CopyFieldValue( ""SALES_ORGANIZATION"", ""Back Office Sales Organization"");
			iBAPIImportComp.CopyFieldValue( ""DISTRIBUTION_CHANNEL"", ""Back Office Distribution Channel"");
			iBAPIImportComp.CopyFieldValue( ""DIVISION"", ""Back Office Sales Area Division Code"");
     
            // call BAPI
            bapiAdapter.InvokeMethod (""Execute"", inputBAPI, outputBAPI);
            
            // test output
           oBAPIExportComp = ((outputBAPI.GetChild(0)).GetChild(0)).GetChild(0);

           errorType = oBAPIExportComp.GetProperty (""RETURN-TYPE"");
               
           if (errorType != ""E"")
           {
              customerExists = true;
              
              break;
           }
           outputBAPI.Reset();
         
        } // endloop iSalesAreaAccountComp.NextRecord()
        
      } // endif iAccountComp.NextRecord()
   } // endif iAccountObj.NextInstance()
   
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");
   oAccountObj.NewInstance ();
   oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
   oAccountComp.NewRecord ();
   // Set ""Id"" so Siebel Adapter can synchronize
   oAccountComp.SetFieldValue (""Id"", inputId);
   
   if (customerExists)
   {
      outputMsg.SetArgument(""Customer Exists"", ""True"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"",  """");
   }
   else
   {    
      var output = LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP1"")+"" ""+  	 
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP2"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP3"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP4"");
      outputMsg.SetArgument(""Customer Exists"", ""False"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"", output);
   }
   
 } // end function"
function GetAccountName (Int_ID)
{// referenced by script ReceiveAccount_47IDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", Int_ID);
	AccBusComp.ActivateField(""Name"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Name"");
	}
      	else
           return null;
}
function GetAccountStatus (oIntId)
{ // referenced by script ReceiveAccount_47IDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", oIntId);
	AccBusComp.ActivateField(""Account Status"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Account Status"");
	}
      	else
           return null;
}
function GetSalesArea (SalesOrg, DistChannel, DivCode)
{ // referenced by script ReceiveAccount_47IDOCToSiebel
	var OrgBusObject = TheApplication().GetBusObject(""Organizations"");
	var SABusComp = OrgBusObject.GetBusComp(""Organization"");
	
	SABusComp.SetViewMode(3);  // All Mode
		
	SABusComp.ClearToQuery();
    SABusComp.SetSearchSpec(""Back Office Sales Organization"", SalesOrg);
    SABusComp.SetSearchSpec(""Back Office Distribution Channel"", DistChannel);
    SABusComp.SetSearchSpec(""Back Office Division"", DivCode);

//	SABusComp.ActivateField(""Organization Id"");
	SABusComp.ActivateField(""Party Id"");
	
	SABusComp.ExecuteQuery();
	
	if(SABusComp.FirstRecord())
	{
//	   return SABusComp.GetFieldValue(""Organization Id"");
	   return SABusComp.GetFieldValue(""Party Id"");
	}
      else
         return null;
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function ReceiveAccount_47IDOCToSiebel (inputMsg, outputMsg)
{ // referenced by workflow Account - Receive SAP 47 Customer
	/* Input Objects' Integration Components	
	*   Account - Send or Receive SAP 47 Customer (DEBMAS05)			
	*     E2KNA1M005, E2KNVKM, E2DNVVM006, E2KNKKM001, E2KNVPM002
	* Output Object's Integration Components:
	*  Account - Send or Receive SAP 47 Customer (Siebel 77)
	*   Account
	*   Contact
	*   Business Address
	*/

	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Inbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Inbound"");
	var defaultOrgLM = EAIGetValueMap (""Default Org"", ""Siebel Inbound"");
	var undefinedOrgLM = EAIGetValueMap (""Undefined SAP Org"", ""Siebel Inbound"");
	var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Inbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Inbound"");

	/* Set up EAI Input Message objects */
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iKNA1MComp; // IDOC Customer Header
	var iComp;      // for reading child components

	/* Set up EAI Output Message objects */
	var oAccountObj;    // Siebel Account instance
	var oAccountComp;   // Account
	var oAddrComp;      // Address
	var oContactComp;   // Contact

	var oCustAcctGrp;	// Customer Account Group
	var oIntId;			// SAP Customer Number
	var oAcctSts;		// Account Status
	var regCode;        // SAP Country + Region Code	(12-90S337)
	var sapCode;        // SAP Region Code				(12-90S337)
	var osiebReg;       // Siebel Region 				(12-90S337)
	
	var AcctIntId       // Account Integration Id for Contact (12-C34KYN)
	
	/* Find and create top-level integration object */
	iIDOCObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 47 Customer (DEBMAS05)"");
	oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");

	/* Misc set up */
//	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only

	/* Read int object instances from EAI message */
	enumObj: while (iIDOCObj.NextInstance ())
	{
		/* Read virtual root component that IDOC RFC Adapter populates */
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		if( !iIDOCComp.NextRecord() ) continue enumObj;   // TODO: Root component is missing - log an error???

		/* Read ""KNA1M"" component */
		iKNA1MComp = iIDOCComp.GetIntComp (""E2KNA1M005"");
		if( !iKNA1MComp.NextRecord() ) continue enumObj;

		/* Create ""Account"" object */
		oAccountObj.NewInstance ();

		/* Create ""Account"" component in output message */
		oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
		oAccountComp.NewRecord ();	
		oAccountComp.SetCopySource (iKNA1MComp);
		
		/* Set Integration Id and Name */
		oIntId = iKNA1MComp.GetFieldValue (""KUNNR"");
		var Name = iKNA1MComp.GetFieldValue (""NAME1"");
		
		oAccountComp.CopyFieldValue (""Integration Id"", ""KUNNR"");
		oAccountComp.CopyFieldValue (""Name"",           ""NAME1"");
		
		AcctIntId = oIntId ;  // Account Integration Id for Contact (12-C34KYN)
		
		oCustAcctGrp = acctGroupLM.Translate (iKNA1MComp.GetFieldValue (""KTOKD""));
		var AcctGrp = TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_GROUP_TYPE"", oCustAcctGrp);
		oAccountComp.SetFieldValue (""Customer Account Group"", AcctGrp);

		/* Set location to ""<City> KUNNR1"" If <City> is null, put ""No City"" */
		var location = iKNA1MComp.GetFieldValue (""ORT01"");
		if (location == null) location = ""No City"";
		location += "" "" + iKNA1MComp.GetFieldValue (""KUNNR"");
		oAccountComp.SetFieldValue (""Location"",   location);

		/* Check if customer is Marked for Deletion */
		if (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X"") 
		{
			oAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
		}
		else
		{
			oAcctSts = GetAccountStatus (oIntId);
			if (oAcctSts == ""Marked For Deletion"")
				oAccountComp.SetFieldValue (""Account Status"", ""Active"");
			else
				oAccountComp.SetFieldValue (""Account Status"", oAcctSts);
		}

		/* Set telephone numbers */
		oAccountComp.CopyFieldValue (""Main Phone Number"", ""TELF1"");
		oAccountComp.CopyFieldValue (""Main Fax Number"",   ""TELFX"");

		/* Set other fields ; Defaults from buscomp:*/
		oAccountComp.CopyFieldValue (""Row Status"", ""Y"");

		/* Set fields for SAP 4x */
		oAccountComp.CopyFieldValue (""Primary Industry Id"", ""BRSCH"");

		// Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet)
		// oAccountComp.CopyFieldValue ("""", ""STCEG"");
		
		oAccountComp.SetFieldValue (""Language Code"",languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

		/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
		// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
		// findKNRZE: while (iComp.NextRecord ())
		// {
			//oAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
			/* only get first row */
			//break findKNRZE;
		// }
			
		var timenow = Timestamp();
		var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Sync from Back Office"");
	   	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
		oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
			
		// Set operation to ""    "" since we are using the ""Execute"" method.
		oAccountComp.SetFieldValue (""operation"", ""sync"");
		
		/* Write ""Address"" component */
		oAddrComp = oAccountComp.CreateIntComp (""Account_Business Address"", false);
		oAddrComp.NewRecord ();
		oAddrComp.SetCopySource (iKNA1MComp);
		oAddrComp.CopyFieldValue (""Integration Id"", ""KUNNR"");

		// Set Street address
		var stras = iKNA1MComp.GetFieldValue (""STRAS""); // Street address
		var pfach = iKNA1MComp.GetFieldValue (""PFACH""); // PO Box
		var street;

		if (stras == """" && pfach == """") 	street = ""None"";
		else if (stras != """" && pfach == """")street = stras;
		else if (stras != """" && pfach != """")street = stras + "" P.O. Box "" + pfach;
		else if (stras == """" && pfach != """")street = ""P.O. Box "" + pfach;

		oAddrComp.SetFieldValue  (""Street Address"", street);
		oAddrComp.CopyFieldValue (""City"",    ""ORT01"", ""None"", ""None"");
		oAddrComp.SetFieldValue  (""Country"", countryLM.Translate (iKNA1MComp.GetFieldValue (""LAND1"")));
		var x = 0; x += 1; //temporarily fix until operation synchronize works
		var AddrName = street + x + ', ' + iKNA1MComp.GetFieldValue (""ORT01"") + ', ' + iKNA1MComp.GetFieldValue (""REGIO"") ;
		oAddrComp.SetFieldValue (""Address Name"", AddrName); 

// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing
		sapCode  = iKNA1MComp.GetFieldValue (""REGIO"");	//12-90S337
		regCode  = iKNA1MComp.GetFieldValue (""LAND1"");	//12-90S337
		regCode  = regCode + ""_"" + sapCode;				//12-90S337
		osiebReg = regCodeLM.Translate (regCode);		//12-90S337
		var sRegion = TheApplication().InvokeMethod (""LookupValue"", ""STATE_ABBREV"", osiebReg);	//12-90S337
		oAddrComp.SetFieldValue (""State"",    sRegion);	//12-90S337
				
		oAddrComp.CopyFieldValue (""Postal Code"", ""PSTLZ"");
		oAddrComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
		oAddrComp.SetFieldValue (""operation"", ""sync"");

		/* Read ""KNVKM"" component */
		iComp   = iKNA1MComp.GetIntComp (""E2KNVKM"");
		oContactComp = oAccountComp.CreateIntComp (""Contact"", false);
		while (iComp.NextRecord ())
		{
			/* Write ""Contact"" component */
			oContactComp.NewRecord ();
			oContactComp.SetCopySource  (iComp);
			oContactComp.CopyFieldValue (""Integration Id"", ""PARNR"");
			oContactComp.CopyFieldValue (""Employee Number"", ""PARNR"");
			
			// Set First Name
			oContactComp.CopyFieldValue (""First Name"", ""NAMEV"", ""No First Name"", ""No First Name"");
			// Set Last name
			oContactComp.CopyFieldValue (""Last Name"", ""NAME1"");

			// Set job title
			oContactComp.CopyFieldValue (""Job Title"",    ""TITEL_AP"");
			oContactComp.CopyFieldValue (""M/M"",          ""ANRED"");
			oContactComp.CopyFieldValue (""Work Phone #"", ""TELF1"");
			
			// Account Integration Id for Contact (12-C34KYN)
			oContactComp.SetFieldValue ( ""Account Integration Id"", AcctIntId );
			
			// flags
			oContactComp.CopyFieldValue (""Personal Contact"",      ""N"");
			oContactComp.CopyFieldValue (""Suppress All Mailings"", ""Y"");
			oContactComp.CopyFieldValue (""Row Status"", ""Y"");

			oContactComp.SetFieldValue (""operation"", ""sync"");
		} // while (iComp.NextRecord ())

		/* Process the Sales Area Accounts */

		var e2knvvm = iKNA1MComp.GetIntComp (""E2KNVVM006"");
		var oSalesAreaAccountComp = oAccountComp.CreateIntComp (""SAP 4x Account Sales Area"", false);
		
		enumOrg: while( e2knvvm.NextRecord() )
		{
			/* Create ""Sales Area Account"" component in output message	*/
			oSalesAreaAccountComp.NewRecord ();

			oSalesAreaAccountComp.SetCopySource (e2knvvm);

			var SalesOrg = e2knvvm.GetFieldValue(""VKORG"");
			var DistChannel= e2knvvm.GetFieldValue(""VTWEG"");
			var DivCode = e2knvvm.GetFieldValue(""SPART"");

			var OrgID = GetSalesArea(SalesOrg, DistChannel, DivCode);

			if (OrgID != null) 	
			   oSalesAreaAccountComp.SetFieldValue(""Organization Id"", OrgID);
			else
			   EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+SalesOrg+"",""+DistChannel+"",""+DivCode+""""));
		   
		   	oSalesAreaAccountComp.SetFieldValue(""Integration Id"", oIntId);
		   	oSalesAreaAccountComp.SetFieldValue(""Organization Loc"", location);
		   	oSalesAreaAccountComp.SetFieldValue(""Organization Name"", Name);
//		   	oSalesAreaAccountComp.SetFieldValue(""Organization Partner Flag"", ""N"");

			/* Check if sales area is marked as deleted */
			if ((e2knvvm.GetFieldValue (""LOEVM"") == ""X"") || (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X""))
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
//				continue enumOrg;
			}
			else
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", """");
			}
				
			/* Set language code */
			oSalesAreaAccountComp.SetFieldValue (""Language Code"", languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms"", ""INCO1"");
			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms Info"", ""INCO2"");
			oSalesAreaAccountComp.SetFieldValue (""Type"", TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_TYPE"", e2knvvm.GetFieldValue(""KDGRP"")));
				
			oSalesAreaAccountComp.CopyFieldValue (""Primary Fulfillment InvLoc ID"", ""VWERK"");
			oSalesAreaAccountComp.CopyFieldValue (""Payment Terms"", ""ZTERM"");
			oSalesAreaAccountComp.CopyFieldValue (""Price List Type"", ""PLTYP"");
			oSalesAreaAccountComp.SetFieldValue (""Shipping Conditions"", TheApplication().InvokeMethod (""LookupValue"", ""SHIPPING_CONDITION"", e2knvvm.GetFieldValue(""VSBED"")));
			// oSalesAreaAccountComp.CopyFieldValue (""Pricing Group Code"", ""KONDA"");

			/* Set currency code */
			oSalesAreaAccountComp.SetFieldValue (""Currency Code"", currencyLM.Translate (e2knvvm.GetFieldValue (""WAERS"")));

			/* Block Credit Flag */
			var e2knkkm = iKNA1MComp.GetIntComp(""E2KNKKM001"");
			var oCrdtCtlAreaComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Credit Control Area"", false);
			while (e2knkkm.NextRecord () )
			{
				oCrdtCtlAreaComp.NewRecord ();
				oCrdtCtlAreaComp.SetCopySource (e2knkkm);
				oCrdtCtlAreaComp.CopyFieldValue (""Credit Control Area Code"", ""KKBER"");
				if (e2knkkm.GetFieldValue(""CRBLB"") == ""X"") 
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""Y"");
				else
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""N"");
				
				oCrdtCtlAreaComp.SetFieldValue (""operation"", ""upsert"");
			}

			/* Primary Partner Relationships of Sales Area Accounts  */
			var e2knvpm = e2knvvm.GetIntComp (""E2KNVPM002"");
			var oShipToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"", false);	
			var oPayerPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"", false);
			var oBillToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"", false);
			var oSoldToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"", false);

			var FirstShipTo, FirstPayer, FirstBillTo;
			FirstShipTo = true;
			FirstPayer = true;
			FirstBillTo = true;
			enumPartner: while (e2knvpm.NextRecord () )
			{
				// Default Ship To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""WE"" )
				{
					oShipToPartnerComp.NewRecord ();
					oShipToPartnerComp.SetCopySource( e2knvpm );
					oShipToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oShipToPartnerComp.SetFieldValue (""Ship To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstShipTo) {
						FirstShipTo = false;
						oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oShipToPartnerComp.SetFieldValue (""operation"", ""sync"");
				
				}	
				// Default Payer Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RG"" )
				{
					oPayerPartnerComp.NewRecord ();
					oPayerPartnerComp.SetCopySource (e2knvpm);
					oPayerPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oPayerPartnerComp.SetFieldValue (""Payer Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstPayer) {
						FirstPayer = false;
						oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oPayerPartnerComp.SetFieldValue (""operation"", ""sync"");
					
				}
				// Default Bill To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RE"" )
				{
					oBillToPartnerComp.NewRecord ();
					oBillToPartnerComp.SetCopySource (e2knvpm);
					oBillToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oBillToPartnerComp.SetFieldValue (""Bill To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstBillTo) {
						FirstBillTo = false;
						oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oBillToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
				// Sold To Partner
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""AG"" )
				{
					oSoldToPartnerComp.NewRecord ();
					oSoldToPartnerComp.SetCopySource (e2knvpm);
					oSoldToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oSoldToPartnerComp.SetFieldValue (""Sold To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oSoldToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					oSoldToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
			}

			/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
			// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
			// findKNRZE: while (iComp.NextRecord ())
			// {
				// oSalesAreaAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
				/* only get first row */
				//break findKNRZE;
			//}
		  // Set operation to ""upsert"" since we are using the ""Execute"" method
		  oSalesAreaAccountComp.SetFieldValue (""operation"", ""sync"");
		} // ... while( e2knvvm.Ne...
	} // ... while (iIDOCObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function RequestCustomerNumber_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP 47 Internal Customer Number (BAPI Output))
    *     Export Parameters (output)
    * 	    CUSTOMERID
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Send or Receive SAP 47 Customer (Siebel 77))
    *     Integration Id, Location, Sync status data (oAccount)
    */

   /*
    * Set up EAI Input Message objects
    */
   var iBAPIObj;   // BAPI object instance
   var iExportComp; // BAPI Export Parameters

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;      // Siebel Account instance
   var oAccountComp;     // Account

   /*
    * Find and create top-level integration object
    */
   iBAPIObj = inputMsg.GetIntObj (""Account - Get SAP 47 Internal Customer Number (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iBAPIObj.NextInstance ())
   {
      /*
       * Create ""Account"" object
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component in output message
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iBAPIObj.GetPrimaryIntComp (""Export Parameters"");

      if (iExportComp.NextRecord ())
      {
      	 oAccountComp.SetCopySource  (iExportComp);
      	 oAccountComp.CopyFieldValue (""EAI Sync Error Text"", ""RETURN-MESSAGE"");
      	 var ErrorType = iExportComp.GetFieldValue (""RETURN-TYPE"");
      	 
      	 if (ErrorType != ""E"")
      	 {
      	 
 		 /*
      	  * Update ""Account"" component
      	  */
        	oAccountComp.CopyFieldValue (""Integration Id"", ""CUSTOMERID"");
        	var customerno = iExportComp.GetFieldValue (""CUSTOMERID"");
        	var timenow = Timestamp();
         	var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Created in Back Office"");
	     	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
	     	oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
	     	
    	
	     	/*
	     	 *	Get Address Info to create the location field with 
	     	 *     embedded customer number
	     	 */
			var AccBusObject = TheApplication().GetBusObject(""Account"");
		 	var AccBusComp   = AccBusObject.GetBusComp(""Account"");
		 
			 // Set View Mode to 3 (or AllView)
		 	AccBusComp.SetViewMode(3);  
		 
		 	AccBusComp.ClearToQuery();
    	 	AccBusComp.SetSearchSpec(""Id"", inputId);
			AccBusComp.ActivateField(""Location"");
			
		 	AccBusComp.ExecuteQuery();
		 	if(AccBusComp.FirstRecord())
			{
	  		 var city        = AccBusComp.GetFieldValue(""City"");
	  		 var location    = AccBusComp.GetFieldValue(""Location"");
	  		 
	  		 /*
	  		  *		Site
	  		  */
	  		 if (location == """")
	  		 {
	  		 	location = AccBusComp.GetFieldValue(""City"");
	  		 }
	  		 location += "" "" + customerno;
	  		 oAccountComp.SetFieldValue (""Location"", location );
			}
			  	 
	     	   	
	     }
      }
   } //   while (iCreateAccountObj.NextInstance ())
} //function RequestCustomerNumber_BAPIToSiebel"
function RequestCustomerNumber_SiebelToBAPI (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Account Object (Account - Send or Receive SAP 47 Customer (Siebel 77))
    *     Account (Account)
    *       
    *
    * Output Object's Integration Components:
    *   Account - Get SAP 47 Internal Customer Number (BAPI Input)
    */

	/* Set up EAI Lookup maps */
    var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account

   /*
    * Set up EAI Output Message objects
    */
   var oBAPIObj;    // BAPI object instance
   var oBAPIImportComp;  // BAPI Import parameters
   

   /*
    * Find and create top-level integration object
    */
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");
   oBAPIObj = outputMsg.CreateIntObj (""Account - Get SAP 47 Internal Customer Number (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create BAPI object in output message
       */
      oBAPIObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oBAPIImportComp = oBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
      while (iAccountComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iAccountComp.GetFieldValue (""Integration Id"") != """")
	       {
			var IntId = iAccountComp.GetFieldValue (""Integration Id"");
			EAIRaiseError(LocalizeMessage(""ERR_MSG_ACCOUNT_EXISTS,""+IntId+""""));//nbc
	       }
	      /*
	       *	Validate Address
	       */
	       
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      /*
	       * Return an error if no address is found
	       */
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }

         /*
          * Write ""Import Parameters"" component
          */
         oBAPIImportComp.NewRecord ();
         oBAPIImportComp.SetFieldValue (""QUANTITY"", ""1"");
   	     var acctGroup = iAccountComp.GetFieldValue(""Customer Account Group"");
	     oBAPIImportComp.SetFieldValue (""ACCOUNTGROUP"", acctGroupLM.Translate(acctGroup));
   
      } //while (iAccountComp.NextRecord ())
   } //while (iAccountObj.NextInstance ())
} //function RequestCustomerNumber_SiebelToBAPI"
function SendAccount_SiebelToDEBMAS05 (inputMsg, outputMsg)
{
	/* Input Objects' Integration Components						
	 *   Account Object (Account - Send or Receive SAP 47 Customer (Siebel 77))
	 *
	 *	Output Object's Integration Components:
	 *			Customer IDOC (Account - Send or Receive SAP 47 Customer (DEBMAS05))
	 */
	
	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Outbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Outbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Outbound"");
	var acctGrpLM  = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Outbound"");
	
	/* Set up EAI Input Message objects */
	var iAccountObj;    // Siebel Account instance
	var iAccountComp;   // Account
	var iAddrComp;      // Address
	var iContactComp;   // Contact

	/* Set up EAI Output Message objects */
	var oIDOCObj;   // IDOC instance
	var oIDOCComp;  // top level IDOC segment
	var oKNA1MComp; // IDOC Customer Header
	var oComp;      // for reading child components

	/* Find and create top-level integration object	*/
	iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 47 Customer (Siebel 77)"");
	oIDOCObj =  outputMsg.CreateIntObj (""Account - Send or Receive SAP 47 Customer (DEBMAS05)"");

	/* Misc set up	*/
	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only
	var custAccntGrp;
    var currencyCode;
    var ctr = 0;
    var countryCode;
    var regCode;
    var sapCode;
	
	/* Read int object instances from EAI message */
	enumObj: while (iAccountObj.NextInstance ())
	{
		/* Read root Account component */
		iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
		if( !iAccountComp.NextRecord() ) continue enumObj;
		
		/*
         * Return an error if Integration Id is not null
         */
			if (iAccountComp.GetFieldValue (""Integration Id"") == """")
		    {
				var errMsg = iAccountComp.GetFieldValue (""EAI Sync Error Text"");
				EAIRaiseError ( errMsg );
	       	}

		/* Create ""IDOC"" object	*/
		oIDOCObj.NewInstance ();

		/* Create ""IDOC"" component in output message */
		oIDOCComp = oIDOCObj.CreatePrimaryIntComp (""Idoc Segments"");
		oIDOCComp.NewRecord ();
		oKNA1MComp = oIDOCComp.CreateIntComp (""E2KNA1M005"",false);
		oKNA1MComp.NewRecord ();	
		oKNA1MComp.SetCopySource (iAccountComp);

		/* Set Integration Id, Name	and Account Group*/
		oKNA1MComp.CopyFieldValue (""KUNNR"", ""Integration Id"");
		oKNA1MComp.CopyFieldValue (""NAME1"", ""Name"");
		oKNA1MComp.SetFieldValue (""KTOKD"", acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group"")));

		/* Set location	*/
		// oKNA1MComp.CopyFieldValue (""ORT01"", ""Location"");
	
		/* Account Status */
		// oKNA1MComp.CopyFieldValue (""AUFSD"", ""Account Status"" );
		oKNA1MComp.SetFieldValue (""LOEVM"", """");
		if (iAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
			oKNA1MComp.SetFieldValue (""LOEVM"", ""X""); 

		/* Primary Industry */
		// oKNA1MComp.CopyFieldValue (""BRSCH"", ""Primary Industry Id"");

		/* Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet) */
		// oKNA1MComp.CopyFieldValue (""STCEG"", """" );

		/* Search Term */
		oKNA1MComp.CopyFieldValue (""SORTL"", ""Name"");			

		/* Transportation Zone */
		// oKNA1MComp.SetFieldValue (""LZONE"", ""0000000001"");			

		/* Set language code */
		oKNA1MComp.SetFieldValue (""SPRAS"", languageLM.Translate (iAccountComp.GetFieldValue (""Language Code"")));
		
		/* Set main Phone/FAX numbers */
		oKNA1MComp.CopyFieldValue (""TELF1"", ""Main Phone Number"" );
		oKNA1MComp.CopyFieldValue (""TELFX"", ""Main Fax Number"" );
		
	
		/* Read ""KNVKM"" component */
		iContactComp = iAccountComp.GetIntComp (""Contact"");
		oComp = oKNA1MComp.CreateIntComp (""E2KNVKM"", false);
		while (iContactComp.NextRecord ())
		{
			/* Write ""Contact"" component */

			oComp.NewRecord ();
			oComp.SetCopySource  (iContactComp);
			// oComp.CopyFieldValue (""PARNR"", ""Integration Id"");
			// oComp.CopyFieldValue (""PARNR"", ""Employee Number"");

			/* Set First Name */
			oComp.CopyFieldValue (""NAMEV"", ""First Name"");

			/* Set Last name */
			oComp.CopyFieldValue (""NAME1"", ""Last Name"");

			/* Set job title */
			oComp.CopyFieldValue (""TITEL_AP"", ""Job Title"");
			oComp.CopyFieldValue (""ANRED"", ""M/M"");
			oComp.CopyFieldValue ( ""TELF1"", ""Work Phone #"");
		} // while (iContactComp.NextRecord ())

		/* Write ""Address"" component */
		iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
		while (iAddrComp.NextRecord () )
		{
			oKNA1MComp.SetCopySource(iAddrComp);
			if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
			{

			// Set telephone numbers
			// oKNA1MComp.CopyFieldValue (""TELF1"", ""Phone Number"" );
			// oKNA1MComp.CopyFieldValue (""TELFX"", ""Fax Number"" );

			// Set Street address
			oKNA1MComp.CopyFieldValue  (""STRAS"", ""Street Address"");
			oKNA1MComp.CopyFieldValue (""ORT01"", ""City"");
			countryCode = countryLM.Translate (iAddrComp.GetFieldValue (""Country""));
			oKNA1MComp.SetFieldValue (""LAND1"", countryLM.Translate (iAddrComp.GetFieldValue (""Country"")));
			
// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing 
			regCode = regCodeLM.Translate (iAddrComp.GetFieldValue (""State""));	//12-90S337
			sapCode = regCode.substring(3,5);									//12-90S337
			oKNA1MComp.SetFieldValue (""REGIO"", sapCode );						//12-90S337
	
			oKNA1MComp.CopyFieldValue (""PSTLZ"", ""Postal Code"" );
			
		// Set operation to ""upsert"" since we are using the ""Execute"" method.
			oKNA1MComp.SetFieldValue (""operation"", ""upsert"");
			}
		}
		

/* Process Sales Area Account */

		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
		var e2knvvm = oKNA1MComp.CreateIntComp (""E2KNVVM006"", false);
			
		enumOrg: while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Create ""Account"" component in output message	*/

			e2knvvm.NewRecord ();
			e2knvvm.SetCopySource ( iSalesAreaAccountComp );


			/* Set sales organization */

			e2knvvm.CopyFieldValue( ""VKORG"", ""Back Office Sales Organization"");
			e2knvvm.CopyFieldValue( ""VTWEG"", ""Back Office Distribution Channel"");
			e2knvvm.CopyFieldValue( ""SPART"", ""Back Office Sales Area Division Code"");
			
			/* Account Status (for Sales Area Accounts) */
			// e2knvvm.CopyFieldValue (""AUFSD"", ""Account Status"");
			if (iSalesAreaAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
				e2knvvm.SetFieldValue( ""LOEVM"", ""X"");

			/* Freight Terms a.k.a Incoterms 1 */
			// e2knvvm.CopyFieldValue (""INCO1"", ""Freight Terms"");

			/* Freight Terms Info a.k.a Incoterms 2 */
			// e2knvvm.CopyFieldValue (""INCO2"", ""Freight Terms Info"");

			/* Primary Fullfilment Inventory Location Id  */
			// e2knvvm.CopyFieldValue (""VWERK"", ""Primary Fulfillment InvLoc ID"");

			/* Payment Terms */
			// e2knvvm.CopyFieldValue (""ZTERM"", ""Payment Terms"");

			/* Price List Type */
			// e2knvvm.CopyFieldValue (""PLTYP"", ""Price List Type"");

			/* Account Type / Customer Group  */
               e2knvvm.SetFieldValue( ""KDGRP"", iSalesAreaAccountComp.GetFieldValue(""Type"" ));
			
			/* Customer Stats Group */
			   e2knvvm.SetFieldValue (""VERSG"", ""/"");

			// e2knvvm.SetFieldValue (""PERFK"", ""US"");

			/* Sales District Code */
			// e2knvvm.SetFieldValue (""BZIRK"", ""CENTRE"");			

			/* Pricing Group Code */
			// e2knvvm.SetFieldValue (""KONDA"", ""02"");

			/* Pricing Procedure */
 			e2knvvm.SetFieldValue (""KALKS"", ""/"");

			/* Shipping Conditions */
			var shpCond = iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions"");
			if ( shpCond == """" )
				e2knvvm.SetFieldValue (""VSBED"", ""02""); // Change Me
			else
				e2knvvm.SetFieldValue (""VSBED"", iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions""));

			/* Set currency code */
			var sCurCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
			if ( sCurCode == """")
				currencyCode = TheApplication().CurrencyCode();
			else
				currencyCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
				
			e2knvvm.SetFieldValue (""WAERS"", currencyLM.Translate (currencyCode));

			/* Set Block Credit Flag */
//			var e2knkkm = oKNA1MComp.CreateIntComp(""E2KNKKM001"",false);
//			var iCrdtCtlAreaComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Credit Control Area"");
//			while (iCrdtCtlAreaComp.NextRecord () )
//			{
//				e2knkkm.NewRecord ();
//				e2knkkm.SetCopySource (iCrdtCtlAreaComp);
//				e2knkkm.CopyFieldValue (""KKBER"", ""Credit Control Area Code"");
//				e2knkkm.CopyFieldValue (""CRBLB"", ""Block Credit Flag"");
//				e2knkkm.SetFieldValue (""operation"", ""upsert"");
//			}

			/* Tax classification */
			// var iTaxCode = e2knvvm004.CreateIntComp (""E2KNVIM"",false);
			// iTaxCode.NewRecord ();
			// iTaxCode.SetFieldValue (""TAXKD"",""0"");
			
			/* Set Primary Partner Relationships of Sales Area Accounts */
			var acctGrp = acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group""));
			var intId   = iAccountComp.GetFieldValue (""Integration Id"");
			if ( acctGrp == ""0001"" || acctGrp == ""0002"" )
			{
			
			var e2knvpm = e2knvvm.CreateIntComp (""E2KNVPM002"",false);

			var iShipToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"");	
			var iPayerPartnerComp  = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"");
			var iBillToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"");
			var iSoldToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"");

			var i = 0;
			enumShipToPartner: while (iShipToPartnerComp.NextRecord () )
			{
				// Default Ship To Partner 
				if ( iShipToPartnerComp.GetFieldValue(""Ship To Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource( iShipToPartnerComp );
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
   					e2knvpm.SetFieldValue (""PARVW"", ""WE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 )
			{
				e2knvpm.NewRecord ();
		   		e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""WE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			if ( acctGrp == ""0002"" )  goto SoldToPartner;

			i = 0;
			enumPayerPartner: while (iPayerPartnerComp.NextRecord () )
			{
				// Default Payer Partner 
				if ( iPayerPartnerComp.GetFieldValue(""Payer Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iPayerPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RG"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}
	
			i = 0;
			enumBillToPartner: while (iBillToPartnerComp.NextRecord () )
			{
				// Default Bill To Partner 
				if ( iBillToPartnerComp.GetFieldValue(""Bill To Partner Function"")  )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iBillToPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			SoldToPartner:
			i = 0;
			enumSoldToPartner: while (iSoldToPartnerComp.NextRecord () )
			{
				// Default Sold To Partner 
				if ( iSoldToPartnerComp.GetFieldValue(""Sold To Partner Function"")  )
				{
					if (( iSoldToPartnerComp.GetFieldValue(""Integration Id"") != intId )) 
					{	
						e2knvpm.NewRecord ();
						e2knvpm.SetCopySource (iSoldToPartnerComp);
						e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
						e2knvpm.SetFieldValue (""PARVW"", ""AG"");
						e2knvpm.SetFieldValue (""operation"", ""upsert"");
						i++;
					}
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""AG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			/* Set operation to ""upsert"" since we are using the ""Execute"" method. */
			e2knvvm.SetFieldValue (""operation"", ""upsert"");
			}

		} // enumOrg: while( iSalesAreaAccountComp.NextRecord() )
		/* Set Company Code & Parent Account Id	*/
		// var oCoCodeComp = oKNA1MComp.CreateIntComp (""E2KNB1M005"",false);
		// oCoCodeComp.NewRecord ();
		// oCoCodeComp.SetCopySource(iAccountComp);
		// oCoCodeComp.CopyFieldValue (""KNRZE"", ""Parent Account Integration Id"");
		// oCoCodeComp.SetFieldValue (""BUKRS"", ""0010"");
		// oCoCodeComp.SetFieldValue (""AKONT"", ""121000"");

	} // ... while (iAccountObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"
function Timestamp()
{
	var d = Date.fromSystem(Clib.time());

	// Return date in the format MM/DD/YYYY HH:MM:SS
	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
	  d.getHours(), d.getMinutes(), d.getSeconds());
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function GetSAPOrderList_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP 47 Order List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Get SAP 47 Order List (MO))
    *     Account (oAccount)
    *       Get List for Account Output
    *       Get List for Account Header
    *         Get List for Account Item
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;   // BAPI Order instance
   var iGLExportComp; // BAPI Export Parameters
   var iGLHeaderComp; // BAPI Order Header
   var iGLItemComp;   // BAPI Order Item

   // Store inputId (ROW_ID) to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;   // Siebel Order instance
   var oAccountComp;  // Account
   var oGLOutputComp; // Get List Output
   var oGLHeaderComp; // Get List Header
   var oGLItemComp;   // Get List Item

   var theApp = TheApplication();

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Get SAP 47 Order List (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Get SAP 47 Order List (MO)"");

   /*
    * Read int object instances from EAI message
    */
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Account"" object in output message
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);
      
      // Get Primary Sales Area of the account
      var SalesOrg;
      var SalesChn;
	  var SalesDiv;
	  var AccBusObj = theApp.GetBusObject(""Account"");
	  var AccBusCmp = AccBusObj.GetBusComp(""Account"");
	  
	  // Set View Mode to 3 (or AllView)	  
	  AccBusCmp.SetViewMode(3);  
		
	  AccBusCmp.ClearToQuery();
      AccBusCmp.SetSearchSpec(""Id"", inputId);
      AccBusCmp.ActivateField(""Primary Organization Id"");
            	
	  AccBusCmp.ExecuteQuery();
	  
		
	  if(AccBusCmp.FirstRecord())
	  {
	     var PrimOrg = AccBusCmp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = theApp.GetBusObject(""Organizations"");
	     var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
	     
	     
	     // Set View Mode to 3 (or AllView)		
		 OrgBusCmp.SetViewMode(3);  	
		 
	     OrgBusCmp.ClearToQuery();
         OrgBusCmp.SetSearchSpec(""Id"", PrimOrg);
         OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	     OrgBusCmp.ActivateField(""Back Office Distribution Channel"");
	     OrgBusCmp.ActivateField(""Back Office Division"");
	
	     OrgBusCmp.ExecuteQuery();
		 
		 // get saleOrg, distChnl and division of the primary SA
	     if(OrgBusCmp.FirstRecord())
	     {
		    var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
		    var SalesChn = OrgBusCmp.GetFieldValue(""Back Office Distribution Channel"");
		    var SalesDiv = OrgBusCmp.GetFieldValue(""Back Office Division"");
	     }
//	     else
//	     {
//		  	EAIRaiseError(""Unable to get sales area info for the primary organization"");
//	     }
	  }
//	  else
//	  {
//	  	EAIRaiseError(""Invalid account"");
//	  }
      

      /*
       * Read ""Export Parameters"" component
       */
      iGLExportComp = iGLOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      
      oGLOutputComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Output"", oAccountComp);
      if (iGLExportComp.NextRecord ())
      {
      	
         /*
          * Write ""Get List for Account Output"" component
          */
         oGLOutputComp.NewRecord ();
         oGLOutputComp.SetCopySource  (iGLExportComp);
         oGLOutputComp.SetFieldValue  (""Input Id"",          inputId);
         oGLOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oGLOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oGLOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");

         /*
          * Read ""Order Header"" component to 
          */
         iGLHeaderComp = iGLExportComp.GetIntComp (""Order Header"");
         oGLHeaderComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Header"", oAccountComp);
         while (iGLHeaderComp.NextRecord ())
        /* 
       	 * Validate Sales area
       	 */
      	 {
      		var iSalesOrg = iGLHeaderComp.GetFieldValue(""SALES_ORG""); 
       	 	var iSalesChn = iGLHeaderComp.GetFieldValue(""DISTR_CHAN""); 
       	 	var iSalesDiv = iGLHeaderComp.GetFieldValue(""DIVISION""); 
      
	      	if ((SalesOrg == iSalesOrg) && (SalesChn == iSalesChn) && (SalesDiv == iSalesDiv))  
			{
			   oGLHeaderComp.NewRecord ();
			   oGLHeaderComp.SetCopySource  (iGLHeaderComp);
			   oGLHeaderComp.SetFieldValue  (""Input Id"",         inputId);
			   oGLHeaderComp.CopyFieldValue (""Currency"",             ""CURRENCY"");
			   oGLHeaderComp.CopyFieldValue (""Distribution Channel"", ""DISTR_CHAN"");
			   oGLHeaderComp.CopyFieldValue (""Division"",             ""DIVISION"");
			   oGLHeaderComp.CopyFieldValue (""Order Date"",           ""DOC_DATE"");
			   oGLHeaderComp.CopyFieldValue (""Order Number"",         ""SD_DOC"");
			   oGLHeaderComp.CopyFieldValue (""Order Status"",         ""DOC_STATUS"");
			   oGLHeaderComp.CopyFieldValue (""Order Type"",           ""DOC_TYPE"");
			   oGLHeaderComp.CopyFieldValue (""Purchase Order"",       ""PURCH_NO"");
			   oGLHeaderComp.CopyFieldValue (""Sales Organization"",   ""SALES_ORG"");
			   oGLHeaderComp.CopyFieldValue (""Sold To Customer"",     ""SOLD_TO"");
	
	           /*
	            * Read the ""Order Item"" component
	            */
	           // to ""Get List for Account Item"" component
			   iGLItemComp = iGLHeaderComp.GetIntComp (""Order Item"");
			   oGLItemComp = oGLHeaderComp.CreateIntComp (""Account - Get SAP Order List Item"", oGLHeaderComp);
			   while (iGLItemComp.NextRecord ())
			   {
				  oGLItemComp.NewRecord ();
				  oGLItemComp.SetCopySource  (iGLItemComp);
				  oGLItemComp.SetFieldValue  (""Input Id"",         inputId);
				  oGLItemComp.CopyFieldValue (""Item Number"",          ""ITM_NUMBER"");
				  oGLItemComp.CopyFieldValue (""Material Part Number"", ""MATERIAL"");
				  oGLItemComp.CopyFieldValue (""Material Short Text"",  ""SHORT_TEXT"");
				  oGLItemComp.CopyFieldValue (""Net Price"",            ""NET_PRICE"");
				  oGLItemComp.CopyFieldValue (""Net Value"",            ""NET_VALUE"");
				  oGLItemComp.CopyFieldValue (""Sales Unit"",           ""SALES_UNIT"");
			   }
            }
         }
      }
   }
}
function GetSAPOrderList_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Account Object (Account - Get SAP 47 Order List (MO))
    *     Account (iAccount)
	 *       Get List for Account Header
    *
    * Output Object's Integration Components:
    *   BAPI Import (Account - Get SAP 47 Order List (BAPI Input))
    *     Import Parameters (output)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var theApp = TheApplication(); // nbc
   var iAccountObj;    // Siebel Account instance
   var iAccountComp;   // Account
	var iHeaderComp;    // Account Header

   /*
    * Set up EAI Output Message objects
    */
   var oGLObj;         // BAPI instance
   var oGLImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */

   iAccountObj = inputMsg.GetIntObj (""Account - Get SAP 47 Order List (MO)"");
   oGLObj = outputMsg.CreateIntObj (""Account - Get SAP 47 Order List (BAPI Input)"");

   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create ""Get List for Account"" object
       */
      oGLObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oGLImportComp = oGLObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iAccountComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGLImportComp.NewRecord ();
         oGLImportComp.SetCopySource  (iAccountComp);

	     var intId = iAccountComp.GetFieldValue( ""Integration Id"" );
	     var fromDate = iAccountComp.GetFieldValue( ""Back Office Order Query Start  Dt"" ); //nbc
	     var toDate = iAccountComp.GetFieldValue( ""Back Office Order Query End  Dt"" ); //nbc

         oGLImportComp.SetFieldValue  (""CUSTOMER_NUMBER"",intId );
         oGLImportComp.SetFieldValue  (""MATERIAL"", """");
         oGLImportComp.SetFieldValue  (""TRANSACTION_GROUP"", ""0"");
         oGLImportComp.SetFieldValue  (""PURCHASE_ORDER"", """"); // ""Peter 1"";
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE"", fromDate );    // Empty string means ""00000000""
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE_TO"",  toDate ); // Empty string means ""00000000""

		 // Read the primary sales area
	     var primOrgId = iAccountComp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = TheApplication().GetBusObject(""Organizations"");
		 var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
		 
		 // Set View Mode to 3 (or AllView)
		 OrgBusCmp.SetViewMode(3);  
		 
		 OrgBusCmp.ClearToQuery();
    	 OrgBusCmp.SetSearchSpec(""Id"", primOrgId);
    	 OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	 
	
		 OrgBusCmp.ExecuteQuery();
		 if(OrgBusCmp.FirstRecord())
		 {
	  		 var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
	  		 // Write ""Import Parameters"" component
			 oGLImportComp.SetFieldValue( ""SALES_ORGANIZATION"", SalesOrg );
		 }
		}
   }
}
function ImportSAPOrder_GetSAPOrderListToSiebelOrder (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Import Get List for Account (Account - Import SAP 47 Order (Get SAP Order List) (MO))
    *     Get List for Account Header
    *
    * Output Object's Integration Components:
    *   Import (Account - Import SAP 47 Order (Siebel Order) (MO))
    *     Order (oOrder)
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;  // Get List instance
   var iGLOrderComp; // Get List Order

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oOrderOrgComp;  // Order Organization

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Import SAP 47 Order (Get SAP Order List) (MO)"");
   oOrderObj = outputMsg.CreateIntObj (""Account - Import SAP 47 Order (Siebel Order) (MO)"");

   /*
    * Read int object instances from EAI message
    */
    
   
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();
            	
      /*
       * Read ""Get List Order"" component
       */
      iGLOrderComp = iGLOrderObj.GetPrimaryIntComp (""Get List for Account Header"");
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      
      while (iGLOrderComp.NextRecord ())
      {
         /*
          * Write ""Order"" component
          */
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iGLOrderComp);
         
         var SiebOrdNo = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         if (SiebOrdNo == """")												//xx
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue(""Order Number"");		//xx
         }																	//xx
         else
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         }																	//xx
 		 
 		 oOrderComp.SetFieldValue (""Order Number"",               OrdNumber);//xx
 		             
 		 var oTypeSAP = orderTypeLM.Translate (iGLOrderComp.GetFieldValue (""Order Type""));
		 var oType    = TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_TYPE"", oTypeSAP);
		 oOrderComp.SetFieldValue  (""Order Type"",              oType);
         oOrderComp.CopyFieldValue (""Order Date"",             ""Order Date"");
         oOrderComp.CopyFieldValue (""Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Integration Id"",         ""Order Number"");
 		 oOrderOrgComp = oOrderComp.CreateIntComp(""Order Entry - Orders_Organization"");

	 	oOrderOrgComp.NewRecord();
	 	oOrderOrgComp.SetCopySource  (iGLOrderComp);
		
	 	oOrderOrgComp.SetFieldValue ( ""IsPrimaryMVG"",			""Y"");
        oOrderOrgComp.CopyFieldValue ( ""Organization Id"",		""SAP Organization Id (MO)"");
		
			
		
      }
   }
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var result = EAIExecuteMap (MethodName, Inputs, Outputs);

	return result;
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function CheckSAPCustomer_CallBAPI (inputMsg, outputMsg) { 
  /*  Referenced in workflow Account - Check SAP 46C Customer
    * Input Object:
    *  Account - Send or Receive SAP 50 Customer (Siebel 77)
    *       
    *
    * Output Object's Integration Components:
    *  Account - Send or Receive SAP 50 Customer (Siebel 77)
    *   set property ""customerExists"" to true or false in outputMsg
    *  if customer does not exist, set ""EAI Sync Error Text""
    */

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
   *  temporary variables
   */
   var customerExists = false;
   var errorType;

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account
   var oAccountObj;
   var oAccountComp;
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");
   
   
   /*
   *   Create new property sets for BAPI call to SAP and create adapter bus service
   */   
   var inputBAPI = TheApplication().NewPropertySet();
   var outputBAPI = TheApplication().NewPropertySet();
   var inputBAPIMsg = EAICreateIntMsgOut (inputBAPI);
  
   
   var iBAPIObj = inputBAPIMsg.CreateIntObj (""Account - Check SAP 47 Customer Existence (BAPI Input)"");

   inputBAPIMsg.SetArgument (""OutputIntObjectName"", ""Account - Check SAP 47 Customer Existence (BAPI Output)"");
   inputBAPIMsg.SetArgument (""SAPAutoError"",""False"");

   var bapiAdapter = TheApplication().GetService(""EAI SAP BAPI Adapter"");
   
   var oBAPIObj;
   var oBAPIExportComp;
   var iBAPIImportComp;
  
    
   /*
    * create top-level integration object
    */
   
   if (iAccountObj.NextInstance ())
   {
     /*
      * Create BAPI object in output message
      */
      iBAPIObj.NewInstance ();
      

      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      iBAPIImportComp = iBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
 
       if (iAccountComp.NextRecord ())
      {
	      var IntId = iAccountComp.GetFieldValue (""Integration Id"");
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }
       /*
        * Write ""Import Parameters"" component
        */
         iBAPIImportComp.NewRecord ();
         iBAPIImportComp.SetFieldValue (""CUSTOMERNO"", IntId);
         /*
         *  Loop over sales orgs, call BAPI for each until one suceeds
         */
		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
			
		while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Copy sales org info	*/

			iBAPIImportComp.SetCopySource ( iSalesAreaAccountComp );
			iBAPIImportComp.CopyFieldValue( ""SALES_ORGANIZATION"", ""Back Office Sales Organization"");
			iBAPIImportComp.CopyFieldValue( ""DISTRIBUTION_CHANNEL"", ""Back Office Distribution Channel"");
			iBAPIImportComp.CopyFieldValue( ""DIVISION"", ""Back Office Sales Area Division Code"");
     
            // call BAPI
            bapiAdapter.InvokeMethod (""Execute"", inputBAPI, outputBAPI);
            
            // test output
           oBAPIExportComp = ((outputBAPI.GetChild(0)).GetChild(0)).GetChild(0);

           errorType = oBAPIExportComp.GetProperty (""RETURN-TYPE"");
               
           if (errorType != ""E"")
           {
              customerExists = true;
              
              break;
           }
           outputBAPI.Reset();
         
        } // endloop iSalesAreaAccountComp.NextRecord()
        
      } // endif iAccountComp.NextRecord()
   } // endif iAccountObj.NextInstance()
   
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");
   oAccountObj.NewInstance ();
   oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
   oAccountComp.NewRecord ();
   // Set ""Id"" so Siebel Adapter can synchronize
   oAccountComp.SetFieldValue (""Id"", inputId);
   
   if (customerExists)
   {
      outputMsg.SetArgument(""Customer Exists"", ""True"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"",  """");
   }
   else
   {    
      var output = LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP1"")+"" ""+  	 
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP2"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP3"")+"" ""+
      LocalizeMessage(""ERR_MSG_CUSTOMER_DOES_NOT_EXIST_IN_SAP4"");
      outputMsg.SetArgument(""Customer Exists"", ""False"");
      oAccountComp.SetFieldValue (""EAI Sync Error Text"", output);
   }
   
 } // end function"
function GetAccountName (Int_ID)
{// referenced by script ReceiveAccount_47IDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", Int_ID);
	AccBusComp.ActivateField(""Name"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Name"");
	}
      	else
           return null;
}
function GetAccountStatus (oIntId)
{ // referenced by script ReceiveAccount_47IDOCToSiebel
	var AccBusObject = TheApplication().GetBusObject(""Account"");
	var AccBusComp = AccBusObject.GetBusComp(""Account"");
		
	AccBusComp.ClearToQuery();
    AccBusComp.SetSearchSpec(""Integration Id"", oIntId);
	AccBusComp.ActivateField(""Account Status"");
	AccBusComp.ExecuteQuery();
		
	if(AccBusComp.FirstRecord())
	{
	   return AccBusComp.GetFieldValue(""Account Status"");
	}
      	else
           return null;
}
function GetSalesArea (SalesOrg, DistChannel, DivCode)
{ // referenced by script ReceiveAccount_47IDOCToSiebel
	var OrgBusObject = TheApplication().GetBusObject(""Organizations"");
	var SABusComp = OrgBusObject.GetBusComp(""Organization"");
	
	SABusComp.SetViewMode(3);  // All Mode
		
	SABusComp.ClearToQuery();
    SABusComp.SetSearchSpec(""Back Office Sales Organization"", SalesOrg);
    SABusComp.SetSearchSpec(""Back Office Distribution Channel"", DistChannel);
    SABusComp.SetSearchSpec(""Back Office Division"", DivCode);

//	SABusComp.ActivateField(""Organization Id"");
	SABusComp.ActivateField(""Party Id"");
	
	SABusComp.ExecuteQuery();
	
	if(SABusComp.FirstRecord())
	{
//	   return SABusComp.GetFieldValue(""Organization Id"");
	   return SABusComp.GetFieldValue(""Party Id"");
	}
      else
         return null;
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function ReceiveAccount_47IDOCToSiebel (inputMsg, outputMsg)
{ // referenced by workflow Account - Receive SAP 50 Customer
	/* Input Objects' Integration Components	
	*   Account - Send or Receive SAP 50 Customer (DEBMAS05)			
	*     E2KNA1M005, E2KNVKM001, E2DNVVM006, E2KNKKM001, E2KNVPM002
	* Output Object's Integration Components:
	*  Account - Send or Receive SAP 50 Customer (Siebel 77)
	*   Account
	*   Contact
	*   Business Address
	*/

	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Inbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Inbound"");
	var defaultOrgLM = EAIGetValueMap (""Default Org"", ""Siebel Inbound"");
	var undefinedOrgLM = EAIGetValueMap (""Undefined SAP Org"", ""Siebel Inbound"");
	var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Inbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Inbound"");

	/* Set up EAI Input Message objects */
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iKNA1MComp; // IDOC Customer Header
	var iComp;      // for reading child components

	/* Set up EAI Output Message objects */
	var oAccountObj;    // Siebel Account instance
	var oAccountComp;   // Account
	var oAddrComp;      // Address
	var oContactComp;   // Contact

	var oCustAcctGrp;	// Customer Account Group
	var oIntId;			// SAP Customer Number
	var oAcctSts;		// Account Status
	var regCode;        // SAP Country + Region Code	(12-90S337)
	var sapCode;        // SAP Region Code				(12-90S337)
	var osiebReg;       // Siebel Region 				(12-90S337)
	
	var AcctIntId       // Account Integration Id for Contact (12-C34KYN)
	
	/* Find and create top-level integration object */
	iIDOCObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 50 Customer (DEBMAS05)"");
	oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");

	/* Misc set up */
//	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only

	/* Read int object instances from EAI message */
	enumObj: while (iIDOCObj.NextInstance ())
	{
		/* Read virtual root component that IDOC RFC Adapter populates */
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		if( !iIDOCComp.NextRecord() ) continue enumObj;   // TODO: Root component is missing - log an error

		/* Read ""KNA1M"" component */
		iKNA1MComp = iIDOCComp.GetIntComp (""E2KNA1M005"");
		if( !iKNA1MComp.NextRecord() ) continue enumObj;

		/* Create ""Account"" object */
		oAccountObj.NewInstance ();

		/* Create ""Account"" component in output message */
		oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
		oAccountComp.NewRecord ();	
		oAccountComp.SetCopySource (iKNA1MComp);
		
		/* Set Integration Id and Name */
		oIntId = iKNA1MComp.GetFieldValue (""KUNNR"");
		var Name = iKNA1MComp.GetFieldValue (""NAME1"");
		
		oAccountComp.CopyFieldValue (""Integration Id"", ""KUNNR"");
		oAccountComp.CopyFieldValue (""Name"",           ""NAME1"");
		
		AcctIntId = oIntId ;  // Account Integration Id for Contact (12-C34KYN)
		
		oCustAcctGrp = acctGroupLM.Translate (iKNA1MComp.GetFieldValue (""KTOKD""));
		var AcctGrp = TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_GROUP_TYPE"", oCustAcctGrp);
		oAccountComp.SetFieldValue (""Customer Account Group"", AcctGrp);

		/* Set location to ""<City> KUNNR1"" If <City> is null, put ""No City"" */
		var location = iKNA1MComp.GetFieldValue (""ORT01"");
		if (location == null) location = ""No City"";
		location += "" "" + iKNA1MComp.GetFieldValue (""KUNNR"");
		oAccountComp.SetFieldValue (""Location"",   location);

		/* Check if customer is Marked for Deletion */
		if (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X"") 
		{
			oAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
		}
		else
		{
			oAcctSts = GetAccountStatus (oIntId);
			if (oAcctSts == ""Marked For Deletion"")
				oAccountComp.SetFieldValue (""Account Status"", ""Active"");
			else
				oAccountComp.SetFieldValue (""Account Status"", oAcctSts);
		}

		/* Set telephone numbers */
		oAccountComp.CopyFieldValue (""Main Phone Number"", ""TELF1"");
		oAccountComp.CopyFieldValue (""Main Fax Number"",   ""TELFX"");

		/* Set other fields ; Defaults from buscomp:*/
		oAccountComp.CopyFieldValue (""Row Status"", ""Y"");

		/* Set fields for SAP 4x */
		oAccountComp.CopyFieldValue (""Primary Industry Id"", ""BRSCH"");

		// Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet)
		// oAccountComp.CopyFieldValue ("""", ""STCEG"");
		
		oAccountComp.SetFieldValue (""Language Code"",languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

		/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
		// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
		// findKNRZE: while (iComp.NextRecord ())
		// {
			//oAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
			/* only get first row */
			//break findKNRZE;
		// }
			
		var timenow = Timestamp();
		var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Sync from Back Office"");
	   	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
		oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
			
		// Set operation to ""    "" since we are using the ""Execute"" method.
		oAccountComp.SetFieldValue (""operation"", ""sync"");
		
		/* Write ""Address"" component */
		oAddrComp = oAccountComp.CreateIntComp (""Account_Business Address"", false);
		oAddrComp.NewRecord ();
		oAddrComp.SetCopySource (iKNA1MComp);
		oAddrComp.CopyFieldValue (""Integration Id"", ""KUNNR"");

		// Set Street address
		var stras = iKNA1MComp.GetFieldValue (""STRAS""); // Street address
		var pfach = iKNA1MComp.GetFieldValue (""PFACH""); // PO Box
		var street;

		if (stras == """" && pfach == """") 	street = ""None"";
		else if (stras != """" && pfach == """")street = stras;
		else if (stras != """" && pfach != """")street = stras + "" P.O. Box "" + pfach;
		else if (stras == """" && pfach != """")street = ""P.O. Box "" + pfach;

		oAddrComp.SetFieldValue  (""Street Address"", street);
		oAddrComp.CopyFieldValue (""City"",    ""ORT01"", ""None"", ""None"");
		oAddrComp.SetFieldValue  (""Country"", countryLM.Translate (iKNA1MComp.GetFieldValue (""LAND1"")));
		var x = 0; x += 1; //temporarily fix until operation synchronize works
		var AddrName = street + x + ', ' + iKNA1MComp.GetFieldValue (""ORT01"") + ', ' + iKNA1MComp.GetFieldValue (""REGIO"") ;
		oAddrComp.SetFieldValue (""Address Name"", AddrName); 

// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing
		sapCode  = iKNA1MComp.GetFieldValue (""REGIO"");	//12-90S337
		regCode  = iKNA1MComp.GetFieldValue (""LAND1"");	//12-90S337
		regCode  = regCode + ""_"" + sapCode;				//12-90S337
		osiebReg = regCodeLM.Translate (regCode);		//12-90S337
		var sRegion = TheApplication().InvokeMethod (""LookupValue"", ""STATE_ABBREV"", osiebReg);	//12-90S337
		oAddrComp.SetFieldValue (""State"",    sRegion);	//12-90S337
				
		oAddrComp.CopyFieldValue (""Postal Code"", ""PSTLZ"");
		oAddrComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
		oAddrComp.SetFieldValue (""operation"", ""sync"");

		/* Read ""KNVKM"" component */
		iComp   = iKNA1MComp.GetIntComp (""E2KNVKM001"");
		oContactComp = oAccountComp.CreateIntComp (""Contact"", false);
		while (iComp.NextRecord ())
		{
			/* Write ""Contact"" component */
			oContactComp.NewRecord ();
			oContactComp.SetCopySource  (iComp);
			oContactComp.CopyFieldValue (""Integration Id"", ""PARNR"");
			oContactComp.CopyFieldValue (""Employee Number"", ""PARNR"");
			
			// Set First Name
			oContactComp.CopyFieldValue (""First Name"", ""NAMEV"", ""No First Name"", ""No First Name"");
			// Set Last name
			oContactComp.CopyFieldValue (""Last Name"", ""NAME1"");

			// Set job title
			oContactComp.CopyFieldValue (""Job Title"",    ""TITEL_AP"");
			oContactComp.CopyFieldValue (""M/M"",          ""ANRED"");
			oContactComp.CopyFieldValue (""Work Phone #"", ""TELF1"");
			
			// Account Integration Id for Contact (12-C34KYN)
			oContactComp.SetFieldValue ( ""Account Integration Id"", AcctIntId );
			
			// flags
			oContactComp.CopyFieldValue (""Personal Contact"",      ""N"");
			oContactComp.CopyFieldValue (""Suppress All Mailings"", ""Y"");
			oContactComp.CopyFieldValue (""Row Status"", ""Y"");

			oContactComp.SetFieldValue (""operation"", ""sync"");
		} // while (iComp.NextRecord ())

		/* Process the Sales Area Accounts */

		var e2knvvm = iKNA1MComp.GetIntComp (""E2KNVVM006"");
		var oSalesAreaAccountComp = oAccountComp.CreateIntComp (""SAP 4x Account Sales Area"", false);
		
		enumOrg: while( e2knvvm.NextRecord() )
		{
			/* Create ""Sales Area Account"" component in output message	*/
			oSalesAreaAccountComp.NewRecord ();

			oSalesAreaAccountComp.SetCopySource (e2knvvm);

			var SalesOrg = e2knvvm.GetFieldValue(""VKORG"");
			var DistChannel= e2knvvm.GetFieldValue(""VTWEG"");
			var DivCode = e2knvvm.GetFieldValue(""SPART"");

			var OrgID = GetSalesArea(SalesOrg, DistChannel, DivCode);

			if (OrgID != null) 	
			   oSalesAreaAccountComp.SetFieldValue(""Organization Id"", OrgID);
			else
			   EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+SalesOrg+"",""+DistChannel+"",""+DivCode+""""));
		   
		   	oSalesAreaAccountComp.SetFieldValue(""Integration Id"", oIntId);
		   	oSalesAreaAccountComp.SetFieldValue(""Organization Loc"", location);
		   	oSalesAreaAccountComp.SetFieldValue(""Organization Name"", Name);
//		   	oSalesAreaAccountComp.SetFieldValue(""Organization Partner Flag"", ""N"");

			/* Check if sales area is marked as deleted */
			if ((e2knvvm.GetFieldValue (""LOEVM"") == ""X"") || (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X""))
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", ""Marked For Deletion"");
//				continue enumOrg;
			}
			else
			{
				oSalesAreaAccountComp.SetFieldValue (""Account Status"", """");
			}
				
			/* Set language code */
			oSalesAreaAccountComp.SetFieldValue (""Language Code"", languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS_ISO"")));

			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms"", ""INCO1"");
			oSalesAreaAccountComp.CopyFieldValue (""Freight Terms Info"", ""INCO2"");
			oSalesAreaAccountComp.SetFieldValue (""Type"", TheApplication().InvokeMethod (""LookupValue"", ""ACCOUNT_TYPE"", e2knvvm.GetFieldValue(""KDGRP"")));
				
			oSalesAreaAccountComp.CopyFieldValue (""Primary Fulfillment InvLoc ID"", ""VWERK"");
			oSalesAreaAccountComp.CopyFieldValue (""Payment Terms"", ""ZTERM"");
			oSalesAreaAccountComp.CopyFieldValue (""Price List Type"", ""PLTYP"");
			oSalesAreaAccountComp.SetFieldValue (""Shipping Conditions"", TheApplication().InvokeMethod (""LookupValue"", ""SHIPPING_CONDITION"", e2knvvm.GetFieldValue(""VSBED"")));
			// oSalesAreaAccountComp.CopyFieldValue (""Pricing Group Code"", ""KONDA"");

			/* Set currency code */
			oSalesAreaAccountComp.SetFieldValue (""Currency Code"", currencyLM.Translate (e2knvvm.GetFieldValue (""WAERS"")));

			/* Block Credit Flag */
			var e2knkkm = iKNA1MComp.GetIntComp(""E2KNKKM001"");
			var oCrdtCtlAreaComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Credit Control Area"", false);
			while (e2knkkm.NextRecord () )
			{
				oCrdtCtlAreaComp.NewRecord ();
				oCrdtCtlAreaComp.SetCopySource (e2knkkm);
				oCrdtCtlAreaComp.CopyFieldValue (""Credit Control Area Code"", ""KKBER"");
				if (e2knkkm.GetFieldValue(""CRBLB"") == ""X"") 
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""Y"");
				else
					oCrdtCtlAreaComp.SetFieldValue (""Block Credit Flag"", ""N"");
				
				oCrdtCtlAreaComp.SetFieldValue (""operation"", ""upsert"");
			}

			/* Primary Partner Relationships of Sales Area Accounts  */
			var e2knvpm = e2knvvm.GetIntComp (""E2KNVPM002"");
			var oShipToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"", false);	
			var oPayerPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"", false);
			var oBillToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"", false);
			var oSoldToPartnerComp = oSalesAreaAccountComp.CreateIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"", false);

			var FirstShipTo, FirstPayer, FirstBillTo;
			FirstShipTo = true;
			FirstPayer = true;
			FirstBillTo = true;
			enumPartner: while (e2knvpm.NextRecord () )
			{
				// Default Ship To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""WE"" )
				{
					oShipToPartnerComp.NewRecord ();
					oShipToPartnerComp.SetCopySource( e2knvpm );
					oShipToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oShipToPartnerComp.SetFieldValue (""Ship To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstShipTo) {
						FirstShipTo = false;
						oShipToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oShipToPartnerComp.SetFieldValue (""operation"", ""sync"");
				
				}	
				// Default Payer Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RG"" )
				{
					oPayerPartnerComp.NewRecord ();
					oPayerPartnerComp.SetCopySource (e2knvpm);
					oPayerPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oPayerPartnerComp.SetFieldValue (""Payer Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstPayer) {
						FirstPayer = false;
						oPayerPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oPayerPartnerComp.SetFieldValue (""operation"", ""sync"");
					
				}
				// Default Bill To Partner 
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""RE"" )
				{
					oBillToPartnerComp.NewRecord ();
					oBillToPartnerComp.SetCopySource (e2knvpm);
					oBillToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oBillToPartnerComp.SetFieldValue (""Bill To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					if (FirstBillTo) {
						FirstBillTo = false;
						oBillToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					}
					oBillToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
				// Sold To Partner
				if ( e2knvpm.GetFieldValue(""PARVW"") == ""AG"" )
				{
					oSoldToPartnerComp.NewRecord ();
					oSoldToPartnerComp.SetCopySource (e2knvpm);
					oSoldToPartnerComp.CopyFieldValue (""Integration Id"", ""KUNN2"");
					var Int_ID = e2knvpm.GetFieldValue (""KUNN2"");
					if ( Int_ID == oIntId )
					{
						var AccName = iKNA1MComp.GetFieldValue (""NAME1"");
					}
					else
					{
						var AccName = GetAccountName (Int_ID);
					}	
					oSoldToPartnerComp.SetFieldValue (""Sold To Partner Function"", AccName);
					if ( e2knvpm.GetFieldValue(""DEFPA"") == ""X"" ) oSoldToPartnerComp.SetFieldValue (""IsPrimaryMVG"", ""Y"");
					oSoldToPartnerComp.SetFieldValue (""operation"", ""sync"");

				}	
			}

			/* Set Parent Account Id - P Lim. 3/15/00. In our system, the component has trailing 002 */
			// iComp = iKNA1MComp.GetIntComp (""E2KNB1M005"");
			// findKNRZE: while (iComp.NextRecord ())
			// {
				// oSalesAreaAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));
				/* only get first row */
				//break findKNRZE;
			//}
		  // Set operation to ""upsert"" since we are using the ""Execute"" method
		  oSalesAreaAccountComp.SetFieldValue (""operation"", ""sync"");
		} // ... while( e2knvvm.Ne...
	} // ... while (iIDOCObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function RequestCustomerNumber_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP 47 Internal Customer Number (BAPI Output))
    *     Export Parameters (output)
    * 	    CUSTOMERID
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Send or Receive SAP 50 Customer (Siebel 77))
    *     Integration Id, Location, Sync status data (oAccount)
    */

   /*
    * Set up EAI Input Message objects
    */
   var iBAPIObj;   // BAPI object instance
   var iExportComp; // BAPI Export Parameters

   // Store inputId for later use
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;      // Siebel Account instance
   var oAccountComp;     // Account

   /*
    * Find and create top-level integration object
    */
   iBAPIObj = inputMsg.GetIntObj (""Account - Get SAP 47 Internal Customer Number (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iBAPIObj.NextInstance ())
   {
      /*
       * Create ""Account"" object
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component in output message
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iBAPIObj.GetPrimaryIntComp (""Export Parameters"");

      if (iExportComp.NextRecord ())
      {
      	 oAccountComp.SetCopySource  (iExportComp);
      	 oAccountComp.CopyFieldValue (""EAI Sync Error Text"", ""RETURN-MESSAGE"");
      	 var ErrorType = iExportComp.GetFieldValue (""RETURN-TYPE"");
      	 
      	 if (ErrorType != ""E"")
      	 {
      	 
 		 /*
      	  * Update ""Account"" component
      	  */
        	oAccountComp.CopyFieldValue (""Integration Id"", ""CUSTOMERID"");
        	var customerno = iExportComp.GetFieldValue (""CUSTOMERID"");
        	var timenow = Timestamp();
         	var SyncStat = TheApplication().InvokeMethod (""LookupValue"", ""EAI_ACCOUNT_SYNC_STATUS"", ""Created in Back Office"");
	     	oAccountComp.SetFieldValue (""EAI Sync Status Code"",  SyncStat);
	     	oAccountComp.SetFieldValue (""EAI Sync Date"",timenow);
	     	
    	
	     	/*
	     	 *	Get Address Info to create the location field with 
	     	 *     embedded customer number
	     	 */
			var AccBusObject = TheApplication().GetBusObject(""Account"");
		 	var AccBusComp   = AccBusObject.GetBusComp(""Account"");
		 
			 // Set View Mode to 3 (or AllView)
		 	AccBusComp.SetViewMode(3);  
		 
		 	AccBusComp.ClearToQuery();
    	 	AccBusComp.SetSearchSpec(""Id"", inputId);
			AccBusComp.ActivateField(""Location"");
			
		 	AccBusComp.ExecuteQuery();
		 	if(AccBusComp.FirstRecord())
			{
	  		 var city        = AccBusComp.GetFieldValue(""City"");
	  		 var location    = AccBusComp.GetFieldValue(""Location"");
	  		 
	  		 /*
	  		  *		Site
	  		  */
	  		 if (location == """")
	  		 {
	  		 	location = AccBusComp.GetFieldValue(""City"");
	  		 }
	  		 location += "" "" + customerno;
	  		 oAccountComp.SetFieldValue (""Location"", location );
			}
			  	 
	     	   	
	     }
      }
   } //   while (iCreateAccountObj.NextInstance ())
} //function RequestCustomerNumber_BAPIToSiebel"
function RequestCustomerNumber_SiebelToBAPI (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Account Object (Account - Send or Receive SAP 50 Customer (Siebel 77))
    *     Account (Account)
    *       
    *
    * Output Object's Integration Components:
    *   Account - Get SAP 47 Internal Customer Number (BAPI Input)
    */

	/* Set up EAI Lookup maps */
    var acctGroupLM = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;  // Account object instance
   var iAccountComp; // Account

   /*
    * Set up EAI Output Message objects
    */
   var oBAPIObj;    // BAPI object instance
   var oBAPIImportComp;  // BAPI Import parameters
   

   /*
    * Find and create top-level integration object
    */
   iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");
   oBAPIObj = outputMsg.CreateIntObj (""Account - Get SAP 47 Internal Customer Number (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create BAPI object in output message
       */
      oBAPIObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oBAPIImportComp = oBAPIObj.CreatePrimaryIntComp (""Import Parameters"");
      while (iAccountComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iAccountComp.GetFieldValue (""Integration Id"") != """")
	       {
			var IntId = iAccountComp.GetFieldValue (""Integration Id"");
			EAIRaiseError(LocalizeMessage(""ERR_MSG_ACCOUNT_EXISTS,""+IntId+""""));//nbc
	       }
	      /*
	       *	Validate Address
	       */
	       
	      var iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
	      var AddressFlag = ""N"";
	      if (iAddrComp.Exists ())
	      {
	      	while (iAddrComp.NextRecord())
	      	{
	      		if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
	      		{
	      			AddressFlag = ""Y"";
	      		}
	      	}
	      }
	      /*
	       * Return an error if no address is found
	       */
	      if (AddressFlag == ""N"")
	      {
	      	EAIRaiseError(LocalizeMessage(""ERR_MSG_INVALID_ADDRESS,"" + """"));
	      }

         /*
          * Write ""Import Parameters"" component
          */
         oBAPIImportComp.NewRecord ();
         oBAPIImportComp.SetFieldValue (""QUANTITY"", ""1"");
   	     var acctGroup = iAccountComp.GetFieldValue(""Customer Account Group"");
	     oBAPIImportComp.SetFieldValue (""ACCOUNTGROUP"", acctGroupLM.Translate(acctGroup));
   
      } //while (iAccountComp.NextRecord ())
   } //while (iAccountObj.NextInstance ())
} //function RequestCustomerNumber_SiebelToBAPI"
function SendAccount_SiebelToDEBMAS05 (inputMsg, outputMsg)
{
	/* Input Objects' Integration Components						
	 *   Account Object (Account - Send or Receive SAP 50 Customer (Siebel 77))
	 *
	 *	Output Object's Integration Components:
	 *			Customer IDOC (Account - Send or Receive SAP 50 Customer (DEBMAS05))
	 */
	
	/* Set up EAI Lookup maps */
	var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Outbound"");
	var languageLM = EAIGetValueMap (""SAP Language 4x"", ""Siebel Outbound"");
	var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Outbound"");
	var acctGrpLM  = EAIGetValueMap (""SAP Customer Acct Group Code"", ""Siebel Outbound"");
	var regCodeLM  = EAIGetValueMap (""Back Office Region"", ""Siebel Outbound"");
	
	/* Set up EAI Input Message objects */
	var iAccountObj;    // Siebel Account instance
	var iAccountComp;   // Account
	var iAddrComp;      // Address
	var iContactComp;   // Contact

	/* Set up EAI Output Message objects */
	var oIDOCObj;   // IDOC instance
	var oIDOCComp;  // top level IDOC segment
	var oKNA1MComp; // IDOC Customer Header
	var oComp;      // for reading child components

	/* Find and create top-level integration object	*/
	iAccountObj = inputMsg.GetIntObj (""Account - Send or Receive SAP 50 Customer (Siebel 77)"");
	oIDOCObj =  outputMsg.CreateIntObj (""Account - Send or Receive SAP 50 Customer (DEBMAS05)"");

	/* Misc set up	*/
	var generateMasterRecord = 1;   // Set to '0' to generate sub-organization records only
	var custAccntGrp;
    var currencyCode;
    var ctr = 0;
    var countryCode;
    var regCode;
    var sapCode;
	
	/* Read int object instances from EAI message */
	enumObj: while (iAccountObj.NextInstance ())
	{
		/* Read root Account component */
		iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
		if( !iAccountComp.NextRecord() ) continue enumObj;
		
		/*
         * Return an error if Integration Id is not null
         */
			if (iAccountComp.GetFieldValue (""Integration Id"") == """")
		    {
				var errMsg = iAccountComp.GetFieldValue (""EAI Sync Error Text"");
				EAIRaiseError ( errMsg );
	       	}

		/* Create ""IDOC"" object	*/
		oIDOCObj.NewInstance ();

		/* Create ""IDOC"" component in output message */
		oIDOCComp = oIDOCObj.CreatePrimaryIntComp (""Idoc Segments"");
		oIDOCComp.NewRecord ();
		oKNA1MComp = oIDOCComp.CreateIntComp (""E2KNA1M005"",false);
		oKNA1MComp.NewRecord ();	
		oKNA1MComp.SetCopySource (iAccountComp);

		/* Set Integration Id, Name	and Account Group*/
		oKNA1MComp.CopyFieldValue (""KUNNR"", ""Integration Id"");
		oKNA1MComp.CopyFieldValue (""NAME1"", ""Name"");
		oKNA1MComp.SetFieldValue (""KTOKD"", acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group"")));

		/* Set location	*/
		// oKNA1MComp.CopyFieldValue (""ORT01"", ""Location"");
	
		/* Account Status */
		// oKNA1MComp.CopyFieldValue (""AUFSD"", ""Account Status"" );
		oKNA1MComp.SetFieldValue (""LOEVM"", """");
		if (iAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
			oKNA1MComp.SetFieldValue (""LOEVM"", ""X""); 

		/* Primary Industry */
		// oKNA1MComp.CopyFieldValue (""BRSCH"", ""Primary Industry Id"");

		/* Tax Exempt Number (not created in bus comp for VAT_REGN_NUM yet) */
		// oKNA1MComp.CopyFieldValue (""STCEG"", """" );

		/* Search Term */
		oKNA1MComp.CopyFieldValue (""SORTL"", ""Name"");			

		/* Transportation Zone */
		// oKNA1MComp.SetFieldValue (""LZONE"", ""0000000001"");			

		/* Set language code */
		oKNA1MComp.SetFieldValue (""SPRAS"", languageLM.Translate (iAccountComp.GetFieldValue (""Language Code"")));
		
		/* Set main Phone/FAX numbers */
		oKNA1MComp.CopyFieldValue (""TELF1"", ""Main Phone Number"" );
		oKNA1MComp.CopyFieldValue (""TELFX"", ""Main Fax Number"" );
		
	
		/* Read ""KNVKM"" component */
		iContactComp = iAccountComp.GetIntComp (""Contact"");
		oComp = oKNA1MComp.CreateIntComp (""E2KNVKM001"", false);
		while (iContactComp.NextRecord ())
		{
			/* Write ""Contact"" component */

			oComp.NewRecord ();
			oComp.SetCopySource  (iContactComp);
			// oComp.CopyFieldValue (""PARNR"", ""Integration Id"");
			// oComp.CopyFieldValue (""PARNR"", ""Employee Number"");

			/* Set First Name */
			oComp.CopyFieldValue (""NAMEV"", ""First Name"");

			/* Set Last name */
			oComp.CopyFieldValue (""NAME1"", ""Last Name"");

			/* Set job title */
			oComp.CopyFieldValue (""TITEL_AP"", ""Job Title"");
			oComp.CopyFieldValue (""ANRED"", ""M/M"");
			oComp.CopyFieldValue ( ""TELF1"", ""Work Phone #"");
		} // while (iContactComp.NextRecord ())

		/* Write ""Address"" component */
		iAddrComp = iAccountComp.GetIntComp (""Account_Business Address"");
		while (iAddrComp.NextRecord () )
		{
			oKNA1MComp.SetCopySource(iAddrComp);
			if (iAddrComp.GetFieldValue (""IsPrimaryMVG"") == ""Y"")
			{

			// Set telephone numbers
			// oKNA1MComp.CopyFieldValue (""TELF1"", ""Phone Number"" );
			// oKNA1MComp.CopyFieldValue (""TELFX"", ""Fax Number"" );

			// Set Street address
			oKNA1MComp.CopyFieldValue  (""STRAS"", ""Street Address"");
			oKNA1MComp.CopyFieldValue (""ORT01"", ""City"");
			countryCode = countryLM.Translate (iAddrComp.GetFieldValue (""Country""));
			oKNA1MComp.SetFieldValue (""LAND1"", countryLM.Translate (iAddrComp.GetFieldValue (""Country"")));
			
// nbc 11/10/01. CR#12-90S337 - The EAI value maps for State / Region is missing 
			regCode = regCodeLM.Translate (iAddrComp.GetFieldValue (""State""));	//12-90S337
			sapCode = regCode.substring(3,5);									//12-90S337
			oKNA1MComp.SetFieldValue (""REGIO"", sapCode );						//12-90S337
	
			oKNA1MComp.CopyFieldValue (""PSTLZ"", ""Postal Code"" );
			
		// Set operation to ""upsert"" since we are using the ""Execute"" method.
			oKNA1MComp.SetFieldValue (""operation"", ""upsert"");
			}
		}
		

/* Process Sales Area Account */

		var iSalesAreaAccountComp = iAccountComp.GetIntComp (""SAP 4x Account Sales Area"");
		var e2knvvm = oKNA1MComp.CreateIntComp (""E2KNVVM006"", false);
			
		enumOrg: while (iSalesAreaAccountComp.NextRecord() )
		{
			/* Create ""Account"" component in output message	*/

			e2knvvm.NewRecord ();
			e2knvvm.SetCopySource ( iSalesAreaAccountComp );


			/* Set sales organization */

			e2knvvm.CopyFieldValue( ""VKORG"", ""Back Office Sales Organization"");
			e2knvvm.CopyFieldValue( ""VTWEG"", ""Back Office Distribution Channel"");
			e2knvvm.CopyFieldValue( ""SPART"", ""Back Office Sales Area Division Code"");
			
			/* Account Status (for Sales Area Accounts) */
			// e2knvvm.CopyFieldValue (""AUFSD"", ""Account Status"");
			if (iSalesAreaAccountComp.GetFieldValue (""Account Status"") == ""Marked For Deletion"")
				e2knvvm.SetFieldValue( ""LOEVM"", ""X"");

			/* Freight Terms a.k.a Incoterms 1 */
			// e2knvvm.CopyFieldValue (""INCO1"", ""Freight Terms"");

			/* Freight Terms Info a.k.a Incoterms 2 */
			// e2knvvm.CopyFieldValue (""INCO2"", ""Freight Terms Info"");

			/* Primary Fullfilment Inventory Location Id  */
			// e2knvvm.CopyFieldValue (""VWERK"", ""Primary Fulfillment InvLoc ID"");

			/* Payment Terms */
			// e2knvvm.CopyFieldValue (""ZTERM"", ""Payment Terms"");

			/* Price List Type */
			// e2knvvm.CopyFieldValue (""PLTYP"", ""Price List Type"");

			/* Account Type / Customer Group  */
               e2knvvm.SetFieldValue( ""KDGRP"", iSalesAreaAccountComp.GetFieldValue(""Type"" ));
			
			/* Customer Stats Group */
			   e2knvvm.SetFieldValue (""VERSG"", ""/"");

			// e2knvvm.SetFieldValue (""PERFK"", ""US"");

			/* Sales District Code */
			// e2knvvm.SetFieldValue (""BZIRK"", ""CENTRE"");			

			/* Pricing Group Code */
			// e2knvvm.SetFieldValue (""KONDA"", ""02"");

			/* Pricing Procedure */
 			e2knvvm.SetFieldValue (""KALKS"", ""/"");

			/* Shipping Conditions */
			var shpCond = iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions"");
			if ( shpCond == """" )
				e2knvvm.SetFieldValue (""VSBED"", ""02""); // Change Me
			else
				e2knvvm.SetFieldValue (""VSBED"", iSalesAreaAccountComp.GetFieldValue(""Shipping Conditions""));

			/* Set currency code */
			var sCurCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
			if ( sCurCode == """")
				currencyCode = TheApplication().CurrencyCode();
			else
				currencyCode = iSalesAreaAccountComp.GetFieldValue (""Currency Code"");
				
			e2knvvm.SetFieldValue (""WAERS"", currencyLM.Translate (currencyCode));

			/* Set Block Credit Flag */
//			var e2knkkm = oKNA1MComp.CreateIntComp(""E2KNKKM001"",false);
//			var iCrdtCtlAreaComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Credit Control Area"");
//			while (iCrdtCtlAreaComp.NextRecord () )
//			{
//				e2knkkm.NewRecord ();
//				e2knkkm.SetCopySource (iCrdtCtlAreaComp);
//				e2knkkm.CopyFieldValue (""KKBER"", ""Credit Control Area Code"");
//				e2knkkm.CopyFieldValue (""CRBLB"", ""Block Credit Flag"");
//				e2knkkm.SetFieldValue (""operation"", ""upsert"");
//			}

			/* Tax classification */
			// var iTaxCode = e2knvvm004.CreateIntComp (""E2KNVIM"",false);
			// iTaxCode.NewRecord ();
			// iTaxCode.SetFieldValue (""TAXKD"",""0"");
			
			/* Set Primary Partner Relationships of Sales Area Accounts */
			var acctGrp = acctGrpLM.Translate (iAccountComp.GetFieldValue(""Customer Account Group""));
			var intId   = iAccountComp.GetFieldValue (""Integration Id"");
			if ( acctGrp == ""0001"" || acctGrp == ""0002"" )
			{
			
			var e2knvpm = e2knvvm.CreateIntComp (""E2KNVPM002"",false);

			var iShipToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Ship To)"");	
			var iPayerPartnerComp  = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Payer)"");
			var iBillToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Bill To)"");
			var iSoldToPartnerComp = iSalesAreaAccountComp.GetIntComp (""SAP 4x Account Sales Area_Account Partner Function (Sold To)"");

			var i = 0;
			enumShipToPartner: while (iShipToPartnerComp.NextRecord () )
			{
				// Default Ship To Partner 
				if ( iShipToPartnerComp.GetFieldValue(""Ship To Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource( iShipToPartnerComp );
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
   					e2knvpm.SetFieldValue (""PARVW"", ""WE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 )
			{
				e2knvpm.NewRecord ();
		   		e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""WE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			if ( acctGrp == ""0002"" )  goto SoldToPartner;

			i = 0;
			enumPayerPartner: while (iPayerPartnerComp.NextRecord () )
			{
				// Default Payer Partner 
				if ( iPayerPartnerComp.GetFieldValue(""Payer Partner Function"") )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iPayerPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RG"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}
	
			i = 0;
			enumBillToPartner: while (iBillToPartnerComp.NextRecord () )
			{
				// Default Bill To Partner 
				if ( iBillToPartnerComp.GetFieldValue(""Bill To Partner Function"")  )
				{
					e2knvpm.NewRecord ();
					e2knvpm.SetCopySource (iBillToPartnerComp);
					e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
					e2knvpm.SetFieldValue (""PARVW"", ""RE"");
					e2knvpm.SetFieldValue (""operation"", ""upsert"");
					i++;
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""RE"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			SoldToPartner:
			i = 0;
			enumSoldToPartner: while (iSoldToPartnerComp.NextRecord () )
			{
				// Default Sold To Partner 
				if ( iSoldToPartnerComp.GetFieldValue(""Sold To Partner Function"")  )
				{
					if (( iSoldToPartnerComp.GetFieldValue(""Integration Id"") != intId )) 
					{	
						e2knvpm.NewRecord ();
						e2knvpm.SetCopySource (iSoldToPartnerComp);
						e2knvpm.CopyFieldValue (""KUNN2"", ""Integration Id"" );
						e2knvpm.SetFieldValue (""PARVW"", ""AG"");
						e2knvpm.SetFieldValue (""operation"", ""upsert"");
						i++;
					}
				}	
			}
			if ( i == 0 && acctGrp == ""0001"" )
			{
				e2knvpm.NewRecord ();
	   			e2knvpm.SetFieldValue (""KUNN2"", intId);
				e2knvpm.SetFieldValue (""PARVW"", ""AG"");
				e2knvpm.SetFieldValue (""operation"", ""upsert"");
			}

			/* Set operation to ""upsert"" since we are using the ""Execute"" method. */
			e2knvvm.SetFieldValue (""operation"", ""upsert"");
			}

		} // enumOrg: while( iSalesAreaAccountComp.NextRecord() )
		/* Set Company Code & Parent Account Id	*/
		// var oCoCodeComp = oKNA1MComp.CreateIntComp (""E2KNB1M005"",false);
		// oCoCodeComp.NewRecord ();
		// oCoCodeComp.SetCopySource(iAccountComp);
		// oCoCodeComp.CopyFieldValue (""KNRZE"", ""Parent Account Integration Id"");
		// oCoCodeComp.SetFieldValue (""BUKRS"", ""0010"");
		// oCoCodeComp.SetFieldValue (""AKONT"", ""121000"");

	} // ... while (iAccountObj.NextInstance ())
} // ... ReceiveSAPCustomer_IDOCToSiebel"
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"
function Timestamp()
{
	var d = Date.fromSystem(Clib.time());

	// Return date in the format MM/DD/YYYY HH:MM:SS
	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
	  d.getHours(), d.getMinutes(), d.getSeconds());
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    P. Lim
//
// DESCRIPTION
//    Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function GetSAPOrderList_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP Order List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Get SAP Order List (Siebel))
    *     Account (oAccount)
    *       Get List for Account Output
    *       Get List for Account Header
    *         Get List for Account Item
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;   // BAPI Order instance
   var iGLExportComp; // BAPI Export Parameters
   var iGLHeaderComp; // BAPI Order Header
   var iGLItemComp;   // BAPI Order Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;   // Siebel Order instance
   var oAccountComp;  // Account
   var oGLOutputComp; // Get List Output
   var oGLHeaderComp; // Get List Header
   var oGLItemComp;   // Get List Item

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Get SAP Order List (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Get SAP Order List (Siebel)"");

   /*
    * Read int object instances from EAI message
    */
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Account"" object in output message
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iGLExportComp = iGLOrderObj.GetPrimaryIntComp (""Export Parameters"");
      oGLOutputComp = oAccountComp.CreateIntComp (""Get List for Account Output"", oAccountComp);
      if (iGLExportComp.NextRecord ())
      {
         /*
          * Write ""Get List for Account Output"" component
          */
         oGLOutputComp.NewRecord ();
         oGLOutputComp.SetCopySource  (iGLExportComp);
         oGLOutputComp.SetFieldValue  (""Input Id"",          inputId);
         oGLOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oGLOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oGLOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");

         /*
          * Read ""Order Header"" component to 
          */
         iGLHeaderComp = iGLExportComp.GetIntComp (""Order Header"");
         oGLHeaderComp = oAccountComp.CreateIntComp (""Get List for Account Header"", oAccountComp);
         while (iGLHeaderComp.NextRecord ())
         {
            oGLHeaderComp.NewRecord ();
            oGLHeaderComp.SetCopySource  (iGLHeaderComp);
            oGLHeaderComp.SetFieldValue  (""Input Id"",         inputId);
            oGLHeaderComp.CopyFieldValue (""Currency"",             ""CURRENCY"");
            oGLHeaderComp.CopyFieldValue (""Distribution Channel"", ""DISTR_CHAN"");
            oGLHeaderComp.CopyFieldValue (""Division"",             ""DIVISION"");
            oGLHeaderComp.CopyFieldValue (""Order Date"",           ""DOC_DATE"");
            oGLHeaderComp.CopyFieldValue (""Order Number"",         ""SD_DOC"");
            oGLHeaderComp.CopyFieldValue (""Order Status"",         ""DOC_STATUS"");
            oGLHeaderComp.CopyFieldValue (""Order Type"",           ""DOC_TYPE"");
            oGLHeaderComp.CopyFieldValue (""Purchase Order"",       ""PURCH_NO"");
            oGLHeaderComp.CopyFieldValue (""Sales Organization"",   ""SALES_ORG"");
            oGLHeaderComp.CopyFieldValue (""Sold To Customer"",     ""SOLD_TO"");

            /*
             * Read the ""Order Item"" component
             */
            // to ""Get List for Account Item"" component
            iGLItemComp = iGLHeaderComp.GetIntComp (""Order Item"");
            oGLItemComp = oGLHeaderComp.CreateIntComp (""Get List for Account Item"", oGLHeaderComp);
            while (iGLItemComp.NextRecord ())
            {
               oGLItemComp.NewRecord ();
               oGLItemComp.SetCopySource  (iGLItemComp);
               oGLItemComp.SetFieldValue  (""Input Id"",         inputId);
               oGLItemComp.CopyFieldValue (""Item Number"",          ""ITM_NUMBER"");
               oGLItemComp.CopyFieldValue (""Material Part Number"", ""MATERIAL"");
               oGLItemComp.CopyFieldValue (""Material Short Text"",  ""SHORT_TEXT"");
               oGLItemComp.CopyFieldValue (""Net Price"",            ""NET_PRICE"");
               oGLItemComp.CopyFieldValue (""Net Value"",            ""NET_VALUE"");
               oGLItemComp.CopyFieldValue (""Sales Unit"",           ""SALES_UNIT"");
            }
         }
      }
   }
}
"
function GetSAPOrderList_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Account Object (Account - Get SAP Order List (Siebel))
    *     Account (iAccount)
    *
    * Output Object's Integration Components:
    *   BAPI Import (Account - Get SAP Order List (BAPI Input))
    *     Import Parameters (output)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iAccountObj;    // Siebel Account instance
   var iAccountComp;   // Account

   /*
    * Set up EAI Output Message objects
    */
   var oGLObj;         // BAPI instance
   var oGLImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */
   iAccountObj = inputMsg.GetIntObj (""Account - Get SAP Order List (Siebel)"");
   oGLObj = outputMsg.CreateIntObj (""Account - Get SAP Order List (BAPI Input)"");

   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create ""Get List for Account"" object
       */
      oGLObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oGLImportComp = oGLObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iAccountComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGLImportComp.NewRecord ();
         oGLImportComp.SetCopySource  (iAccountComp);
         oGLImportComp.CopyFieldValue (""CUSTOMER_NUMBER"", ""Integration Id"");
         oGLImportComp.SetFieldValue  (""MATERIAL"", """");
         oGLImportComp.SetFieldValue  (""SALES_ORGANIZATION"", """");
         oGLImportComp.SetFieldValue  (""PURCHASE_ORDER"", """"); // ""Peter 1"";
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE"", """");    // Empty string means ""00000000""
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE_TO"", """"); // Empty string means ""00000000""
      }
   }
}
"
function ImportSAPOrder_GetSAPOrderListToSiebelOrder (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Import Get List for Account (Account - Import SAP Order (Get SAP Order List))
    *     Get List for Account Header
    *
    * Output Object's Integration Components:
    *   Import (Account - Import SAP Order (Siebel Order))
    *     Order (oOrder)
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;  // Get List instance
   var iGLOrderComp; // Get List Order

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Import SAP Order (Get SAP Order List)"");
   oOrderObj = outputMsg.CreateIntObj (""Account - Import SAP Order (Siebel Order)"");

   /*
    * Read int object instances from EAI message
    */
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Read ""Get List Order"" component
       */
      iGLOrderComp = iGLOrderObj.GetPrimaryIntComp (""Get List for Account Header"");
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");

      while (iGLOrderComp.NextRecord ())
      {
         /*
          * Write ""Order"" component
          */
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iGLOrderComp);

         oOrderComp.CopyFieldValue (""Order Number"",           ""Order Number"");
         oOrderComp.SetFieldValue  (""Order Type"",
                                    orderTypeLM.Translate (iGLOrderComp.GetFieldValue (""Order Type"")));
         oOrderComp.CopyFieldValue (""Order Date"",             ""Order Date"");
         oOrderComp.CopyFieldValue (""Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Integration Id"",         ""Order Number"");
         oOrderComp.CopyFieldValue (""SAP Sales Area"",         ""SAP Sales Area"");
         // PLim. ??? Set Organization until we can figure out how to fix dup key index problem
         // oOrderComp.SetFieldValue  (""Organization"",         ""Siebel Administration"");
      }
   }
}
"
function ReceiveSAPCustomer_IDOCToSiebel (inputMsg, outputMsg)
{
   var app = TheApplication();
   var msg;

   /* Input Objects' Integration Components
    *   Customer IDOC (Account - Receive SAP Customer (IDOC Input))
    *     E2KNA1M
    *       E2KNB1M002 (?)
    *       E2KNVKM (?)
    *       E2KNVVM (?)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Receive SAP Customer (Siebel))
    *     Account (oAccount)
    *       Contact
    *       Business Address
    */

   /*
    * Set up EAI Lookup maps
    */
   var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");
   var languageLM = EAIGetValueMap (""SAP Language"", ""Siebel Inbound"");
   var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iIDOCObj;   // IDOC instance
   var iIDOCComp;  // top level IDOC segment
   var iKNA1MComp; // IDOC Customer Header
   var iComp;      // for reading child components

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;    // Siebel Account instance
   var oAccountComp;   // Account
   var oAddrComp;      // Address
   var oContactComp;   // Contact

   /*
    * Find and create top-level integration object
    */
   iIDOCObj = inputMsg.GetIntObj (""Account - Receive SAP Customer (IDOC Input)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Receive SAP Customer (Siebel)"");

   /*
    * Read int object instances from EAI message
    */
   while (iIDOCObj.NextInstance ())
   {
      /*
       * Create ""Account"" object
       */
      oAccountObj.NewInstance ();

      // app.MsgBox("foo"");

      /*
       * Read virtual root component that IDOC RFC Adapter populates
       */
      iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
      iIDOCComp.NextRecord ();

      /*
       * Read ""KNA1M"" component
       */
      iKNA1MComp = iIDOCComp.GetIntComp (""E2KNA1M"");
      if (iKNA1MComp.NextRecord ())
      {
         /*
          * Create ""Account"" component in output message
          */
         oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
         oAccountComp.NewRecord ();
         oAccountComp.SetCopySource (iKNA1MComp);

         /*
          * Set Integration Id and Name
          */
         oAccountComp.CopyFieldValue (""Integration Id"", ""KUNNR"");
         oAccountComp.CopyFieldValue (""Name"",           ""NAME1"");

         /*
          * Set location to ""<City> KUNNR1""
          * If <City> is null, put ""No City""
          */
         var location;
         location = iKNA1MComp.GetFieldValue (""ORT01"");
         if (location == null)
            location = ""No City"";
         location += "" "" + iKNA1MComp.GetFieldValue (""KUNNR"");

         oAccountComp.SetFieldValue (""Location"",   location);

         /* Check if product is marked as deleted */
         /* P Lim. 3/16/00. Deletes not supported in this release. 
            Next release: Add a column to show that the item is marked for deletion. */
         // if (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X"")
         // {  /* The customer is marked as deleted: delete the account from Siebel */
         //   oAccountComp.SetFieldValue (""operation"", ""delete"");
         //   continue;
         // }

         // Set operation to ""upsert"" since we are using the ""Execute"" method.
         oAccountComp.SetFieldValue (""operation"", ""upsert"");

         /*
          * Set telephone numbers
          */
         oAccountComp.CopyFieldValue (""Main Phone Number"", ""TELF1"");
         oAccountComp.CopyFieldValue (""Main Fax Number"",   ""TELFX"");

         /*
          * Set other fields
          */
         // Defaults from buscomp:
         // oAccountComp.CopyFieldValue (account, ""Account Status"", ""Active"");
         // oAccountComp.CopyFieldValue (account, ""Disable DataCleansing"", ""N"");
         oAccountComp.CopyFieldValue (""Row Status"", ""Y"");

         /*
          * Set language code
          */
         oAccountComp.SetFieldValue (""Language Code"",
                                     languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS"")));

         /*
          * Set currency code
          */
         iComp = iKNA1MComp.GetIntComp (""E2KNVVM"");
         var currencyCode = null;
         while (iComp.NextRecord ())
         {
            // msg = ""SalesOrg: "" + iComp.GetFieldValue (""VKORG"");
            // app.MsgBox(msg);

            // Find sales area specific unit of measure
            if (iComp.GetFieldValue (""VKORG"") == ""0010"")
            {
               if (iComp.GetFieldValue (""LOEVM"") == ""X"")
               {  /* the sales area specific info is marked as deleted: set values to empty string */
                  /* NOTE: in the multiorg maps, should delete the account for this sales area */
                  currencyCode = """";
               }
               else
               {
                  currencyCode = currencyLM.Translate (iComp.GetFieldValue (""WAERS""));
               }
               break;
            }
         }
         /* P Lim. 3/29/00. 12-1CI2UC: Currency Code is a required field */
         if (currencyCode != null && currencyCode != """")
         {
            oAccountComp.SetFieldValue (""Currency Code"", currencyCode);
         }


         /*
          * Set Parent Account Id
          */
         /* P Lim. 3/15/00. In our system, the component has trailing 002 */
         iComp = iKNA1MComp.GetIntComp (""E2KNB1M002"");
         while (iComp.NextRecord ())
         {
            // msg = ""KNRZE: "" + iComp.GetFieldValue (""KNRZE"");
            // app.MsgBox(msg);

            oAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));

            /* only get first row */
            break;
         }

         /*
          * Write ""Address"" component
          */
         oAddrComp = oAccountComp.CreateIntComp (""Business Address"", oAccountComp);
         oAddrComp.NewRecord ();
         oAddrComp.SetCopySource (iKNA1MComp);
         oAddrComp.CopyFieldValue (""Integration Id"", ""KUNNR"");

         // Set Street address
         var stras = iKNA1MComp.GetFieldValue (""STRAS""); // Street address
         var pfach = iKNA1MComp.GetFieldValue (""PFACH""); // PO Box
         var street;

         if (stras == """" && pfach == """")
            street = ""None"";
         else if (stras != """" && pfach == """")
            street = stras;
         else if (stras != """" && pfach != """")
            street = stras + "" P.O. Box "" + pfach;
         else if (stras == """" && pfach != """")
            street = ""P.O. Box "" + pfach;
         oAddrComp.SetFieldValue  (""Street Address"", street);

         oAddrComp.CopyFieldValue (""City"",    ""ORT01"", ""None"", ""None"");
         oAddrComp.SetFieldValue  (""Country"", countryLM.Translate (iKNA1MComp.GetFieldValue (""LAND1"")));

         // Set Province and State depending on whether address is in the US
         if (iKNA1MComp.GetFieldValue (""LAND1"") == ""US"")
         {
            oAddrComp.SetFieldValue  (""Province"", """");
            oAddrComp.CopyFieldValue (""State"",    ""REGIO"");
         }
         else
         {
            oAddrComp.CopyFieldValue (""Province"", ""REGIO"");
            oAddrComp.SetFieldValue  (""State"",     """");
         }
         oAddrComp.CopyFieldValue (""Postal Code"", ""PSTLZ"");

         // Defaults from buscomp
         // oAddRComp.SetFieldValue  (""Disable DataCleansing"", ""N"");

         /*
          * Read ""KNVKM"" component
          */
         iComp   = iKNA1MComp.GetIntComp (""E2KNVKM"");
         oContactComp = oAccountComp.CreateIntComp (""Contact"", oAccountComp);
         while (iComp.NextRecord ())
         {
            /*
             * Write ""Contact"" component
             */
            oContactComp.NewRecord ();
            oContactComp.SetCopySource  (iComp);
            oContactComp.CopyFieldValue (""Integration Id"", ""PARNR"");

            oContactComp.CopyFieldValue (""Employee Number"", ""PARNR"");

            // Set creator login
            // Defaults to ""System: Creator""
            // oContactComp.SetFieldValue (""Create Login"", ""SADMIN"");

            // Set First Name
            oContactComp.CopyFieldValue (""First Name"", ""NAMEV"", ""No First Name"", ""No First Name"");

            // Set Last name
            oContactComp.CopyFieldValue (""Last Name"", ""NAME1"");

            // Set job title
            oContactComp.CopyFieldValue (""Job Title"",    ""TITEL_AP"");
            oContactComp.CopyFieldValue (""M/M"",          ""ANRED"");
            oContactComp.CopyFieldValue (""Work Phone #"", ""TELF1"");

            // flags
            oContactComp.CopyFieldValue (""Personal Contact"",      ""N"");
            oContactComp.CopyFieldValue (""Suppress All Mailings"", ""Y"");
            oContactComp.CopyFieldValue (""Row Status"", ""Y"");

            // buscomp defaults to ""N""
            // oContactComp.CopyFieldValue (""Disable DataCleansing"", ""N"");
            // oContactComp.CopyFieldValue (""Email SR Updates Flag"", ""N"");
         }
      }
   }
}
function ReceiveSAPCustomer_IDOCToSiebel_4x (inputMsg, outputMsg)
{
   var app = TheApplication();
   var msg;

   /* Input Objects' Integration Components
    *   Customer IDOC (Account - Receive SAP Customer (4x IDOC Input))
    *     E2KNA1M
    *       E2KNB1M002 (?)
    *       E2KNVKM (?)
    *       E2KNVVM (?)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Receive SAP Customer (Siebel))
    *     Account (oAccount)
    *       Contact
    *       Business Address
    */

   /*
    * Set up EAI Lookup maps
    */
   var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");
   var languageLM = EAIGetValueMap (""SAP Language"", ""Siebel Inbound"");
   var countryLM  = EAIGetValueMap (""SAP Country"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iIDOCObj;   // IDOC instance
   var iIDOCComp;  // top level IDOC segment
   var iKNA1MComp; // IDOC Customer Header
   var iComp;      // for reading child components

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;    // Siebel Account instance
   var oAccountComp;   // Account
   var oAddrComp;      // Address
   var oContactComp;   // Contact

   /*
    * Find and create top-level integration object
    */
   iIDOCObj = inputMsg.GetIntObj (""Account - Receive SAP Customer (4x IDOC Input)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Receive SAP Customer (Siebel)"");

   /*
    * Read int object instances from EAI message
    */
   while (iIDOCObj.NextInstance ())
   {
      /*
       * Create ""Account"" object
       */
      oAccountObj.NewInstance ();

      // app.MsgBox("foo"");

      /*
       * Read virtual root component that IDOC RFC Adapter populates
       */
      iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
      iIDOCComp.NextRecord ();

      /*
       * Read ""KNA1M"" component
       */
      iKNA1MComp = iIDOCComp.GetIntComp (""E2KNA1M"");
      if (iKNA1MComp.NextRecord ())
      {
         /*
          * Create ""Account"" component in output message
          */
         oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
         oAccountComp.NewRecord ();
         oAccountComp.SetCopySource (iKNA1MComp);

         /*
          * Set Integration Id and Name
          */
         oAccountComp.CopyFieldValue (""Integration Id"", ""KUNNR"");
         oAccountComp.CopyFieldValue (""Name"",           ""NAME1"");

         /*
          * Set location to ""<City> KUNNR1""
          * If <City> is null, put ""No City""
          */
         var location;
         location = iKNA1MComp.GetFieldValue (""ORT01"");
         if (location == null)
            location = ""No City"";
         location += "" "" + iKNA1MComp.GetFieldValue (""KUNNR"");

         oAccountComp.SetFieldValue (""Location"",   location);

         /* Check if product is marked as deleted */
         /* P Lim. 3/16/00. Deletes not supported in this release. 
            Next release: Add a column to show that the item is marked for deletion. */
         // if (iKNA1MComp.GetFieldValue (""LOEVM"") == ""X"")
         // {  /* The customer is marked as deleted: delete the account from Siebel */
         //   oAccountComp.SetFieldValue (""operation"", ""delete"");
         //   continue;
         // }

         // Set operation to ""upsert"" since we are using the ""Execute"" method.
         oAccountComp.SetFieldValue (""operation"", ""upsert"");

         /*
          * Set telephone numbers
          */
         oAccountComp.CopyFieldValue (""Main Phone Number"", ""TELF1"");
         oAccountComp.CopyFieldValue (""Main Fax Number"",   ""TELFX"");

         /*
          * Set other fields
          */
         // Defaults from buscomp:
         // oAccountComp.CopyFieldValue (account, ""Account Status"", ""Active"");
         // oAccountComp.CopyFieldValue (account, ""Disable DataCleansing"", ""N"");
         oAccountComp.CopyFieldValue (""Row Status"", ""Y"");

         /*
          * Set language code
          */
         oAccountComp.SetFieldValue (""Language Code"",
                                     languageLM.Translate (iKNA1MComp.GetFieldValue (""SPRAS"")));

         /*
          * Set currency code
          */
         iComp = iKNA1MComp.GetIntComp (""E2KNVVM"");
         var currencyCode = null;
         while (iComp.NextRecord ())
         {
            // msg = ""SalesOrg: "" + iComp.GetFieldValue (""VKORG"");
            // app.MsgBox(msg);

            // Find sales area specific unit of measure
            if (iComp.GetFieldValue (""VKORG"") == ""0010"")
            {
               if (iComp.GetFieldValue (""LOEVM"") == ""X"")
               {  /* the sales area specific info is marked as deleted: set values to empty string */
                  /* NOTE: in the multiorg maps, should delete the account for this sales area */
                  currencyCode = """";
               }
               else
               {
                  currencyCode = currencyLM.Translate (iComp.GetFieldValue (""WAERS""));
               }
               break;
            }
         }
         /* P Lim. 3/29/00. 12-1CI2UC: Currency Code is a required field */
         if (currencyCode != null && currencyCode != """")
         {
            oAccountComp.SetFieldValue (""Currency Code"", currencyCode);
         }


         /*
          * Set Parent Account Id
          */
         /* P Lim. 3/15/00. In our system, the component has trailing 002 */
         iComp = iKNA1MComp.GetIntComp (""E2KNB1M002"");
         while (iComp.NextRecord ())
         {
            // msg = ""KNRZE: "" + iComp.GetFieldValue (""KNRZE"");
            // app.MsgBox(msg);

            oAccountComp.SetFieldValue (""Parent Account Integration Id"", iComp.GetFieldValue (""KNRZE""));

            /* only get first row */
            break;
         }

         /*
          * Write ""Address"" component
          */
         oAddrComp = oAccountComp.CreateIntComp (""Business Address"", oAccountComp);
         oAddrComp.NewRecord ();
         oAddrComp.SetCopySource (iKNA1MComp);
         oAddrComp.CopyFieldValue (""Integration Id"", ""KUNNR"");

         // Set Street address
         var stras = iKNA1MComp.GetFieldValue (""STRAS""); // Street address
         var pfach = iKNA1MComp.GetFieldValue (""PFACH""); // PO Box
         var street;

         if (stras == """" && pfach == """")
            street = ""None"";
         else if (stras != """" && pfach == """")
            street = stras;
         else if (stras != """" && pfach != """")
            street = stras + "" P.O. Box "" + pfach;
         else if (stras == """" && pfach != """")
            street = ""P.O. Box "" + pfach;
         oAddrComp.SetFieldValue  (""Street Address"", street);

         oAddrComp.CopyFieldValue (""City"",    ""ORT01"", ""None"", ""None"");
         oAddrComp.SetFieldValue  (""Country"", countryLM.Translate (iKNA1MComp.GetFieldValue (""LAND1"")));

         // Set Province and State depending on whether address is in the US
         if (iKNA1MComp.GetFieldValue (""LAND1"") == ""US"")
         {
            oAddrComp.SetFieldValue  (""Province"", """");
            oAddrComp.CopyFieldValue (""State"",    ""REGIO"");
         }
         else
         {
            oAddrComp.CopyFieldValue (""Province"", ""REGIO"");
            oAddrComp.SetFieldValue  (""State"",     """");
         }
         oAddrComp.CopyFieldValue (""Postal Code"", ""PSTLZ"");

         // Defaults from buscomp
         // oAddRComp.SetFieldValue  (""Disable DataCleansing"", ""N"");

         /*
          * Read ""KNVKM"" component
          */
         iComp   = iKNA1MComp.GetIntComp (""E2KNVKM"");
         oContactComp = oAccountComp.CreateIntComp (""Contact"", oAccountComp);
         while (iComp.NextRecord ())
         {
            /*
             * Write ""Contact"" component
             */
            oContactComp.NewRecord ();
            oContactComp.SetCopySource  (iComp);
            oContactComp.CopyFieldValue (""Integration Id"", ""PARNR"");

            oContactComp.CopyFieldValue (""Employee Number"", ""PARNR"");

            // Set creator login
            // Defaults to ""System: Creator""
            // oContactComp.SetFieldValue (""Create Login"", ""SADMIN"");

            // Set First Name
            oContactComp.CopyFieldValue (""First Name"", ""NAMEV"", ""No First Name"", ""No First Name"");

            // Set Last name
            oContactComp.CopyFieldValue (""Last Name"", ""NAME1"");

            // Set job title
            oContactComp.CopyFieldValue (""Job Title"",    ""TITEL_AP"");
            oContactComp.CopyFieldValue (""M/M"",          ""ANRED"");
            oContactComp.CopyFieldValue (""Work Phone #"", ""TELF1"");

            // flags
            oContactComp.CopyFieldValue (""Personal Contact"",      ""N"");
            oContactComp.CopyFieldValue (""Suppress All Mailings"", ""Y"");
            oContactComp.CopyFieldValue (""Row Status"", ""Y"");

            // buscomp defaults to ""N""
            // oContactComp.CopyFieldValue (""Disable DataCleansing"", ""N"");
            // oContactComp.CopyFieldValue (""Email SR Updates Flag"", ""N"");
         }
      }
   }
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   return EAIExecuteMap (MethodName, Inputs, Outputs);
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Account to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
"
function GetSAPOrderList_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (Account - Get SAP Order List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *
    * Output Object's Integration Components:
    *   Account Object (Account - Get SAP Order List (MO))
    *     Account (oAccount)
    *       Get List for Account Output
    *       Get List for Account Header
    *         Get List for Account Item
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;   // BAPI Order instance
   var iGLExportComp; // BAPI Export Parameters
   var iGLHeaderComp; // BAPI Order Header
   var iGLItemComp;   // BAPI Order Item

   // Store inputId (ROW_ID) to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Account Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oAccountObj;   // Siebel Order instance
   var oAccountComp;  // Account
   var oGLOutputComp; // Get List Output
   var oGLHeaderComp; // Get List Header
   var oGLItemComp;   // Get List Item

   var theApp = TheApplication();

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Get SAP Order List (BAPI Output)"");
   oAccountObj = outputMsg.CreateIntObj (""Account - Get SAP Order List (MO)"");

   /*
    * Read int object instances from EAI message
    */
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Account"" object in output message
       */
      oAccountObj.NewInstance ();

      /*
       * Create ""Account"" component
       */
      oAccountComp = oAccountObj.CreatePrimaryIntComp (""Account"");
      oAccountComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oAccountComp.SetFieldValue (""Id"", inputId);
      
      // Get Primary Sales Area of the account
      var SalesOrg;
      var SalesChn;
	  var SalesDiv;
	  var AccBusObj = theApp.GetBusObject(""Account"");
	  var AccBusCmp = AccBusObj.GetBusComp(""Account"");
	  
	  // Set View Mode to 3 (or AllView)	  
	  AccBusCmp.SetViewMode(3);  
		
	  AccBusCmp.ClearToQuery();
      AccBusCmp.SetSearchSpec(""Id"", inputId);
      AccBusCmp.ActivateField(""Primary Organization Id"");
            	
	  AccBusCmp.ExecuteQuery();
	  
		
	  if(AccBusCmp.FirstRecord())
	  {
	     var PrimOrg = AccBusCmp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = theApp.GetBusObject(""Organizations"");
	     var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
	     
	     
	     // Set View Mode to 3 (or AllView)		
		 OrgBusCmp.SetViewMode(3);  	
		 
	     OrgBusCmp.ClearToQuery();
         OrgBusCmp.SetSearchSpec(""Id"", PrimOrg);
         OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	     OrgBusCmp.ActivateField(""Back Office Distribution Channel"");
	     OrgBusCmp.ActivateField(""Back Office Division"");
	
	     OrgBusCmp.ExecuteQuery();
		 
		 // get saleOrg, distChnl and division of the primary SA
	     if(OrgBusCmp.FirstRecord())
	     {
		    var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
		    var SalesChn = OrgBusCmp.GetFieldValue(""Back Office Distribution Channel"");
		    var SalesDiv = OrgBusCmp.GetFieldValue(""Back Office Division"");
	     }
//	     else
//	     {
//		  	EAIRaiseError(""Unable to get sales area info for the primary organization"");
//	     }
	  }
//	  else
//	  {
//	  	EAIRaiseError(""Invalid account"");
//	  }
      

      /*
       * Read ""Export Parameters"" component
       */
      iGLExportComp = iGLOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      
      oGLOutputComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Output"", oAccountComp);
      if (iGLExportComp.NextRecord ())
      {
      	
         /*
          * Write ""Get List for Account Output"" component
          */
         oGLOutputComp.NewRecord ();
         oGLOutputComp.SetCopySource  (iGLExportComp);
         oGLOutputComp.SetFieldValue  (""Input Id"",          inputId);
         oGLOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oGLOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oGLOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oGLOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");

         /*
          * Read ""Order Header"" component to 
          */
         iGLHeaderComp = iGLExportComp.GetIntComp (""Order Header"");
         oGLHeaderComp = oAccountComp.CreateIntComp (""Account - Get SAP Order List Header"", oAccountComp);
         while (iGLHeaderComp.NextRecord ())
        /* 
       	 * Validate Sales area
       	 */
      	 {
      		var iSalesOrg = iGLHeaderComp.GetFieldValue(""SALES_ORG""); 
       	 	var iSalesChn = iGLHeaderComp.GetFieldValue(""DISTR_CHAN""); 
       	 	var iSalesDiv = iGLHeaderComp.GetFieldValue(""DIVISION""); 
      
	      	if ((SalesOrg == iSalesOrg) && (SalesChn == iSalesChn) && (SalesDiv == iSalesDiv))  
			{
			   oGLHeaderComp.NewRecord ();
			   oGLHeaderComp.SetCopySource  (iGLHeaderComp);
			   oGLHeaderComp.SetFieldValue  (""Input Id"",         inputId);
			   oGLHeaderComp.CopyFieldValue (""Currency"",             ""CURRENCY"");
			   oGLHeaderComp.CopyFieldValue (""Distribution Channel"", ""DISTR_CHAN"");
			   oGLHeaderComp.CopyFieldValue (""Division"",             ""DIVISION"");
			   oGLHeaderComp.CopyFieldValue (""Order Date"",           ""DOC_DATE"");
			   oGLHeaderComp.CopyFieldValue (""Order Number"",         ""SD_DOC"");
			   oGLHeaderComp.CopyFieldValue (""Order Status"",         ""DOC_STATUS"");
			   oGLHeaderComp.CopyFieldValue (""Order Type"",           ""DOC_TYPE"");
			   oGLHeaderComp.CopyFieldValue (""Purchase Order"",       ""PURCH_NO"");
			   oGLHeaderComp.CopyFieldValue (""Sales Organization"",   ""SALES_ORG"");
			   oGLHeaderComp.CopyFieldValue (""Sold To Customer"",     ""SOLD_TO"");
	
	           /*
	            * Read the ""Order Item"" component
	            */
	           // to ""Get List for Account Item"" component
			   iGLItemComp = iGLHeaderComp.GetIntComp (""Order Item"");
			   oGLItemComp = oGLHeaderComp.CreateIntComp (""Account - Get SAP Order List Item"", oGLHeaderComp);
			   while (iGLItemComp.NextRecord ())
			   {
				  oGLItemComp.NewRecord ();
				  oGLItemComp.SetCopySource  (iGLItemComp);
				  oGLItemComp.SetFieldValue  (""Input Id"",         inputId);
				  oGLItemComp.CopyFieldValue (""Item Number"",          ""ITM_NUMBER"");
				  oGLItemComp.CopyFieldValue (""Material Part Number"", ""MATERIAL"");
				  oGLItemComp.CopyFieldValue (""Material Short Text"",  ""SHORT_TEXT"");
				  oGLItemComp.CopyFieldValue (""Net Price"",            ""NET_PRICE"");
				  oGLItemComp.CopyFieldValue (""Net Value"",            ""NET_VALUE"");
				  oGLItemComp.CopyFieldValue (""Sales Unit"",           ""SALES_UNIT"");
			   }
            }
         }
      }
   }
}
function GetSAPOrderList_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Account Object (Account - Get SAP Order List (MO))
    *     Account (iAccount)
	 *       Get List for Account Header
    *
    * Output Object's Integration Components:
    *   BAPI Import (Account - Get SAP Order List (BAPI Input))
    *     Import Parameters (output)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var theApp = TheApplication(); // nbc
   var iAccountObj;    // Siebel Account instance
   var iAccountComp;   // Account
	var iHeaderComp;    // Account Header

   /*
    * Set up EAI Output Message objects
    */
   var oGLObj;         // BAPI instance
   var oGLImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */

   iAccountObj = inputMsg.GetIntObj (""Account - Get SAP Order List (MO)"");
   oGLObj = outputMsg.CreateIntObj (""Account - Get SAP Order List (BAPI Input)"");

   /*
    * Read int object instances from EAI message
    */
   while (iAccountObj.NextInstance ())
   {
      /*
       * Create ""Get List for Account"" object
       */
      oGLObj.NewInstance ();

      /*
       * Read ""Account"" component
       */
      iAccountComp = iAccountObj.GetPrimaryIntComp (""Account"");
      oGLImportComp = oGLObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iAccountComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGLImportComp.NewRecord ();
         oGLImportComp.SetCopySource  (iAccountComp);

	     var intId = iAccountComp.GetFieldValue( ""Integration Id"" );
	     var fromDate = iAccountComp.GetFieldValue( ""Back Office Order Query Start  Dt"" ); //nbc
	     var toDate = iAccountComp.GetFieldValue( ""Back Office Order Query End  Dt"" ); //nbc

         oGLImportComp.SetFieldValue  (""CUSTOMER_NUMBER"",intId );
         oGLImportComp.SetFieldValue  (""MATERIAL"", """");
         oGLImportComp.SetFieldValue  (""PURCHASE_ORDER"", """"); // ""Peter 1"";
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE"", fromDate );    // Empty string means ""00000000""
         oGLImportComp.SetFieldValue  (""DOCUMENT_DATE_TO"",  toDate ); // Empty string means ""00000000""

		 // Read the primary sales area
	     var primOrgId = iAccountComp.GetFieldValue(""Primary Organization Id"");
	     var OrgBusObj = TheApplication().GetBusObject(""Organizations"");
		 var OrgBusCmp = OrgBusObj.GetBusComp(""Organization"");
		 
		 // Set View Mode to 3 (or AllView)
		 OrgBusCmp.SetViewMode(3);  
		 
		 OrgBusCmp.ClearToQuery();
    	 OrgBusCmp.SetSearchSpec(""Id"", primOrgId);
    	 OrgBusCmp.ActivateField(""Back Office Sales Organization"");
	 
	
		 OrgBusCmp.ExecuteQuery();
		 if(OrgBusCmp.FirstRecord())
		 {
	  		 var SalesOrg = OrgBusCmp.GetFieldValue(""Back Office Sales Organization"");
	  		 // Write ""Import Parameters"" component
			 oGLImportComp.SetFieldValue( ""SALES_ORGANIZATION"", SalesOrg );
		 }
		}
   }
}
function ImportSAPOrder_GetSAPOrderListToSiebelOrder (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   Import Get List for Account (Account - Import SAP Order (Get SAP Order List) (MO))
    *     Get List for Account Header
    *
    * Output Object's Integration Components:
    *   Import (Account - Import SAP Order (Siebel Order) (MO))
    *     Order (oOrder)
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGLOrderObj;  // Get List instance
   var iGLOrderComp; // Get List Order

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oOrderOrgComp;  // Order Organization

   /*
    * Find and create top-level integration object
    */
   iGLOrderObj = inputMsg.GetIntObj (""Account - Import SAP Order (Get SAP Order List) (MO)"");
   oOrderObj = outputMsg.CreateIntObj (""Account - Import SAP Order (Siebel Order) (MO)"");

   /*
    * Read int object instances from EAI message
    */
    
   /*
    * Get ActiveBusComp & RowID
    */
   
//   var CurBC = TheApplication().ActiveBusComp();
//   var rowid = CurBC.GetFieldValue(""Id""); //nbc
   
   while (iGLOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();
            	
      /*
       * Read ""Get List Order"" component
       */
      iGLOrderComp = iGLOrderObj.GetPrimaryIntComp (""Get List for Account Header"");
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      
      while (iGLOrderComp.NextRecord ())
      {
         /*
          * Write ""Order"" component
          */
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iGLOrderComp);
         
         var SiebOrdNo = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         if (SiebOrdNo == """")												//xx
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue(""Order Number"");		//xx
         }																	//xx
         else
         {																	//xx
         	var OrdNumber = iGLOrderComp.GetFieldValue (""Siebel Order Number"");//xx
         }																	//xx
 		 
 		 oOrderComp.SetFieldValue (""Order Number"",               OrdNumber);//xx
 		             
//       oOrderComp.CopyFieldValue (""Order Number"",           ""Order Number""); //nbcxx 
//		 oOrderComp.CopyFieldValue (""Order Number"",                    rowid); //nbc
// 	     oOrderComp.SetFieldValue  (""Order Type"",
//                                   orderTypeLM.Translate (iGLOrderComp.GetFieldValue (""Order Type"")));
 		 var oTypeSAP = orderTypeLM.Translate (iGLOrderComp.GetFieldValue (""Order Type""));
		 var oType    = TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_TYPE"", oTypeSAP);
		 oOrderComp.SetFieldValue  (""Order Type"",              oType);
         oOrderComp.CopyFieldValue (""Order Date"",             ""Order Date"");
         oOrderComp.CopyFieldValue (""Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""Sold To Customer"");
         oOrderComp.CopyFieldValue (""Integration Id"",         ""Order Number"");
         // oOrderComp.CopyFieldValue (""Primary Organization Id"",         ""SAP Organization Id (MO)"");
         // PLim. ??? Set Organization until we can figure out how to fix dup key index problem
         // was: oOrderComp.CopyFieldValue  (""Organization"",         ""Organization"");
			// oOrderComp.CopyFieldValue (""Account Location"",         ""Account Location"");
		// }
		
	 // oOrderOrgComp.NewInstance ();
		oOrderOrgComp = oOrderComp.CreateIntComp(""Order Entry - Orders_Organization"");
		// while (iGLOrderComp.NextRecord ())
      // {
	 	oOrderOrgComp.NewRecord();
	 	oOrderOrgComp.SetCopySource  (iGLOrderComp);
		
	 	oOrderOrgComp.SetFieldValue ( ""IsPrimaryMVG"",			""Y"");
        oOrderOrgComp.CopyFieldValue ( ""Organization Id"",		""SAP Organization Id (MO)"");
        // oOrderOrgComp.CopyFieldValue ( ""Location"",		""Account Location"");
		
			
		
      }
   }
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var result = EAIExecuteMap (MethodName, Inputs, Outputs);

	return result;
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// CREATOR		:	CAROLINE M.
// LAST UPDATED	:	12/28/2000
//
// DESCRIPTION
//    Javascript maps from Oracle Operating Unit to Siebel Organization
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyIntegrationObjectData (OracleIntObject, SiebelIntObject)
{
	//
	// Declare variables to hold the Oracle Primary Integration Component and
	// The Siebel Primary Integration Component
	//
	var OracleCustomerIntComp, SiebelAccountIntComp;
	
	//
	//Get the primary integration component from the Oracle Integration Object
	//
	OracleCustomerIntComp = OracleIntObject.GetPrimaryIntComp (""RA_CUSTOMERS_INTERFACE_ALL"");

	if (OracleCustomerIntComp.Exists ())
	{
		// CUSTOMER INTERFACE

		SiebelAccountIntComp = SiebelIntObject.CreatePrimaryIntComp (""Account"");

		while (OracleCustomerIntComp.NextRecord ())
		{
			SiebelAccountIntComp.NewRecord ();
			SiebelAccountIntComp.SetCopySource (OracleCustomerIntComp);
			
			SiebelAccountIntComp.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_CUSTOMER_REF"");
			SiebelAccountIntComp.SetFieldValue (""EAI Sync Status Code"", ""Error on Oracle Import"");
			SiebelAccountIntComp.SetFieldValue(""EAI Sync Date"", Timestamp());
			SiebelAccountIntComp.CopyFieldValue (""EAI Sync Error Text"",""INTERFACE_STATUS"");
		}
	}
	else
	{
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_MISSING_COMPONENT,RA_CUSTOMERS_INTERFACE_ALL,Account - Get Oracle Customer Import Status (Oracle)""));
	}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function UpsertSiebelAccount (InputMsg, OutputMsg)
{
	//
	// Declare a variable to hold the Siebel Integration Object.
	//
	var SiebelIntObject;

	//
	// Declare a variable to hold the Oracle Integration Object
	//
	var OracleIntObject;

	//
	// Get the Oracle Integration Object from the Input message
	//
	OracleIntObject = InputMsg.GetIntObj(""Account - Get Oracle Customer Import Status (Oracle)"");

	//
	// Check the validity of the Oracle Integration Object.
	//
	if (OracleIntObject.Exists ())
	{
		//
		// Create a new Siebel Integration Object on the Output Message.
		//
		SiebelIntObject = OutputMsg.CreateIntObj (""Account - Get Oracle Customer Import Status (Siebel)"");

		//
		// Navigate through all the available instances in the Integration Object
		//
		while (OracleIntObject.NextInstance ())
		{
			//
			// Create a new instance in the Oracle Integration Object
			//
			SiebelIntObject.NewInstance ();

			//
			// CopyFields is a user defined function which is written to copy all
			// the fields from the source to the target.
			//
			CopyIntegrationObjectData (OracleIntObject, SiebelIntObject);
		}
	}
}  ///~ End of CreateSiebelProduct function."
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// LAST UPDATED	:	12/28/2000
//
// DESCRIPTION
//    Javascript maps from Oracle Operating Unit to Siebel Organization
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyIntegrationObjectData (OracleIntObject, SiebelIntObject)
{
	var OracleCustomerIntComp, SiebelAccountIntComp;
	
	OracleCustomerIntComp = OracleIntObject.GetPrimaryIntComp (""RA_CUSTOMERS_INTERFACE_ALL"");

	if (OracleCustomerIntComp.Exists ())
	{
		// CUSTOMER INTERFACE
		SiebelAccountIntComp = SiebelIntObject.CreatePrimaryIntComp (""Account"");

		while (OracleCustomerIntComp.NextRecord ())
		{
			SiebelAccountIntComp.NewRecord ();
			SiebelAccountIntComp.SetCopySource (OracleCustomerIntComp);
			
			SiebelAccountIntComp.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_CUSTOMER_REF"");
			SiebelAccountIntComp.SetFieldValue  (""EAI Sync Status Code"", ""Error on Oracle Import"");
			SiebelAccountIntComp.SetFieldValue  (""EAI Sync Date"", Timestamp());
			SiebelAccountIntComp.CopyFieldValue (""EAI Sync Error Text"",""INTERFACE_STATUS"");
		}
	}
	else
	{
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_MISSING_COMPONENT,RA_CUSTOMERS_INTERFACE_ALL,Account - Get Oracle Customer Import Status (Oracle)""));
	}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function UpsertSiebelAccount (InputMsg, OutputMsg)
{
	//
	// Declare a variable to hold the Siebel Integration Object.
	//
	var SiebelIntObject;

	//
	// Declare a variable to hold the Oracle Integration Object
	//
	var OracleIntObject;

	//
	// Get the Oracle Integration Object from the Input message
	//
	OracleIntObject = InputMsg.GetIntObj(""Account - Get Oracle11i Customer Import Status (Oracle)"");

	//
	// Check the validity of the Oracle Integration Object.
	//
	if (OracleIntObject.Exists ())
	{
		//
		// Create a new Siebel Integration Object on the Output Message.
		//
		SiebelIntObject = OutputMsg.CreateIntObj (""Account - Get Oracle11i Customer Import Status (Siebel)"");

		//
		// Navigate through all the available instances in the Integration Object
		//
		while (OracleIntObject.NextInstance ())
		{
			//
			// Create a new instance in the Oracle Integration Object
			//
			SiebelIntObject.NewInstance ();

			//
			// CopyFields is a user defined function which is written to copy all
			// the fields from the source to the target.
			//
			CopyIntegrationObjectData (OracleIntObject, SiebelIntObject);
		}
	}
}  ///~ End of CreateSiebelProduct function."
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// DESCRIPTION
//    Javascript maps to Siebel Account from Oracle Customer
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyFields (OracleIntObject, SiebelIntObject)
{
	var SiebelPrimIntComp, OraclePrimIntComp, OraclePhoneIntComp;

	var AccountStatusVM   = EAIGetValueMap (""Oracle Account Status"", ""Siebel Inbound"", ""Active"");
	var CountryVM 		  = EAIGetValueMap (""Oracle Country"", ""Siebel Inbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountPhoneVM    = EAIGetValueMap (""Oracle Account Phone"", ""Siebel Inbound"", ""Main Phone Number"");
	var AddressPhoneVM    = EAIGetValueMap (""Oracle Address Phone"", ""Siebel Inbound"", ""Phone Number"");
	var ContactPhoneVM    = EAIGetValueMap (""Oracle Contact Phone"", ""Siebel Inbound"", ""Alternate Phone #"");
	var FreightVM 	      = EAIGetValueMap (""Oracle Freight"", ""Siebel Inbound"", EAIValueMap_NoEntry_RaiseError);
	var ContactVM 		  = EAIGetValueMap(""Oracle Contact Title"", ""Siebel Inbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountCategoryVM = EAIGetValueMap(""Oracle Account Category"", ""Siebel Inbound"", EAIValueMap_NoEntry_RaiseError);
	
	OraclePrimIntComp = OracleIntObject.GetPrimaryIntComp (""RA_CUSTOMERS"");
	
	//
	// ACCOUNTS
	//
	if (OraclePrimIntComp.Exists ())
	{
		SiebelPrimIntComp = SiebelIntObject.CreatePrimaryIntComp (""Account"");
		
		while (OraclePrimIntComp.NextRecord ())
		{
			// Process delete operation
			if(ProcessDelete(OraclePrimIntComp)) continue;
		
			SiebelPrimIntComp.NewRecord ();
		
			var OracleAcctPhIntComp = OraclePrimIntComp.GetIntComp (""RA_PHONES"");
	
			SiebelPrimIntComp.SetCopySource (OraclePrimIntComp);
			
			// Set the opcode for this component
			SetOperationCode(SiebelPrimIntComp, OraclePrimIntComp);

			SiebelPrimIntComp.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_REFERENCE"");				
			SiebelPrimIntComp.CopyFieldValue (""Name"", ""CUSTOMER_NAME"");
			SiebelPrimIntComp.CopyFieldValue (""CSN"", ""CUSTOMER_NUMBER"");
			
			SiebelPrimIntComp.SetFieldValue(""EAI Sync Status Code"", ""Sync from Back Office"");
			SiebelPrimIntComp.SetFieldValue(""EAI Sync Date"", Timestamp());
			SiebelPrimIntComp.SetFieldValue(""EAI Sync Error Text"","""");
			
			SiebelPrimIntComp.CopyFieldValue (""GSA Flag"", ""GSA_INDICATOR"");
			SiebelPrimIntComp.CopyFieldValue (""Home Page"", ""URL"");
			SiebelPrimIntComp.CopyFieldValue (""Price List Integration Id"", ""PRICE_LIST_ID"");
			
			SiebelPrimIntComp.SetFieldValue (""Freight Terms"", FreightVM.Translate(
					OraclePrimIntComp.GetFieldValue (""FREIGHT_TERM"")));

			SiebelPrimIntComp.SetFieldValue (""Type"", AccountCategoryVM.Translate (
				OraclePrimIntComp.GetFieldValue (""CUSTOMER_CATEGORY_CODE"")));

			SiebelPrimIntComp.SetFieldValue (""Account Status"", AccountStatusVM.Translate (
				OraclePrimIntComp.GetFieldValue (""STATUS"")));
			
			//
			// ACCOUNT SYNONYM
			//
			var customerNamePhonetic = 
				OraclePrimIntComp.GetFieldValue(""CUSTOMER_NAME_PHONETIC"").substring(0, 49);
				
			if(customerNamePhonetic != """")
			{
				// Create a new child integration component in the Siebel from
				// Primary integration Component
				var SiebelAccSynIntComp = SiebelPrimIntComp.CreateIntComp (""Account_Account Synonym"");
			
				SiebelAccSynIntComp.NewRecord ();
					
				SetOperationCode(SiebelAccSynIntComp, OraclePrimIntComp);
						
				SiebelAccSynIntComp.SetFieldValue (""Synonym"", customerNamePhonetic);
			} // ACCOUNT SYNONYM
								
			// 
			// ACCOUNT PHONES
			//
			if (OracleAcctPhIntComp.Exists ())
			{
				while (OracleAcctPhIntComp.NextRecord ())
				{
					var OraclePhStatus = OracleAcctPhIntComp.GetFieldValue (""STATUS"");	
					var OraclePhPrimFlg = OracleAcctPhIntComp.GetFieldValue (""PRIMARY_FLAG"");
				 	var OraclePhAddr = OracleAcctPhIntComp.GetFieldValue (""ADDRESS_ID"");
					var OraclePhContact = OracleAcctPhIntComp.GetFieldValue (""CONTACT_ID"");							 	
					// CR: 12-9X2JRV					
					if (OraclePhStatus == ""A"" && OraclePhAddr == """" && OraclePhContact == """")
							TransformPhone (OracleAcctPhIntComp, SiebelPrimIntComp, AccountPhoneVM);
				}
			} // END ACCOUNT PHONES

			//
			// ADDRESSES
			// 
			var OracleAddressIntComp = OraclePrimIntComp.GetIntComp (""RA_ADDRESSES_ALL"");
			
			// Check the validity of the integration component.
			if (OracleAddressIntComp.Exists ())
			{
				// Create the Siebel address integration component in the Siebel primary integration component
				var SiebelAddressIntComp = SiebelPrimIntComp.CreateIntComp (""Account_Business Address"");
								
				// Navigate through all the available records.
				while (OracleAddressIntComp.NextRecord ())
				{
					var OracleAddrPhIntComp = OracleAddressIntComp.GetIntComp (""RA_PHONES2"");

					// Create a new record on the Siebel side.
					SiebelAddressIntComp.NewRecord ();
					
					SiebelAddressIntComp.SetCopySource(OracleAddressIntComp);
					
					// Copy Values from Oracle AddressIntComp to Siebel 
					// AddressIntComp
					//
					// Set the opcode for this component
					SetOperationCode(SiebelAddressIntComp, OracleAddressIntComp);
		
					SiebelAddressIntComp.CopyFieldValue (""Address Active Status"", ""STATUS"");
					SiebelAddressIntComp.CopyFieldValue (""Address Integration Id"", ""ORIG_SYSTEM_REFERENCE"");
					SiebelAddressIntComp.CopyFieldValue (""Street Address"", ""ADDRESS1"");
   					SiebelAddressIntComp.CopyFieldValue (""Street Address 2"", ""ADDRESS2"");
					SiebelAddressIntComp.CopyFieldValue (""City"", ""CITY"");
					SiebelAddressIntComp.CopyFieldValue (""State"", ""STATE"");
					SiebelAddressIntComp.CopyFieldValue (""Province"", ""PROVINCE"");
					SiebelAddressIntComp.CopyFieldValue (""County"", ""COUNTY"");
					SiebelAddressIntComp.CopyFieldValue (""Postal Code"", ""POSTAL_CODE"");
					 
					
					SiebelAddressIntComp.SetFieldValue (""Country"", CountryVM.Translate (
						OracleAddressIntComp.GetFieldValue (""COUNTRY"")));

					// 
					// ADDRESS PHONES
					//
					if (OracleAddrPhIntComp.Exists ())
					{
						while (OracleAddrPhIntComp.NextRecord ())
						{
							var OraclePhStatus = OracleAddrPhIntComp.GetFieldValue (""STATUS"");	
							var OraclePhPrimFlg = OracleAddrPhIntComp.GetFieldValue (""PRIMARY_FLAG"");
						 	var OraclePhContact = OracleAddrPhIntComp.GetFieldValue (""CONTACT_ID"");

						 	// CR: 12-9X2JRV
							if (OraclePhStatus == ""A"" && OraclePhContact == """")
										TransformPhone (OracleAddrPhIntComp, SiebelAddressIntComp, AddressPhoneVM);
						}
					} // END ADDRESS PHONES
				} 
			} // END ADDRESSES
			
			//
			// CONTACTS
			// 
			var OracleContactIntComp = OraclePrimIntComp.GetIntComp (""RA_CONTACTS"");
			
			if (OracleContactIntComp.Exists ())
			{
				var SiebelContactIntComp = SiebelPrimIntComp.CreateIntComp (""Contact"");
			
				while (OracleContactIntComp.NextRecord ())
				{
					var OracleContPhIntComp = OracleContactIntComp.GetIntComp (""RA_PHONES3"");

					SiebelContactIntComp.NewRecord ();

					SiebelContactIntComp.SetCopySource (OracleContactIntComp);
					
					// Set the opcode for this component
					SetOperationCode(SiebelContactIntComp, OracleContactIntComp);
					
					SiebelContactIntComp.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_REFERENCE"");
					SiebelContactIntComp.CopyFieldValue (""Last Name"", ""LAST_NAME"");
					SiebelContactIntComp.CopyFieldValue (""Job Title"", ""JOB_TITLE"");
					SiebelContactIntComp.CopyFieldValue (""M/F"", ""SEX_CODE"");
					
					var ContactStatus = OracleContactIntComp.GetFieldValue (""STATUS"");
					if (ContactStatus = ""A"")
						SiebelContactIntComp.SetFieldValue (""Active Status"", ""Y"");
					else
						SiebelContactIntComp.SetFieldValue (""Active Status"", ""N"");
											
					SiebelContactIntComp.SetFieldValue (""M/M"", ContactVM.Translate(
						OracleContactIntComp.GetFieldValue(""TITLE"")));
											
					SiebelContactIntComp.SetFieldValue (""Email Address"", 
						OracleContactIntComp.GetFieldValue (""EMAIL_ADDRESS"").substring(0, 49)); 
					
					SiebelContactIntComp.CopyFieldValue (""Mail Stop"", ""MAIL_STOP"");
					SiebelContactIntComp.CopyFieldValue (""Comment"", ""CONTACT_PERSONAL_INFORMATION"");
					SiebelContactIntComp.CopyFieldValue (""Contact Organization Integration Id"", ""ORG_ID"");
					
					var OraFName = OracleContactIntComp.GetFieldValue (""FIRST_NAME"");
					if(OraFName != """" && OraFName != null)
						SiebelContactIntComp.SetFieldValue (""First Name"", OraFName);
					else
						EAIRaiseError(TranslateMessage(""ORA_MSG_NULL_FIRST_NAME,""));
					    
					// 
					// CONTACT PHONES
					//
					if (OracleContPhIntComp.Exists ())
					{
						while (OracleContPhIntComp.NextRecord ())
						{
							var OraclePhStatus = OracleContPhIntComp.GetFieldValue (""STATUS"");	
							var OraclePhPrimFlg = OracleContPhIntComp.GetFieldValue (""PRIMARY_FLAG"");
						 	// CR: 12-9X2JRV
							if (OraclePhStatus == ""A"")					
								TransformPhone (OracleContPhIntComp, SiebelContactIntComp, ContactPhoneVM);
						}
					} // END CONTACT PHONES				
				} 
			} // END CONTACTS
			
			//
			// CREDIT PROFILES
			// 
			var OracleProfileAmtIntComp = OraclePrimIntComp.GetIntComp (""SIE_CUSTOMER_PROFILE_AMOUNTS"");
			
			if (OracleProfileAmtIntComp.Exists ())
			{
				var SiebelCrdPrfIntComp = SiebelPrimIntComp.CreateIntComp (""Account_Account Credit Profile"");
				
				while (OracleProfileAmtIntComp.NextRecord ())
				{
					SiebelCrdPrfIntComp.NewRecord ();
					
					SiebelCrdPrfIntComp.SetCopySource (OracleProfileAmtIntComp);
					
					SetOperationCode(SiebelCrdPrfIntComp, OracleProfileAmtIntComp);
					
					SiebelCrdPrfIntComp.CopyFieldValue (""Credit Control Area Code"", ""CUSTOMER_PROFILE_AMOUNT_ID"");
					SiebelCrdPrfIntComp.CopyFieldValue (""Credit Limit Amount"", ""OVERALL_CREDIT_LIMIT"");
					SiebelCrdPrfIntComp.CopyFieldValue (""Credit Currency Code"", ""CURRENCY_CODE"");
				}
			} // END CREDIT PROFILES
		} 
	} // END ACCOUNTS
	else
	{
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_MISSING_COMPONENT,RA_CUSTOMERS,Account - Get/Put Siebel Customer (Oracle)""));
	}
}
function ProcessDelete(OracleComp)
{
	// If not a delete return false.
	// If delete (X or D) perform delete through COM interface.  X indicates that
	// there should be a D at a lower level.
	//
	// For Accounts we expect deletes at SIE_CUSTOMER_PROFILE_AMOUNT only.
	//   X  RA_CUSTOMERS
	//   D  SIE_CUSTOMER_PROFILE_AMOUNT
	//
	// Phone Deletes are treated specially
	// We need to first figure out whether it's a Customer Phone,
	// Address Phone or a Contact Phone.

	var opCode;
	var childComp;

	opCode = OracleComp.GetFieldValue(""SysOp"");
	if (opCode == ""D"")
	{
		// Delete of Discount not supported.
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_DELETION,RA_CUSTOMERS""));
	}
	else if (opCode == ""X"")
	{
		// Expect delete within account
		childComp = OracleComp.GetIntComp(""SIE_CUSTOMER_PROFILE_AMOUNT"");

	    if(childComp.Exists() && childComp.NextRecord())
		{
			opCode = childComp.GetFieldValue(""SysOp"");
			if (opCode == ""D"")
			{
				// Delete Credit Profile
				var BusObject = TheApplication().GetBusObject(""Account"");
				var BComp = BusObject.GetBusComp(""Account Credit Profile"");
				BComp.SetViewMode(3);
				BComp.ClearToQuery();
  				BComp.SetSearchSpec(""Credit Control Area Code"",
  				        childComp.GetFieldValue(""CUSTOMER_PROFILE_AMOUNT_ID""));
				BComp.ExecuteQuery();
				BComp.FirstRecord();
				BComp.DeleteRecord();
				BComp.WriteRecord();

				return true;
			}
			else
				EAIRaiseError(TranslateMessage(
					""ORA_MSG_INVALID_SYSOP,""+opCode+"",SIE_CUSTOMER_PROFILE_AMOUNT""));
        }
		else
		{
		  //Phone delete processing
		  childComp = OracleComp.GetIntComp(""RA_PHONES"");
		  if(!childComp.Exists() || !childComp.NextRecord())
		  {
			childComp = OracleComp.GetIntComp(""RA_ADDRESSES_ALL"");

			if(childComp.Exists() && childComp.NextRecord())
			{
				childComp = childComp.GetIntComp(""RA_PHONES2"");

				if(!childComp.Exists() || !childComp.NextRecord())
				{
					EAIRaiseError(TranslateMessage(
						""ORA_MSG_MISSING_COMPONENT, RA_PHONES2, RA_CUSTOMERS""));
				}
		    }
			else
			{
				//see if it's a contact phone
				childComp = OracleComp.GetIntComp(""RA_CONTACTS"");

				if(childComp.Exists() && childComp.NextRecord())
				{
					childComp = childComp.GetIntComp(""RA_PHONES3"");

					if(!childComp.Exists() || !childComp.NextRecord())
					{
						EAIRaiseError(TranslateMessage(
							""ORA_MSG_MISSING_COMPONENT, RA_PHONES3, RA_CUSTOMERS""));
					}
				}
			}//end of contact phone check
		  }//either address or contact phone

		  opCode = childComp.GetFieldValue(""SysOp"");
		  //We still need to check what kind of phone it is
		  //as the receiver may return an incorrect hierarchy
		  //The parent comp is put in this column
		  var SiebelBusComp;
          var ValueMapName;
		  var TableName;
	  	  //Get the parent type.
		  var BusCompType = childComp.GetFieldValue(""ROOT_TBL_PRI_KEY2"");
		  if(BusCompType == 1)
		  {
			SiebelBusComp = ""Account"";
			ValueMapName = ""Oracle Account Phone"";
			TableName = ""RA_PHONE"";
	      }
		  else if(BusCompType == 2)
		  {
			SiebelBusComp = ""Business Address"";
			ValueMapName = ""Oracle Address Phone"";
			TableName = ""RA_PHONE2"";
		  }
		  else if(BusCompType == 3)
		  {
			SiebelBusComp = ""Contact"";
			ValueMapName = ""Oracle Contact Phone"";
			TableName = ""RA_PHONE3"";
		  }
		  else
	 	  {
			/*Add this message
			EAIRaiseError(TranslateMessage(
						""ORA_MSG_INVALID_PHONE, ""+BusCompType+""""));*/
		  }

		  if(opCode == ""D"")
		  {
			var BusObject = TheApplication().GetBusObject(""Account"");
			var BComp = BusObject.GetBusComp(SiebelBusComp);
			BComp.SetViewMode(3);
			BComp.ClearToQuery();
			
			//assume that the receiver sets this from the
			//error message column. The phone type is put in this column.
			var AccountPhoneVM = EAIGetValueMap(ValueMapName, ""Siebel Inbound"");

			//Get the Phone Type which is put in the
			//Error Message column of the notification tbl
			var type = childComp.GetFieldValue(""ERROR_MESSAGE"");

			var SiebelColName = AccountPhoneVM.Translate(type);
			//Empty the field in siebel
			BComp.ActivateField(SiebelColName);
			
			//Get the RowId of the Siebel BusComp
			var rowid = childComp.GetFieldValue(""ORIGINAL_SYSTEM_REFERENCE"");
  			BComp.SetSearchSpec(""Id"", rowid);
			BComp.ExecuteQuery();
			BComp.FirstRecord();

			BComp.SetFieldValue(SiebelColName, """");

			BComp.WriteRecord();

			return true;
		  }
		  else
			EAIRaiseError(TranslateMessage(
				""ORA_MSG_INVALID_SYSOP, ""+opCode+"", ""+TableName+""""));
	 }// end of phone processing
}// if opcode was X
else
	return false;  // Not a delete
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"/**
 * Sets the operation code for this Siebel integration component
 */
function SetOperationCode(SiebelIntComp, OracleIntComp)
{
	var opCode = OracleIntComp.GetFieldValue (""SysOp"");
	if(opCode == ""D"")
		SiebelIntComp.SetFieldValue (""operation"", ""delete"");
	else
		SiebelIntComp.SetFieldValue (""operation"", ""upsert"");
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TransformOracleCustomer (InputMsg, OutputMsg)
{
	var OracleIntObject, SiebelIntObject;
	
	OracleIntObject = InputMsg.GetIntObj (""Account - Get Oracle Customer (Oracle)"");
	
	SiebelIntObject = OutputMsg.CreateIntObj (""Account - Get/Put Oracle Customer (Siebel)"");
	
	while (OracleIntObject.NextInstance ())
	{
		SiebelIntObject.NewInstance (); 

		CopyFields (OracleIntObject, SiebelIntObject);
	}
}
function TransformPhone (OraclePhoneIntComp, SiebelIntComp, PhoneValueMap)
{
	// Declare a variable to hold the Phone type.
	var PhoneType, SiebelPhoneField;
	
	// Get the Phone_Type field from Oracle.
	PhoneType = OraclePhoneIntComp.GetFieldValue(""PHONE_TYPE"");

	// Use the value map to lookup the Phone field in the Siebel Integration Object.
	SiebelPhoneField = PhoneValueMap.Translate(PhoneType);
		  
	if(SiebelPhoneField == """")
	{
		// Exception: Missing phone type
		EAIRaiseError (TranslateMessage(
			""ORA_MSG_MISSING_VALUE_MAPPING,""+PhoneType+"",Oracle Account Phone""));
	} 
		  
	SiebelIntComp.SetFieldValue (SiebelPhoneField, 
		OraclePhoneIntComp.GetFieldValue (""PHONE_NUMBER""));

}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// LAST UPDATED	:	01/03/2001
//
// DESCRIPTION
//    Javascript maps from Oracle11i Customer to Siebel Account
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyFields (OracleIntObject, SiebelIntObject)
{
	var OracleCustomer, SiebelAccount;

	OracleCustomer = OracleIntObject.GetPrimaryIntComp (""HZ_CUST_ACCOUNTS"");

	if (OracleCustomer.Exists ())
	{
		SiebelAccount = SiebelIntObject.CreatePrimaryIntComp (""Account"");
		
		while (OracleCustomer.NextRecord ())
		{
			//
			// ACCOUNTS
			//
			SiebelAccount.NewRecord ();
			SiebelAccount.SetCopySource (OracleCustomer);
			SetOperationCode(SiebelAccount, OracleCustomer);
			
			SiebelAccount.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_REFERENCE"");
			SiebelAccount.SetFieldValue  (""EAI Sync Status Code"", ""Sync from Back Office"");
			SiebelAccount.SetFieldValue  (""EAI Sync Date"", Timestamp());
			SiebelAccount.SetFieldValue  (""EAI Sync Error Text"","""");
			SiebelAccount.CopyFieldValue (""CSN"", ""ACCOUNT_NUMBER"");
								
			// 
			// CONTACTS
			//
			var OracleCustContacts = OracleCustomer.GetIntComp (""SIE_CONTACTS_V"");
			
			if (OracleCustContacts.Exists ())
			{
				var SiebelAccountContacts = SiebelAccount.CreateIntComp (""Contact"");
									
				while (OracleCustContacts.NextRecord ())
				{
					SiebelAccountContacts.NewRecord ();
					SiebelAccountContacts.SetCopySource (OracleCustContacts);
					SetOperationCode(SiebelAccountContacts, OracleCustContacts);

					// For all the contacts passed from Oracle to Siebel
					// make the current account as the contact's primary account 
					SiebelAccountContacts.SetFieldValue(""Account Integration Id"", OracleCustomer.GetFieldValue(""ORIG_SYSTEM_REFERENCE""));
					SiebelAccountContacts.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_REFERENCE"");
				} 
			} 
																
			// 
			// ADDRESSES
			//
			var OracleCustSites = OracleCustomer.GetIntComp (""SIE_ADDRESSES_V"");
			
			if (OracleCustSites.Exists ())
			{
				var SiebelAccountAddresses = SiebelAccount.CreateIntComp (""Business Address"");
									
				while (OracleCustSites.NextRecord ())
				{
					SiebelAccountAddresses.NewRecord ();
					SiebelAccountAddresses.SetCopySource (OracleCustSites);
					SetOperationCode(SiebelAccountAddresses, OracleCustSites);
					
					SiebelAccountAddresses.CopyFieldValue (""Integration Id"", ""ORIG_SYSTEM_REFERENCE"");
				} 
			} 
		} ///~ while(OracleAccount.NextRecord())
	} ///~ if(OracleAccount.Exists())
	else
	{
		EAIRaiseError (TranslateMessage (
			""ORA_MSG_MISSING_COMPONENT,HZ_CUST_ACCOUNTS,Account - Get Oracle11i Customer (Oracle)""));
	}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
function SetOperationCode(SiebelIntComp, OracleIntComp)
{
	var opCode = OracleIntComp.GetFieldValue (""SysOp"");
	if(opCode == ""D"")
		SiebelIntComp.SetFieldValue (""operation"", ""delete"");
	else
		SiebelIntComp.SetFieldValue (""operation"", ""upsert"");
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TransformOracleCustomer (InputMsg, OutputMsg)
{
	
	// Declare a variable to hold the Oracle Integration Object
	var OracleIntObject;
	
	// Declare a variable to hold the Siebel Integration Object.
	var SiebelIntObject;	
	
	// Get the Oracle Integration Object from the Input message
	OracleIntObject = InputMsg.GetIntObj (""Account - Get Oracle11i Customer (Oracle)"");
	
	// Check the validity of the Oracle Integration Object.
	if (OracleIntObject.Exists ())
	{
		// Go ahead and create a new Siebel Integration Object on the Output Message.
		SiebelIntObject = OutputMsg.CreateIntObj (""Account - Get Oracle11i Customer (Siebel)"");
		
		// Navigate through all the available instances in the Integration Object
		while (OracleIntObject.NextInstance ())
		{
			// Create a new instance in the Siebel Integration Object
			SiebelIntObject.NewInstance (); 
			// CopyFields is again a user defined function which is written to copy all 
			// the fields from the source to the target.
			CopyFields (OracleIntObject, SiebelIntObject);
		}
	} ///~ if (OracleIntObject.Exists ())
	else
	{
		//Raise an exception saying that the Oracle Integration Object was not found in      
		// the Input message
		EAIRaiseError (TranslateMessage (""ORA_MSG_EMPTY,Account - Get Oracle11i Customer (Oracle)""));
	} ///~ else
} ///~ End of TransformOracleCustomer function."
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// DESCRIPTION
//    Javascript maps from Siebel Account to Oracle Customer
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
"// Set Integration Id for new accounts, contacts or addresses created in Siebel

function AccountLoopBack(InputMsg, OutputMsg)
{
	var SiebelObjectIn, SiebelObjectOut;
	
	var AccCompIn, AccCompOut, 
		AddrCompIn, AddrCompOut, 
		ConCompIn, ConCompOut;
	
	var AccSharedID, AccIntegId, 
		AddrSharedID, AddrIntegId, 
		ConSharedID, ConIntegId; 
	
	/* Check the validation message */
	var ValidationMessage = InputMsg.GetArgument(""Validation Message"");
	
	if (ValidationMessage != """")
	{
		EAIRaiseError(TranslateMessage(ValidationMessage));
	}

	SiebelObjectIn = InputMsg.GetIntObj(""Account - Get/Put Oracle Customer (Siebel)"");
	
	if (SiebelObjectIn.Exists ())
	{
		SiebelObjectOut = OutputMsg.CreateIntObj(""Account - Get/Put Oracle Customer (Siebel)"");
		
		while (SiebelObjectIn.NextInstance ())
		{
			SiebelObjectOut.NewInstance ();

			AccCompIn = SiebelObjectIn.GetPrimaryIntComp (""Account"");

			// 
			// ACCOUNT
			//
			if (AccCompIn.Exists ())
			{
				AccCompOut = SiebelObjectOut.CreatePrimaryIntComp(""Account"");
								
		    	while (AccCompIn.NextRecord ())
				{
					AccCompOut.SetCopySource (AccCompIn);
					
					AccCompOut.NewRecord ();   
						
					AccCompOut.CopyFieldValue(""Id"", ""Id"");
					AccCompOut.SetFieldValue(""EAI Sync Date"", Timestamp());
					
					AccIntegId = AccCompIn.GetFieldValue(""Integration Id"");
	 				if (AccIntegId == """" || AccIntegId == null)
					{
						// New Account
						AccCompOut.CopyFieldValue(""Integration Id"", ""Id"");
						AccCompOut.SetFieldValue(""EAI Sync Status Code"", 
							""Creating in Back Office"");
					}
					else
					{
						// Existing Account
						AccCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
						AccCompOut.SetFieldValue(""EAI Sync Status Code"", 
							""Sync To Back Office"");
					}
					AccCompOut.SetFieldValue (""EAI Sync Error Text"","""");
					AccCompOut.SetFieldValue (""EAI Sync Date"", Timestamp());

					//
					// ACCOUNT ADDRESSES
					//		
					var AddrCompIn = AccCompIn.GetIntComp (""Business Address"");
					
					if (AddrCompIn.Exists())
					{
						AddrCompOut = AccCompOut.CreateIntComp(""Business Address"");
									
						while (AddrCompIn.NextRecord())
						{
							AddrCompOut.SetCopySource (AddrCompIn);
				
							AddrCompOut.NewRecord();   
	
							AddrCompOut.CopyFieldValue(""Id"", ""Id"");

							AddrIntegId = AddrCompIn.GetFieldValue(
								""Integration Id"");
								
			 				if (AddrIntegId == """" || AddrIntegId == null)
			 				{
								// New Address
								AddrCompOut.CopyFieldValue(""Integration Id"", ""Id"");
							}
							else
							{
								// Existing Address
								AddrCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
							}
						}
					} // END ACCOUNT ADDRESSES
														
					//
					// ACCOUNT CONTACTS
					//		
					var ConCompIn = AccCompIn.GetIntComp (""Contact"");
					
					if (ConCompIn.Exists())
					{
						ConCompOut = AccCompOut.CreateIntComp(""Contact"");
								
						while (ConCompIn.NextRecord())
						{
							ConCompOut.SetCopySource (ConCompIn);
					
							ConCompOut.NewRecord();   
	
							ConCompOut.CopyFieldValue(""Id"", ""Id"");
					
							ConIntegId = ConCompIn.GetFieldValue(
								""Integration Id"");
								
			 				if (ConIntegId == """" || ConIntegId == null)
			 				{
								// New Contact
								ConCompOut.CopyFieldValue(""Integration Id"", ""Id"");
							}
							else
							{
								// Existing Contact
								ConCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
							}
						}
					} // END ACCOUNT CONTACTS
				}
			} // END ACCOUNT 
		} 
	} 
	else
	{
		EAIRaiseError (TranslateMessage (
			""ORA_MSG_EMPTY,Account - Get/Put Oracle Customer (Siebel)""));
	}
}
function CopyAddressInfo (OracleCustComp, SiebelAddressIntComp,
	CountryVM, AddrSharedID)
{
	OracleCustComp.SetCopySource (SiebelAddressIntComp);
	
	OracleCustComp.SetFieldValue (""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleCustComp.CopyFieldValue (""ADDRESS1"", ""Street Address"");
	OracleCustComp.CopyFieldValue (""ADDRESS2"", ""Street Address 2"");
	OracleCustComp.CopyFieldValue (""CITY"", ""City"");
	OracleCustComp.CopyFieldValue (""STATE"", ""State"");
	OracleCustComp.CopyFieldValue (""PROVINCE"", ""Province"");
	OracleCustComp.CopyFieldValue (""COUNTY"", ""County"");
	OracleCustComp.CopyFieldValue (""POSTAL_CODE"", ""Postal Code"");
	OracleCustComp.CopyFieldValue (""ORG_ID"", ""Organization Integration Id"");

	var CountryVal = SiebelAddressIntComp.GetFieldValue(""Country"");
	if ( CountryVal != """" ) 
	{
		OracleCustComp.SetFieldValue (""COUNTRY"",
			CountryVM.Translate (
			SiebelAddressIntComp.GetFieldValue (""Country"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_COUNTRY, NULL""));
	}
}
function CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
	SiebelContactIntComp, ContactInsUpdFlag, 
	ContactTitleVM, AccSharedID, ConSharedID)
{
	OracleContactIntComp.NewRecord();
	OracleContactIntComp.SetCopySource (SiebelContactIntComp);

	OracleContactIntComp.SetFieldValue  (""operation"", ""upsert"");
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_CONTACT_REF"", ConSharedID);
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", """");
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_TELEPHONE_REF"", """");

	OracleContactIntComp.SetFieldValue  (""INSERT_UPDATE_FLAG"",ContactInsUpdFlag);
	OracleContactIntComp.SetFieldValue  (""CONTACT_TITLE"",
		ContactTitleVM.Translate (SiebelContactIntComp.GetFieldValue (""M/M"")));

    OracleContactIntComp.SetFieldValue  (""CONTACT_JOB_TITLE"", 
    	SiebelContactIntComp.GetFieldValue(""Job Title"").substring(0,49));

    OracleContactIntComp.CopyFieldValue (""CONTACT_LAST_NAME"", ""Last Name"");
    OracleContactIntComp.SetFieldValue  (""CONTACT_FIRST_NAME"", 
    	SiebelContactIntComp.GetFieldValue(""First Name"").substring(0,39));

    OracleContactIntComp.CopyFieldValue (""SEX_CODE"",""M/F"");
    OracleContactIntComp.CopyFieldValue (""EMAIL_ADDRESS"", ""Email Address"");
    OracleContactIntComp.CopyFieldValue (""MAIL_STOP"", ""Mail Stop"");
    OracleContactIntComp.SetFieldValue  (""ORG_ID"", """");
    			
    OracleContactIntComp.SetFieldValue  (""CREATION_DATE"", SiebelContactIntComp.GetFieldValue (""Created""));
    OracleContactIntComp.SetFieldValue  (""LAST_UPDATE_DATE"", SiebelContactIntComp.GetFieldValue (""Updated""));
}
function CopyContactPhoneInfo(SiebelAccountIntComp, SiebelAddressIntComp,
	SiebelContactIntComp,OracleContactIntComp, ContactInsUpdFlag, 
	ContactTitleVM, ContactPhoneVM, AccSharedID, ConSharedID)

{
	var PhoneFields = new Array(""Cellular Phone #"", ""Fax Phone #"",
		""Home Phone #"", ""Work Phone #"", ""Alternate Phone #"", ""Assistant Phone #"");

	var PhoneNumber, PhoneType;	
	
	for ( var i = 0; i < PhoneFields.length; i++ )
	{
		PhoneNumber = SiebelContactIntComp.GetFieldValue (PhoneFields[i]).substring(0,24);

		if (PhoneNumber != """")
		{
			// Fetch the Phone Type from Contact VM
			PhoneType = ContactPhoneVM.Translate(PhoneFields[i]);

			// Copy the Contact details first
			CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
				SiebelContactIntComp, ContactInsUpdFlag,  
				ContactTitleVM, AccSharedID, ConSharedID);

		 	// Copy the Phone details
		 	CopyPhoneInfo(OracleContactIntComp, SiebelAccountIntComp, 
				PhoneType, ContactInsUpdFlag, 
				PhoneNumber, AccSharedID, """", ConSharedID);
		} 
	}
}
function CopyCustomerInfo(OracleCustomerComp, SiebelAccountIntComp,
	InsertUpdateFlag, CusType, AccountCategoryVM, AccountStatusVM,
	AccSharedID)
{
	OracleCustomerComp.SetCopySource (SiebelAccountIntComp); 
	OracleCustomerComp.SetFieldValue (""operation"", ""upsert"");

	OracleCustomerComp.SetFieldValue  (""INSERT_UPDATE_FLAG"", InsertUpdateFlag);
	OracleCustomerComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleCustomerComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", """");
	OracleCustomerComp.SetFieldValue  (""SITE_USE_CODE"", """");
	OracleCustomerComp.CopyFieldValue (""ORG_ID"",  ""Account Organization Integration Id"");
	OracleCustomerComp.SetFieldValue  (""CUSTOMER_NAME"", 
		SiebelAccountIntComp.GetFieldValue(""Name"").substring(0,49));
	OracleCustomerComp.SetFieldValue  (""CUSTOMER_TYPE"", CusType);
	OracleCustomerComp.CopyFieldValue (""URL"", ""Home Page"");

	var CustomerTypeVal = SiebelAccountIntComp.GetFieldValue (""Type"");
	if ( CustomerTypeVal != """") 
	{
		OracleCustomerComp.SetFieldValue (""CUSTOMER_CATEGORY_CODE"",
			AccountCategoryVM.Translate (SiebelAccountIntComp.GetFieldValue (""Type"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_CUST_CATEGORY, NULL""));
	}

	var CustomerStatusVal = SiebelAccountIntComp.GetFieldValue (""Account Status"");
	if ( CustomerStatusVal != """") 
	{

		OracleCustomerComp.SetFieldValue (""CUSTOMER_STATUS"",
			AccountStatusVM.Translate ( SiebelAccountIntComp.GetFieldValue (""Account Status"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage (""ORA_MSG_INVALID_CUST_STATUS, null""));
	}

	OracleCustomerComp.CopyFieldValue (""CREATION_DATE"", ""Created"");
	OracleCustomerComp.CopyFieldValue (""LAST_UPDATE_DATE"", ""Updated"");
}
function CopyFields (SiebelIntObject, OracleIntObject, OutputMsg)
{
	// Declare variables to hold the Primary Integration Components
	var SiebelAccountIntComp, OracleCustomerIntComp;
	
	// Variables to hold the Oracle Contact and Oracle Profile integration Components.
	var OracleContactIntComp, OracleProfileIntComp;
	
	// Declare Shared ID's and misc. variables
	var AccSharedID, AccIntegId, InsertUpdateFlag, 
		AddrSharedID, AddrIntegId, AddrInsUpdFlag, AddressCount,
		ConSharedID, ConIntegId, ContactInsUpdFlag,
		PhoneNumber, PhoneType, PhoneField;
	
	// Customer Type should either External(""E"") or Internal(""I"") at oracle side
	var  CusType		= ""R"";
	var  ProfileClass 	= ""Default"";
	var  CreditHold 	= ""N"";
	
	// Open the EAI Value Map for Account here.
	var CountryVM 		 = EAIGetValueMap(""Oracle Country"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountStatusVM  = EAIGetValueMap(""Oracle Account Status"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountPhoneVM 	 = EAIGetValueMap(""Oracle Account Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AddressPhoneVM 	 = EAIGetValueMap(""Oracle Address Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var ContactPhoneVM 	 = EAIGetValueMap(""Oracle Contact Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountCategoryVM= EAIGetValueMap(""Oracle Account Category"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var ContactTitleVM   = EAIGetValueMap(""Oracle Contact Title"", ""Siebel Outbound"");

	//Get the primary integration component from the Siebel Integration Object
	SiebelAccountIntComp = SiebelIntObject.GetPrimaryIntComp (""Account"");
	
	// If the Primary Integration Component is valid, then go ahead with the copying process
	// Else raise an error message.
	if (SiebelAccountIntComp.Exists ())
	{
		// Create the Oracle Integration Components 
		OracleCustomerIntComp =
			OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");
						
		// Navigate through all the available records in the Siebel primary integration component
    	while (SiebelAccountIntComp.NextRecord ())
		{
			// Create a new record in the Oracle Primary Integration Object
			OracleCustomerIntComp.NewRecord ();   
					
			OracleContactIntComp = 
				OracleCustomerIntComp.CreateIntComp(""SIE_CONTACT_PHONES_INT_ALL"");
			OracleProfileIntComp = 
				OracleCustomerIntComp.CreateIntComp(""SIE_CUSTOMER_PROFILES_INT_ALL"");
			
			// 
			// ACCOUNT
			//
			AccIntegId = SiebelAccountIntComp.GetFieldValue(""Integration Id"");
 			if (AccIntegId == """" || AccIntegId == null)
			{
				// New Account
				AccSharedID = SiebelAccountIntComp.GetFieldValue(""Id"");
				InsertUpdateFlag = ""I"";
			}
			else
			{
				// Existing Account
				AccSharedID = AccIntegId;
				InsertUpdateFlag = ""U"";
			}

			OutputMsg.SetArgument(""ObjectIntegrationId"", AccSharedID);
			
			// set values in SIE_CUSTOMERS_INTERFACE_ALL
			CopyCustomerInfo(OracleCustomerIntComp, SiebelAccountIntComp,
				InsertUpdateFlag, CusType, AccountCategoryVM, AccountStatusVM,
				AccSharedID);
			
			// set values in SIE_CUSTOMER_PROFILES_INT_ALL		
			// Inserting a profile class for the Account in SIE_CUSTOMER_PROFILES_INT_ALL
			if (InsertUpdateFlag == ""I"")
			{
				OracleProfileIntComp.NewRecord();
				CopyProfileInfo (OracleProfileIntComp, SiebelAccountIntComp,
					ProfileClass, CreditHold, InsertUpdateFlag, 
					AccSharedID, """");
			}
											
			// Set the copy source to SiebelAccountIntComp
			OracleContactIntComp.SetCopySource (SiebelAccountIntComp);
			
			PhoneField = ""Main Phone Number"";
			PhoneNumber = SiebelAccountIntComp.GetFieldValue(PhoneField).substring(0,24);
			if (PhoneNumber != """")
			{
				OracleContactIntComp.NewRecord();
				PhoneType = AccountPhoneVM.Translate(PhoneField);
								
				// Call the function CopyPhoneInfo to copy the common fields.
				CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
					PhoneType, InsertUpdateFlag, 
					PhoneNumber, AccSharedID, """", """");
			}
			
			PhoneField = ""Main Fax Number"";
			PhoneNumber = SiebelAccountIntComp.GetFieldValue(PhoneField).substring(0,24);
			if (PhoneNumber != """")
			{
				OracleContactIntComp.NewRecord();
				PhoneType = AccountPhoneVM.Translate(PhoneField);
								
				// Call the function CopyPhoneInfo to copy the common fields.
				CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
					PhoneType, InsertUpdateFlag, 
					PhoneNumber, AccSharedID, """", """");
			}
			
			//
			// ACCOUNT ADDRESSES
			//		
			var SiebelAddressIntComp = SiebelAccountIntComp.GetIntComp (""Business Address"");
			
			// Check the validity of the integration component.
			if (SiebelAddressIntComp.Exists())
			{
				AddressCount = 1;

				// Navigate through all the available records.
				while (SiebelAddressIntComp.NextRecord())
				{
					AddrIntegId = SiebelAddressIntComp.GetFieldValue(""Integration Id"");
		 			if (AddrIntegId == """" || AddrIntegId == null)
					{
						// New Address
						AddrSharedID = SiebelAddressIntComp.GetFieldValue(""Id"");
						AddrInsUpdFlag = ""I"";
					}
					else
					{
						// Existing Address
						AddrSharedID = AddrIntegId;
						AddrInsUpdFlag = ""U"";
					}
								
					if (AddressCount > 1)
					{	
						// Create a new customer interface record.
						OracleIntObject.NewInstance ();
						var NewOracleCustIntComp =				
							OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");				
						NewOracleCustIntComp.NewRecord ();
						
						// Set customer info
						CopyCustomerInfo(NewOracleCustIntComp, SiebelAccountIntComp,
							AddrInsUpdFlag, CusType, AccountCategoryVM, AccountStatusVM,
							AccSharedID);

						// Copy Address Details
						CopyAddressInfo (NewOracleCustIntComp, SiebelAddressIntComp,
							CountryVM, AddrSharedID);	

						// Copy Site Use Details for the address																		
						CopySiteUseInfo(NewOracleCustIntComp, OracleProfileIntComp, 
							SiebelAccountIntComp, SiebelAddressIntComp, 
							AccountStatusVM, CountryVM, 
							AccountCategoryVM, AddrInsUpdFlag, OracleIntObject,
							AccSharedID, AddrSharedID);
					}
					else
					{
						// Copy Address Details
						CopyAddressInfo (OracleCustomerIntComp, SiebelAddressIntComp,
							CountryVM, AddrSharedID);	

						// Copy Site Use Details for the address																		
						CopySiteUseInfo(OracleCustomerIntComp, OracleProfileIntComp, 
							SiebelAccountIntComp, SiebelAddressIntComp, 
							AccountStatusVM, CountryVM, 
							AccountCategoryVM, AddrInsUpdFlag, OracleIntObject,
							AccSharedID, AddrSharedID);
					}

					PhoneField = ""Phone Number"";
					PhoneNumber = SiebelAddressIntComp.GetFieldValue(PhoneField).substring(0,24);
					if (PhoneNumber != """")
					{
						OracleContactIntComp.NewRecord();
						PhoneType = AddressPhoneVM.Translate(PhoneField);
										
						// Call the function CopyPhoneInfo to copy the common fields.
						CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
							PhoneType, InsertUpdateFlag, 
							PhoneNumber, AccSharedID, AddrSharedID, """");
					}

					PhoneField = ""Fax Number"";
					PhoneNumber = SiebelAddressIntComp.GetFieldValue(PhoneField).substring(0,24);
					if (PhoneNumber != """")
					{
						OracleContactIntComp.NewRecord();
						PhoneType = AddressPhoneVM.Translate(PhoneField);
										
						CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
							PhoneType, InsertUpdateFlag, 
							PhoneNumber, AccSharedID, AddrSharedID, """");
					}

					AddressCount++;
				}
			}
			
			//
			// ACCOUNT CONTACTS
			//									
			var SiebelContactIntComp = SiebelAccountIntComp.GetIntComp (""Contact"");

			// Set the copy source as the Siebel Child Integration Component
			// Check the validity of the integration component.
			if (SiebelContactIntComp.Exists())
			{
				while (SiebelContactIntComp.NextRecord ())
				{
					// Only send this contact if we are the primary account for it
					if (SiebelContactIntComp.GetFieldValue(""Account Id"") !=
					   SiebelAccountIntComp.GetFieldValue(""Id""))
					   	continue;
													 
					ConIntegId = SiebelContactIntComp.GetFieldValue(""Integration Id"");
		 			if (ConIntegId == """" || ConIntegId == null)
					{
						// New Contact
						ConSharedID = SiebelContactIntComp.GetFieldValue(""Id"");
						ContactInsUpdFlag = ""I"";
					}
					else
					{
						// Existing Contact
						ConSharedID = ConIntegId;
						ContactInsUpdFlag = ""U"";
					}
					
					// Copy the Contact Details
					CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
						SiebelContactIntComp, ContactInsUpdFlag, 
						ContactTitleVM, AccSharedID, ConSharedID);
					 	
					// Copy the Siebel phone number, telephone reference etc.,
					CopyContactPhoneInfo(SiebelAccountIntComp, SiebelAddressIntComp, 
						SiebelContactIntComp, OracleContactIntComp, ContactInsUpdFlag, 
						ContactTitleVM, ContactPhoneVM, AccSharedID, 
						ConSharedID);
				} 
			} 
		} ///~ while(SiebelAccountIntComp.NextRecord())
	} ///~ if(SiebelAccountIntComp.Exists())
	else
	{
		// Raise an exception saying that the primary integration component is not found.
		EAIRaiseError (TranslateMessage (""ORA_MSG_MISSING_COMPONENT,Account,Account - Get/Put Oracle Customer (Siebel)""));
	}
}
function CopyPhoneInfo(OracleContactIntComp, SiebelAccountIntComp,
	PhoneType, InsertUpdateFlag, PhoneNumber, 
	AccSharedID, AddrSharedID, ConSharedID)
{
	OracleContactIntComp.SetFieldValue(""operation"", ""upsert"");
	OracleContactIntComp.SetFieldValue(""TELEPHONE"", PhoneNumber);		  
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);	  				 
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_CONTACT_REF"", ConSharedID);
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_TELEPHONE_REF"", 
		AccSharedID+"":""+AddrSharedID+"":""+ConSharedID+"":""+PhoneType);

	OracleContactIntComp.SetFieldValue(""TELEPHONE_TYPE"", PhoneType);
	OracleContactIntComp.SetFieldValue(""INSERT_UPDATE_FLAG"", InsertUpdateFlag);  
	
	OracleContactIntComp.SetFieldValue(""CREATION_DATE"", SiebelAccountIntComp.GetFieldValue (""Created""));
	OracleContactIntComp.SetFieldValue(""LAST_UPDATE_DATE"", SiebelAccountIntComp.GetFieldValue (""Updated""));
}
function CopyProfileInfo (OracleProfileIntComp, SiebelAccountIntComp,
	ProfileClass, CreditHold, InsertUpdateFlag, 
	AccSharedID, AddrSharedID)
{ 
	OracleProfileIntComp.SetCopySource(SiebelAccountIntComp);

	OracleProfileIntComp.SetFieldValue  (""operation"", ""upsert"");
	OracleProfileIntComp.SetFieldValue  (""CUSTOMER_PROFILE_CLASS_NAME"", ProfileClass);
	OracleProfileIntComp.SetFieldValue  (""CREDIT_HOLD"", CreditHold);
	OracleProfileIntComp.SetFieldValue  (""INSERT_UPDATE_FLAG"", InsertUpdateFlag);
	OracleProfileIntComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleProfileIntComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleProfileIntComp.CopyFieldValue (""ORG_ID"", ""Account Organization Integration Id"");
	
	OracleProfileIntComp.CopyFieldValue (""CREATION_DATE"", ""Created"");
	OracleProfileIntComp.CopyFieldValue (""LAST_UPDATE_DATE"", ""Updated"");
}
function CopySiteUseInfo (OracleCustomerIntComp, OracleProfileIntComp, 
							   SiebelAccountIntComp, SiebelAddressIntComp, 
							   AccountStatusVM, CountryVM,
							   AccountCategoryVM, InsertUpdateFlag, OracleIntObject,
							   AccSharedID, AddrSharedID)
{
	var AddrSharedID;
	var SiteUseList = new Array();
	var PrimarySiteUseList = new Array();
	var SiteUseCount = 0;
	var NewOracleCustomerIntComp;
	
	// Get the Address & Address Integration Id
	var AddrId  		= SiebelAddressIntComp.GetFieldValue (""Id"");
	var AddrIntId 		= SiebelAddressIntComp.GetFieldValue (""Integration Id"");

	var BillToSiteUse = null, ShipToSiteUse = null, GeneralSiteUse = null;
	
	var CusType			= ""R"";
	var ProfileClass	= ""Default"";
	var CreditHold		= ""N"";

	if (AddrIntId == """" || AddrIntId == null)
	{
		// New Address
		AddrSharedID = AddrId;
	}
	else
	{
		// Existing Address so nothing to do
		// (We don't support changing site uses)
		return;
	}
		
	if (SiebelAddressIntComp.GetFieldValue (""Bill Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""BILL_TO"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Bill To Address Id"")) ? ""Y"" : ""N""
	}
	
	if (SiebelAddressIntComp.GetFieldValue (""Ship Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""SHIP_TO"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Ship To Address Id"")) ? ""Y"" : ""N""
	}
	
	if (SiebelAddressIntComp.GetFieldValue (""Main Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""GENERAL"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Address Id"")) ? ""Y"" : ""N""
	}
	
    for ( var i = 0; i < SiteUseList.length; i++ )
    {
		if (SiteUseList[i] == ""BILL_TO"")
	    {
			// Create new profile for BILL_TO
	 		OracleProfileIntComp.NewRecord();
			// Copy the Address Id from the Address Integration Component
			CopyProfileInfo ( OracleProfileIntComp, SiebelAccountIntComp,
				ProfileClass, CreditHold, ""I"", 
				AccSharedID, AddrSharedID);					
	    }
	    
		if (i > 0)
		{
			// Need new customer interface record
			OracleIntObject.NewInstance ();
			NewOracleCustomerIntComp =				
				OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");				
			NewOracleCustomerIntComp.NewRecord ();

			CopyCustomerInfo(NewOracleCustomerIntComp, SiebelAccountIntComp,
				""I"", CusType, AccountCategoryVM, AccountStatusVM,
				AccSharedID);
			CopyAddressInfo (NewOracleCustomerIntComp, SiebelAddressIntComp,
				CountryVM, AddrSharedID);	

	    	NewOracleCustomerIntComp.SetFieldValue (""SITE_USE_CODE"", SiteUseList[i]);
	    	NewOracleCustomerIntComp.SetFieldValue (""PRIMARY_SITE_USE_FLAG"", PrimarySiteUseList[i]);
		}
		else
		{
	    	// Use existing customer interface record
	    	OracleCustomerIntComp.SetFieldValue (""SITE_USE_CODE"", SiteUseList[i]);
	    	OracleCustomerIntComp.SetFieldValue (""INSERT_UPDATE_FLAG"", ""I"");
	    	OracleCustomerIntComp.SetFieldValue (""PRIMARY_SITE_USE_FLAG"", PrimarySiteUseList[i]);
		}
    }
}
"// Map Siebel Account to Oracle Customer
// Returns argument ""ObjectIntegrationId""
function CreateSiebelCustomer(InputMsg, OutputMsg)
{
	var SiebelIntObject, OracleIntObject;
	
	OutputMsg.SetArgument(""ObjectIntegrationId"", """");

	SiebelIntObject = InputMsg.GetIntObj(""Account - Get/Put Oracle Customer (Siebel)"");
	
	// Check the validity of the Siebel Integration Object.
	if (SiebelIntObject.Exists ())
	{
		// Go ahead and create a new Oracle Integration Object on the Output Message.
		OracleIntObject = OutputMsg.CreateIntObj(""Account - Put Oracle Customer (Oracle)"");
		
		// Navigate through all the available instances in the Integration Object
		while (SiebelIntObject.NextInstance ())
		{
			// Create a new instance in the Oracle Integration Object
			OracleIntObject.NewInstance ();
			
			// CopyFields is again a user defined function which is written to copy all // the fields from the source to the target.
			CopyFields (SiebelIntObject, OracleIntObject, OutputMsg);
		} ///~ while(SiebelIntObject.NextInstance())
	} ///~ if(SiebelIntObject.Exists())
	else
	{
		// Raise an exception saying that the Siebel Integration Object was not found in
		// the Input message. Actually we don't have to do this because, the workflow
		// system itself will inform the user with an Error message.
		EAIRaiseError (TranslateMessage (""ORA_MSG_EMPTY,Account - Get/Put Oracle Customer (Siebel)""));
	} ///~ else

}  ///~ End of CreateSiebelAccount function."
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// LAST UPDATED	:	01/03/2001
//
// DESCRIPTION
//    Javascript maps from Oracle11i Customer to Siebel Account
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function AccountLoopBack(InputMsg, OutputMsg)
{
	var SiebelObjectIn, SiebelObjectOut;
	
	var AccCompIn, AccCompOut, 
		AddrCompIn, AddrCompOut, 
		ConCompIn, ConCompOut;
	
	var AccSharedID, AccIntegId, 
		AddrSharedID, AddrIntegId, 
		ConSharedID, ConIntegId; 
	
	/* Check the validation message */
	var ValidationMessage = InputMsg.GetArgument(""Validation Message"");
	
	if (ValidationMessage != """")
	{
		EAIRaiseError(TranslateMessage(ValidationMessage));
	}

	SiebelObjectIn = InputMsg.GetIntObj(""Account - Put Oracle11i Customer (Siebel)"");
	
	if (SiebelObjectIn.Exists ())
	{
		SiebelObjectOut = OutputMsg.CreateIntObj(""Account - Put Oracle11i Customer (Siebel)"");
		
		while (SiebelObjectIn.NextInstance ())
		{
			SiebelObjectOut.NewInstance ();

			AccCompIn = SiebelObjectIn.GetPrimaryIntComp (""Account"");

			// 
			// ACCOUNT
			//
			if (AccCompIn.Exists ())
			{
				AccCompOut = SiebelObjectOut.CreatePrimaryIntComp(""Account"");
								
		    	while (AccCompIn.NextRecord ())
				{
					AccCompOut.SetCopySource (AccCompIn);
					
					AccCompOut.NewRecord ();   
						
					AccCompOut.CopyFieldValue(""Id"", ""Id"");
					AccCompOut.SetFieldValue(""EAI Sync Date"", Timestamp());
					
					AccIntegId = AccCompIn.GetFieldValue(""Integration Id"");
	 				if (AccIntegId == """" || AccIntegId == null)
					{
						// New Account
						AccCompOut.CopyFieldValue(""Integration Id"", ""Id"");
						AccCompOut.SetFieldValue(""EAI Sync Status Code"", 
							""Creating in Back Office"");
					}
					else
					{
						// Existing Account
						AccCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
						AccCompOut.SetFieldValue(""EAI Sync Status Code"", 
							""Sync To Back Office"");
					}
					
					AccCompOut.SetFieldValue (""EAI Sync Error Text"","""");

					//
					// ACCOUNT ADDRESSES
					//		
					var AddrCompIn = AccCompIn.GetIntComp (""Business Address"");
					
					if (AddrCompIn.Exists())
					{
						AddrCompOut = AccCompOut.CreateIntComp(""Business Address"");
									
						while (AddrCompIn.NextRecord())
						{
							AddrCompOut.SetCopySource (AddrCompIn);
				
							AddrCompOut.NewRecord();   
	
							AddrCompOut.CopyFieldValue(""Id"", ""Id"");

							AddrIntegId = AddrCompIn.GetFieldValue(
								""Integration Id"");
								
			 				if (AddrIntegId == """" || AddrIntegId == null)
			 				{
								// New Address
								AddrCompOut.CopyFieldValue(""Integration Id"", ""Id"");
							}
							else
							{
								// Existing Address
								AddrCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
							}
						}
					} // END ACCOUNT ADDRESSES
														
					//
					// ACCOUNT CONTACTS
					//		
					var ConCompIn = AccCompIn.GetIntComp (""Contact"");
					
					if (ConCompIn.Exists())
					{
						ConCompOut = AccCompOut.CreateIntComp(""Contact"");
								
						while (ConCompIn.NextRecord())
						{
							ConCompOut.SetCopySource (ConCompIn);
					
							ConCompOut.NewRecord();   
	
							ConCompOut.CopyFieldValue(""Id"", ""Id"");
					
							ConIntegId = ConCompIn.GetFieldValue(
								""Integration Id"");
								
			 				if (ConIntegId == """" || ConIntegId == null)
			 				{
								// New Contact
								ConCompOut.CopyFieldValue(""Integration Id"", ""Id"");
							}
							else
							{
								// Existing Contact
								ConCompOut.CopyFieldValue(""Integration Id"", ""Integration Id"");
							}
						}
					} // END ACCOUNT CONTACTS
				}
			} // END ACCOUNT 
		} 
	} 
	else
	{
		EAIRaiseError (TranslateMessage (
			""ORA_MSG_EMPTY,Account - Put Oracle11i Customer (Siebel)""));
	}
}
function CopyAddressInfo (OracleCustComp, SiebelAddressIntComp,
	CountryVM, AddrSharedID)
{
	OracleCustComp.SetCopySource (SiebelAddressIntComp);
	
	OracleCustComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleCustComp.CopyFieldValue (""ADDRESS1"", ""Street Address"");
	OracleCustComp.CopyFieldValue (""ADDRESS2"", ""Street Address 2"");
	OracleCustComp.CopyFieldValue (""CITY"", ""City"");
	OracleCustComp.CopyFieldValue (""STATE"", ""State"");
	OracleCustComp.CopyFieldValue (""PROVINCE"", ""Province"");
	OracleCustComp.CopyFieldValue (""COUNTY"", ""County"");
	OracleCustComp.CopyFieldValue (""POSTAL_CODE"", ""Postal Code"");
	OracleCustComp.CopyFieldValue (""ORG_ID"", ""Organization Integration Id"");
	

	var CountryVal = SiebelAddressIntComp.GetFieldValue(""Country"");
	if ( CountryVal != """" ) 
	{
		OracleCustComp.SetFieldValue (""COUNTRY"",
			CountryVM.Translate (
			SiebelAddressIntComp.GetFieldValue (""Country"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_COUNTRY,NULL""));
	}
}
function CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
	SiebelContactIntComp, ContactInsUpdFlag, 
	ContactTitleVM, AccSharedID, ConSharedID)
{
	OracleContactIntComp.NewRecord();
	OracleContactIntComp.SetCopySource (SiebelContactIntComp);

	OracleContactIntComp.SetFieldValue  (""operation"", ""upsert"");
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_CONTACT_REF"", ConSharedID);
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", """");
	OracleContactIntComp.SetFieldValue  (""ORIG_SYSTEM_TELEPHONE_REF"", """");

	OracleContactIntComp.SetFieldValue  (""INSERT_UPDATE_FLAG"",ContactInsUpdFlag);
	OracleContactIntComp.SetFieldValue  (""CONTACT_TITLE"",
		ContactTitleVM.Translate (SiebelContactIntComp.GetFieldValue (""M/M"")));

    OracleContactIntComp.SetFieldValue  (""CONTACT_JOB_TITLE"", 
    	SiebelContactIntComp.GetFieldValue(""Job Title"").substring(0,49));

    OracleContactIntComp.CopyFieldValue (""CONTACT_LAST_NAME"", ""Last Name"");
    OracleContactIntComp.SetFieldValue  (""CONTACT_FIRST_NAME"", 
    	SiebelContactIntComp.GetFieldValue(""First Name"").substring(0,39));

    OracleContactIntComp.CopyFieldValue (""SEX_CODE"",""M/F"");
    OracleContactIntComp.CopyFieldValue (""EMAIL_ADDRESS"", ""Email Address"");
    OracleContactIntComp.CopyFieldValue (""MAIL_STOP"", ""Mail Stop"");
    OracleContactIntComp.SetFieldValue  (""ORG_ID"", """");
	
	OracleContactIntComp.SetFieldValue (""CREATED_BY"", ""-1"");
	OracleContactIntComp.SetFieldValue (""LAST_UPDATED_BY"", ""-1"");	
    OracleContactIntComp.SetFieldValue  (""CREATION_DATE"", SiebelContactIntComp.GetFieldValue (""Created""));
    OracleContactIntComp.SetFieldValue  (""LAST_UPDATE_DATE"", SiebelContactIntComp.GetFieldValue (""Updated""));
}
function CopyContactPhoneInfo(SiebelAccountIntComp, SiebelAddressIntComp,
	SiebelContactIntComp,OracleContactIntComp, ContactInsUpdFlag, 
	ContactTitleVM, ContactPhoneVM, AccSharedID, ConSharedID)

{
	var PhoneFields = new Array(""Cellular Phone #"", ""Fax Phone #"",
		""Home Phone #"", ""Work Phone #"", ""Alternate Phone #"", ""Assistant Phone #"");

	var PhoneNumber, PhoneType;	
	
	for ( var i = 0; i < PhoneFields.length; i++ )
	{
		PhoneNumber = SiebelContactIntComp.GetFieldValue (PhoneFields[i]).substring(0,24);

		if (PhoneNumber != """")
		{
			// Fetch the Phone Type from Contact VM
			PhoneType = ContactPhoneVM.Translate(PhoneFields[i]);

			// Copy the Contact details first
			CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
				SiebelContactIntComp, ContactInsUpdFlag, 
				ContactTitleVM, AccSharedID, ConSharedID);

		 	// Copy the Phone details
		 	CopyPhoneInfo(OracleContactIntComp, SiebelAccountIntComp, 
				PhoneType, ContactInsUpdFlag, 
				PhoneNumber, AccSharedID, """", ConSharedID);
		} 
	}
}
function CopyCustomerInfo(OracleCustomerComp, SiebelAccountIntComp,
	InsertUpdateFlag, CusType, AccountCategoryVM, AccountStatusVM,
	AccSharedID)
{
	OracleCustomerComp.SetCopySource (SiebelAccountIntComp); 
	OracleCustomerComp.SetFieldValue (""operation"", ""upsert"");

	OracleCustomerComp.SetFieldValue  (""INSERT_UPDATE_FLAG"", InsertUpdateFlag);
	OracleCustomerComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleCustomerComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", """");
	OracleCustomerComp.SetFieldValue  (""SITE_USE_CODE"", """");
	OracleCustomerComp.CopyFieldValue (""ORG_ID"",  ""Account Organization Integration Id"");
	OracleCustomerComp.SetFieldValue  (""CUSTOMER_NAME"", 
		SiebelAccountIntComp.GetFieldValue(""Name"").substring(0,49));
	OracleCustomerComp.SetFieldValue  (""CUSTOMER_TYPE"", CusType);
	OracleCustomerComp.CopyFieldValue (""URL"", ""Home Page"");

	var CustomerTypeVal = SiebelAccountIntComp.GetFieldValue (""Type"");
	if ( CustomerTypeVal != """") 
	{
		OracleCustomerComp.SetFieldValue (""CUSTOMER_CATEGORY_CODE"",
			AccountCategoryVM.Translate (SiebelAccountIntComp.GetFieldValue (""Type"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_CUST_CATEGORY, NULL""));
	}

	var CustomerStatusVal = SiebelAccountIntComp.GetFieldValue (""Account Status"");
	if ( CustomerStatusVal != """") 
	{

		OracleCustomerComp.SetFieldValue (""CUSTOMER_STATUS"",
			AccountStatusVM.Translate ( SiebelAccountIntComp.GetFieldValue (""Account Status"")));
	}
	else
	{
		EAIRaiseError(TranslateMessage (""ORA_MSG_INVALID_CUST_STATUS, null""));
	}

	OracleCustomerComp.SetFieldValue (""CREATED_BY"", ""-1"");
	OracleCustomerComp.SetFieldValue (""LAST_UPDATED_BY"", ""-1"");	
	OracleCustomerComp.CopyFieldValue (""CREATION_DATE"", ""Created"");
	OracleCustomerComp.CopyFieldValue (""LAST_UPDATE_DATE"", ""Updated"");
}
function CopyFields (SiebelIntObject, OracleIntObject, OutputMsg)
{
	// Declare variables to hold the Primary Integration Components
	var SiebelAccountIntComp, OracleCustomerIntComp;
	
	// Variables to hold the Oracle Contact and Oracle Profile integration Components.
	var OracleContactIntComp, OracleProfileIntComp;
	
	// Declare Shared ID's and misc. variables
	var AccSharedID, AccIntegId, InsertUpdateFlag, 
		AddrSharedID, AddrIntegId, AddrInsUpdFlag, AddressCount,
		ConSharedID, ConIntegId, ContactInsUpdFlag,
		PhoneNumber, PhoneType, PhoneField;
	
	// Customer Type should either External(""E"") or Internal(""I"") at oracle side
	var  CusType		= ""R"";
	var  ProfileClass 	= ""DEFAULT"";
	var  CreditHold 	= ""N"";
	
	// Open the EAI Value Map for Account here.
	var CountryVM 		 = EAIGetValueMap(""Oracle11i Country"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountStatusVM  = EAIGetValueMap(""Oracle11i Account Status"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountPhoneVM 	 = EAIGetValueMap(""Oracle11i Account Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AddressPhoneVM 	 = EAIGetValueMap(""Oracle11i Address Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var ContactPhoneVM 	 = EAIGetValueMap(""Oracle11i Contact Phone"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var AccountCategoryVM= EAIGetValueMap(""Oracle11i Account Category"", ""Siebel Outbound"", EAIValueMap_NoEntry_RaiseError);
	var ContactTitleVM   = EAIGetValueMap(""Oracle11i Contact Title"", ""Siebel Outbound"");

	//Get the primary integration component from the Siebel Integration Object
	SiebelAccountIntComp = SiebelIntObject.GetPrimaryIntComp (""Account"");
	
	// If the Primary Integration Component is valid, then go ahead with the copying process
	// Else raise an error message.
	if (SiebelAccountIntComp.Exists ())
	{
		// Create the Oracle Integration Components 
		OracleCustomerIntComp =
			OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");
						
		// Navigate through all the available records in the Siebel primary integration component
    	while (SiebelAccountIntComp.NextRecord ())
		{
			// Create a new record in the Oracle Primary Integration Object
			OracleCustomerIntComp.NewRecord ();   
					
			OracleContactIntComp = 
				OracleCustomerIntComp.CreateIntComp(""SIE_CONTACT_PHONES_INT_ALL"");
			OracleProfileIntComp = 
				OracleCustomerIntComp.CreateIntComp(""SIE_CUSTOMER_PROFILES_INT_ALL"");
			
			// 
			// ACCOUNT
			//
			AccIntegId = SiebelAccountIntComp.GetFieldValue(""Integration Id"");
 			if (AccIntegId == """" || AccIntegId == null)
			{
				// New Account
				AccSharedID = SiebelAccountIntComp.GetFieldValue(""Id"");
				InsertUpdateFlag = ""I"";
			}
			else
			{
				// Existing Account
				AccSharedID = AccIntegId;
				InsertUpdateFlag = ""U"";
			}

			OutputMsg.SetArgument(""ObjectIntegrationId"", AccSharedID);
			
			// set values in SIE_CUSTOMERS_INTERFACE_ALL
			CopyCustomerInfo(OracleCustomerIntComp, SiebelAccountIntComp,
				InsertUpdateFlag, CusType, AccountCategoryVM, AccountStatusVM,
				AccSharedID);
			
			// set values in SIE_CUSTOMER_PROFILES_INT_ALL		
			// Inserting a profile class for the Account in SIE_CUSTOMER_PROFILES_INT_ALL
			if (InsertUpdateFlag == ""I"")
			{
				OracleProfileIntComp.NewRecord();
				CopyProfileInfo (OracleProfileIntComp, SiebelAccountIntComp,
					ProfileClass, CreditHold, InsertUpdateFlag, 
					AccSharedID, """");
			}
											
			// Set the copy source to SiebelAccountIntComp
			OracleContactIntComp.SetCopySource (SiebelAccountIntComp);
			
			PhoneField = ""Main Phone Number"";
			PhoneNumber = SiebelAccountIntComp.GetFieldValue(PhoneField).substring(0,24);
			if (PhoneNumber != """")
			{
				OracleContactIntComp.NewRecord();
				PhoneType = AccountPhoneVM.Translate(PhoneField);
								
				// Call the function CopyPhoneInfo to copy the common fields.
				CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
					PhoneType, InsertUpdateFlag, 
					PhoneNumber, AccSharedID, """", """");
			}
			
			PhoneField = ""Main Fax Number"";
			PhoneNumber = SiebelAccountIntComp.GetFieldValue(PhoneField).substring(0,24);
			if (PhoneNumber != """")
			{
				OracleContactIntComp.NewRecord();
				PhoneType = AccountPhoneVM.Translate(PhoneField);
								
				// Call the function CopyPhoneInfo to copy the common fields.
				CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
					PhoneType, InsertUpdateFlag, 
					PhoneNumber, AccSharedID, """", """");
			}
			
			//
			// ACCOUNT ADDRESSES
			//		
			var SiebelAddressIntComp = SiebelAccountIntComp.GetIntComp (""Business Address"");
			
			// Check the validity of the integration component.
			if (SiebelAddressIntComp.Exists())
			{
				AddressCount = 1;

				// Navigate through all the available records.
				while (SiebelAddressIntComp.NextRecord())
				{
					AddrIntegId = SiebelAddressIntComp.GetFieldValue(""Integration Id"");
		 			if (AddrIntegId == """" || AddrIntegId == null)
					{
						// New Address
						AddrSharedID = SiebelAddressIntComp.GetFieldValue(""Id"");
						AddrInsUpdFlag = ""I"";
					}
					else
					{
						// Existing Address
						AddrSharedID = AddrIntegId;
						AddrInsUpdFlag = ""U"";
					}
								
					if (AddressCount > 1)
					{	
						// Create a new customer interface record.
						OracleIntObject.NewInstance ();
						var NewOracleCustIntComp =				
							OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");				
						NewOracleCustIntComp.NewRecord ();
						
						// Set customer info
						CopyCustomerInfo(NewOracleCustIntComp, SiebelAccountIntComp,
							AddrInsUpdFlag, CusType, AccountCategoryVM, AccountStatusVM,
							AccSharedID);

						// Copy Address Details
						CopyAddressInfo (NewOracleCustIntComp, SiebelAddressIntComp,
							CountryVM, AddrSharedID);	

						// Copy Site Use Details for the address																		
						CopySiteUseInfo(NewOracleCustIntComp, OracleProfileIntComp, 
							SiebelAccountIntComp, SiebelAddressIntComp, 
							AccountStatusVM, CountryVM, 
							AccountCategoryVM, AddrInsUpdFlag, OracleIntObject,
							AccSharedID, AddrSharedID);
					}
					else
					{
						// Copy Address Details
						CopyAddressInfo (OracleCustomerIntComp, SiebelAddressIntComp,
							CountryVM, AddrSharedID);	

						// Copy Site Use Details for the address																		
						CopySiteUseInfo(OracleCustomerIntComp, OracleProfileIntComp, 
							SiebelAccountIntComp, SiebelAddressIntComp, 
							AccountStatusVM, CountryVM, 
							AccountCategoryVM, AddrInsUpdFlag, OracleIntObject,
							AccSharedID, AddrSharedID);
					}

					PhoneField = ""Phone Number"";
					PhoneNumber = SiebelAddressIntComp.GetFieldValue(PhoneField).substring(0,24);
					if (PhoneNumber != """")
					{
						OracleContactIntComp.NewRecord();
						PhoneType = AddressPhoneVM.Translate(PhoneField);
										
						// Call the function CopyPhoneInfo to copy the common fields.
						CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
							PhoneType, InsertUpdateFlag, 
							PhoneNumber, AccSharedID, AddrSharedID, """");
					}

					PhoneField = ""Fax Number"";
					PhoneNumber = SiebelAddressIntComp.GetFieldValue(PhoneField).substring(0,24);
					if (PhoneNumber != """")
					{
						OracleContactIntComp.NewRecord();
						PhoneType = AddressPhoneVM.Translate(PhoneField);
										
						CopyPhoneInfo (OracleContactIntComp, SiebelAccountIntComp, 
							PhoneType, InsertUpdateFlag, 
							PhoneNumber, AccSharedID, AddrSharedID, """");
					}

					AddressCount++;
				}
			}
			
			//
			// ACCOUNT CONTACTS
			//									
			var SiebelContactIntComp = SiebelAccountIntComp.GetIntComp (""Contact"");

			// Set the copy source as the Siebel Child Integration Component
			// Check the validity of the integration component.
			if (SiebelContactIntComp.Exists())
			{
				while (SiebelContactIntComp.NextRecord ())
				{
					// Only send this contact if we are the primary account for it
					if (SiebelContactIntComp.GetFieldValue(""Account Id"") !=
					   SiebelAccountIntComp.GetFieldValue(""Id""))
					   	continue;
													 
					ConIntegId = SiebelContactIntComp.GetFieldValue(""Integration Id"");
		 			if (ConIntegId == """" || ConIntegId == null)
					{
						// New Contact
						ConSharedID = SiebelContactIntComp.GetFieldValue(""Id"");
						ContactInsUpdFlag = ""I"";
					}
					else
					{
						// Existing Contact
						ConSharedID = ConIntegId;
						ContactInsUpdFlag = ""U"";
					}
					
					// Copy the Contact Details
					CopyContactInfo(OracleContactIntComp, SiebelAccountIntComp, 
						SiebelContactIntComp, ContactInsUpdFlag, 
						ContactTitleVM, AccSharedID, ConSharedID);
					 	
					// Copy the Siebel phone number, telephone reference etc.,
					CopyContactPhoneInfo(SiebelAccountIntComp, SiebelAddressIntComp, 
						SiebelContactIntComp, OracleContactIntComp, ContactInsUpdFlag, 
						ContactTitleVM, ContactPhoneVM, AccSharedID, 
						ConSharedID);
				} 
			} 
		} ///~ while(SiebelAccountIntComp.NextRecord())
	} ///~ if(SiebelAccountIntComp.Exists())
	else
	{
		// Raise an exception saying that the primary integration component is not found.
		EAIRaiseError (TranslateMessage (""ORA_MSG_MISSING_COMPONENT,Account,Account - Get/Put Oracle Customer (Siebel)""));
	}
}
function CopyPhoneInfo(OracleContactIntComp, SiebelAccountIntComp,
	PhoneType, InsertUpdateFlag, PhoneNumber, 
	AccSharedID, AddrSharedID, ConSharedID)
{
	OracleContactIntComp.SetFieldValue(""operation"", ""upsert"");
	OracleContactIntComp.SetFieldValue(""TELEPHONE"", PhoneNumber);		  
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);	  				 
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_CONTACT_REF"", ConSharedID);
	OracleContactIntComp.SetFieldValue(""ORIG_SYSTEM_TELEPHONE_REF"", 
		AccSharedID+"":""+AddrSharedID+"":""+ConSharedID+"":""+PhoneType);

	OracleContactIntComp.SetFieldValue(""TELEPHONE_TYPE"", PhoneType);
	OracleContactIntComp.SetFieldValue(""INSERT_UPDATE_FLAG"", InsertUpdateFlag);  
	
	OracleContactIntComp.SetFieldValue (""CREATED_BY"", ""-1"");
	OracleContactIntComp.SetFieldValue (""LAST_UPDATED_BY"", ""-1"");	
	OracleContactIntComp.SetFieldValue(""CREATION_DATE"", SiebelAccountIntComp.GetFieldValue (""Created""));
	OracleContactIntComp.SetFieldValue(""LAST_UPDATE_DATE"", SiebelAccountIntComp.GetFieldValue (""Updated""));
}
function CopyProfileInfo (OracleProfileIntComp, SiebelAccountIntComp,
	ProfileClass, CreditHold, InsertUpdateFlag, 
	AccSharedID, AddrSharedID)
{ 
	OracleProfileIntComp.SetCopySource(SiebelAccountIntComp);

	OracleProfileIntComp.SetFieldValue  (""operation"", ""upsert"");
	OracleProfileIntComp.SetFieldValue  (""CUSTOMER_PROFILE_CLASS_NAME"", ProfileClass);
	OracleProfileIntComp.SetFieldValue  (""CREDIT_HOLD"", CreditHold);
	OracleProfileIntComp.SetFieldValue  (""INSERT_UPDATE_FLAG"", InsertUpdateFlag);
	OracleProfileIntComp.SetFieldValue  (""ORIG_SYSTEM_CUSTOMER_REF"", AccSharedID);
	OracleProfileIntComp.SetFieldValue  (""ORIG_SYSTEM_ADDRESS_REF"", AddrSharedID);
	OracleProfileIntComp.CopyFieldValue (""ORG_ID"", ""Account Organization Integration Id"");
	
	OracleProfileIntComp.SetFieldValue (""CREATED_BY"", ""-1"");
	OracleProfileIntComp.SetFieldValue (""LAST_UPDATED_BY"", ""-1"");	
	OracleProfileIntComp.CopyFieldValue (""CREATION_DATE"", ""Created"");
	OracleProfileIntComp.CopyFieldValue (""LAST_UPDATE_DATE"", ""Updated"");
}
function CopySiteUseInfo (OracleCustomerIntComp, OracleProfileIntComp, 
							   SiebelAccountIntComp, SiebelAddressIntComp, 
							   AccountStatusVM, CountryVM,
							   AccountCategoryVM, InsertUpdateFlag, OracleIntObject,
							   AccSharedID, AddrSharedID)
{
	var AddrSharedID;
	var SiteUseList = new Array();
	var PrimarySiteUseList = new Array();
	var SiteUseCount = 0;
	var NewOracleCustomerIntComp;
	
	// Get the Address & Address Integration Id
	var AddrId  		= SiebelAddressIntComp.GetFieldValue (""Id"");
	var AddrIntId 		= SiebelAddressIntComp.GetFieldValue (""Integration Id"");

	var BillToSiteUse = null, ShipToSiteUse = null, GeneralSiteUse = null;
	
	var CusType			= ""R"";
	var ProfileClass	= ""DEFAULT"";
	var CreditHold		= ""N"";

	if (AddrIntId == """" || AddrIntId == null)
	{
		// New Address
		AddrSharedID = AddrId;
	}
	else
	{
		// Existing Address so nothing to do
		// (We don't support changing site uses)
		return;
	}
		
	if (SiebelAddressIntComp.GetFieldValue (""Bill Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""BILL_TO"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Bill To Address Id"")) ? ""Y"" : ""N""
	}
	
	if (SiebelAddressIntComp.GetFieldValue (""Ship Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""SHIP_TO"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Ship To Address Id"")) ? ""Y"" : ""N""
	}
	
	if (SiebelAddressIntComp.GetFieldValue (""Main Address Flag"") == ""Y"")
	{
		SiteUseList[SiteUseCount] = ""GENERAL"";
		PrimarySiteUseList[SiteUseCount++] = 
			(AddrId == SiebelAccountIntComp.GetFieldValue (""Primary Address Id"")) ? ""Y"" : ""N""
	}
	
    for ( var i = 0; i < SiteUseList.length; i++ )
    {
		if (SiteUseList[i] == ""BILL_TO"")
	    {
			// Create new profile for BILL_TO
	 		OracleProfileIntComp.NewRecord();
			// Copy the Address Id from the Address Integration Component
			CopyProfileInfo ( OracleProfileIntComp, SiebelAccountIntComp,
				ProfileClass, CreditHold, ""I"", 
				AccSharedID, AddrSharedID);					
	    }
	    
		if (i > 0)
		{
			// Need new customer interface record
			OracleIntObject.NewInstance ();
			NewOracleCustomerIntComp =				
				OracleIntObject.CreatePrimaryIntComp(""SIE_CUSTOMERS_INTERFACE_ALL"");				
			NewOracleCustomerIntComp.NewRecord ();

			CopyCustomerInfo(NewOracleCustomerIntComp, SiebelAccountIntComp,
				""I"", CusType, AccountCategoryVM, AccountStatusVM,
				AccSharedID);
			CopyAddressInfo (NewOracleCustomerIntComp, SiebelAddressIntComp,
				CountryVM, AddrSharedID);	

	    	NewOracleCustomerIntComp.SetFieldValue (""SITE_USE_CODE"", SiteUseList[i]);
	    	NewOracleCustomerIntComp.SetFieldValue (""PRIMARY_SITE_USE_FLAG"", PrimarySiteUseList[i]);
		}
		else
		{
	    	// Use existing customer interface record
	    	OracleCustomerIntComp.SetFieldValue (""SITE_USE_CODE"", SiteUseList[i]);
	    	OracleCustomerIntComp.SetFieldValue (""INSERT_UPDATE_FLAG"", ""I"");
	    	OracleCustomerIntComp.SetFieldValue (""PRIMARY_SITE_USE_FLAG"", PrimarySiteUseList[i]);
		}
    }
}
"// Map Siebel Account to Oracle Customer
// Returns argument ""ObjectIntegrationId""
function CreateSiebelCustomer(InputMsg, OutputMsg)
{
	var SiebelIntObject, OracleIntObject;
	
	OutputMsg.SetArgument(""ObjectIntegrationId"", """");

	SiebelIntObject = InputMsg.GetIntObj(""Account - Put Oracle11i Customer (Siebel)"");
	
	// Check the validity of the Siebel Integration Object.
	if (SiebelIntObject.Exists ())
	{
		// Go ahead and create a new Oracle Integration Object on the Output Message.
		OracleIntObject = OutputMsg.CreateIntObj(""Account - Put Oracle11i Customer (Oracle)"");
		
		// Navigate through all the available instances in the Integration Object
		while (SiebelIntObject.NextInstance ())
		{
			// Create a new instance in the Oracle Integration Object
			OracleIntObject.NewInstance ();
			
			// CopyFields is again a user defined function which is written to copy all 
			// the fields from the source to the target.
			CopyFields (SiebelIntObject, OracleIntObject, OutputMsg);
		} ///~ while(SiebelIntObject.NextInstance())
	} ///~ if(SiebelIntObject.Exists())
	else
	{
		// Raise an exception saying that the Siebel Integration Object was not found in
		// the Input message. Actually we don't have to do this because, the workflow
		// system itself will inform the user with an Error message.
		EAIRaiseError (TranslateMessage (""ORA_MSG_EMPTY,Account - Put Oracle11i Customer (Siebel)""));
	} ///~ else

}  ///~ End of CreateSiebelAccount function."
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
	
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", 
 	  d.getMonth()+1, d.getDate(), d.getFullYear(), 
 	  d.getHours(), d.getMinutes(), d.getSeconds());
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];
			
			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
try
{
	if(MethodName == ""GetLOVDescription"")
	{
		var sLovType, sLIC, boLOV, bcLOV, sDescription;
		Outputs.SetProperty(""Description"", """");
		sLovType =Inputs.GetProperty(""Type"");	
		sLIC = Inputs.GetProperty(""LIC"");
		boLOV =  TheApplication().GetBusObject(""List Of Values"");
		bcLOV = boLOV.GetBusComp(""List Of Values"");
		if(sLovType != null && sLovType != """" && sLIC != null && sLIC != """")
		{
			with(bcLOV)
			{
				ClearToQuery();
				SetViewMode(AllView);
				ActivateField(""Description"");
				SetSearchSpec(""Type"", sLovType);
				SetSearchSpec(""Name"", sLIC);
				ExecuteQuery(ForwardOnly);
				if(FirstRecord())
				{
					sDescription = GetFieldValue(""Description"");
				}
			}
		}
		Outputs.SetProperty(""Description"", sDescription);	
		return(CancelOperation)
	}
}	
catch(e)
{
	throw(e);
}
finally
{
	bcLOV = null;
	boLOV = null;
}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if(MethodName == ""Resubmit"")
	{
		Resubmit();
		return(CancelOperation);    
	}
	else
    {    
		return(ContinueOperation);
    }
}
function trim(s) {
var r=/\b(.*)\b/.exec(s);
return (r==null)?"""":r[1];
}




function Resubmit()
{
	var MRowId="""";

	/*	WIPRO-Upgrade-02.05.2016-TSINGHALC - Gets the Filename along with Filepath from LOV Description	*/
	
	var svc = TheApplication().GetService(""STC Get Filename"");
	var Inputs = TheApplication().NewPropertySet();
	var Outputs = TheApplication().NewPropertySet();
	Inputs.SetProperty(""Type"",""STC_FILE_NAME"");
	Inputs.SetProperty(""LIC"",""STC_BULK_TERMINATION"");
	svc.InvokeMethod(""STC Get LOV Desc"", Inputs, Outputs);
	var filepath = Outputs.GetProperty(""Description"");
	
	var file = Clib.fopen(filepath, ""rt"");
	
	/* WIPRO-Upgrade-02.05.2016-TSINGHALC - Commented the below line as the filename is received from the above lines by invoking the Generic BS */

	//var file=Clib.fopen(""/siebelfs/hout.csv"", ""rt"");



	if (file==null)
	{
		TheApplication().RaiseErrorText(""Error in opening the file"");
    }
	else
    {
		while(!Clib.feof(file))
        {

			MRowId = (Clib.fgets(file));  
			MRowId = trim(MRowId);
			var MInputs = TheApplication().NewPropertySet();
			var MOutputs = TheApplication().NewPropertySet();

			MInputs.SetProperty(""Object Id"",MRowId);    

			MInputs.SetProperty(""ProcessName"",""STC Terminate order from Policy"");


			var MWorkflowProc = TheApplication().GetService(""Workflow Process Manager"");

			MWorkflowProc.InvokeMethod(""RunProcess"", MInputs, MOutputs);

        }
    }
	MWorkflowProc=null;
	MOutputs=null;
	MInputs=null;
	MRowId=null
	file = null;
	filepath = null;
	Outputs = null;
	Inputs = null;
	svc = null;
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if(MethodName == ""Resubmit"")
	{
		Resubmit();
		return(CancelOperation);    
	}
	else
    {    
		return(ContinueOperation);
    }
}
function trim(s) {
var r=/\b(.*)\b/.exec(s);
return (r==null)?"""":r[1];
}




function Resubmit()
{
	var MRowId="""";

	/*	WIPRO-Upgrade-02.05.2016-TSINGHALC - Gets the Filename along with Filepath from LOV Description	*/
	
	var svc = TheApplication().GetService(""STC Get Filename"");
	var Inputs = TheApplication().NewPropertySet();
	var Outputs = TheApplication().NewPropertySet();
	Inputs.SetProperty(""Type"",""STC_FILE_NAME"");
	Inputs.SetProperty(""LIC"",""STC_BULK_TERMINATION_NEW"");
	svc.InvokeMethod(""STC Get LOV Desc"", Inputs, Outputs);
	var filepath = Outputs.GetProperty(""Description"");
	
	var file = Clib.fopen(filepath, ""rt"");

	/*	WIPRO-Upgrade-02.05.2016-TSINGHALC - Commented the below line as the filename is received from the above lines by invoking the Generic BS */
	
	//var file=Clib.fopen(""/siebelfs/hout.csv"", ""rt"");

	if (file==null)
	{
		TheApplication().RaiseErrorText(""Error in opening the file"");
    }
	else
	{
		while(!Clib.feof(file))
        {

			MRowId = (Clib.fgets(file));  
			MRowId = trim(MRowId);
			var MInputs = TheApplication().NewPropertySet();
			var MOutputs = TheApplication().NewPropertySet();

			MInputs.SetProperty(""Object Id"",MRowId);    

			MInputs.SetProperty(""ProcessName"",""STC Dunning Termination Order WF"");

			var MWorkflowProc = TheApplication().GetService(""Workflow Process Manager"");

			MWorkflowProc.InvokeMethod(""RunProcess"", MInputs, MOutputs);


        }
    }
	MWorkflowProc=null;
	MOutputs=null;
	MInputs=null;
	MRowId=null
	file = null;
	filepath = null;
	Outputs = null;
	Inputs = null;
	svc = null;
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""Init"")
	{
		Inputs.SetProperty(""Field1"", """");
		Inputs.SetProperty(""Field2"", """");
		Inputs.SetProperty(""Field3"", """");
		Inputs.SetProperty(""Field4"", """");
		Inputs.SetProperty(""Field5"", """");
		Inputs.SetProperty(""Field6"", """");
		Inputs.SetProperty(""Field7"", """");
		Inputs.SetProperty(""Field8"", """");
		Inputs.SetProperty(""Field9"", """");
		Inputs.SetProperty(""Field10"", """");
		Inputs.SetProperty(""Field11"", """");
		Inputs.SetProperty(""Field12"", """");
		Inputs.SetProperty(""Field13"", """");
		Inputs.SetProperty(""Field14"", """");
		Inputs.SetProperty(""Field41"", """");
		Inputs.SetProperty(""Field16"", """");
		Inputs.SetProperty(""Field17"", """");
		Inputs.SetProperty(""Field18"", """");
		Inputs.SetProperty(""Field19"", """");
		Inputs.SetProperty(""Field20"", """");
		Inputs.SetProperty(""Field21"", """");
		Inputs.SetProperty(""Field22"", """");
		Inputs.SetProperty(""Field23"", """");
		Inputs.SetProperty(""Field24"", """");
		Inputs.SetProperty(""Field25"", """");
		Inputs.SetProperty(""Field26"", """");
		Inputs.SetProperty(""Field27"", """");
		Inputs.SetProperty(""Field28"", """");
		Inputs.SetProperty(""Field29"", """");
		Inputs.SetProperty(""Field30"", """");
		Inputs.SetProperty(""Field31"", """");
		Inputs.SetProperty(""Field32"", """");
		Inputs.SetProperty(""Field33"", """");
		Inputs.SetProperty(""Field34"", """");
		Inputs.SetProperty(""Field35"", """");
		Inputs.SetProperty(""Field36"", """");
		Inputs.SetProperty(""Field37"", """");
		Inputs.SetProperty(""Field38"", """");
		Inputs.SetProperty(""Field39"", """");
		Inputs.SetProperty(""Field40"", """");
		return (CancelOperation);
	}
	
	if (MethodName == ""Query"")
	{
		var oPs = TheApplication().NewPropertySet();
		Outputs.AddChild(oPs);
		oPs = TheApplication().NewPropertySet();
		Outputs.AddChild(oPs);
		oPs = TheApplication().NewPropertySet();
		Outputs.AddChild(oPs);
		oPs = TheApplication().NewPropertySet();
		Outputs.AddChild(oPs);
		
		return (CancelOperation);
	}
	
	if (MethodName == ""Update"")
	{
		return (CancelOperation);
	}


	return (ContinueOperation);
}
var theData:PropertySet; // The Database
function Service_PreInvokeMethod (MethodName:String, Inputs:PropertySet, Outputs:PropertySet)
{
	if (MethodName == ""Init"")
		return myInitialise(Outputs);
	else if (MethodName == ""Query"")
		return myQuery(Inputs, Outputs);
	else if (MethodName == ""PreInsert"")
		return myPreInsert(Outputs);
	else if (MethodName == ""Insert"")
		return myInsert(Inputs, Outputs);
	else if (MethodName == ""Delete"")
		return myDelete(Inputs, Outputs);
	else if (MethodName == ""Update"")
		return myUpdate(Inputs, Outputs);
	else 
		return (ContinueOperation);
}
"
function makeid()
{
    var text = """";
    var possible = ""ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"";

    for( var i=0; i < 5; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));

    return text;
}
function myDelete(Inputs, Outputs)
{
	var oChild:PropertySet = Inputs.GetChild(0);
	var oRecord:PropertySet;
	var sPropName:String;
	var bFound:bool = false;
	var bEqual:bool;
	
	if (oChild.GetProperty(""First Name"") == ""Jack"")
	{	
		var oErrorChild:PropertySet = TheApplication().NewPropertySet();
		oErrorChild.SetType(""Status"");
		oErrorChild.SetProperty(""Status"", ""4"");
		oErrorChild.SetProperty(""Error Field"", ""First Name"");
		oErrorChild.SetProperty(""Error Text"", ""Cannot delete Jack"");
		Outputs.AddChild(oErrorChild);
	}
	else
	{
		for (var i=0; i < theData.GetChildCount() && !bFound; i++)
		{
			bEqual = true;
		
			oRecord = theData.GetChild(i);
		
			sPropName = oChild.GetFirstProperty();
		
			while (sPropName != """" && bEqual)
			{
				if (oChild.GetProperty(sPropName) != oRecord.GetProperty(sPropName))
					bEqual = false;
				
				sPropName = oChild.GetNextProperty();
			}

			if (bEqual)
			{
				bFound = true;
				theData.RemoveChild(i);
			}		
		}
	}
	
	return (CancelOperation);
}
function myInitialise(Outputs:PropertySet)
{
	var currentRow:PropertySet;
	var i;
		
	for (i=1; i < 100; i++)
	{
		Outputs.SetProperty(""Field"" + i, """");
	}
		
	// fill our 'database' with some inital data	
	
	theData = TheApplication().NewPropertySet();
	
		
	for (var j=0; j < 20; j++)
	{
		currentRow = TheApplication().NewPropertySet() ;
		
		for (i=1; i < 100; i++)
		{
			currentRow.SetProperty(""Field""+i, makeid());
		}
		theData.AddChild(currentRow);
	}
	
	currentRow = null;
				
	return (CancelOperation);  
	
}
function myInsert(Inputs, Outputs)
{
	//Update my array to include the inserted new Row
	theData.AddChild(Inputs.GetChild(0));
	
	Outputs.AddChild(Inputs.GetChild(0));
	
	return (CancelOperation);
}
function myLike(SearchString:String, Pattern:String)
{
	if (Pattern.indexOf(""*"") >= 0)
	{
		var oSearch = Pattern.split(""*"");
		var bMatch:bool = true;
		var Index:Number = 0;
		
		for (var i=0; i < oSearch.length && bMatch; i++)
		{
			if (oSearch[i].length > 0)
			{
				Index = SearchString.indexOf(oSearch[i], Index);
			
				if (Index < 0)
					bMatch = false;
				
				Index++;
			}
		}
		
		return bMatch;
	}
	else
		return (SearchString == Pattern);
}
function myPreInsert(Outputs:PropertySet)
{
	var newRow:PropertySet = TheApplication().NewPropertySet();
	
	newRow.SetProperty(""First Name"","""");
	newRow.SetProperty(""Last Name"","""");
	newRow.SetProperty(""Phone"","""");
	newRow.SetProperty(""Key"","""");
	newRow.SetProperty(""Occupation"",""SC"");
	
	Outputs.AddChild(newRow);
	
	newRow = null;
	
	return (CancelOperation);
}
function myQuery(Inputs:PropertySet,Outputs:PropertySet)
{
	var oQuerySpec:PropertySet;
	var oChild:PropertySet;
	var bAdd:bool;
	var sPropName:String;
	
	// The Query specifications are in a child propertyset of the inputs	
	oQuerySpec = Inputs.GetChild(0);
	
	
	for (var i=0; i < theData.GetChildCount(); i++)
	{
		bAdd = true;
	
		oChild = theData.GetChild(i);
		
		sPropName = oQuerySpec.GetFirstProperty();
		
		while (sPropName != """" && bAdd)
		{
			bAdd =  myLike(oChild.GetProperty(sPropName),oQuerySpec.GetProperty(sPropName));
			sPropName = oQuerySpec.GetNextProperty();	
		}
	
		if (bAdd)
			Outputs.AddChild(theData.GetChild(i));
	}
	
	return (CancelOperation);  
}
function myUpdate(Inputs:PropertySet, Outputs:PropertySet)
{
	var oChild:PropertySet;
	var oInputChild:PropertySet;
	var bFound:bool = false;
	var bEqual:bool;
	var oOutputChild:PropertySet = TheApplication().NewPropertySet();
	
	for (var i=0; i < theData.GetChildCount() && !bFound; i++)
	{
		bEqual = true;
		var j:Number;
		
		oChild = theData.GetChild(i);
		
		for (j=0; j < Inputs.GetChildCount() && bEqual; j++)
		{
			oInputChild = Inputs.GetChild(j);
			
			if (oInputChild.GetProperty(""Changed"") == "false"")
			{
				if (oInputChild.GetProperty(""Field Value"") != oChild.GetProperty(oInputChild.GetProperty(""Field Name"")))
					bEqual = false;
			}	
		}
		
		if (bEqual)
		{
			bFound = true;
	
			for (j=0; j < Inputs.GetChildCount(); j++)
			{
				oInputChild = Inputs.GetChild(j);
				
				if (oInputChild.GetProperty(""Changed"") == ""true"")
				{
					theData.GetChild(i).SetProperty(oInputChild.GetProperty(""Field Name""), oInputChild.GetProperty(""Field Value""));
					oOutputChild.SetProperty(oInputChild.GetProperty(""Field Name""), oInputChild.GetProperty(""Field Value""));               
				}
			}
		}		
	}

	Outputs.AddChild(oOutputChild);
		
	return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	switch (MethodName)
	{
		case ""Init"" :
			Outputs.SetProperty (""Name"", """");
			return (CancelOperation);
		break;
		case ""Query"" :
			var test = TheApplication().NewPropertySet ();
			Outputs.AddChild (test);
			test.SetType (""Status"");
			test.SetProperty (""Status"", ""5"");
			test.SetProperty (""Error Field"", ""Name"");
			test.SetProperty (""Error Text"", ""Text"");
			return (CancelOperation);
		break;
	}
	return (ContinueOperation);
}
function CallBPELGetConfigParams		(Inputs, Outputs)
{
	//TheApplication().TraceOn(""d:\\temp\\CallBPELGetConfigParams.txt"", ""Allocation"", ""All"");

	try 
		{
			//CALL USING DTE MAP FUNCTIONS
			
			// setup the map parameters, service out put parameters
			
			var MAPreqInput =TheApplication().NewPropertySet ();
			var BPELreqInput =TheApplication().NewPropertySet ();
			var MAPresInput =TheApplication().NewPropertySet ();
			var BPELresOutput =TheApplication().NewPropertySet ();
			var MAPcfg = TheApplication().NewPropertySet ();
			
			var sourceConfigHeader = Inputs.GetProperty(""SourceConfigHeader"");
			var sourceConfigRevNbr = Inputs.GetProperty(""SourceConfigRevNbr"");
			//set up the format required to call the map
			
			
           //TheApplication().Trace(""sourceConfigHeader = "" + sourceConfigHeader);
		   //TheApplication().Trace(""sourceConfigRevNbr = "" + sourceConfigRevNbr);
		   
			var siebelMessage = TheApplication().NewPropertySet ();
			siebelMessage.SetType(""SiebelMessage"");

			var rootComponent = TheApplication().NewPropertySet ();
			siebelMessage.AddChild(rootComponent);
		
			//set up all the parameters required for the 
			//DTE map function
			MAPreqInput.SetProperty(""MapName"", "formatCopyRequest"");
			MAPreqInput.SetProperty(""InputType"", ""SiebelMessage"");
			MAPreqInput.SetProperty(""OutputType"", ""SiebelMessage"");
			MAPreqInput.SetProperty(""OutputIntObjectName"",""InputParameters"");
			MAPreqInput.SetProperty(""SiebelMessage"", """");
			MAPreqInput.SetProperty(""InputConfigHeaderId"",sourceConfigHeader);
			MAPreqInput.SetProperty(""InputConfigRevNbr"",sourceConfigRevNbr);

			
			MAPreqInput.AddChild(siebelMessage);
			
			// call out the DTE map function to create
			// the integration object
			var oraclecopycfgMAPsvc = TheApplication().GetService(""CZIntegPrepareIntegrationObjects"");
			//var oraclecopycfgMAPsvc = TheApplication().GetService(""CopyConfigEbizAdapter_ptt"");
			oraclecopycfgMAPsvc.InvokeMethod(""Execute"", MAPreqInput, BPELreqInput);
			//oraclecopycfgMAPsvc.InvokeMethod(""ConfiguratorCopyConfigEbizAdapter"", MAPreqInput, BPELreqInput);
			
			//TheApplication().Trace(""Passed1"");
			
			// set the type to the name of the input argument to CZCopyCon 
			// Business service.
			//BPELreqInput.GetChild(0).SetType(""CZIntegCopyConfigSEBL782ToEBS11i10SyncRequestMessage:payload"");
			BPELreqInput.GetChild(0).SetType(""args_in_msg:InputParameters"");
			
			
			// call the BPEL Service
			//var oraclecopycfgBPELsvc = TheApplication().GetService(""CZIntegCopyConfigSEBL782ToEBS11i10Sync"");
			//oraclecopycfgBPELsvc.InvokeMethod(""process"", BPELreqInput, BPELresOutput);
			
			var oraclecopycfgBPELsvc = TheApplication().GetService(""CopyConfigEbizAdapter_ptt"");
			oraclecopycfgBPELsvc.InvokeMethod(""ConfiguratorCopyConfigEbizAdapter"", BPELreqInput, BPELresOutput);
			//TheApplication().Trace(""Passed2"");
			
			var destConfigHeader = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""OUT_CONFIG_HDR_ID"");
			var destConfigRevNbr = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""OUT_CONFIG_REV_NBR"");
			var copyErrorMessage = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""ERROR_MESSAGE"");
			var copyReturn = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""RETURN_VALUE"");
			
			
			Outputs.SetProperty(""DestConfigRevNbr"", destConfigRevNbr);
			Outputs.SetProperty(""DestConfigHeader"", destConfigHeader);
    	}
		catch  (e) 
		{
		  //in the event of an exception, ensure that the return values
		  //are null
		    Outputs.SetProperty(""DestConfigRevNbr"", null);
			Outputs.SetProperty(""DestConfigHeader"", null);

		//	TheApplication().Trace(e.toString());
			var error = e.toString();
			throw e;
		}
		finally 
		{
			oraclecopycfgMAPsvc = null;
			oraclecopycfgBPELsvc = null;
			siebelMessage = null;
			MAPreqInput = null;
			BPELreqInput = null;
			rootComponent = null;
			destConfigHeader = null;
			destConfigRevNbr= null;
			copyErrorMessage= null;
			copyReturn= null;
			BPELresOutput=null;

		
		}
		//TheApplication().TraceOff();
}
function CopyItemConfiguration	(Inputs, Outputs)
{

	try 
	{
		var rootItemId = Inputs.GetProperty(""RootItemId"");
		var rootQuoteOrderAgreementId = Inputs.GetProperty(""QuoteorOrderorAgreementId"");

		var boName = Inputs.GetProperty(""BusinessObject"");
		var bcName = Inputs.GetProperty(""BusinessComponent"");
		
		var destConfigRevNbr = Outputs.GetProperty(""DestConfigRevNbr"");
		var destConfigHeader = Outputs.GetProperty(""DestConfigHeader"");
	
		//at the time that this is invoked, the root item is still not committed and will not be
		//available in the database.  Only the child(ren) are committed at this point. Therefore
		//  ** TheApplication().ActiveBusObject() returns just the root quote item
		//  ** TheApplication().GetBusObject(""Quote"") returns just the child(ren)
		//the ""External Configurator reference"" columns for the root item will be 
		//set in the applet from where this is called.
	
		var bo = TheApplication().GetBusObject(boName);
		var bc = bo.GetBusComp(bcName);
		bc.ActivateField(""External Configurator Reference 1"");
		bc.ActivateField(""External Configurator Reference 2"");
	 	bc.ActivateField(""External Configurator Reference 3"");
		bc.ClearToQuery();
		var bcSearchStr;
		if (bcName == ""Quote Item"" || bcName == ""Template Item"" || bcName == ""Quote Catalog - Template Item"")
		{
			bcSearchStr = ""[Quote Id] = '"" + rootQuoteOrderAgreementId + ""'"";
  		bcSearchStr = bcSearchStr + "" AND "" ;
 		  bcSearchStr = bcSearchStr + ""[Root Quote Item Id] = '"" + rootItemId + ""'"";
		}
		else if (bcName == ""Order Entry - Line Items"")
		{
			bcSearchStr = ""[Order Header Id] = '"" + rootQuoteOrderAgreementId + ""'"";
			bcSearchStr = bcSearchStr + "" AND "" ;
 		  bcSearchStr = bcSearchStr + ""[Root Order Item Id] = '"" + rootItemId + ""'"";
		}
		else if (bcName == ""FS Agreement Item"")
		{
			bcSearchStr = ""[Agreement Id] = '"" + rootQuoteOrderAgreementId + ""'"";
			bcSearchStr = bcSearchStr + "" AND "" ;
 		  bcSearchStr = bcSearchStr + ""[Root Agreement Item Id] = '"" + rootItemId + ""'"";
		}
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		var recCount = bc.CountRecords();
		if (bc.FirstRecord())
		{
			do
			 {
			  bc.SetFieldValue(""External Configurator Reference 1"",destConfigHeader);
			  bc.SetFieldValue(""External Configurator Reference 2"",destConfigRevNbr );
			} while (bc.NextRecord()) 
		}
	}
  catch  (e) 
	{
	//	TheApplication().Trace(e.toString());
		var error = e.toString();
		throw e;
	}
	finally 
	{
  	if (bo != null) { bo = null;}
	  if (bc != null) {bc = null;}
	  bcSearchStr = null;
	  recCount = null;
	}


}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""CopyOracleConfiguration"")
	{

		try 
		{
			var sourceConfigHeader = Inputs.GetProperty(""SourceConfigHeader"");
			var sourceConfigRevNbr = Inputs.GetProperty(""SourceConfigRevNbr"");
			
			if (sourceConfigHeader !=null && sourceConfigHeader != """")
			{
				CallBPELGetConfigParams(Inputs, Outputs);		  
			}
		}
		catch  (e) 
		{
		 // TheApplication().Trace(e.toString());
		  var error = e.toString();
		  throw e;
		}
		// when the BPEL call is valid, the config parameters
		// will have the correct values.  When the 
		// BPEL call fails, the config parameters will have null values.
		finally  
		{
		  CopyItemConfiguration(Inputs, Outputs);
		}
	
	}

	return (CancelOperation);
}
function CallBPELGetOracleParams		(Inputs, Outputs)
{

	//TheApplication().TraceOn(consLogFileName(""IsOracleProduct""), ""Allocation"", ""All"");
	//TheApplication().TraceOn(""d:\\temp\\CallBPELGetOracleParams.txt"", ""Allocation"", ""All"");
	try 
		{


			// call the BPEL service for operating unit, resp, user

			var siebelBU =Inputs.GetProperty(""InputSiebelBU"");
			var siebelUser =Inputs.GetProperty(""InputSiebelUser"")
			var siebelLang = Inputs.GetProperty(""InputSiebelLang"");
			

			//CALL USING DTE MAP FUNCTIONS
			//TheApplication().Trace(""siebelBU = "" + siebelBU);
			//TheApplication().Trace(""siebelUser = "" + siebelUser);
			//TheApplication().Trace(""siebelLang = "" + siebelLang);
			
			// setup the map parameters, service out put parameters
			
			var MAPreqInput =TheApplication().NewPropertySet ();
			var BPELreqInput =TheApplication().NewPropertySet ();
			var MAPresInput =TheApplication().NewPropertySet ();
			var BPELresOutput =TheApplication().NewPropertySet ();
			var MAPcfg = TheApplication().NewPropertySet ();
			
			var sourceConfigHeader = Inputs.GetProperty(""SourceConfigHeader"");
			var sourceConfigRevNbr = Inputs.GetProperty(""SourceConfigRevNbr"");
			//set up the format required to call the map
			//TheApplication().Trace(""sourceConfigHeader = "" + sourceConfigHeader);
			//TheApplication().Trace(""sourceConfigRevNbr = "" + sourceConfigRevNbr);
			
			var siebelMessage = TheApplication().NewPropertySet ();
			siebelMessage.SetType(""SiebelMessage"");
			
			var rootComponent = TheApplication().NewPropertySet ();
			
			siebelMessage.AddChild(rootComponent);
		
			//set up all the parameters required for the 
			//DTE map function
			MAPreqInput.SetProperty(""MapName"", "formatEBSUserRespOURequest"");
			MAPreqInput.SetProperty(""InputType"", ""SiebelMessage"");
			MAPreqInput.SetProperty(""OutputType"", ""SiebelMessage"");
			//New
			//MAPreqInput.SetProperty(""OutputIntObjectName"",""CRMIntegGetEBSUserRespProcessRequest"");
			MAPreqInput.SetProperty(""OutputIntObjectName"",""ConfiguratorUserLangSiebelAdapterProcessRequest"");
			MAPreqInput.SetProperty(""SiebelMessage"", """");
			MAPreqInput.SetProperty(""InputSiebelBU"",siebelBU)
			MAPreqInput.SetProperty(""InputSiebelLang"",siebelLang);
			MAPreqInput.SetProperty(""InputSiebelUser"",siebelUser);
			
			MAPreqInput.AddChild(siebelMessage);
			
			// call out the DTE map function to create
			// the integration object
			var mapService = TheApplication().GetService(""CZIntegPrepareIntegrationObjects"");
			//TheApplication().Trace(""Passed Service0  = "");
			mapService.InvokeMethod(""Execute"", MAPreqInput, BPELreqInput);
			
			//TheApplication().Trace(""Passed Service  = CZIntegPrepareIntegrationObjects "");
			
			// set the type to the name of the input argument to CZCopyCon 
			// Business service.
			//New
			//BPELreqInput.GetChild(0).SetType(""CRMIntegGetEBSUserRespRequestMessage:payload"");
			BPELreqInput.GetChild(0).SetType(""ConfiguratorUserLangSiebelAdapterRequestMessage:payload"");
			
			//TheApplication().Trace(""Passed Service2  = "");
			
			// call the BPEL Service
			var bpelService = TheApplication().GetService(""ConfiguratorUserLangSiebelAdapter"");
			bpelService.InvokeMethod(""process"", BPELreqInput, BPELresOutput);
			//TheApplication().Trace(""Passed Service3  = "");
			
			var oracleuser = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""EBIZ_User"");
				//TheApplication().Trace(""oracleuser = "" + oracleuser);
			var oracleresp = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""EBIZ_Responsibility_Id"");
				//TheApplication().Trace(""oracleresp = "" + oracleresp);
			//var oracleou = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""ORCL_OU"");			
			var oraclelang = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""EBIZ_Lang"");
			var oracleou = BPELresOutput.GetChild(0).GetChild(0).GetChild(0).GetProperty(""EBIZ_Operating_Unit_Id"");
				//TheApplication().Trace(""Passed Service4  = "");
			Outputs.SetProperty(""OutputOracleResp"", oracleresp);
			Outputs.SetProperty(""OutputOracleOU"", oracleou);
			Outputs.SetProperty(""OutputOracleUser"", oracleuser);
			Outputs.SetProperty(""OutputOracleLang"", oraclelang);
			
			//TheApplication().Trace(""oracleresp = "" + oracleresp);
			//TheApplication().Trace(""oraclelang = "" + oraclelang);
    }
		catch  (e) 
		{
		//	TheApplication().Trace(e.toString());
			var error = e.toString();
			TheApplication().RaiseErrorText(e.toString());
			throw e;
		}
		finally 
		{
      bpelService = null;
		  siebelMessage = null;
      BPELreqInput = null;
      rootComponent = null;
      BPELresOutput=null;
		
	}
	//TheApplication().TraceOff();
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""GetOracleUserRespOULang"")
	{
		try 
		{
		   CallBPELGetOracleParams(Inputs, Outputs)
	  }
	  catch  (e) 
	  {
		  TheApplication().RaiseErrorText(e.toString());
    //  TheApplication().Trace(e.toString());
		  var error = e.toString();
			throw e;
		}
	
	}

	return (CancelOperation);
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// DESCRIPTION
//    Javascript maps to Siebel Product from Oracle Item
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js""




"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
	//return Execute(MethodName, Inputs, Outputs);
	
	/*if (MethodName == ""Execute"")
	{

		try 
		{
		
				formatCopyRequest(Inputs, Outputs);		  
		
		}
		catch  (e) 
		{
		  TheApplication().Trace(e.toString());
		  var error = e.toString();
		  throw e;
		}
		// when the BPEL call is valid, the config parameters
		// will have the correct values.  When the 
		// BPEL call fails, the config parameters will have null values.
		
	
	}

	return (CancelOperation);*/
}
function formatCopyRequest (InputMsg, OutputMsg)
{
	//
	// Declare a variable to hold the Siebel Integration Object.
	//
	//TheApplication().TraceOn(""d:\\temp\\CZprepareIO1.txt"", ""Allocation"", ""All"");
	try 
	{	
		var reqIntObj;
		var reqIntComp;
		
	  var configHdrId = InputMsg.GetArgument(""InputConfigHeaderId"");
      var	configRevNbr = InputMsg.GetArgument(""InputConfigRevNbr"");

		reqIntObj = OutputMsg.CreateIntObj (""InputParameters"");
		reqIntObj.NewInstance ();
		
		//TheApplication().Trace(""configHdrId = "" + configHdrId);
	//	TheApplication().Trace(""configRevNbr = "" + configRevNbr);
		
	
	  reqIntComp = reqIntObj.CreatePrimaryIntComp (""InputParameters"");
	  reqIntComp.NewRecord ();

	  reqIntComp.SetFieldValue(""CONFIG_HDR_ID"", configHdrId);
	  reqIntComp.SetFieldValue(""CONFIG_REV_NBR"", configRevNbr);
	  reqIntComp.SetFieldValue(""NEW_CONFIG_FLAG"",""1"");
	  reqIntComp.SetFieldValue(""ERROR_MESSAGE"","""");
	  reqIntComp.SetFieldValue(""HANDLE_DELETED_FLAG"","""");
	  reqIntComp.SetFieldValue(""NEW_NAME"","""");
	  reqIntComp.SetFieldValue(""OUT_CONFIG_HDR_ID"","""");
	  reqIntComp.SetFieldValue(""OUT_CONFIG_REV_NBR"","""");
	  reqIntComp.SetFieldValue(""RETURN_VALUE"","""");

	}	  
	catch  (e) 
	{
		TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		var error = e.toString();
		throw e;
	}
	finally 
	{
		reqIntObj = null;;
		reqIntComp =  null;
		configHdrId = null;
		configRevNbr = null;

	}     			
//TheApplication().TraceOff();
}
function formatEBSLangRequest (InputMsg, OutputMsg)
{
	try 
	{
		var reqIntObj;
		var reqIntComp;
	
	  var siebelLang = InputMsg.GetArgument(""InputSiebelLang"");
		
		reqIntObj = OutputMsg.CreateIntObj (""CZIntegGetLanguageSyncProcessRequest"");
		reqIntObj.NewInstance ();
	
	  reqIntComp = reqIntObj.CreatePrimaryIntComp (""CZIntegGetLanguageSyncProcessRequest"");
	  reqIntComp.NewRecord ();
	
	  reqIntComp.SetFieldValue(""Siebel_Lang"",siebelLang);
	}	  
	catch  (e) 
	{
		TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		var error = e.toString();
		throw e;
	}
	finally 
	{
		reqIntObj = null;;
		reqIntComp =  null;

	}
}
function formatEBSUserRespOURequest (InputMsg, OutputMsg)
{
	//
	// Declare a variable to hold the Siebel Integration Object.
	//
	//TheApplication().TraceOn(""d:\\temp\\trace1.txt"", ""Allocation"", ""All"");
	try 
	{
		var reqIntObj;
		var reqIntComp;
	
	  var siebelUser = InputMsg.GetArgument(""InputSiebelUser"");
	  var	siebelBU = InputMsg.GetArgument(""InputSiebelBU"");
	  var siebelLang = InputMsg.GetArgument(""InputSiebelLang"");
		
        //reqIntObj = OutputMsg.CreateIntObj (""CRMIntegGetEBSUserRespProcessRequest"");
  		reqIntObj = OutputMsg.CreateIntObj (""ConfiguratorUserLangSiebelAdapterProcessRequest"");
		reqIntObj.NewInstance ();
	 
      //reqIntComp = reqIntObj.CreatePrimaryIntComp (""CRMIntegGetEBSUserRespProcessRequest"");
  	  reqIntComp = reqIntObj.CreatePrimaryIntComp (""ConfiguratorUserLangSiebelAdapterProcessRequest"");
	  reqIntComp.NewRecord ();
		//TheApplication().Trace(""siebelUser = "" + siebelUser);
		//TheApplication().Trace(""siebelLang = "" + siebelLang);
		
	  //reqIntComp.SetFieldValue(""Siebel_user_id"",siebelUser);
	  reqIntComp.SetFieldValue(""Siebel_User"",siebelUser);	  
	  
	  //reqIntComp.SetFieldValue(""process_name"",""Configurator"");
	  //reqIntComp.SetFieldValue(""siebel_bu_id"",siebelBU);
	  reqIntComp.SetFieldValue(""Siebel_Lang"",siebelLang);

	}	  
	catch  (e) 
	{
		TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		var error = e.toString();
		throw e;
	}
	finally 
	{
		reqIntObj = null;;
		reqIntComp =  null;

	}
	//TheApplication().TraceOff();
}
"var G_RUNTIME_ID             = ""Id"";
var G_PARENT_RUNTIME_ID      = ""Parent Item Id"";
var G_INV_ITEM_ID            = ""External Inventory System Ref"";
var G_INTEGRATION_ID         = ""Integration Id"";
var G_PRODUCT_ID             = ""Product Id"";
var G_PRODUCT_INTEGRATION_ID = ""Product Integration Id"";
var G_QUANTITY               = ""Quantity"";   
var G_CZOPERATION            = ""CZOperation"";

var G_LIST_PRICE             = ""List Price""; 
var G_NET_PRICE              = ""Net Price"";
var G_ELIGIBILITY_STATUS     = ""Eligibility Status"";
var G_ELIGIBILITY_REASON     = ""Eligibility Reason"";

var G_PREPICK_MODE           = ""Pre-Pick"";   
var G_POSTPICK_MODE          = ""Post-Pick"";   

var G_INSERT_MODE            = ""INSERT"";   
var G_UPDATE_MODE            = ""UPDATE"";   
var G_DELETE_MODE            = ""DELETE"";   

var G_LOGGING_MODE           = ""Y"";

var G_LOGGING_IS_ON          = ""Y""; 
var G_LOGGING_IS_OFF         = ""N""; 

var G_UNDEFINED              = ""-1"";

var G_LOGGING_DIR            = ""C:\\"";

var CZSessionCachePS;
var CZSelectedItemsPS;

var cacheRuntimeId;
var cacheQuanity;
var cacheListPrice;
var cacheNetPrice;
var cacheEligibilityStatus;
var cacheEligibilityReason;

var cacheSelectedItemsRuntimeId;

var G_PROP_NAME_ARY = new Array(G_CZOPERATION,G_ELIGIBILITY_REASON,G_ELIGIBILITY_STATUS,G_LIST_PRICE,G_NET_PRICE, G_RUNTIME_ID, G_PARENT_RUNTIME_ID, G_INV_ITEM_ID, G_QUANTITY);  

var RUN_ID;"
function ClearCache(Inputs, Outputs)
{

  if ( CZSessionCachePS == null ) {	  
    CZSessionCachePS = TheApplication().NewPropertySet();   
  } 
  else {
    CZSessionCachePS.Reset(); 
  }	  

  if ( CZSelectedItemsPS == null ) {	  
    CZSelectedItemsPS = TheApplication().NewPropertySet();   
  }
  else {
    CZSelectedItemsPS.Reset();
  }
  
  
  if (cacheRuntimeId == null) {
    cacheRuntimeId = new Array();
  }
  else {
    cacheRuntimeId = null;
  }
  
  if (cacheQuanity == null) {
    cacheQuanity = new Array();
  }
  else {
    cacheQuanity = null;
  }
 
  if (cacheListPrice == null) {  
    cacheListPrice = new Array();
  }
  else {
    cacheListPrice = null;
  }
  
  if (cacheNetPrice == null) {   
    cacheNetPrice = new Array();
  }
  else {
    cacheNetPrice  = null;
  }

  if (cacheEligibilityStatus == null) {   
    cacheEligibilityStatus = new Array();
  } 
  else {
    cacheEligibilityStatus = null;
  }
 
  if (cacheEligibilityReason == null) {  
     cacheEligibilityReason = new Array();
  }   
  else {
    cacheEligibilityReason = null;
  }  

  if (cacheSelectedItemsRuntimeId == null) {  
     cacheSelectedItemsRuntimeId = new Array();
  }
  else {
     cacheSelectedItemsRuntimeId = null;
  }
         
}
function CollectData(inputId, inputPS)
{

   if (inputPS.PropertyExists(G_QUANTITY)) 
      cacheQuanity[inputId] = inputPS.GetProperty(G_QUANTITY);
   else   
      cacheQuanity[inputId] = ""0"";      

   if (inputPS.PropertyExists(G_LIST_PRICE)) 
      cacheListPrice[inputId] = inputPS.GetProperty(G_LIST_PRICE);
   else   
      cacheListPrice[inputId] = G_UNDEFINED;      

   if (inputPS.PropertyExists(G_NET_PRICE)) 
      cacheNetPrice[inputId] = inputPS.GetProperty(G_NET_PRICE);
   else   
      cacheNetPrice[inputId] = G_UNDEFINED;      

   if (inputPS.PropertyExists(G_ELIGIBILITY_STATUS)) {
      cacheEligibilityStatus[inputId] = inputPS.GetProperty(G_ELIGIBILITY_STATUS);
      cacheEligibilityReason[inputId] = inputPS.GetProperty(G_ELIGIBILITY_REASON);      
   }   
   else {  
      cacheEligibilityStatus[inputId] = G_UNDEFINED;      
      cacheEligibilityReason[inputId] = G_UNDEFINED;            
   }   
            
}
function InitializeSessionCache()
{
  if ( CZSessionCachePS == null ) {	  
    CZSessionCachePS = TheApplication().NewPropertySet();   
  }	  

  if ( CZSelectedItemsPS == null ) {	  
    CZSelectedItemsPS = TheApplication().NewPropertySet();   
  }
  
  
  if (cacheRuntimeId == null) {
    cacheRuntimeId = new Array();
  }
  if (cacheQuanity == null) {
    cacheQuanity = new Array();
  }
  if (cacheListPrice == null) {  
     cacheListPrice = new Array();
  }
  if (cacheNetPrice == null) {   
     cacheNetPrice = new Array();
  }
  if (cacheEligibilityStatus == null) {   
     cacheEligibilityStatus = new Array();
  } 
 
  if (cacheSelectedItemsRuntimeId == null) {  
     cacheSelectedItemsRuntimeId = new Array();
  }  
  if  
 (cacheEligibilityReason == null) {  
     cacheEligibilityReason = new Array();
  }   


}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	if ((MethodName == ""SyncCache"") || 
      (MethodName == ""GetDelta"") ||
      (MethodName == ""ClearCache"")) {

		CanInvoke = ""TRUE"";
		return (CancelOperation);
	}
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
    //////////////////////////////////////////////////////////////////////
    
    var InputConfigLevel =  TheApplication().NewPropertySet();
    var currentRow       =  TheApplication().NewPropertySet(); 
    var currentSIRow      =  TheApplication().NewPropertySet(); 
    var rowsetPS         =  TheApplication().NewPropertySet(); 
    var newRowToInsert   =  TheApplication().NewPropertySet(); 
    var inputRowSet      =  TheApplication().NewPropertySet(); 
    var selectedPS       =  TheApplication().NewPropertySet(); 
    var rowToUpdate      =  TheApplication().NewPropertySet(); 
    var deltaRow         =  TheApplication().NewPropertySet(); 
    var currRowLevel     =  TheApplication().NewPropertySet(); 
    var currSelRowLevel  =  TheApplication().NewPropertySet(); 
    
    var currentRowRuntimeId;     
    var inputRuntimeId;

    var inputListPrice;
    var inputNetPrice;           
    var inputEligibilityStatus;  
    
    var itemExistsInCache;
    var itemInSelectedItemsCache;

    var sessionListPrice;    
    var sessionNetPrice;        
    var sessionEligibilityStatus;
            
    var czOperation;
    var fieldName;       
    var len;
    var child_counter = 0;
    var sel_counter = 0;  
    var currRuntimeId;  
    
    var removedItems = new Array();
    
    if (RUN_ID==null) RUN_ID = 1;
    else RUN_ID = RUN_ID + 1;

    var propStr;    
    var fileLoc  = G_LOGGING_DIR + ""CZProperty.txt"";
    var fp = Clib.fopen(fileLoc, ""r"");
        
    if ( fp == null ) {
    }
    else {
            
        propStr = Clib.fgets(10, fp);
        if (propStr == ""logging=Y"") {
          G_LOGGING_MODE = ""Y"";
        }
        if (propStr == ""logging=N"") {
          G_LOGGING_MODE = ""N"";
        }                
        Clib.fclose(fp);  
    }
    if (MethodName == ""SyncCache"") {
            
      var pickMode = Inputs.GetProperty (""Pick Mode"");
      
  	  InitializeSessionCache();

  	  len = Inputs.GetChildCount();
 
      inputRowSet.Reset();
      for (var i=0; i<len; i++) {
         inputRowSet = Inputs.GetChild(i);
	  	 if (inputRowSet.GetType() == ""Row Set"")
	  	    break;
	  }
      
      if (pickMode==G_PREPICK_MODE) {
 
         dumpPropSet(Inputs, ""SyncCache_Inputs_PREPICK_RUN_ID="" + RUN_ID + "".txt""); 
  
         InputConfigLevel.Reset();
         for (var j = 0; j < inputRowSet.GetChildCount(); j++) {
            InputConfigLevel = inputRowSet.GetChild(j);
            
            inputRuntimeId = InputConfigLevel.GetProperty(G_RUNTIME_ID);            

            if (InputConfigLevel.PropertyExists(G_CZOPERATION)) {
               czOperation = InputConfigLevel.GetProperty(G_CZOPERATION);
            }   
            
            else {
               czOperation = G_INSERT_MODE; 
            }
            

            if (czOperation==G_DELETE_MODE) {
            
               if ((cacheRuntimeId[inputRuntimeId] != null) && (cacheRuntimeId[inputRuntimeId] != ""undefined"")) {              
                 CZSessionCachePS.RemoveChild(cacheRuntimeId[inputRuntimeId]);
                 SyncCacheArrays(""cacheRuntimeId"", inputRuntimeId);
               }

               if ((cacheSelectedItemsRuntimeId[inputRuntimeId] != null) && (cacheSelectedItemsRuntimeId[inputRuntimeId] != ""undefined"") ) {  
                 try {
                   CZSelectedItemsPS.RemoveChild(cacheSelectedItemsRuntimeId[inputRuntimeId]);                           
                   SyncCacheArrays(""cacheSelectedItemsRuntimeId"", inputRuntimeId); 
                 }
                 catch (e) {
                 }
               }     
               
            } // end of  if (czOperation==G_DELETE_MODE)

            if (czOperation==G_INSERT_MODE) { 
              CollectData(inputRuntimeId, InputConfigLevel);
              child_counter = CZSessionCachePS.GetChildCount();                        
              CZSessionCachePS.InsertChildAt(InputConfigLevel.Copy(), child_counter);
              cacheRuntimeId[inputRuntimeId] = child_counter;
            }  

		        
   		    if (ToNumber(InputConfigLevel.GetProperty(G_QUANTITY)) > 0) {
   		      sel_counter = CZSelectedItemsPS.GetChildCount();
              CZSelectedItemsPS.InsertChildAt(InputConfigLevel.Copy(), sel_counter);
  		      cacheSelectedItemsRuntimeId[inputRuntimeId] = sel_counter; 
   		    }   		      		        	   		      
         }

     	 rowsetPS = CZSessionCachePS.Copy();
    	 rowsetPS.SetType(""Row Set"");
		 Outputs.AddChild(rowsetPS);    

		 dumpPropSet(CZSessionCachePS, ""SyncCache_CZSessionCachePS_PREPICK_RUN_ID="" + RUN_ID + "".txt"");
	     dumpPropSet(CZSelectedItemsPS, ""SyncCache_CZSelectedItemsPS_PREPICK_RUN_ID="" + RUN_ID + "".txt"");
	     
		 return CancelOperation;    

      }  // end of if (pickMode==G_PREPICK_MODE)

      //////////////////////////////////////////////////////////////////////
      
      // in ""Post-Pick"" mode insert/delete/update CZSessionCachePS based on data in Inputs ( in ""Row Set"" parameter )
      if (pickMode==G_POSTPICK_MODE) {
 
         dumpPropSet(Inputs, ""SyncCache_Inputs_POSTPICK_RUN_ID="" + RUN_ID + "".txt"");     	 
 
      	 InputConfigLevel.Reset();     
         for (var j = 0; j < inputRowSet.GetChildCount(); j++) {
            InputConfigLevel = inputRowSet.GetChild(j);       
            
            inputRuntimeId = InputConfigLevel.GetProperty(G_RUNTIME_ID);
            
            if (InputConfigLevel.PropertyExists(G_CZOPERATION)) {
               czOperation = InputConfigLevel.GetProperty(G_CZOPERATION);
            }   
            
            else {
               czOperation = G_UPDATE_MODE; 
            }
                        
            //////////////////////////////////////////////////////////////////////              
            
            if (czOperation==G_INSERT_MODE) {               
               if (cacheRuntimeId[inputRuntimeId] > -1) {	                
                  CollectData(inputRuntimeId, InputConfigLevel);

                  child_counter = CZSessionCachePS.GetChildCount();                        
                  CZSessionCachePS.InsertChildAt(InputConfigLevel.Copy(), child_counter);
                  cacheRuntimeId[inputRuntimeId] = child_counter;

     		          sel_counter = CZSelectedItemsPS.GetChildCount();
                  CZSelectedItemsPS.InsertChildAt(InputConfigLevel.Copy(), sel_counter);
  	    	        cacheSelectedItemsRuntimeId[inputRuntimeId] = sel_counter; 
               }   
            }
         
            if (czOperation==G_DELETE_MODE) {
            
               if ((cacheRuntimeId[inputRuntimeId] != null) && (cacheRuntimeId[inputRuntimeId] != ""undefined"") ) {              
                 CZSessionCachePS.RemoveChild(cacheRuntimeId[inputRuntimeId]);
                 SyncCacheArrays(""cacheRuntimeId"", inputRuntimeId);
               }

               if ((cacheSelectedItemsRuntimeId[inputRuntimeId] != null) && (cacheSelectedItemsRuntimeId[inputRuntimeId] != ""undefined"") ) {  
                 try {
                   CZSelectedItemsPS.RemoveChild(cacheSelectedItemsRuntimeId[inputRuntimeId]);                           
                   SyncCacheArrays(""cacheSelectedItemsRuntimeId"", inputRuntimeId);
                 }
                 catch (e) {
                 }
               }     
               
            } // end of  if (czOperation==G_DELETE_MODE)

            //////////////////////////////////////////////////////////////////////
          
            if (czOperation==G_UPDATE_MODE) { 

               //////////////////////////////////////////////////////

               if (cacheRuntimeId[inputRuntimeId] > -1) {
                  currentRow = CZSessionCachePS.GetChild(cacheRuntimeId[inputRuntimeId]);

                  fieldName = InputConfigLevel.GetFirstProperty();
                  while (fieldName != """") {

                     if (InputConfigLevel.PropertyExists(fieldName)) {
                        currentRow.SetProperty(fieldName, InputConfigLevel.GetProperty(fieldName));
                     }                                                                
                     fieldName =  InputConfigLevel.GetNextProperty();  
                  }   
    
                  if (cacheSelectedItemsRuntimeId[inputRuntimeId]>-1)  {
                     CZSelectedItemsPS.RemoveChild(cacheSelectedItemsRuntimeId[inputRuntimeId]);
                     CZSelectedItemsPS.InsertChildAt(currentRow.Copy(), cacheSelectedItemsRuntimeId[inputRuntimeId]);                           
                  }
                  else {
     		             sel_counter = CZSelectedItemsPS.GetChildCount();
                     CZSelectedItemsPS.InsertChildAt(currentRow.Copy(), sel_counter);
     	    	         cacheSelectedItemsRuntimeId[inputRuntimeId] = sel_counter;                   
                  }   
                  
               }    
               else {
                  CollectData(inputRuntimeId, InputConfigLevel);

                  child_counter = CZSessionCachePS.GetChildCount();                        
                  CZSessionCachePS.InsertChildAt(InputConfigLevel.Copy(), child_counter);
                  cacheRuntimeId[inputRuntimeId] = child_counter;

   		          sel_counter = CZSelectedItemsPS.GetChildCount();
                  CZSelectedItemsPS.InsertChildAt(InputConfigLevel.Copy(), sel_counter);
    	        cacheSelectedItemsRuntimeId[inputRuntimeId] = sel_counter; 
               }
             
            }  // end of  if (czOperation==G_UPDATE_MODE) 
          
         } // end of for (var j = 0; j < rowSet.GetChildCount(); j++)

            
         selectedPS = CZSelectedItemsPS.Copy();

         // delete output items with quantity=0

         var arrLength = selectedPS.GetChildCount();
         var y = 0;
           
         while ( y < arrLength ) {
           currentSIRow = selectedPS.GetChild(y);
           if (ToInteger(currentSIRow.GetProperty(G_QUANTITY)) == 0) {

              currRuntimeId = currentSIRow.GetProperty(G_RUNTIME_ID)
              if ((cacheRuntimeId[currRuntimeId] != null) &&
                  (cacheRuntimeId[currRuntimeId] != ""undefined"")) {
                  
                currRowLevel = CZSessionCachePS.GetChild(cacheRuntimeId[currRuntimeId]);
                if ( currRowLevel != null ) {
                  currRowLevel.SetProperty(G_ELIGIBILITY_STATUS, ""Y"");
                  currRowLevel.SetProperty(G_ELIGIBILITY_REASON, """");
                  CollectData(currRuntimeId, currRowLevel);
                }
                  
              }    
              
              if ((cacheSelectedItemsRuntimeId[currRuntimeId] != null) && (cacheSelectedItemsRuntimeId[currRuntimeId] != ""undefined"")) {
                currSelRowLevel = CZSelectedItemsPS.GetChild(cacheSelectedItemsRuntimeId[currRuntimeId]);
                if (currSelRowLevel != null ) {
                  currSelRowLevel.SetProperty(G_ELIGIBILITY_STATUS, ""Y"");
                  currSelRowLevel.SetProperty(G_ELIGIBILITY_REASON, """");
                  CollectData(currRuntimeId, currSelRowLevel);
                 }
               }     
              
              selectedPS.RemoveChild(y);
              y = y - 1;
           }
           y = y + 1;  
           if ( y==selectedPS.GetChildCount()) break;         
         }
                  
       ///////////////////////////////////////
       dumpPropSet(CZSessionCachePS, ""POSTPICK_CZSessionCachePS_""  + RUN_ID + "".txt"");
       dumpPropSet(CZSelectedItemsPS, ""POSTPICK_CZSelectedItemsPS_"" + RUN_ID + "".txt"");
                   
    	 selectedPS.SetType(""Row Set"");
	     Outputs.AddChild(selectedPS);   

       } // end of if (pickMode==G_POSTPICK_MODE)
	  
       return CancelOperation;  
       
	}  // end of if (MethodName == ""SyncCache"")
    
    //////////////////////////////////////////////////////////////////////
    
	else if (MethodName == ""GetDelta"") {
      dumpPropSet(Inputs, ""GetDelta_Inputs_RUN_ID="" + RUN_ID + "".txt"");
      // get ""Row Set"" parameter ( type : Property Set )	  
   	  len = Inputs.GetChildCount(); 
      inputRowSet.Reset();
      for (var i=0; i<len; i++) {
         inputRowSet = Inputs.GetChild(i);
	  	 if (inputRowSet.GetType() == ""Row Set"")
	  	    break;
	  }

       InputConfigLevel.Reset();
       for (var j = 0; j < inputRowSet.GetChildCount(); j++) {
           InputConfigLevel = inputRowSet.GetChild(j);
           inputRuntimeId = InputConfigLevel.GetProperty(G_RUNTIME_ID);


           if (cacheRuntimeId[inputRuntimeId] > -1) {

              rowToUpdate = CZSessionCachePS.GetChild(cacheRuntimeId[inputRuntimeId]);

              if (InputConfigLevel.PropertyExists(G_LIST_PRICE)) {
                 inputListPrice = InputConfigLevel.GetProperty(G_LIST_PRICE);
                 if (inputListPrice=="""") inputListPrice=""0"";
                 rowToUpdate.SetProperty(G_LIST_PRICE, inputListPrice);           
              }
              else {
                  inputListPrice = cacheListPrice[inputRuntimeId];           
              }

              if (InputConfigLevel.PropertyExists(G_NET_PRICE)) {
                 inputNetPrice = InputConfigLevel.GetProperty(G_NET_PRICE); 
                 if (inputNetPrice=="""") inputNetPrice=""0"";                 
                 rowToUpdate.SetProperty(G_NET_PRICE, inputNetPrice);          
              }
              else {
                  inputNetPrice = cacheNetPrice[inputRuntimeId];           
              }

              if (InputConfigLevel.PropertyExists(G_ELIGIBILITY_STATUS)) {
                 inputEligibilityStatus = InputConfigLevel.GetProperty(G_ELIGIBILITY_STATUS);           
                 rowToUpdate.SetProperty(G_ELIGIBILITY_STATUS, inputEligibilityStatus);                   
                 if (InputConfigLevel.PropertyExists(G_ELIGIBILITY_REASON))
                    rowToUpdate.SetProperty(G_ELIGIBILITY_REASON, InputConfigLevel.GetProperty(G_ELIGIBILITY_REASON));              
              }
              else {
                  inputEligibilityStatus = cacheEligibilityStatus[inputRuntimeId];           
              }

              sessionListPrice = cacheListPrice[inputRuntimeId]; 
             // if ((sessionListPrice == G_UNDEFINED)&&(inputListPrice==""0"")) 
             //    sessionListPrice = inputListPrice;    
                 
              sessionNetPrice = cacheNetPrice[inputRuntimeId];  
             // if ((sessionNetPrice == G_UNDEFINED)&&(inputNetPrice==""0""))  
             //    sessionNetPrice = inputNetPrice;    
              
              sessionEligibilityStatus = cacheEligibilityStatus[inputRuntimeId];  
              if (sessionEligibilityStatus == G_UNDEFINED) 
                 sessionEligibilityStatus = inputEligibilityStatus;    
              
                                          
              // CONDITION FOR CHECKING DELTA
              if ( (inputListPrice != sessionListPrice)||
                   (inputNetPrice != sessionNetPrice)||
                   (InputConfigLevel.PropertyExists(G_ELIGIBILITY_STATUS)) && (sessionEligibilityStatus != inputEligibilityStatus) ) {
                 deltaRow.AddChild(rowToUpdate.Copy());                                     
              }                           
              
              // END OF DELTA COLLECTING

              cacheListPrice[inputRuntimeId] = inputListPrice;              
              cacheNetPrice[inputRuntimeId] = inputNetPrice;
              cacheEligibilityStatus[inputRuntimeId] = inputEligibilityStatus;
              
           } // end of if (cacheRuntimeId[inputRuntimeId] > -1)
       }  // end of for (var j = 0; ...... 
       
  	   deltaRow.SetType(""Row Set"");
	     Outputs.AddChild(deltaRow);   

       dumpPropSet(Outputs, ""GetDelta_Outputs_""  + RUN_ID + "".txt""); 
       dumpPropSet(CZSessionCachePS, ""GetDelta_CZSessionCachePS_""  + RUN_ID + "".txt"");
       dumpPropSet(CZSelectedItemsPS, ""GetDelta_CZSelectedItemsPS_"" + RUN_ID + "".txt"");

       return CancelOperation;  		
	}  // end of if (MethodName == ""GetDelta"")	

	else if (MethodName == ""ClearCache"") {
	   ClearCache(Inputs, Outputs);
       return CancelOperation;  		
	}	
	else {
		return ContinueOperation;
	}

   	return ContinueOperation;

}
function SyncCacheArrays(arrName,inputId)
{
  var nn;
  if (arrName==""cacheSelectedItemsRuntimeId"") {
    for ( nn in cacheSelectedItemsRuntimeId ) {
      if (cacheSelectedItemsRuntimeId[nn] > cacheSelectedItemsRuntimeId[inputId]) {
        cacheSelectedItemsRuntimeId[nn] = cacheSelectedItemsRuntimeId[nn] - 1;  
      }
    }    
    cacheSelectedItemsRuntimeId[inputId] = ""undefined"";
  }  

  if (arrName==""cacheRuntimeId"") {
    for ( nn in cacheRuntimeId ) {
      if (cacheRuntimeId[nn] > cacheRuntimeId[inputId]) {
        cacheRuntimeId[nn] = cacheRuntimeId[nn] - 1;  
      }
    }  
    cacheRuntimeId[inputId] = ""undefined"";  
  }  

}
function dumpPropSet(inputPS, fileName)
{

 if ( G_LOGGING_MODE == G_LOGGING_IS_ON ) {
   var fileLoc  = G_LOGGING_DIR + fileName;
   var pspLevel = TheApplication().NewPropertySet(); 
   var fieldName;
   var x;
  
   var len = inputPS.GetChildCount();
   var rowSet = null;  
   var flag = 0;
	 for (var i=0; i<len; i++) {
	    rowSet = inputPS.GetChild(i);
	  	if (rowSet.GetType() == ""Row Set"")
	  	  {
	  	   flag = 1;
	  	   break;
	  	  } 
	 }

   var fp = Clib.fopen(fileLoc, ""at"");

   if ( flag == 1 ) {
      Clib.fputs(""+++++++++++++++ Row Set +++++++++++++++"" + ""\n"",fp);
      Clib.fputs(""----------------------------------"" + ""\n"",fp);
      for (var j = 0; j < rowSet.GetChildCount(); j++) {
         pspLevel = rowSet.GetChild(j);

         fieldName = pspLevel.GetFirstProperty();
         while (fieldName != """") {
             Clib.fputs(fieldName + "" = '"" + pspLevel.GetProperty(fieldName) + ""'"" + ""\n"", fp);             
             fieldName =  pspLevel.GetNextProperty();  
         }   
         
         Clib.fputs(""----------------------------------"" + ""\n"",fp); 
      }   
 
   } 
   else {
      Clib.fputs(""----------------------------------"" + ""\n"",fp);                  
      for (var j = 0; j < inputPS.GetChildCount(); j++) {
         pspLevel = inputPS.GetChild(j);

         fieldName = pspLevel.GetFirstProperty();
         while (fieldName != """") {
             Clib.fputs(fieldName + "" = '"" + pspLevel.GetProperty(fieldName) + ""'"" + ""\n"", fp);             
             fieldName =  pspLevel.GetNextProperty();  
         }   

         Clib.fputs(""----------------------------------"" + ""\n"",fp);
          
      }   
 
   }

   Clib.fclose(fp); 	  
 }   
}
"// Used to insure siebel client and Oracle Configurator compatibility
// Must be changed when required init message change, return/pricing ps or
// xml change. cz.common.UiXmlInitMessage must be updated when this value
// changes.
// 11.1 Initial
// 11.2 Provide Siebel_app
// 11.3 Provide S_SEBL_VERSION

var S_VERSION                 = ""11.3""; 
var S_USERNAME                = ""username"";
var S_PWD                     = ""pwd"";
var S_BV_RESPONSE             = ""bvresponse"";
var S_BV_SITE_URL             = ""BvSiteUrl"";
var S_INIT_MESSAGE            = ""InitMessage"";
var S_BVP					  = ""BVP"";
var S_WI_SYMURL_NAME          = ""WISymUrlName"";
var S_SSO_SYSTEM_NAME         = ""SsoSystemName"";
var S_VERIFY_MODE             = ""VerifyMode"";
var S_VERIFY_VAL_ALL          = ""0"";
var S_VERIFY_VAL_FIRST_FAIL   = ""1"";
var S_RETURN_MESSAGE          = ""Message"";
var S_BV_STATUS               = ""legal"";
var S_ITEM_NAME               = ""ItemName"";

// Init Message params

var S_RESP_ID                 = ""responsibility_id"";
var S_INV_ITEM_ID             = ""inventory_item_id"";
var S_WAREHOUSE_ORG_ID        = ""warehouse_id"";
var S_SEBL_VERSION            = ""siebel_cfg_client"";
var S_SEBL_PRICE_LIST_ID      = ""siebel_price_list_id"";
var S_SEBL_EXCHG_DATE         = ""siebel_exchange_date"";
var S_HDR_ID                  = ""client_header"";
var S_LINE_ID                 = ""client_line"";
var S_SEBL_APP_MODE           = ""siebel_app_mode"";
var S_JAVA_PRICING_CLASS_NAME = ""java_pricing_class_name"";
var S_SEBL_ACCT_ID            = ""siebel_account_id"";
var S_CFG_HDR_ID   			  = ""config_header_id"";
var S_CFG_REV_NBR             = ""config_rev_nbr"";
var S_MODEL_QTY               = ""model_quantity"";
var S_CALLING_APP_SHORT_NAME  = ""calling_application_short_name"";
var S_SEBL_SES_COOKIE         = ""siebel_cookie"";
var S_SEBL_SES_SRN			  = ""siebel_srn"";                              //added for	Bug 16859819
var S_SEBL_SRVR_URL           = ""siebel_server_url"";
var S_RETURN_URL              = ""return_url"";
var S_TERMINATE_BEHAVIOR      = ""terminate_msg_behavior"";
var S_LANGUAGE                = ""language"";
var S_CFG_CREATION_DATE       = ""config_creation_date"";
var S_SAVE_BEHAVIOR           = ""save_config_behavior"";
var S_OU_ID                   = ""operating_unit_org_id"";

// BV Return xml

var S_COMPLETE_CONFIGURATION  = ""complete_configuration"";
var S_VALID_CONFIGURATION     = ""valid_configuration"";
var S_MESSAGE_TEXT            = ""message_text"";
var S_RULE_VIOLATION_EMPTY    = ""RuleViolationEmpty"";
var S_RULE_VIOLATION          = ""RuleViolation"";

var S_STD_ERROR_TEXT = ""A system error has occured when launching configurator. Please inform your system administrator. "";

var mBusObjName = null;
var mHeaderBusCompName = null;
var mHeaderId = null;
var mHostApp = null;
var RUN_ID;"
function CacheErrorMessage(Inputs, Outputs)
{
	mErrorMsg = Inputs.GetProperty(""Message"");
}
function ComputeTargetView(Inputs, Outputs)
{
	var returnViewName = TheApplication().GetProfileAttr(""CZReturnViewName"");
}
function DisplayVerifyMessages(Inputs, Outputs) {

  var msgsvc = TheApplication().GetService(""Verify Management Service"");
  var payloadPS = TheApplication().NewPropertySet();

  payloadPS.SetProperty(""Return Message - Validate CP"", Inputs.GetProperty(""Message""));
  payloadPS.SetProperty(""Message Type"", Inputs.GetProperty(""MessageType""));

  msgsvc.InvokeMethod(""DisplayMessages"", payloadPS, Outputs);

}
function IsOracleConfigurableProduct(Inputs, Outputs)
{
	//The next 3 lines is to get things working in local DB till we get
	//sentinel product data 
	//Outputs.SetProperty(""IsOracleProduct"", ""true"");
	//Outputs.SetProperty(""InventoryItemId"", ""137"");
	//return;
  updateRunId();
 // TheApplication().TraceOn(consLogFileName(""IsConfigurable""), ""Allocation"", ""All"");
	
	var bOracleProduct = false;
	var invItemId = ""NULL"";
	var orgId = ""NULL""
	var bUseProdId = false;
	var seblOrgId = ""NULL"";
	
	//When launched from Quote/Order/Agreement the active bus obj and active bus comp
	//is available and we can directly query the bus comp to find if it is a oracle product or not
	//But when launched from catalog we don't have bus comp and in that time we need to 
	//query Internal Product bus comp.

	var busCompName = Inputs.GetProperty(""BusCompName"");
 // TheApplication().Trace("""");
 // TheApplication().Trace(""busCompName = "" + busCompName);
	if (busCompName != null && busCompName != """") {
		try {
		  var bUseActiveObject = true;
		  
		  if (bUseActiveObject) {
		   // TheApplication().Trace(""Using Active Object for external ref"");
		   
				var busObj = TheApplication().ActiveBusObject();
				if (busObj != null) {
					var busComp = busObj.GetBusComp(busCompName);
					var activeId = busComp.GetFieldValue(""Id"");
					var isActiveIdRootItem = busComp.GetFieldValue(""IsRootItem"");

	      //  TheApplication().Trace(""active item Id = "" + activeId + "" isRoot = "" + isActiveIdRootItem);					

          if (isActiveIdRootItem == ""N"") {
            // If not the root then lookup via the product id
            bUseProdId = true; 
          }
          else {
					  var externalRef = busComp.GetFieldValue(""External Inventory System Ref"");
					  
					  //externalRef = ""137:204"";

	       //   TheApplication().Trace(""externalRef = "" + externalRef);					
					
					  invItemId = getInvItemId(externalRef);
					  orgId = getOrgId(externalRef);
					  
					  var isCP = busComp.GetFieldValue(""IsComplexProduct"");
				//	  TheApplication().Trace(""Is Complex product = "" + isCP);
				
	          if ((isCP == ""Y"") && (invItemId != null) && (invItemId != """")) {
						  bOracleProduct = true;
					  }
					  seblOrgId = busComp.GetFieldValue(""Organization Id"");
					}
				}
				else {
					TheApplication().RaiseErrorText(""Cannot find ActiveBusObject. Invoke this method in the context of a active business object"");
				}
			}
		}
		catch(e) {
			bUseProdId = true;
		}
	}
	else {
		bUseProdId = true;
	}
	
	//User the product id to query the Internal Product bus comp to confirm for
	//Oracle product.
	if (bUseProdId) {
		
	//	TheApplication().Trace(""Using Product Id path for external ref"");

		var busObj = null;
		var busComp = null;
		try {
			var prodId = Inputs.GetProperty(""ProductId"");	
			
		//	TheApplication().Trace(""Product Id = "" + prodId);

			busObj = TheApplication().GetBusObject(""Internal Product"");
			busComp = busObj.GetBusComp(""Internal Product"");
			busComp.ActivateField(""External Inventory System Ref"");
			busComp.ActivateField(""Organization Id"");
			busComp.ActivateField(""IsNotComplexProduct"");
			busComp.SetViewMode(AllView);
			busComp.ClearToQuery();
			busComp.SetSearchSpec(""Id"", prodId);
			busComp.ExecuteQuery();
			
			var success = busComp.FirstRecord();
			if (success) {
				var externalRef = busComp.GetFieldValue(""External Inventory System Ref"");
				
			//	TheApplication().Trace(""externalRef = "" + externalRef);					

				invItemId = getInvItemId(externalRef);
				orgId = getOrgId(externalRef);
				var isNotCP = busComp.GetFieldValue(""IsNotComplexProduct"");
			//	TheApplication().Trace(""Is Not Complex product="" + isNotCP);
				if ((isNotCP == ""N"") && (invItemId != null) && (invItemId != """")) {
					bOracleProduct = true;
				}
				seblOrgId = busComp.GetFieldValue(""Organization Id"");
			}
			else {
			//	TheApplication().Trace(""No Internal Product found with Id = "" + prodId);					
			}
		} catch  (e) {
			throw e;
		}
		finally {
			//release the resources
			if (busComp != null) busComp = null;
			if (busObj != null) busObj = null;
		}
	}
/*	TheApplication().Trace(""Completed IsOracleProduct = "" + bOracleProduct
	                       + "" InventoryItemId = "" + invItemId
	                       + "" OrganizationId = "" + orgId);	*///
	
	Outputs.SetProperty(""IsOracleProduct"", bOracleProduct);
	Outputs.SetProperty(""InventoryItemId"", invItemId);
	Outputs.SetProperty(""OrganizationId"", orgId);
	Outputs.SetProperty(""SeblOrganizationId"", seblOrgId);
//	TheApplication().TraceOff();
}
function LaunchBatchValidate(Inputs, Outputs)
{
  updateRunId();

 // TheApplication().TraceOn(consLogFileName(""LaunchBv""), ""Allocation"", ""All"");
  
  var finalMessage = """";
  var valType = ""item"";
  
  if (Inputs.PropertyExists(""ValidationType"")) {
    var valType = Inputs.GetProperty(""ValidationType"");    
  }
  
 // TheApplication().Trace(""LaunchBatchvalidate: type = "" + valType);
  
  if (valType.toLowerCase() == ""all"") {
    bvAllItems(Inputs, Outputs);
    finalMessage = finalMessage
                 + Outputs.GetProperty(S_MESSAGE_TEXT);

  }
  else {
    bvSingleItem(Inputs, Outputs);
    
    var messagePs = Outputs.Copy();
    messagePs.SetProperty(""preamble"", finalMessage);
    
    finalMessage = bvMakeMessage(messagePs);
    
  }
//  TheApplication().TraceOff();
  
  // The process property name is ""Message"". Remove the
  // internal message property
  
  Outputs.RemoveProperty(S_MESSAGE_TEXT);
  Outputs.SetProperty(S_RETURN_MESSAGE, finalMessage);

 // TheApplication().Trace(""LaunchBatchvalidate: messages = "" + finalMessage);
 // TheApplication().Trace(""LaunchBatchvalidate: Complete"");
  
 // TheApplication().TraceOff();
}
function LaunchConfigurator(Inputs, Outputs)
{
  updateRunId();
  
  //TheApplication().TraceOn(""d:\\temp\\lanuachconfig.txt"", ""Allocation"", ""All"");
	var xmlMsgPS = TheApplication().NewPropertySet();
	xmlMsgPS.SetProperty(S_INV_ITEM_ID, Inputs.GetProperty(""InventoryItemId""));
	xmlMsgPS.SetProperty(S_WAREHOUSE_ORG_ID, Inputs.GetProperty(""OrganizationId""));
	xmlMsgPS.SetProperty(S_SEBL_PRICE_LIST_ID, Inputs.GetProperty(""PriceListId""));
	xmlMsgPS.SetProperty(S_SEBL_EXCHG_DATE, Inputs.GetProperty(""ExchangeDate""));
	
	mHeaderId = Inputs.GetProperty(""ParentObjectId"");
	xmlMsgPS.SetProperty(S_HDR_ID, mHeaderId);
	
	var objectId = Inputs.GetProperty(""ObjectId"");
	xmlMsgPS.SetProperty(S_LINE_ID, objectId);
	
	mHostApp = Inputs.GetProperty(""HostAppMode"");
	xmlMsgPS.SetProperty(S_SEBL_APP_MODE, mHostApp);
	xmlMsgPS.SetProperty(S_TERMINATE_BEHAVIOR, ""brief"");
	
	var pricingClassName = Inputs.GetProperty(""JavaPricingClassName"");
	if ((pricingClassName != null) && (pricingClassName == """")) {
		pricingClassName = ""oracle.apps.cz.integration.sebl.SeblPspPricingEngine"";
	}
	xmlMsgPS.SetProperty(S_JAVA_PRICING_CLASS_NAME, pricingClassName);
	
	mBusObjName = Inputs.GetProperty(""BusObjectName"");
	var busCompName = Inputs.GetProperty(""BusCompName"");
	mHeaderBusCompName = getHeaderBusCompName(Inputs);
	
	var busObj = TheApplication().ActiveBusObject();
	var source = Inputs.GetProperty(""Source"");
	var bCatalogLaunch = false;
	if (source != null && source == ""Catalog"") {
		bCatalogLaunch = true;
		//In Catalog launch the WF process prop does not have bus object name so
		//infer it from active bus object.	
		mBusObjName = busObj.Name();
	}
	try {
		var modelQty = 1;
		if (mHostApp != ""Template"") {
			//query the header bus comp to get the account id
			var headerBusComp = busComp = busObj.GetBusComp(mHeaderBusCompName);
			var accountId = headerBusComp.GetFieldValue(""Account Id"");
 			xmlMsgPS.SetProperty(S_SEBL_ACCT_ID, accountId);
		}
 		if (!bCatalogLaunch) {
 			//query the line item bus comp for getting config hdr id and rev nbr
			var busComp = busObj.GetBusComp(busCompName);
			//If the line has Config header id and revision number then it is a restore
			//otherwise treat it a new configuration
			var cfgHdrId = busComp.GetFieldValue(""External Configurator Reference 1"");
			var cfgRevNbr = busComp.GetFieldValue(""External Configurator Reference 2"");
			var bRestore = ((cfgHdrId != """") && (cfgRevNbr != """"));
			if (bRestore) {
				xmlMsgPS.SetProperty(S_CFG_HDR_ID, cfgHdrId);
				xmlMsgPS.SetProperty(S_CFG_REV_NBR, cfgRevNbr);
			}
			modelQty = busComp.GetFieldValue(""Quantity"");	
 		}
		else {
			//catalog launch can only be a new configuration
			var busComp = busObj.GetBusComp(""Quote Catalog Internal Product by Price List Optional 2"");
			modelQty = busComp.GetFieldValue(""Quantity"");
		}
		xmlMsgPS.SetProperty(S_MODEL_QTY, modelQty);
	}
	catch (e) {
		throw (e);
	}
		
	// Handle the siebel specific init parameters. Use Oracle
	// code to handle any missing parameters.
	var appShortName = getAppShortName(Inputs);
  xmlMsgPS.SetProperty(S_CALLING_APP_SHORT_NAME, appShortName);
	
//	var sblCookie = TheApplication().GetProfileAttr(""czSblSesCookie"");
	
	//sblCookie = ""Dummy  Cookie"";
	
/*	if (sblCookie == null || sblCookie == """") {
	  TheApplication().RaiseErrorText(""Session Cookie Not Found. Cannot start configuration session. Please contact your System Adminstrator"");
	}*/
	// Added For bug# 12976292 in 8115 Session cookie issue -- START
	var ssnTokInPS = TheApplication().NewPropertySet();
	var ssnTokOutPS = TheApplication().NewPropertySet();
	var sesId,sesName,sesFrm;
	var sesSrn; //added for Bug 16859819
	try
  	{
	    var svc2 = TheApplication().GetService(""Web Engine HTTP TXN"");
	    svc2.InvokeMethod(""GetWebSessionInfo"", ssnTokInPS, ssnTokOutPS);
    	sesId = ssnTokOutPS.GetProperty(""SessionId"");
    	sesFrm = ssnTokOutPS.GetProperty(""SessionIdFrom"");
    	sesName = ssnTokOutPS.GetProperty(""SessionName"");
    	sesSrn = ssnTokOutPS.GetProperty(""SRN""); //added for Bug 16859819
    }
	catch  (e) 
	{
		
	    TheApplication().RaiseErrorText(e.toString());
	    throw e;
	}

	var sblCookie = ""<![CDATA["" + sesName + ""="" + sesId+ ""]]>"";  
	var sblSrn = sesSrn;   //added for Bug 16859819
	xmlMsgPS.SetProperty(S_SEBL_SES_COOKIE, sblCookie);
	xmlMsgPS.SetProperty(S_SEBL_SES_SRN, sblSrn); //added for Bug 16859819
	// Added For bug# 12976292 in Session Cookie issue -- END

//	sblCookie = ""<![CDATA["" + sblCookie + ""]]>"";
//	xmlMsgPS.SetProperty(S_SEBL_SES_COOKIE, sblCookie);
	
	var sblUrl = TheApplication().GetProfileAttr(""czSblUrl"");
	//sblUrl = ""http://sdchs21n080.corp.siebel.com/ecommunications_enu/"";
	
	var sblSweUrl = sblUrl + ""start.swe"";
	var sblRetUrl = sblUrl + ""CZReturn.html"";
	xmlMsgPS.SetProperty(S_SEBL_SRVR_URL, sblSweUrl);
	xmlMsgPS.SetProperty(S_RETURN_URL, sblRetUrl);

  var isiebeluser = TheApplication().LoginName();
  var seblOrgId = Inputs.GetProperty(""SeblOrganizationId"");
  //TheApplication().Trace(""isiebeluser = "" + isiebeluser);
  //TheApplication().Trace(""seblOrgId = "" + seblOrgId);
  
  setBPELProperties(isiebeluser, seblOrgId, xmlMsgPS);
	
	var xmlMsgStr = createInitMessage(xmlMsgPS);
	//TheApplication().Trace(""xmlMsgStr = "" + xmlMsgStr);
	TheApplication().SetProfileAttr(""CZInitMessage"", xmlMsgStr);
	TheApplication().SetProfileAttr(""CZReturnViewName"", TheApplication().ActiveViewName());
	if (mHostApp == ""Quote"") {
		TheApplication().GotoView(""CZRuntimeInstanceView (JS)"");
	}
	else if (mHostApp == ""Order"") {
		TheApplication().GotoView(""CZRuntimeInstanceView (JS) - Order (Sales)"");
	}
	else if (mHostApp == ""Agreement"") {
		TheApplication().GotoView(""CZRuntimeInstanceView (JS) - Agreement"");
	}
	else if (mHostApp == ""Template"") {
		TheApplication().GotoView(""CZRuntimeInstanceView (JS) - Favorites"");
	}
	//TheApplication().TraceOff();
}
function RaiseNonOracleProductError(Inputs, Outputs)
{
	//Todo raise error code to display MLS msg
	TheApplication().RaiseErrorText(""Cannot configure or verify a non Oracle product in Oracle Configurator"");
}
function ReturnToView(Inputs, Outputs)
{
	var busObj = TheApplication().GetBusObject(mBusObjName);
	var busComp = busObj.GetBusComp(mHeaderBusCompName);
	with (busComp) {
		SetViewMode(AllView); //AGG-FIX 
        ClearToQuery();       //AGG-FIX 
		SetSearchSpec(""Id"", mHeaderId);
		ExecuteQuery();
	}
	var viewName = TheApplication().GetProfileAttr(""CZReturnViewName"");
 	TheApplication().GotoView(viewName, busObj);   
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	if ((MethodName == ""IsOracleConfigurableProduct"") || 
      (MethodName == ""LaunchConfigurator"") ||
      (MethodName == ""LaunchBatchValidate"") ||
      (MethodName == ""CacheErrorMessage"") || 
      (MethodName == ""ComputeTargetView"")||
		  (MethodName == ""ReturnToView"") ||
			(MethodName == ""DisplayVerifyMessages"") ||
			(MethodName == ""RaiseNonOracleProductError"")) {

		CanInvoke = ""TRUE"";
		return (CancelOperation);
	}
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var ret= CancelOperation;

	if (MethodName == ""IsOracleConfigurableProduct"") {
		IsOracleConfigurableProduct(Inputs, Outputs);
	}
	else if (MethodName == ""LaunchConfigurator"") {
		LaunchConfigurator(Inputs, Outputs);
	}
	else if (MethodName == ""LaunchBatchValidate"") {
		LaunchBatchValidate(Inputs, Outputs);
	}
	else if (MethodName == ""CacheErrorMessage"") {
		CacheErrorMessage(Inputs, Outputs);
	}
	else if (MethodName == ""DisplayVerifyMessages"") {
		DisplayVerifyMessages(Inputs, Outputs);
	}
	else if (MethodName == ""ComputeTargetView"") {
		ComputeTargetView(Inputs, Outputs);
	}
	else if (MethodName == ""ReturnToView"") {
		ReturnToView(Inputs, Outputs);
	}
	else if (MethodName == ""RaiseNonOracleProductError"") {
		RaiseNonOracleProductError(Inputs, Outputs);
	}
	else {
		ret = ContinueOperation;
	}
	return ret;
}
function bvAllItems(Inputs, Outputs) {
  // Get the quote/order. The id passed is the row id not the 
  // quote/row id
  
  var headerId = Inputs.GetProperty(""ObjectId"");
  var busObj = TheApplication().ActiveBusObject();

  var busCompName = Inputs.GetProperty(""BusCompName"");
  var bcItems = busObj.GetBusComp(busCompName);
  
  bcItems.SetViewMode(3);
  
  var processItem = bcItems.FirstRecord();
  
  bcItems.ActivateField(""Quote Id"");
  bcItems.ActivateField(""Product"");
  bcItems.ActivateField(""Product Id"");
  bcItems.ActivateField(""Parent Quote Item Id"");
  bcItems.ActivateField(""IsRootItem"");
  bcItems.ActivateField(""External Inventory System Ref"");

  // Need to know the 'failure mode' Do we continue
  // to validate after a model returns with an error
  
  var verifyMode = S_VERIFY_VAL_FIRST_FAIL;
  if (Inputs.PropertyExists(S_VERIFY_MODE)) {
    var verifyValue = Inputs.GetProperty(S_VERIFY_MODE);
    if (verifyValue == S_VERIFY_VAL_ALL) {
      verifyMode = S_VERIFY_VAL_ALL;
    }
  }

  var message = """";
  while(processItem) {
  
    // Only work with the first level children
    var product = bcItems.GetFieldValue(""Product"");
    var productId = bcItems.GetFieldValue(""Product Id"");
    var isRootItem = bcItems.GetFieldValue(""IsRootItem"");
    bcItems.ActivateField(""Outline Number""); 
    var lineNumber  = bcItems.GetFieldValue(""Outline Number""); 
    
    var bvStatus = """";
    
   // TheApplication().Trace(""isRoot = "" + isRootItem + "" for "" + productId + "" :("" + lineNumber + "") Name = "" + product);
   
    if (isRootItem == ""Y"") {
      var externalRef = bcItems.GetFieldValue(""External Inventory System Ref"");

      var invItemId = getInvItemId(externalRef);
      var orgId = getOrgId(externalRef);
      
    //  TheApplication().Trace(""External Inv  = "" + invItemId);

      // There has to be an inventory item id. Once past that then
      /// make sure it si a configurable product
      if (invItemId != null && invItemId != """") {
        
        var isOracleCfgInPs = TheApplication().NewPropertySet();
        var isOracleCfgOutPs = TheApplication().NewPropertySet();
        
        isOracleCfgInPs.SetProperty(""ProductId"", productId);
        IsOracleConfigurableProduct(isOracleCfgInPs, isOracleCfgOutPs); 
        var isConfigurable = isOracleCfgOutPs.GetProperty(""IsOracleProduct"");
       // TheApplication().Trace(""bvAllItems: ProductId  = "" + productId);
      //  TheApplication().Trace(""bvAllItems: isConfigurable  = "" + isConfigurable);       
        if (isConfigurable == ""true"") {            
          
          // Need to make sure this is a Oracle Product
          var invokePs = Inputs.Copy();
          var returnPs = TheApplication().NewPropertySet();
        
          // The Object id is of the header. For a single bv
          // that becomes the parent and the row becomes the object
        
          invokePs.SetProperty(""ParentObjectId"", headerId);
          invokePs.SetProperty(""ObjectId"", bcItems.GetFieldValue(""Id""));
          invokePs.SetProperty(""InventoryItemId"", invItemId);
          invokePs.SetProperty(""OrganizationId"", orgId);
        //  TheApplication().Trace(""bvAllItems: Will BV "" + headerId);
        
          bvSingleItem(invokePs, returnPs);
        
          // To support first failure and a different message if all
          // line items are valid
        
          bvStatus = returnPs.GetProperty(S_BV_STATUS);
          var preamble = ""["" + lineNumber +""] "";
          returnPs.SetProperty(""preamble"", preamble);
          var returnMesssage = bvMakeMessage(returnPs);
          message = message + returnMesssage + ""\n"";
  
          // If "first failure"" then stop the verification
          // of any subsequent line items
        
          if (   verifyMode == S_VERIFY_VAL_FIRST_FAIL
              && bvStatus == "false"") {
            // Failure. 
            processItem = false;
            message = message + ""Verification of the remaining items stopped\n"";
          }
        }
      }
		}
		// If firstfailure mode and there is a problem then
		// don't continue
		if (processItem == true) {
      processItem = bcItems.NextRecord();
    }
  }
  // Return messages. At this time don't display them as ""rule
  // violations. But as messages like a single vb
  
  Outputs.SetProperty(S_RULE_VIOLATION_EMPTY, ""Y"");
  
  var emptyPS = TheApplication().NewPropertySet();
  emptyPS.SetType(S_RULE_VIOLATION);
  Outputs.AddChild(emptyPS);
  
  Outputs.SetProperty(S_MESSAGE_TEXT, message);
}
function bvInvoke(Inputs, Outputs) {

 // TheApplication().Trace("""");
 // TheApplication().Trace(""======== invokeBv ========"");
  var outboundMessage = """";
  var initMessage = Inputs.GetProperty(S_INIT_MESSAGE);

  outboundMessage = ""<batch_validate>""
                  + initMessage;
                  + ""</batch_validate>"";

  var credentialPs = TheApplication().NewPropertySet();

  getCredentials(Inputs, credentialPs);

  var user = credentialPs.GetProperty(S_USERNAME);
  var pwd = credentialPs.GetProperty(S_PWD);

  // The password isn't always decrypted when running from tools.
  // Works fine if running from client against server

  if (Inputs.PropertyExists(S_BVP)) {
    var bvp = Inputs.GetProperty(S_BVP);
    
    if (bvp != null && bvp != """") {
     // TheApplication().Trace(""using bvp"");
      pwd = bvp;
    }
  }

  var httpsvc = TheApplication().GetService(""EAI HTTP Transport"");

  var payloadPs = TheApplication().NewPropertySet();
  var responsePs = TheApplication().NewPropertySet();

  payloadPs.SetProperty(""HTTPRequestMethod"", ""POST"");

  var site = credentialPs.GetProperty(S_BV_SITE_URL);
// TODO: The other parameters

  var payloadStr = ""username="" + user
                 + ""&password="" + pwd
                 + ""&XMLmsg="" + outboundMessage;


 // TheApplication().Trace(""Sbl user = "" + TheApplication().LoginId());
 // TheApplication().Trace(""Orcl user = "" + user);
 // TheApplication().Trace(""pwd = "" + pwd);
 // TheApplication().Trace(""InitMessage = "" + outboundMessage + ""\n"");
 // TheApplication().Trace(""site = "" + site);
 // TheApplication().Trace(""value = "" + payloadStr); 

  // The final properties before the outbound call
  
  payloadPs.SetProperty(""HTTPRequestURLTemplate"", site);
  payloadPs.SetValue(payloadStr); 
  payloadPs.SetProperty(""CharSetConversion"", ""UTF-8"");

 // TheApplication().Trace(""+SendReceive"");
  logPs(payloadPs); 
  httpsvc.InvokeMethod(""SendReceive"", payloadPs, responsePs);
//  TheApplication().Trace(""-SendReceive"");
// TheApplication().Trace(""ReturnPS"");
  logPs(responsePs); 

  responsePs.SetType(S_BV_RESPONSE);
  Outputs.AddChild(responsePs);
}
function bvMakeMessage(Inputs) {

  var bvStatus = Inputs.GetProperty(S_BV_STATUS);
  var itemName =  Inputs.GetProperty(S_ITEM_NAME);
  
  var finalMessage = """";
  
  if (Inputs.PropertyExists(""preamble"")) {
    finalMessage = Inputs.GetProperty(""preamble"");
  }
  
  finalMessage = finalMessage
               + ""This '""
               + itemName
               + ""' is ""; 

  if (bvStatus == ""true"") {

    finalMessage = finalMessage + ""valid."";
  }
  else {
    // TODO: message
    finalMessage = finalMessage + ""not valid. To correct click 'Customize'"";
  }
  
  finalMessage = finalMessage
               + Inputs.GetProperty(S_MESSAGE_TEXT);
  
  return finalMessage;
}
function bvProcessHeader(Inputs, Outputs)
{
  var message = """";

  // Get the two bits out of the return message
  
  var psSearchIn = TheApplication().NewPropertySet();
  var psSearchOut = TheApplication().NewPropertySet();

  psSearchIn.SetType(""SearchSpec"");
  psSearchIn.SetValue(S_VALID_CONFIGURATION);
  psSearchIn.AddChild(Inputs);
  searchChild(psSearchIn, psSearchOut);

  var valid = """";

  if (psSearchOut.PropertyExists("found"")) {
    valid = psSearchOut.GetProperty("found"");
  }

  var psSearchIn = TheApplication().NewPropertySet();
  var psSearchOut = TheApplication().NewPropertySet();

  psSearchIn.SetType(""SearchSpec"");
  psSearchIn.SetValue(S_COMPLETE_CONFIGURATION);
  psSearchIn.AddChild(Inputs);
  searchChild(psSearchIn, psSearchOut);

  var complete = """";
  if (psSearchOut.PropertyExists("found"")) {
    complete = psSearchOut.GetProperty("found"");
  } 

  var psSearchIn = TheApplication().NewPropertySet();
  var psSearchOut = TheApplication().NewPropertySet();

  psSearchIn.SetType(""SearchSpec"");
  psSearchIn.SetValue(S_CFG_HDR_ID);
  psSearchIn.AddChild(Inputs);
  searchChild(psSearchIn, psSearchOut);

  var hdr = """";
  if (psSearchOut.PropertyExists("found"")) {
    hdr = psSearchOut.GetProperty("found"");
  } 
  var psSearchIn = TheApplication().NewPropertySet();
  var psSearchOut = TheApplication().NewPropertySet();

  psSearchIn.SetType(""SearchSpec"");
  psSearchIn.SetValue(S_CFG_REV_NBR);
  psSearchIn.AddChild(Inputs);
  searchChild(psSearchIn, psSearchOut);

  var rev = """";
  if (psSearchOut.PropertyExists("found"")) {
    rev = psSearchOut.GetProperty("found"");
  } 
  // Build up the String, if the config is valid and complete
  // return nothing

  var legal = null;
  
  if (complete == ""true"" && valid == ""true"") {
    legal = ""true"";
  }
  else {
    legal = "false"";
  }
  Outputs.SetProperty(S_MESSAGE_TEXT, message);
  Outputs.SetProperty(S_BV_STATUS, legal);
  
  if (hdr != """") {
    Outputs.SetProperty(S_CFG_HDR_ID, hdr);
  }
  if (rev != """") {
    Outputs.SetProperty(S_CFG_REV_NBR, rev);
  }
}
function bvProcessMessages(Inputs) {

  var message = """";
  var searchFor = ""config_messages"";
  var cCount = Inputs.GetChildCount();

  var c = null; 
  for (var i=0; i < cCount; i++) {
	c = Inputs.GetChild(i);
    var candidate = c.GetType();
    if (candidate == searchFor) {
      // THere can multiple messages

      var mCount = c.GetChildCount();
      for (var j = 0; j < mCount; j++) {
        var m = c.GetChild(j);
  
        var psSearchIn = TheApplication().NewPropertySet();
        var psSearchOut = TheApplication().NewPropertySet();

        psSearchIn.SetType(""SearchSpec"");
        psSearchIn.SetValue(S_MESSAGE_TEXT);
        psSearchIn.AddChild(m);
        searchChild(psSearchIn, psSearchOut);

        var str;
        if (psSearchOut.PropertyExists("found"")) {
          str = psSearchOut.GetProperty("found"");
        }
        message = message + ""\n"" + str;
      }
      return message;
    }
  }
  return message;
}
function bvProcessResults(Inputs, Outputs) {

  // The outputs hold the state of all batch validates for this
  // either one or multiple
  
  // Retrieve the results
  
  // TODO: Verify the message is reasonable
  
  var xmlReturnPs = Inputs.GetChild(0);
  var returnString = xmlReturnPs.GetValue(); 

  var psin = TheApplication().NewPropertySet();
  var parsedXMLPs = TheApplication().NewPropertySet();

  var xmlsvc =  TheApplication().GetService(""XML Converter"");
  psin.SetValue(returnString);
  xmlsvc.InvokeMethod(""XMLToPropSet"", psin, parsedXMLPs);
    
  logPs(parsedXMLPs);

  var returnInfoPs = TheApplication().NewPropertySet();
  
  bvProcessHeader(parsedXMLPs, Outputs);
  
  var message = Outputs.GetProperty(S_MESSAGE_TEXT);

  
  // In either case search for any messages and add them.

  var failureMessages = bvProcessMessages(parsedXMLPs);
  if (failureMessages != null && failureMessages != """") {
    message = message + ""\n"" + failureMessages;
  }
  //return message ;
  Outputs.SetProperty(S_MESSAGE_TEXT, message);
}
function bvSingleItem(Inputs, Outputs) {

  var xmlMsgPS = TheApplication().NewPropertySet();
  xmlMsgPS.SetProperty(S_INV_ITEM_ID, Inputs.GetProperty(""InventoryItemId""));
  xmlMsgPS.SetProperty(S_WAREHOUSE_ORG_ID, Inputs.GetProperty(""OrganizationId""));

  mHeaderId = Inputs.GetProperty(""ParentObjectId"");
  xmlMsgPS.SetProperty(S_HDR_ID, mHeaderId);
	
  var objectId = Inputs.GetProperty(""ObjectId"");
  xmlMsgPS.SetProperty(S_LINE_ID, objectId);
	
  mHostApp = Inputs.GetProperty(""HostAppMode"");
  xmlMsgPS.SetProperty(S_SEBL_APP_MODE, mHostApp);
  
  xmlMsgPS.SetProperty(S_TERMINATE_BEHAVIOR, ""message"");
  xmlMsgPS.SetProperty(S_SAVE_BEHAVIOR, ""never"");

  //query the line item bus comp for getting config hdr id and rev nbr
	
	var busCompName = Inputs.GetProperty(""BusCompName"");
	mHeaderBusCompName = getHeaderBusCompName(Inputs);  
	
	var busObj = TheApplication().ActiveBusObject();
	var busComp = busObj.GetBusComp(busCompName);
	
	//If the line has Config header id and revision number then it is a restore
	//otherwise treat it a new configuration
	
	var cfgHdrId = busComp.GetFieldValue(""External Configurator Reference 1"");
	var cfgRevNbr = busComp.GetFieldValue(""External Configurator Reference 2"");
	
  busComp.ActivateField(""Item Display Name"");
	var itemName = busComp.GetFieldValue(""Item Display Name"");
  
  // Get the pricing arguments

	var pricingClassName = Inputs.GetProperty(""JavaPricingClassName"");
	if ((pricingClassName != null) && (pricingClassName == """")) {
		pricingClassName = ""oracle.apps.cz.integration.sebl.SeblPspPricingEngine"";
	}
	xmlMsgPS.SetProperty(S_JAVA_PRICING_CLASS_NAME, pricingClassName);

  var headerBusComp =  busObj.GetBusComp(mHeaderBusCompName);

  headerBusComp.ActivateField(""Price List Id"");
  var s = headerBusComp.GetFieldValue(""Price List Id"");
  xmlMsgPS.SetProperty(S_SEBL_PRICE_LIST_ID, s);

  headerBusComp.ActivateField(""Exchange Date"");
  s = headerBusComp.GetFieldValue(""Exchange Date"");
  xmlMsgPS.SetProperty(S_SEBL_EXCHG_DATE, s);

  headerBusComp.ActivateField(""Account Id"");
  s = headerBusComp.GetFieldValue(""Account Id"");
  xmlMsgPS.SetProperty(S_SEBL_ACCT_ID, s);

	var sblCookie = TheApplication().GetProfileAttr(""czSblSesCookie"");
	if (sblCookie == null || sblCookie == """") {
	  TheApplication().RaiseErrorText(""Session Cookie Not Found. Cannot start configuration session. Please contact your System Adminstrator"");
	}
	
	xmlMsgPS.SetProperty(S_SEBL_SES_COOKIE, sblCookie);
	
	var sblUrl = TheApplication().GetProfileAttr(""czSblUrl"");
	var sblSweUrl = sblUrl + ""start.swe"";

	xmlMsgPS.SetProperty(S_SEBL_SRVR_URL, sblSweUrl);

	var bRestore = ((cfgHdrId != """") && (cfgRevNbr != """"));
	var legal;
	var message;
	
	// TheApplication().Trace(""bvSingleItem: bRestore = "" + bRestore);
	if (bRestore) {
	//	TheApplication().Trace(""bvSingleItem: starting BV txn"");
		xmlMsgPS.SetProperty(S_CFG_HDR_ID, cfgHdrId);
		xmlMsgPS.SetProperty(S_CFG_REV_NBR, cfgRevNbr);
	
	  var modelQty = busComp.GetFieldValue(""Quantity"");	
	  xmlMsgPS.SetProperty(S_MODEL_QTY, modelQty);
  
	  var appShortName = getAppShortName(Inputs);
    xmlMsgPS.SetProperty(S_CALLING_APP_SHORT_NAME, appShortName);
  
    var isiebeluser = TheApplication().LoginName();
    var isiebelbu = busComp.GetFieldValue(""Organization Id"");
    setBPELProperties(isiebeluser, isiebelbu, xmlMsgPS);
    
    var initMessage = createInitMessage(xmlMsgPS);  
                  
    var invokePs = TheApplication().NewPropertySet();
    var responsePs = TheApplication().NewPropertySet();
  
    invokePs.SetProperty(S_INIT_MESSAGE, initMessage);
  
    invokePs.SetProperty(S_SSO_SYSTEM_NAME, Inputs.GetProperty(S_SSO_SYSTEM_NAME));
    invokePs.SetProperty(S_WI_SYMURL_NAME, Inputs.GetProperty(S_WI_SYMURL_NAME));
    invokePs.SetProperty(S_BV_SITE_URL, Inputs.GetProperty(S_BV_SITE_URL));
 
    if (Inputs.PropertyExists(S_BVP)) {
      invokePs.SetProperty(S_BVP, Inputs.GetProperty(S_BVP));
    }
  
    // Make bv request
    bvInvoke(invokePs, responsePs);
    // Process Results
  
    var processPs = TheApplication().NewPropertySet();
    bvProcessResults(responsePs, processPs);

    legal = processPs.GetProperty(S_BV_STATUS);
    message = processPs.GetProperty(S_MESSAGE_TEXT);
  }
  else {
   // TheApplication().Trace(""bvSingleItem: no saved header. An interactive session did not occur for this line"");
    legal = ""true"";
    message = """";
  }
  // Verify BV calls do not save new configuration information.

  Outputs.SetProperty(S_BV_STATUS, legal);
  Outputs.SetProperty(S_ITEM_NAME, itemName);
  Outputs.SetProperty(S_MESSAGE_TEXT, message);

}
function consLogFileName(fileNameBase) {
  //var fn = ""d:\\Cz"" + fileNameBase + ""_$p_$t_"" + RUN_ID + "".txt"";
  var fn = ""..\\LOG\\Cz"" + fileNameBase + ""_$p_$t_"" + RUN_ID + "".txt"";

  return fn;
}
function createInitMessage(Inputs)
{

    // Always send the local date & time.
	var OracleOrgId = Inputs.GetProperty(""operating_unit_org_id"");
    var sysDate = Clib.time();
    var d = Date.fromSystem(sysDate);
    var sString = d.getMonth() + 1 + ""-""
                + d.getDate() + ""-""
                + d.getFullYear() + ""-""
                + d.getHours()  + ""-""
                + d.getMinutes() + ""-""
                + d.getSeconds();
	var xmlmsg = ""<initialize>"";
	xmlmsg += ""<param name='jrad_standalone'>false</param>"";
	xmlmsg += ""<param name='sbm_flag'>true</param>"";
	xmlmsg += ""<param name='ui_type'>JRAD</param>"";
	//xmlmsg += ""<param name='ui_def_id'>4680036</param>"";
	//xmlmsg += ""<param name='share_dio'>false</param>"";
	xmlmsg += ""<param name='operating_unit_org_id'>""+ OracleOrgId + ""</param>"";
    xmlmsg += ""<param name='config_effective_date'>""+ sString + ""</param>"";
	xmlmsg += ""<param name='"" + S_SEBL_VERSION + ""'>""+ S_VERSION + ""</param>"";
	if (Inputs.GetPropertyCount() <= 0) {
		TheApplication.RaiseErrorText(""A system error has occured when launching configurator. Please inform your system administrator"");
		return;
	}

	var paramName = """";
	var paramValue = """";
	paramName = Inputs.GetFirstProperty();
	while ((paramName != null) && (paramName != """")) {
		paramValue = Inputs.GetProperty(paramName);
		if ((paramValue != null) && (paramValue != """")) {
			xmlmsg += ""<param name='"" + paramName + ""'>"" + paramValue + ""</param>"";
		}
		paramName = Inputs.GetNextProperty();
	}

	xmlmsg += ""</initialize>"";
	
	return xmlmsg;
}
function doOracleRespLookup(Inputs, Outputs)
{
  // not used. Remove soon
  
  TheApplication().RaiseErrorText(""doOracleResp shoudl be removed"");
}
function doOracleUserRespOULangLookup(inputPs)
{
  //TheApplication().TraceOn(""d:\\temp\\doOracleUserRespOULangLookup.txt"", ""Allocation"", ""All"");
  var outputPs = TheApplication().NewPropertySet();
  //outputPs.SetProperty(""OutputOracleResp"", ""22713"");
  //outputPs.SetProperty(""OutputOracleLang"", ""ENG"");
  //outputPs.SetProperty(""OutputOracleResp"", ""22713"");
  //outputPs.SetProperty(""OutputOracleLang"", ""US"");
  

  
  //outputPs.SetProperty(""OutputOracleResp"", ""OPERATIONS"");
  //outputPs.SetProperty(""OutputOracleLang"", ""ENG"");
  //outputPs.SetProperty(S_RESP_ID, ""21623"");

  try
  {
	  var svc2 = TheApplication().GetService(""CZIntegGetOracleUserRespOULang"");
	  svc2.InvokeMethod(""GetOracleUserRespOULang"", inputPs, outputPs);
    	  
  }
	catch  (e) 
	{
	//	TheApplication().Trace(e.toString());
	  TheApplication().RaiseErrorText(e.toString());
		throw e;
	}

	//TheApplication().Trace(""Finished"");
	//TheApplication().TraceOff();
  return outputPs;
}
function getAppShortName(Inputs)
{
	var hostApp = Inputs.GetProperty(""HostAppMode"");
	if (hostApp == ""Order"" || hostApp == ""VerifyOrder"") { 
    // Get the value from the worflow
    return (Inputs.GetProperty(""AppNameOrder""));
  }
  else if (hostApp == ""Quote"" || hostApp == ""VerifyQuote"" || hostApp == ""Template"") {
    return (Inputs.GetProperty(""AppNameQuote""));
  }
  else if (hostApp == ""Agreement"") {
    return (Inputs.GetProperty(""AppNameAgreement""));
  }
  else {
  	TheApplication.RaiseErrorText(""A system error has occured when launching configurator. Please inform your system administrator"");
  }
}
function getCredentials(Inputs, Outputs) {

  var boSsoSystemAdmin = TheApplication().GetBusObject(""SSO Systems Admin"") ;
  var systemId;

  // Get the SSO system for Oracle configurator

  var ssoSystemName = Inputs.GetProperty(S_SSO_SYSTEM_NAME);
  
  if (ssoSystemName == null || ssoSystemName == """") {
  	TheApplication.RaiseErrorText(S_STD_ERROR_TEXT + ""SsoSystemName not correctly defined."");  
  }
  var bcSsoSystem = boSsoSystemAdmin.GetBusComp(""SSO Systems"");
  bcSsoSystem.SetViewMode(3);
  bcSsoSystem.ActivateField(""Name"");
  bcSsoSystem.SetSearchSpec(""Name"", ssoSystemName);
  bcSsoSystem.ExecuteQuery();

  var bSuccess = bcSsoSystem.FirstRecord();

  if (!bSuccess) {
  	TheApplication.RaiseErrorText(S_STD_ERROR_TEXT + ""sso system not found: "" + ssoSystemName);
  } 
  else {
	  systemId = bcSsoSystem.GetFieldValue(""Id"");
   
    var bcSsoUser = boSsoSystemAdmin.GetBusComp(""SSO Sys User"") ;
    var loginId = TheApplication().LoginId();
    var loginName = TheApplication().LoginName();
    // Get the user's credentials

    bcSsoUser.SetViewMode(3);
    bcSsoUser.ActivateField(""SSO Password"");
    bcSsoUser.ActivateField(""SSO LoginId"");
    bcSsoUser.ActivateField(""Password Ref"");
    bcSsoUser.SetSearchSpec(""SSO System Id"", systemId);
    bcSsoUser.SetSearchSpec(""User Id"", TheApplication().LoginId());

    bcSsoUser.ExecuteQuery();

	  bSuccess = bcSsoUser.FirstRecord();

    if (!bSuccess) {
      TheApplication.RaiseErrorText(S_STD_ERROR_TEXT + ""No user defined in sso system."");  
    }
  }
  var user = bcSsoUser.GetFieldValue(""SSO LoginId"");
  var pwd = bcSsoUser.GetFieldValue(""SSO Password"");

  Outputs.SetProperty(S_USERNAME, user);
  Outputs.SetProperty(S_PWD, pwd);

  // Now get the URL. If the URL starts with HTTP
  // then the entire path has been provided by the
  // flow. use it. Otherwise, it is the final directory.
  // Append it into the url using the information from
  // WI service

  var siteUrl = Inputs.GetProperty(S_BV_SITE_URL);
  var finalUrl = null;
  // DONT CHECKIN the following line
  //siteUrl = ""http://qapache.us.oracle.com:3744/configurator/oracle.apps.cz.servlet.UiServlet"";

  if (siteUrl == null || siteUrl == """") {
    TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + S_BV_SITE_URL + ""not properly defined."");  
  }
  else {
    var lcUrl = siteUrl.toLowerCase();

    if (lcUrl.indexOf(""http"") != 0) {
      var wiSymUrlName = Inputs.GetProperty(S_WI_SYMURL_NAME);      
      if (wiSymUrlName == null || wiSymUrlName == """") {
  	    TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + ""WiSymUrlName not correctly defined."");  
      }
            
	    var boWiSymUrl = TheApplication().GetBusObject(""WI Symbolic URL"");
	    var bcWiSymUrl = boSsoSystemAdmin.GetBusComp(""WI Symbolic URL"");
	    bcWiSymUrl.SetViewMode(3);
	    bcWiSymUrl.ActivateField(""Name"");
	    bcWiSymUrl.ActivateField(""URL"");
	    bcWiSymUrl.ActivateField(""Host Virtual Name"");
	    bcWiSymUrl.ActivateField(""Host Name"");
	    bcWiSymUrl.SetSearchSpec(""Name"", wiSymUrlName);
	    bcWiSymUrl.ExecuteQuery();
	
      if (!bcWiSymUrl.FirstRecord()) {
        TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + ""WI symbolic url entry not defined."");  
      }
	    var url = bcWiSymUrl.GetFieldValue(""URL"");
	
	    if (url == null || url == """") {
        TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + ""WI symbolic url name not defined."");  
	    }
	    var hostVirtualName = bcWiSymUrl.GetFieldValue(""Host Virtual Name"");
	    if (hostVirtualName == null || hostVirtualName == """") {
        TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + ""WI virtual host name not defined."");  
	    }
	    var hostName = bcWiSymUrl.GetFieldValue(""Host Name"");
	    if (hostName == null || hostName == """") {
        TheApplication().RaiseErrorText(S_STD_ERROR_TEXT + ""WI host name not defined."");  
	    }
	    // Substitute the virtual name with the name
	    var pos = url.indexOf(hostVirtualName);
	    finalUrl = url.substring(0, pos);
	    finalUrl = finalUrl + hostName + url.substring(pos+hostVirtualName.length);
	    // Remove the jsp, which is defined for the interactive session
	    pos = finalUrl.indexOf(""OA_HTML/CfgSebl.jsp"");
	
		  finalUrl = finalUrl.substring(0, pos) + siteUrl;
    }
    else {
		  finalUrl = siteUrl;
    }
  }
  Outputs.SetProperty(S_BV_SITE_URL, finalUrl);
}
function getHeaderBusCompName(Inputs)
{
	var source = Inputs.GetProperty(""Source"");
	var hostApp = Inputs.GetProperty(""HostAppMode"");
	var hdrBusCompName = """";
	
	if (source != null && source == ""Catalog"") {
		//In Catalog launch the WF process prop does not have headerBusCompName.
		switch (hostApp) {
			case ""Order"":
				hdrBusCompName = ""Order Entry - Orders"";
				break;
			case ""Quote"":
				hdrBusCompName = ""Quote"";
				break;
			case ""Agreement"":
				//Todo:
				//hdrBusCompName
				break;
		}
	}
	else {
	  if (hostApp == ""VerifyQuote"") {
	  	hdrBusCompName = ""Quote"";
	  } 
	  else if (hostApp == ""VerifyOrder"") {
	    hdrBusCompName = ""Order Entry - Orders"";
	  }
	  else {
		  hdrBusCompName = Inputs.GetProperty(""HeaderBusCompName"");
		}
	}
	return hdrBusCompName;
}
function getInvItemId(externalRef) {
  // The format is inv::org
  var invItemId = """";
  
  if (externalRef == null || externalRef == """") {
    invItemId = """";
  }
  else {
    var pos = externalRef.indexOf("":"");
     if (pos == -1) {
      TheApplication().RaiseErrorText(""CZSessionManagement.getInvItemId. incorrect format for external ref"");
    }

    invItemId = externalRef.substring(0, pos); 

  }
  return invItemId;
}
function getOrgId(externalRef) {
  // The format is inv::org
  
  var orgId = """";
  
  if (externalRef == null || externalRef == """") {
    orgId = """";
  }
  else {
    var pos = externalRef.lastIndexOf("":"");
    if (pos == -1) {
      TheApplication().RaiseErrorText(""CZSessionManagement.getOrgId. incorrect format for external ref"");
    }
    orgId = externalRef.substring(pos + 1);
  }
  return orgId;
}
function getSiebelLanguage()
{
	var sblLang = TheApplication().InvokeMethod(""LANGUAGE"");
  return sblLang;
}
function logPs(ps) {

 // TheApplication().Trace("">> "" + ps.GetType() + "" = "" + ps.GetValue());
  var p = ps.GetFirstProperty();
  var v;
  while(p != null && p != """") {

    v = ps.GetProperty(p);
  //  TheApplication().Trace(p + "" = "" + v);
    p = ps.GetNextProperty();
  }
  var cCount = ps.GetChildCount();
 // TheApplication().Trace(""#c = "" + cCount);
  var c = null; 
  for (var i=0; i < cCount; i++) {
	  c = ps.GetChild(i);
      logPs(c);
  }
}
function searchChild(Inputs, Outputs) {
 // TheApplication().Trace("">> "" + Inputs.GetType() + "" = "" + Inputs.GetValue());
  var ps = Inputs.GetChild(0);


  var searchFor = Inputs.GetValue();
  var cCount = ps.GetChildCount();

  var c = null; 
  for (var i=0; i < cCount; i++) {
	c = ps.GetChild(i);
    var candidate = c.GetType();
    if (candidate == searchFor) {
      Outputs.SetProperty("found"", c.GetValue());
      return;
    }
  }

}
function setBPELProperties(siebelUser, siebelBusinsessUnit, xmlMsgPS){
	// The BPEL calls to get key init message content
  // specifically the OU,Resp,Language
  // The operating unit is not used because
  // it will be available in external inventory item id
  // column and will be retrieved from there
  
  //TODO - figure out a way to get the language
  //TheApplication().TraceOn(""d:\\temp\\setBPELProperties.txt"", ""Allocation"", ""All"");
  var isiebellang = getSiebelLanguage(); 
  
  var bpelInput = TheApplication().NewPropertySet ();
  var bpelOutput = TheApplication().NewPropertySet ();

  bpelInput.SetProperty (""InputSiebelLang"", isiebellang);
  //bpelInput.SetProperty (""InputSiebelBU"", siebelBusinsessUnit);
  bpelInput.SetProperty(""InputSiebelUser"",siebelUser);
  
  //TheApplication().Trace(""Passed 1"");
  
  bpelOutput = doOracleUserRespOULangLookup(bpelInput);
  
  //TheApplication().Trace(""Passed 2"");  
  
  var oracleresp = bpelOutput.GetProperty(""OutputOracleResp"");
  var oraclelang = bpelOutput.GetProperty(""OutputOracleLang"");
  var oracleuser = bpelOutput.GetProperty(""OutputOracleUser"");
  var oracleOU = bpelOutput.GetProperty(""OutputOracleOU"");
  
  //TheApplication().Trace(""oracleresp = "" + oracleresp);
  //TheApplication().Trace(""OutputOracleLang = "" + oraclelang);
  //TheApplication().Trace(""OutputOracleUser = "" + oracleuser);
  //TheApplication().Trace(""oracleOU = "" + oracleOU);
  
  
  xmlMsgPS.SetProperty(S_LANGUAGE,oraclelang);
  xmlMsgPS.SetProperty(S_RESP_ID, oracleresp);
  xmlMsgPS.SetProperty(S_OU_ID, oracleOU);
	//TheApplication().TraceOff();
	
}
function updateRunId() {
    if (RUN_ID==null) RUN_ID = 1;
    else RUN_ID = RUN_ID + 1;
}
function CallPLSQL(Inputs, Outputs)
{
	var vImptJobId;
    var cmdString;
	vImptJobId = Inputs.GetProperty(""ImportJobId"");
    Clib.sprintf(cmdString, ""C:\\app\\tshaikh\\product\\11.2.0\\client_1\\BIN\\sqlplus.exe ORAFYG101/ORAFYG101@ORAFYG101 @C:\\fs\\callplsql.sql %s"", vImptJobId)    
	Clib.system(cmdString);
	return (ContinueOperation);
}
	
"
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
  CallPLSQL(Inputs, Outputs);    
   return (CancelOperation);	
}
function CheckDupMail(Inputs, Outputs)
{
//Code to check Duplicte records in Responce
	var vConId = Inputs.GetProperty(""ContactId"");
	var RespCount,sSearchExpr;
	var vCampId = Inputs.GetProperty(""CampId"");
	var vPrConId = Inputs.GetProperty(""PrConId"");
	var vAppBO = TheApplication().GetBusObject(""Campaign"");
	var vAppBC = vAppBO.GetBusComp(""Response"");	

	if(vConId != null && vConId != """")
	{

		 sSearchExpr = ""[PR_CON_ID] = '"" + vConId  + ""' AND [SRC_ID] = '"" + vCampId + ""'""; 
	}
	else
	{
		sSearchExpr = ""[PRSP_CON_ID] = '"" + vPrConId  + ""' AND [SRC_ID] = '"" + vCampId + ""'""; 
	}

	vAppBC.SetViewMode(AllView);
	vAppBC.ClearToQuery();
	vAppBC.SetSearchExpr(sSearchExpr);
	vAppBC.ExecuteQuery(ForwardBackward);
	var bExistsRecord = vAppBC.FirstRecord();
	if(bExistsRecord)
			{

				RespCount = ""Y"";
			}
			else
			{
				 RespCount = ""N"";
			}
	Outputs.SetProperty(""RespCount"", RespCount);
}
function CheckExpDate(Inputs, Outputs)
{
		var vCampId = Inputs.GetProperty(""CampaignId"");
		var DateExpired = """";
		var vAppBO = TheApplication().GetBusObject(""Campaign"");
		var vAppBC = vAppBO.GetBusComp(""Campaign"");			
		var sSearchExpr;
		sSearchExpr = ""[Id] = '"" + vCampId + ""'"";
		
		vAppBC.SetViewMode(AllView);
		vAppBC.ClearToQuery();
		vAppBC.SetSearchExpr(sSearchExpr);
		vAppBC.ExecuteQuery(ForwardBackward);
		var dtToCheck = vAppBC.GetFieldValue(""End Date"");

		var dtToday = new Date();
	    dtToday = ToNumber(dtToday.getMonth() + 1) + ""/"" + ToNumber(dtToday.getDate()) + ""/"" + ToNumber(dtToday.getFullYear());
	    dtToday = Date.parse(dtToday);

		dtToCheck = dtToCheck.split(""/"");
        dtToCheck = ToNumber(dtToCheck[0]) + ""/"" + ToNumber(dtToCheck[1]) + ""/"" + ToNumber(dtToCheck[2].substring(0, 4));
        dtToCheck = Date.parse(dtToCheck);

		var iResult = Math.ceil((dtToday - dtToCheck)/86400000);

		if(iResult<0)
		{// Campaign has still not expired
			DateExpired = ""N"";
		}
		else
		{// Campaign has expired
			DateExpired = ""Y"";
		}

		Outputs.SetProperty(""DateExpired"", DateExpired);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	
	try
	{

		if (MethodName == ""CheckExpDate"")
		{
			
			CheckExpDate(Inputs, Outputs);
			return(CancelOperation);
			
		}
		
		if (MethodName == ""CheckDupMail"")
		{
			
			CheckDupMail(Inputs, Outputs);
			return(CancelOperation);
			
		}


		if(MethodName == ""Approval"")
		{

			var vId = Inputs.GetProperty(""CampaignId"");
			var vName = Inputs.GetProperty(""CampaignName"");
			var sID = Inputs.GetProperty(""LoginId"");

			var vAppBO:BusObject = TheApplication().GetBusObject(""FINS Approval"");
			var vAppBC:BusComp = vAppBO.GetBusComp(""FINS Approval Level"");
			var vApplBC:BusComp = vAppBO.GetBusComp(""FINS Approval Stage"");
			//var vCampBO:BusObject = TheApplication().GetBusObject(""UInbox Item Task"");
			//var vInboxItemBC = vCampBO.GetBusComp(""MKTG Approval Process"");	
			//WIPRO.Phase2.11072016 - Commented by TSINGHALC as below cloned BC needs to be invoked
			//var vInboxItemBC:BusComp = vCampBO.GetBusComp(""STC MKTG Approval Process"");

			var svc:Service = TheApplication().GetService(""Workflow Process Manager"");
			var Input:PropertySet = TheApplication().NewPropertySet();
			var Output:PropertySet = TheApplication().NewPropertySet();
	        var sSearchExpr;
			sSearchExpr = ""[Approval Level] = 'Campaign'"";
			vAppBC.SetViewMode(AllView);
			vAppBC.ClearToQuery();
			vAppBC.SetSearchExpr(sSearchExpr);
			vAppBC.ExecuteQuery(ForwardBackward);
			var bExistsRecord = vAppBC.FirstRecord();
			if(bExistsRecord)
			{
				vApplBC.SetViewMode(AllView);
				vApplBC.SetSortSpec(""Created(ASCENDING)"");
				vApplBC.ClearToQuery();
				vApplBC.ExecuteQuery(ForwardBackward);
				var cExistsRecord = vApplBC.FirstRecord();

                if(cExistsRecord)
				{ 
					vApplBC.ActivateField(""Owner Login Id"");
					var vToEmpId = vApplBC.GetFieldValue(""Owner Login Id"");
					Input.SetProperty(""ProcessName"", ""Marketing Approval Process""); 
					Input.SetProperty(""ObjectId"", vId);
					Input.SetProperty(""ObjectStatus"", ""Submit"");
					Input.SetProperty(""ToEmployeeId"", vToEmpId);
					Input.SetProperty(""FromEmployeeId"", sID);
					Input.SetProperty(""InboxTypeName"", ""Campaigns"");
					Input.SetProperty(""InboxName"", vName);
					Input.SetProperty(""BusObjectName"", ""Campaign"");
					Input.SetProperty(""LastPoint"", ""No"");
					svc.InvokeMethod(""RunProcess"", Input, Output);
				}

			}

	//Calling WF
			var vCamBO:BusObject = TheApplication().GetBusObject(""Campaign"");
			var vCamBC:BusComp = vCamBO.GetBusComp(""Campaign"");
						
			var svca:Service = TheApplication().GetService(""Workflow Process Manager"");
			var Inputa:PropertySet = TheApplication().NewPropertySet();
			var Outputa:PropertySet = TheApplication().NewPropertySet();
			
			Inputa.SetProperty(""ProcessName"", ""STC Campaign Mgmt Approval Email WF"");
			Inputa.SetProperty(""Object Id"", vId);
			Inputa.SetProperty(""CampaignId"", vId);

			svca.InvokeMethod(""RunProcess"", Inputa, Outputa);
			
			//End of Calling WF Code 

			var sCampBC:BusComp = TheApplication().GetBusObject(""STC Campaign Thin BO"").GetBusComp(""STC Campaign Thin BC"");
			sCampBC.SetViewMode(AllView);
			sCampBC.SetSearchSpec(""Id"", vId);
			sCampBC.ExecuteQuery(ForwardOnly);
			if (sCampBC.FirstRecord())
			{
				sCampBC.ActivateField(""Approval Status"");
				sCampBC.SetFieldValue(""Approval Status"", ""Submitted"");
				sCampBC.WriteRecord();
			}
//			var sSearchExpr1;
//			sSearchExpr1 = ""[Item Object Id] = '"" + vId + ""' AND [Action] = 'Submit' "";

			//query the BC with search expr
//			vInboxItemBC.SetViewMode(AllView);
	//		vInboxItemBC.SetSortSpec(""Created(ASCENDING)"");
	//	vInboxItemBC.ClearToQuery();
//			vInboxItemBC.SetSearchExpr(sSearchExpr1);
//			vInboxItemBC.ExecuteQuery(ForwardBackward);
//			var IExistsRecord = vInboxItemBC.FirstRecord();
	//		var CountRec =  vInboxItemBC.CountRecords();
//			if(CountRec > 1)
//			{
	//			if(IExistsRecord)
//				{
				 //vInboxItemBC.SetFieldValue(""Item Id"",""Default"");
				 //vInboxItemBC.WriteRecord();
				 //WIPRO.Phase2.11072016 - Commented above code by TSINGHALC as requirement is to delete record
//				 vInboxItemBC.DeleteRecord();
//				}
//			}
      
			
			return(CancelOperation);
			//return (ContinueOperation);

		}
	}

	catch(e)
	{
		throw(e);
	}

	finally 
	{
      vId = null;
	  vName = null;
	  vAppBO = null;
	  vAppBC = null;
	  vApplBC = null;
	 // vCampBO = null;
	  //vInboxItemBC = null;
	 
	  svc = null;
	}



	
}
function CheckDupMail(Inputs, Outputs)
{
//Code to check Duplicte records in Responce
	var vConId = Inputs.GetProperty(""ContactId"");
	var RespCount,sSearchExpr;
	var vCampId = Inputs.GetProperty(""CampId"");
	var vPrConId = Inputs.GetProperty(""PrConId"");
	var vAppBO = TheApplication().GetBusObject(""Campaign"");
	var vAppBC = vAppBO.GetBusComp(""Response"");	

	if(vConId == null || vConId == """")
	{

		 sSearchExpr = ""[S_CAMP_CON_ID] = '"" + vConId  + ""' AND [SRC_ID] = '"" + vCampId + ""'""; 
	}
	else
	{
		sSearchExpr = ""[PR_CON_ID] = '"" + vPrConId  + ""' AND [SRC_ID] = '"" + vCampId + ""'""; 
	}

	vAppBC.SetViewMode(AllView);
	vAppBC.ClearToQuery();
	vAppBC.SetSearchExpr(sSearchExpr);
	vAppBC.ExecuteQuery(ForwardBackward);
	var bExistsRecord = vAppBC.FirstRecord();
	if(bExistsRecord)
			{

				RespCount = ""Y"";
			}
			else
			{
				 RespCount = ""N"";
			}
	Outputs.SetProperty(""RespCount "", RespCount);
}
function CheckExpDate(Inputs, Outputs)
{
		var vCampId = Inputs.GetProperty(""CampaignId"");
		var DateExpired = """";
		var vAppBO = TheApplication().GetBusObject(""Campaign"");
		var vAppBC = vAppBO.GetBusComp(""Campaign"");			
		var sSearchExpr;
		sSearchExpr = ""[Id] = '"" + vCampId + ""'"";
		
		vAppBC.SetViewMode(AllView);
		vAppBC.ClearToQuery();
		vAppBC.SetSearchExpr(sSearchExpr);
		vAppBC.ExecuteQuery(ForwardBackward);
		var dtToCheck = vAppBC.GetFieldValue(""End Date"");

		var dtToday = new Date();
	    dtToday = ToNumber(dtToday.getMonth() + 1) + ""/"" + ToNumber(dtToday.getDate()) + ""/"" + ToNumber(dtToday.getFullYear());
	    dtToday = Date.parse(dtToday);

		dtToCheck = dtToCheck.split(""/"");
        dtToCheck = ToNumber(dtToCheck[0]) + ""/"" + ToNumber(dtToCheck[1]) + ""/"" + ToNumber(dtToCheck[2].substring(0, 4));
        dtToCheck = Date.parse(dtToCheck);

		var iResult = Math.ceil((dtToday - dtToCheck)/86400000);

		if(iResult<0)
		{// Campaign has still not expired
			DateExpired = ""N"";
		}
		else
		{// Campaign has expired
			DateExpired = ""Y"";
		}

		Outputs.SetProperty(""DateExpired"", DateExpired);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	
	try
	{

		if (MethodName == ""CheckExpDate"")
		{
			
			CheckExpDate(Inputs, Outputs);
			return(CancelOperation);
			
		}
		
		if (MethodName == ""CheckDupMail"")
		{
			
			CheckDupMail(Inputs, Outputs);
			return(CancelOperation);
			
		}


		if(MethodName == ""Approval"")
		{

			var vId = Inputs.GetProperty(""BudgetId"");
			var vName = Inputs.GetProperty(""Name"");
			var vTotal = Inputs.GetProperty(""vTotal"");
			var sID = Inputs.GetProperty(""LoginId"");

			var vAppBO:BusObject = TheApplication().GetBusObject(""FINS Approval"");
			var vAppBC:BusComp = vAppBO.GetBusComp(""FINS Approval Level"");
			var vApplBC:BusComp = vAppBO.GetBusComp(""FINS Approval Stage"");
			//var vCampBO:BusObject = TheApplication().GetBusObject(""UInbox Item Task"");
			//var vInboxItemBC = vCampBO.GetBusComp(""MKTG Approval Process"");	
			//WIPRO.Phase2.11072016 - Commented by TSINGHALC as below cloned BC needs to be invoked
			//var vInboxItemBC:BusComp = vCampBO.GetBusComp(""STC MKTG Approval Process"");

			var svc:Service = TheApplication().GetService(""Workflow Process Manager"");
			var Input:PropertySet = TheApplication().NewPropertySet();
			var Output:PropertySet = TheApplication().NewPropertySet();
	        var sSearchExpr;
			sSearchExpr = ""[Approval Level] = 'Campaign Budget'"";
			vAppBC.SetViewMode(AllView);
			vAppBC.ClearToQuery();
			vAppBC.SetSearchExpr(sSearchExpr);
			vAppBC.ExecuteQuery(ForwardBackward);
			var bExistsRecord = vAppBC.FirstRecord();
			if(bExistsRecord)
			{
				vApplBC.SetViewMode(AllView);
				vApplBC.SetSortSpec(""Created(ASCENDING)"");
				vApplBC.ClearToQuery();
				vApplBC.ExecuteQuery(ForwardBackward);
				var cExistsRecord = vApplBC.FirstRecord();

                if(cExistsRecord)
				{ 
					vApplBC.ActivateField(""Owner Login Id"");
					var vToEmpId = vApplBC.GetFieldValue(""Owner Login Id"");
					Input.SetProperty(""ProcessName"", ""Marketing Approval Process""); 
					Input.SetProperty(""ObjectId"", vId);
					Input.SetProperty(""ObjectStatus"", ""Submit"");
					Input.SetProperty(""ToEmployeeId"", vToEmpId);
					Input.SetProperty(""FromEmployeeId"", sID);
					Input.SetProperty(""InboxTypeName"", ""Budget Requests"");
					Input.SetProperty(""InboxName"", vName);
					Input.SetProperty(""BusObjectName"", ""Marketing Budget Request"");
					Input.SetProperty(""LastPoint"", ""No"");
					svc.InvokeMethod(""RunProcess"", Input, Output);
				}

			}

	//Calling WF
			var vCamBO:BusObject = TheApplication().GetBusObject(""Marketing Budget Request"");
			var vCamBC:BusComp = vCamBO.GetBusComp(""Marketing Budget Requests"");
						
			var svca:Service = TheApplication().GetService(""Workflow Process Manager"");
			var Inputa:PropertySet = TheApplication().NewPropertySet();
			var Outputa:PropertySet = TheApplication().NewPropertySet();
			
			Inputa.SetProperty(""ProcessName"", ""STC Budget Approval Email WF"");
			Inputa.SetProperty(""BudgetId"", vId);
			Inputa.SetProperty(""vTotal"", vTotal);

			svca.InvokeMethod(""RunProcess"", Inputa, Outputa);
			
			//End of Calling WF Code 

			var sCampBC:BusComp = TheApplication().GetBusObject(""STC Marketing Budget Request Thin BO"").GetBusComp(""STC Marketing Budget Requests Thin BC"");
			sCampBC.SetViewMode(AllView);
			sCampBC.SetSearchSpec(""Id"", vId);
			sCampBC.ExecuteQuery(ForwardOnly);
			if (sCampBC.FirstRecord())
			{
				sCampBC.ActivateField(""Approval Status"");
				sCampBC.SetFieldValue(""Approval Status"", ""Submitted"");
				sCampBC.WriteRecord();
			}
//			var sSearchExpr1;
//			sSearchExpr1 = ""[Item Object Id] = '"" + vId + ""' AND [Action] = 'Submit' "";

			//query the BC with search expr
//			vInboxItemBC.SetViewMode(AllView);
	//		vInboxItemBC.SetSortSpec(""Created(ASCENDING)"");
	//	vInboxItemBC.ClearToQuery();
//			vInboxItemBC.SetSearchExpr(sSearchExpr1);
//			vInboxItemBC.ExecuteQuery(ForwardBackward);
//			var IExistsRecord = vInboxItemBC.FirstRecord();
	//		var CountRec =  vInboxItemBC.CountRecords();
//			if(CountRec > 1)
//			{
	//			if(IExistsRecord)
//				{
				 //vInboxItemBC.SetFieldValue(""Item Id"",""Default"");
				 //vInboxItemBC.WriteRecord();
				 //WIPRO.Phase2.11072016 - Commented above code by TSINGHALC as requirement is to delete record
//				 vInboxItemBC.DeleteRecord();
//				}
//			}
      
			
			return(CancelOperation);
			//return (ContinueOperation);

		}
	}

	catch(e)
	{
		throw(e);
	}

	finally 
	{
      vId = null;
	  vName = null;
	  vAppBO = null;
	  vAppBC = null;
	  vApplBC = null;
	 // vCampBO = null;
	  //vInboxItemBC = null;
	 
	  svc = null;
	}



	
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""GetLanguageCodeFromMapping"")
	{
		var sRequestSiteID = """";
		sRequestSiteID = Inputs.GetProperty(""RequestSiteID"");
		switch(sRequestSiteID)
		{
			case ""0"":
				Outputs.SetProperty (""LanguageCode"", ""ENU"");
				break;
			case ""101"":
				Outputs.SetProperty (""LanguageCode"", ""ITA"");
				break;
			case ""71"":
				Outputs.SetProperty (""LanguageCode"", ""FRA"");
				break;
			case ""123"":
				Outputs.SetProperty (""LanguageCode"", ""NLB"");
				break;
			/*case ""15"":
				Outputs.SetProperty (""LanguageCode"", ""ENA"");
				break;*/
			case ""218"":
				Outputs.SetProperty (""LanguageCode"", ""SVE"");
				break;
			default:				
				Outputs.SetProperty (""LanguageCode"", ""ENU"");
				break;
		}
		return CancelOperation;
	}		
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if(MethodName == ""Resubmit"")
	{
		Resubmit();
		return(CancelOperation);    
	}
	else
    {    
		return(ContinueOperation);
    }
}
function trim(s) {
var r=/\b(.*)\b/.exec(s);
return (r==null)?"""":r[1];
}




function Resubmit()
{
	var MRowId="""";

	/*	WIPRO-Upgrade-02.05.2016-TSINGHALC - Gets the Filename along with Filepath from LOV Description	*/
	
	var svc = TheApplication().GetService(""STC Get Filename"");
	var Inputs = TheApplication().NewPropertySet();
	var Outputs = TheApplication().NewPropertySet();
	Inputs.SetProperty(""Type"",""STC_FILE_NAME"");
	Inputs.SetProperty(""LIC"",""STC_BULK_TERMINATION"");
	svc.InvokeMethod(""STC Get LOV Desc"", Inputs, Outputs);
	var filepath = Outputs.GetProperty(""Description"");
	
	var file = Clib.fopen(filepath, ""rt"");
	
	/* WIPRO-Upgrade-02.05.2016-TSINGHALC - Commented the below line as the filename is received from the above lines by invoking the Generic BS */

	//var file=Clib.fopen(""/siebelfs/hout.csv"", ""rt"");

	if (file==null)
    {
		TheApplication().RaiseErrorText(""Error in opening the file"");
    }
	else
    {
		while(!Clib.feof(file))
        {

			MRowId = (Clib.fgets(file));  
			MRowId = trim(MRowId);
			var MInputs = TheApplication().NewPropertySet();
			var MOutputs = TheApplication().NewPropertySet();

			MInputs.SetProperty(""Object Id"",MRowId);    
			MInputs.SetProperty(""ResolutionCode"",""Level 2: Bar Outgoing Calls"");
			MInputs.SetProperty(""ProcessName"",""STC Billing Resolution Test"");

			var MWorkflowProc = TheApplication().GetService(""Workflow Process Manager"");

			MWorkflowProc.InvokeMethod(""RunProcess"", MInputs, MOutputs);

		}
    }
	MOutputs=null;
	MWorkflowProc=null;
	MInputs=null;
	MRowId=null
	file = null;
	filepath = null;
	Outputs = null;
	Inputs = null;
	svc = null;
}
function Execute(Inputs, Outputs)
{

// Please implement your specific back-office codes here.
// NOTE: The Inputs argument are in the structure of the Credit Check Request Interface Int. Object.
//       You should set your Outputs argument in the structure of teh Credit Check Response Interface Int. Object before returning it to the calling program. 
//
	
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   var ret= CancelOperation;
   
   if (MethodName==""Execute"")
   {
      Execute(Inputs,Outputs);
   }
   else
   {
      TheApplication.ErrorText(""Invalid function name. Valid method name is 'Execute'"");
      ret=ContinueOperation;
   }
   return ret;
}
function Execute(Inputs, Outputs)
{
var ResponseFile;
var OutputFile;
var xmlService;
var Outdata; 
var Indata;
var psInputs2;
var psOutputs2;
var bsFILE;
var psInputs3;
var psOutputs3;
var psInputs4;
var psOutputs4;
var value2;
var child1;
var logfile;
var getType1;
var resultfile;
var envPath;
var envSlash;

if (Clib.getenv(""OS"") == ""Windows_NT"")
{
 envSlash = ""\\"";
} else
{
 envSlash = ""/"";
}

 envPath = Clib.getenv(""REQUEST_ASI_PATH"") + envSlash;

 if ((envPath == (""null"" + envSlash)) || (envPath == envSlash))
 {
	envPath = Clib.getenv(""SIEBEL_HOME"") + envSlash + ""bin"" + envSlash;
 }


 ResponseFile = envPath + ""CreditResponse.xml"";
 OutputFile = envPath + ""CreditOutput.xml"";
 psInputs2 = TheApplication().NewPropertySet();
 psInputs2 = Inputs;
 psOutputs2 = TheApplication().NewPropertySet();
 xmlService 	= TheApplication().GetService(""EAI XML Write to File"");
 psInputs2.SetProperty (""FileName"", OutputFile);
 xmlService.InvokeMethod(""WriteEAIMsg"", psInputs2, psOutputs2);

 resultfile = Clib.fopen(ResponseFile, ""r"");	   
 if (!resultfile)
  {
	 GenerateResults(Outputs);
  } 
 else 
   {
    psInputs4 = TheApplication().NewPropertySet();
	psInputs4.SetProperty(""FileName"", ResponseFile);	
    xmlService = TheApplication().GetService(""EAI XML Read from File"");
    xmlService.InvokeMethod(""ReadEAIMsg"", psInputs4,  Outputs);
   }
 }
function GenerateResults (Outputs)
{
var SysDate = Clib.time();
var ObjDate = Date.fromSystem(SysDate);
var dateStr = (ObjDate.getMonth()+1) + ""/"" + ObjDate.getDate() + ""/2002"";

var SiebelMessage = TheApplication().NewPropertySet();
var ListOfHeader = TheApplication().NewPropertySet();
var CreditHeader = TheApplication().NewPropertySet(); 

CreditHeader.SetProperty(""Error Code"",""0"");
CreditHeader.SetProperty(""Error Text"",""No error!"");
CreditHeader.SetProperty(""Credit Status As Of"",dateStr);
CreditHeader.SetProperty(""Credit Status Code"",""1"");
CreditHeader.SetProperty(""Credit Status Message"",""Credit Okay"");

ListOfHeader.AddChild(CreditHeader);
SiebelMessage.AddChild(ListOfHeader);
Outputs.AddChild(SiebelMessage);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   var ret= CancelOperation;
   
   if (MethodName==""Execute"")
   {
      Execute(Inputs,Outputs);
   }
   else
   {
      TheApplication.ErrorText(""Invalid function name. Valid method name is 'Execute'"");
      ret=ContinueOperation;
   }
   return ret;
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
    CanInvoke = true;
	return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
     if(MethodName == ""Invoke"") 
     {
		var msg = Inputs.GetProperty(""InputMessage"");
		var outMsg = ""What do you mean by "" + msg + ""?"";
		
		var headerContext = Inputs.GetChild(0);
    	var h1 = headerContext.GetChild(0);
    	var h2 = headerContext.GetChild(1);    	
		var callbackLocation = h1.GetValue();
		var correlationId = h2.GetValue();
		outMsg = outMsg + "":"" + callbackLocation + ""/"" + correlationId;
		Outputs.SetProperty(""OutputMessage"", outMsg);
     }
	return (CancelOperation);
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
    CanInvoke = true;
	return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
     if(MethodName == ""StripHeader"") 
     {
        if(Inputs.GetChildCount() > 0)
        {
           Outputs.InsertChildAt(Inputs.GetChild(0), 0);        
           var soapEnv = Outputs.GetChild(0);
           if(soapEnv.GetChildCount() == 2) // headers and body
           {
              var soapHeader = soapEnv.GetChild(0);
              var callBackHeader = soapHeader.GetChild(0);
              if(callBackHeader.GetChildCount() == 2)
              {
                 var headerContext = TheApplication().NewPropertySet();
                 headerContext.SetType(""CustomHeaderContext"");
                 
                 // get the header child property set
                 var callBackLocnHeader = callBackHeader.GetChild(0);
                 var correlationIdHeader = callBackHeader.GetChild(1);
                 headerContext.AddChild(callBackLocnHeader);
                 headerContext.AddChild(correlationIdHeader);
                 soapHeader.RemoveChild(0);
                 Outputs.AddChild(headerContext);
              }
           }
        }
     }
     else if(MethodName == ""AddHeader"") 
     {
        if(Inputs.GetChildCount() > 0)
        {
            Outputs.InsertChildAt(Inputs.GetChild(0), 0);        
          
            var soapEnv = Outputs.GetChild(0);
	        var soapHeader = TheApplication().NewPropertySet();
	        soapHeader.SetType(""soapEnv:Header"");
	        soapHeader.SetProperty(""xmlns:soapEnv"", ""http://schemas.xmlsoap.org/soap/envelope/"");

			var correlationIdHeader = TheApplication().NewPropertySet();	        
			correlationIdHeader.SetType(""CorrelationId"");
	        if(Inputs.GetChildCount() == 2)
	        {
	          // get the correlation id from soap header context
	          var soapHeaderCntxt = Inputs.GetChild(1);
	          var corIdHeader = soapHeaderCntxt.GetChild(0);
	          correlationIdHeader.SetValue(corIdHeader.GetValue());
	        }
	        else
	        {
	          // set default correlation id header
	          correlationIdHeader.SetValue(""30"");
	        }
	        soapHeader.AddChild(correlationIdHeader);
	        soapEnv.InsertChildAt(soapHeader, 0);
        }
     }
     
     else if(MethodName == ""AddPSHeader"") 
     {
        if(Inputs.GetChildCount() > 0)
        {
            Outputs.InsertChildAt(Inputs.GetChild(0), 0);        
          
            var soapEnv = Outputs.GetChild(0);
	        var soapHeader = TheApplication().NewPropertySet();
	        soapHeader.SetType(""PropertySetHeader"");
	        soapHeader.SetProperty(""xmlns:PropertySet"", ""http://www.siebel.com/propertyset"");

			var correlationIdHeader = TheApplication().NewPropertySet();	        
			correlationIdHeader.SetType(""CorrelationId"");
	        if(Inputs.GetChildCount() == 2)
	        {
	          // get the correlation id from soap header context
	          var soapHeaderCntxt = Inputs.GetChild(1);
	          var corIdHeader = soapHeaderCntxt.GetChild(0);
	          correlationIdHeader.SetValue(corIdHeader.GetValue());
	        }
	        else
	        {
	          // set default correlation id header
	          correlationIdHeader.SetValue(""30"");
	        }
	        soapHeader.AddChild(correlationIdHeader);
	        soapEnv.InsertChildAt(soapHeader, 0);
        }
     }
	return (CancelOperation);
}
"//Your public declarations go here...  
"
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new to add atributes
----------------------------------------------------------------------------------------------------------*/
function AddAttributes(Inputs,Outputs)
{
	var app=TheApplication();
	var vNewLineItemId=Inputs.GetProperty(""New Line Item Id"");
	var vAddProdName=Inputs.GetProperty(""Add ProdName"");
	var vSpec,isRecord=false,vAtrName="""",vAtrId="""",isrec=false;
	var lbc=app.GetBusObject(""List Of Values"").GetBusComp(""List Of Values"");
	var oAtr=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Item XA"");
	var pAtr=app.GetBusObject(""ISS CP Loader"").GetBusComp(""Cfg ISS Obj Attributes"");
		
	try
	{
	 	//Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		with(lbc)
		{
			SetViewMode(AllView);
			ActivateField(""Type"");
			ActivateField(""Value"");
			ActivateField(""Name"");
			ActivateField(""Active"");
			ActivateField(""Description"");
			vSpec=""[Type] = 'STC_SASCMS_PRODUCT' AND [Name] = 'MAINPRODUCT' AND [Active] = 'Y'"";
			ClearToQuery();
			SetSearchExpr(vSpec);
			ExecuteQuery(ForwardOnly);
			isRecord=FirstRecord();
			if(isRecord)
			{
				if(vAddProdName == GetFieldValue(""Value""))
				{
					vSpec=""[Type] = 'STC_SASCMS_PRODUCT' AND [Description] = 'ATTRB' AND [Active] = 'Y'"";
					ClearToQuery();
					SetSearchExpr(vSpec);
					ExecuteQuery(ForwardOnly);
					isRecord=FirstRecord();
					while(isRecord)
					{
						vAtrName=GetFieldValue(""Value"");
						with(oAtr)
						{
							//SetViewMode(AllView);
							with(pAtr)
							{
								SetViewMode(AllView);

								ActivateField(""Name"");
								ActivateField(""Last Version"");
								ActivateField(""Id"");
								vSpec=""[Local Name] = '""+ vAtrName + ""' AND [Last Version] = '999999999'"";
								ClearToQuery();
								SetSearchExpr(vSpec);
								ExecuteQuery(ForwardOnly);
								isrec=FirstRecord();
								
								if(isrec)
								{
									vAtrId=GetFieldValue(""Id"");
								}
								else
								{
									UndoRecord();
									app.RaiseErrorText(""No Attribute with name: ""+vAtrName+""\n"");
								}
								
							}
							ActivateField(""Name"");
							ActivateField(""Object Id"");
							ActivateField(""Action Code"");
							ActivateField(""Attribute Id"");
							ActivateField(""Cfg State Code"");
							ActivateField(""Display Name"");
							
							NewRecord(NewAfter);
							SetFieldValue(""Display Name"",vAtrName);
							SetFieldValue(""Name"",vAtrName);
							SetFieldValue(""Object Id"",vNewLineItemId);
							SetFieldValue(""Action Code"",""Add"");
							SetFieldValue(""Attribute Id"",vAtrId);
							SetFieldValue(""Cfg State Code"",""Engine Picked Item"");
							
							WriteRecord();
		
						}
						isRecord=NextRecord();
					}
				}
			}
			else
			{
				app.RaiseErrorText(""No LOV Rec found for Type: STC_SASCMS_PRODUCT , LIC: MAINPRODUCT \n"");
			}
			
		}
		
		
	}
	catch(e)
	{
		with(oAtr)
		{
			ActivateField(""Object Id"");

			SetViewMode(AllView);
			vSpec=""[Object Id] = '""+ vNewLineItemId + ""'"";
			ClearToQuery();
			SetSearchExpr(vSpec);
			ExecuteQuery(ForwardOnly);
			while(FirstRecord())
			{
				DeleteRecord();
			}
		}
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		oAtr.WriteRecord();
	}
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new to add atributes
12/01/2021		1.1   | GURURAJ MADHAVARAO  | Added logic to recieve part num from calling function
											  And added logic to make attributes addition more generic
----------------------------------------------------------------------------------------------------------*/
function AddAttributes(Inputs,Outputs)
{
	var app=TheApplication();
	var vNewLineItemId=Inputs.GetProperty(""New Line Item Id"");
	var vAddProdName=Inputs.GetProperty(""Add ProdName"");
	//Refer comments version 1.1
	var vAddProdPartNum=Inputs.GetProperty(""Add Prod PartNum"");
	var vSpec,isRecord=false,vAtrName="""",vAtrId="""",isrec=false;
	var lbc=app.GetBusObject(""List Of Values"").GetBusComp(""List Of Values"");
	var oAtr=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Item XA"");
	var pAtr=app.GetBusObject(""ISS CP Loader"").GetBusComp(""Cfg ISS Obj Attributes"");
		
	try
	{
	 	//Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		with(lbc)
		{
			SetViewMode(AllView);
			ActivateField(""Type"");
			ActivateField(""Value"");
			ActivateField(""Name"");
			ActivateField(""Active"");
			ActivateField(""Description"");
			ActivateField(""High"");

			vSpec=""[Type] = 'STC_SASCMS_ATTRPROD' AND [Name] LIKE '"" + vAddProdPartNum +""*' AND [Active] = 'Y'"";
			ClearToQuery();
			SetSearchExpr(vSpec);
			ExecuteQuery(ForwardOnly);
			isRecord=FirstRecord();
			while(isRecord)
			{
				vAtrName=GetFieldValue(""High"");
				with(oAtr)
				{
					//SetViewMode(AllView);
					with(pAtr)
					{
						SetViewMode(AllView);

						ActivateField(""Name"");
						ActivateField(""Last Version"");
						ActivateField(""Id"");
						vSpec=""[Local Name] = '""+ vAtrName + ""' AND [Last Version] = '999999999'"";
						ClearToQuery();
						SetSearchExpr(vSpec);
						ExecuteQuery(ForwardOnly);
						isrec=FirstRecord();
							
						if(isrec)
						{
							vAtrId=GetFieldValue(""Id"");
						}
						else
						{
							UndoRecord();
							app.RaiseErrorText(""No Attribute with name: ""+vAtrName+""\n"");
						}
								
					}
					ActivateField(""Name"");
					ActivateField(""Object Id"");
					ActivateField(""Action Code"");
					ActivateField(""Attribute Id"");
					ActivateField(""Cfg State Code"");
					ActivateField(""Display Name"");
						
					NewRecord(NewAfter);
					SetFieldValue(""Display Name"",vAtrName);
					SetFieldValue(""Name"",vAtrName);
					SetFieldValue(""Object Id"",vNewLineItemId);
					SetFieldValue(""Action Code"",""Add"");
					SetFieldValue(""Attribute Id"",vAtrId);
					SetFieldValue(""Cfg State Code"",""Engine Picked Item"");
							
					WriteRecord();
		
				}
				isRecord=NextRecord();
			}
		}
	}

	catch(e)
	{
		with(oAtr)
		{
			ActivateField(""Object Id"");

			SetViewMode(AllView);
			vSpec=""[Object Id] = '""+ vNewLineItemId + ""'"";
			ClearToQuery();
			SetSearchExpr(vSpec);
			ExecuteQuery(ForwardOnly);
			while(FirstRecord())
			{
				DeleteRecord();
			}
		}
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		oAtr.WriteRecord();
	}
}
function AddMultipleProduct(Inputs,Outputs,RCOIS,QBS)
{
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PortItemId,PPath,addprod;
	var PlanNameArray,PlanName;
	var vProdNameArr, vProdName="""", vParProdName="""", vProdArrLen=0;
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");
	var OrderInstance=TheApplication().NewPropertySet();
	var GetRootPOrderIns=TheApplication().NewPropertySet();
	var CheckFlag=false;
	var out2=TheApplication().NewPropertySet();
	var PrevIntegIdArr=new Array();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			vProdName = PlanNameArray[i];
			vProdNameArr = vProdName.split("":"");
			vProdArrLen = vProdNameArr.length;
			if (vProdArrLen > 1)
			{
				vParProdName = vProdNameArr[0];
				vProdName = vProdNameArr[1];
			}
			else{
				vParProdName = """";
			}

			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+vProdName+""'"");
			inp.SetProperty(""Field0"",""Id"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");	

			inp.Reset();
			out.Reset();
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);

			RCOIS.InvokeMethod(""GetInstance"",inp,out);
			if(i==0)
			{
				OrderInstance.AddChild(out.GetChild(0));
			}
			
			GetRootPOrderIns.AddChild(out.GetChild(0));

			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""OrderId"",ordid);
				SetProperty(""LineItemId"",oliid);
				SetProperty(""AddProdId"",addprod);
				SetProperty(""ParentProductName"",vParProdName);
				SetProperty(""Io"",io);
				AddChild(GetRootPOrderIns.GetChild(0));
			}
			
			// To get parent path to add the product	
			GetRootPath(inp,out,PrevIntegIdArr);
			
			with(out){
				if(GetProperty(""Error Code"") != null && GetProperty(""Error Code"") != """"){
					TheApplication().RaiseErrorText(""GetRootPath Function Execption:""+GetProperty(""Error Message""));
				}

				if(GetProperty(""Par Rel Id"") == null || GetProperty(""Par Rel Id"") == ''){
					PortItemId=GetProperty(""Orig Id"");
				}
				else{
					PortItemId=GetProperty(""Par Rel Id"")
				}
				PPath=GetProperty(""ParentPath"");
				CheckFlag=GetProperty(""CheckFlag"");
			}
			
			// Add the product to Order
			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""ObjId"",ordid);
				SetProperty(""RootId"",oliid);
				SetProperty(""Prod Item Id"",addprod);
				SetProperty(""Name"",vProdName);
				SetProperty(""Product Id"",addprod);
				SetProperty(""Port Item Id"",PortItemId);
				SetProperty(""Quantity"",""1"");
				SetProperty(""Parent Path"",PPath);
				SetProperty(""AutoResolve"",""Y"");
			}
	
			try
			{
				if(PortItemId != null && PPath !=null && CheckFlag)
				{
					RCOIS.InvokeMethod(""AddItem"",inp,out);
				}
			}
			catch(a)
			{
				if(a.errCode == 6881438)
				{
					inp.Reset();
					out.Reset();
			
					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);
					inp.SetProperty(""IntObjName"",io);
		
					RCOIS.InvokeMethod(""GetDetailedReqExpl"",inp,out);

					Outputs.SetType(""DetailedExplanation"");
					Outputs.AddChild(out.Copy());
					Outputs.GetChild(j).SetType(""Mismatch ""+j);
					j++;

					inp.Reset();
					out.Reset();

					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);

					RCOIS.InvokeMethod(""RemoveFailedRequests"",inp,out);
				}
			}
	
			GetRootPOrderIns.RemoveChild(0);
		}

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();
		out.Reset();
		
		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""IntObjName"",io);
		inp.AddChild(OrderInstance.GetChild(0).Copy());
		
		if(ordType==""No Provide"")
		{
			CallOrderSyncWF(inp,out,RCOIS);
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""CallOrderSyncWF Function Execption"");
			}
		}
			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new
----------------------------------------------------------------------------------------------------------*/
function AddMultipleProductNonRCOIS(Inputs,Outputs,ESAdp,QBS)
{
	var app=TheApplication();
	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	var out2=app.NewPropertySet();
	//var OrderInstance=app.NewPropertySet();
	var GetRootPOrderIns=app.NewPropertySet();
	
	var PortItemId,PPath,addprod,bAccntId,sAccntId,PId;
	var PlanNameArray,PlanName;
	var vProdNameArr, vProdName="""", vParProdName="""", vProdArrLen=0;
	var PrevIntegIdArr=new Array();
	var vNewOliIds=new Array();
	var CheckFlag=false;
	
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");

	var bc=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Entry - Line Items (Simple)"");
	var oAtr=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Item XA"");

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			vProdName = PlanNameArray[i];
			vProdNameArr = vProdName.split("":"");
			vProdArrLen = vProdNameArr.length;
			if (vProdArrLen > 1)
			{
				vParProdName = vProdNameArr[0];
				vProdName = vProdNameArr[1];
			}
			else{
				vParProdName = """";
			}

			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+vProdName+""'"");
			inp.SetProperty(""Field0"",""Id"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");	

			if( addprod.length <=0)
			{
				app.RaiseErrorText(""No product by name: ""+vProdName+""\n"");
			}

			inp.Reset();
			out.Reset();

			inp.SetProperty(""PrimaryRowId"",ordid);
			inp.SetProperty(""OutputIntObjectName"",io);
			ESAdp.InvokeMethod(""Query"",inp,out);
			/*
			if(i==0)
			{
				OrderInstance.AddChild(out.GetChild(0));
			}*/
			
			GetRootPOrderIns.AddChild(out.GetChild(0));

			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""OrderId"",ordid);
				SetProperty(""LineItemId"",oliid);
				SetProperty(""AddProdId"",addprod);
				SetProperty(""ParentProductName"",vParProdName);
				SetProperty(""Io"",io);
				AddChild(GetRootPOrderIns.GetChild(0));
			}
			
			// To get parent path to add the product	
			GetRootPath(inp,out,PrevIntegIdArr);
			
			with(out){
				if(GetProperty(""Error Code"") != null && GetProperty(""Error Code"") != """"){
					app.RaiseErrorText(""GetRootPath Function Execption:""+GetProperty(""Error Message"") +""\n"");
				}

				if(GetProperty(""Par Rel Id"") == null || GetProperty(""Par Rel Id"") == ''){
					PortItemId=GetProperty(""Orig Id"");
				}
				else{
					PortItemId=GetProperty(""Par Rel Id"")
				}
				PPath=GetProperty(""ParentPath"");
				PId=GetProperty(""ParentId"");
				CheckFlag=GetProperty(""CheckFlag"");
				bAccntId=out.GetProperty(""Billing Account Id"");	
				sAccntId=out.GetProperty(""Service Account Id"");
				if(PortItemId.length <= 0)
				{
						app.RaiseErrorText(""No Port Ids or Relation ship found for the product: ""+vProdName+""\n"");
				}
			}
			
			// Add the product to Order
			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""ObjId"",ordid);
				SetProperty(""RootId"",oliid);
				SetProperty(""Prod Item Id"",addprod);
				SetProperty(""Name"",vProdName);
				SetProperty(""Product Id"",addprod);
				SetProperty(""Port Item Id"",PortItemId);
				SetProperty(""Billing Account Id"",bAccntId);
				SetProperty(""Parent Path"",PPath);
				SetProperty(""Parent Id"",PId);
				SetProperty(""Product Name"",vProdName);
				SetProperty(""Service Account Id"",sAccntId);
			}
			AddNewLineItem(inp,out,QBS);

			vNewOliIds[j]=out.GetProperty(""Id"");
			j++;
			
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
					app.RaiseErrorText(""AddNewLineItem Function Execption:""+out.GetProperty(""Error Message"")+""\n"");
			}
			
			GetRootPOrderIns.RemoveChild(0);
		}
			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);

		//Delete added line items, if any new expception
		for(j=0;j<vNewOliIds.length;j++)
		{
			if( vNewOliIds[j].length > 0 || vNewOliIds[j] != null || vNewOliIds[j] != """")
			{
				with(bc)
				{
					ActivateField(""Id"");
					ActivateField(""Order Header Id"");
					ActivateField(""Action Code"");

					SetViewMode(AllView);
					ClearToQuery();
					SetSearchExpr(""[Id] = '"" +vNewOliIds[j]+""' AND [Order Header Id] = '""+ ordid +""' AND [Action Code] = 'Add'"");
					ExecuteQuery(ForwardOnly);
					if(FirstRecord())
					{
						DeleteRecord();
					}
					with(oAtr)
					{
						ActivateField(""Object Id"");

						SetViewMode(AllView);
						ClearToQuery();
						SetSearchExpr(""[Object Id] = '""+ vNewOliIds[j] + ""'"");
						ExecuteQuery(ForwardOnly);
						while(FirstRecord())
						{
							DeleteRecord();
						}
					}
	
				}
			}
		}
	}
	finally
	{
		bc.WriteRecord();
		oAtr.WriteRecord();
	}
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new
12/01/2021		1.1	  | GURURAJ MADHAVARAO  | Added a new variable vProdPartNum which servers as input for AddNewLineItem 
----------------------------------------------------------------------------------------------------------*/
function AddMultipleProductNonRCOIS(Inputs,Outputs,ESAdp,QBS)
{
	var app=TheApplication();
	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	var out2=app.NewPropertySet();
	//var OrderInstance=app.NewPropertySet();
	var GetRootPOrderIns=app.NewPropertySet();
	
	var PortItemId,PPath,addprod,bAccntId,sAccntId,PId;
	var PlanNameArray,PlanName;
	//Refer Comment version 1.1
	var vProdNameArr, vProdName="""", vParProdName="""", vProdArrLen=0, vProdPartNum="""";
	var PrevIntegIdArr=new Array();
	var vNewOliIds=new Array();
	var CheckFlag=false;
	
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");

	var bc=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Entry - Line Items (Simple)"");
	var oAtr=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Item XA"");

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			vProdName = PlanNameArray[i];
			vProdNameArr = vProdName.split("":"");
			vProdArrLen = vProdNameArr.length;
			if (vProdArrLen > 1)
			{
				vParProdName = vProdNameArr[0];
				vProdName = vProdNameArr[1];
			}
			else{
				vParProdName = """";
			}

			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+vProdName+""'"");
			inp.SetProperty(""Field0"",""Id"");
			//Refer Comment version 1.1
			inp.SetProperty(""Field1"",""Part #"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");
			//Refer Comment version 1.1
			vProdPartNum=out.GetProperty(""Output1"");

			if( addprod.length <=0)
			{
				app.RaiseErrorText(""No product by name: ""+vProdName+""\n"");
			}

			inp.Reset();
			out.Reset();

			inp.SetProperty(""PrimaryRowId"",ordid);
			inp.SetProperty(""OutputIntObjectName"",io);
			ESAdp.InvokeMethod(""Query"",inp,out);
			/*
			if(i==0)
			{
				OrderInstance.AddChild(out.GetChild(0));
			}*/
			
			GetRootPOrderIns.AddChild(out.GetChild(0));

			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""OrderId"",ordid);
				SetProperty(""LineItemId"",oliid);
				SetProperty(""AddProdId"",addprod);
				SetProperty(""ParentProductName"",vParProdName);
				SetProperty(""Io"",io);
				AddChild(GetRootPOrderIns.GetChild(0));
			}
			
			// To get parent path to add the product	
			GetRootPath(inp,out,PrevIntegIdArr);
			
			with(out){
				if(GetProperty(""Error Code"") != null && GetProperty(""Error Code"") != """"){
					app.RaiseErrorText(""GetRootPath Function Execption:""+GetProperty(""Error Message"") +""\n"");
				}

				if(GetProperty(""Par Rel Id"") == null || GetProperty(""Par Rel Id"") == ''){
					PortItemId=GetProperty(""Orig Id"");
				}
				else{
					PortItemId=GetProperty(""Par Rel Id"")
				}
				PPath=GetProperty(""ParentPath"");
				PId=GetProperty(""ParentId"");
				CheckFlag=GetProperty(""CheckFlag"");
				bAccntId=out.GetProperty(""Billing Account Id"");	
				sAccntId=out.GetProperty(""Service Account Id"");
				if(PortItemId.length <= 0)
				{
						app.RaiseErrorText(""No Port Ids or Relation ship found for the product: ""+vProdName+""\n"");
				}
			}
			
			// Add the product to Order
			inp.Reset();
			out.Reset();
			with(inp){
				SetProperty(""ObjId"",ordid);
				SetProperty(""RootId"",oliid);
				SetProperty(""Prod Item Id"",addprod);
				SetProperty(""Name"",vProdName);
				SetProperty(""Product Id"",addprod);
				SetProperty(""Port Item Id"",PortItemId);
				SetProperty(""Billing Account Id"",bAccntId);
				SetProperty(""Parent Path"",PPath);
				SetProperty(""Parent Id"",PId);
				SetProperty(""Product Name"",vProdName);
				//Refer Comment version 1.1
				SetProperty(""Product Part Num"",vProdPartNum);
				SetProperty(""Service Account Id"",sAccntId);
			}
			AddNewLineItem(inp,out,QBS);

			vNewOliIds[j]=out.GetProperty(""Id"");
			j++;
			
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
					app.RaiseErrorText(""AddNewLineItem Function Execption:""+out.GetProperty(""Error Message"")+""\n"");
			}
			
			GetRootPOrderIns.RemoveChild(0);
		}
			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);

		//Delete added line items, if any new expception
		for(j=0;j<vNewOliIds.length;j++)
		{
			if( vNewOliIds[j].length > 0 || vNewOliIds[j] != null || vNewOliIds[j] != """")
			{
				with(bc)
				{
					ActivateField(""Id"");
					ActivateField(""Order Header Id"");
					ActivateField(""Action Code"");

					SetViewMode(AllView);
					ClearToQuery();
					SetSearchExpr(""[Id] = '"" +vNewOliIds[j]+""' AND [Order Header Id] = '""+ ordid +""' AND [Action Code] = 'Add'"");
					ExecuteQuery(ForwardOnly);
					if(FirstRecord())
					{
						DeleteRecord();
					}
					with(oAtr)
					{
						ActivateField(""Object Id"");

						SetViewMode(AllView);
						ClearToQuery();
						SetSearchExpr(""[Object Id] = '""+ vNewOliIds[j] + ""'"");
						ExecuteQuery(ForwardOnly);
						while(FirstRecord())
						{
							DeleteRecord();
						}
					}
	
				}
			}
		}
	}
	finally
	{
		bc.WriteRecord();
		oAtr.WriteRecord();
	}
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new to insert line item
----------------------------------------------------------------------------------------------------------*/
function AddNewLineItem(Inputs,Outputs,QBS)
{
	var app=TheApplication();
	var NewLineItemId;
	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	var bc=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Entry - Line Items (Simple)"");
	try
	{
			//Setting the Error Code and Message for parent function
			Outputs.SetProperty(""Error Message"","""");
			Outputs.SetProperty(""Error Code"","""");
			with(bc)
			{
				ActivateField(""Status"");
				ActivateField(""Cfg State Code"");
				
				NewRecord(NewAfter);
				SetFieldValue(""Order Header Id"",Inputs.GetProperty(""ObjId""));
				SetFieldValue(""Product Id"", Inputs.GetProperty(""Product Id""));   
				SetFieldValue(""Parent Order Item Id"",Inputs.GetProperty(""Parent Id"")); 
				SetFieldValue(""Root Order Item Id"",Inputs.GetProperty(""RootId""));
				SetFieldValue(""Billing Account Id"",Inputs.GetProperty(""Billing Account Id""));
				SetFieldValue(""Service Account Id"",Inputs.GetProperty(""Service Account Id""));
				SetFieldValue(""Product Port Id"",Inputs.GetProperty(""Port Item Id""));
				SetFieldValue(""Cfg State Code"",""User Requested Item"");
				SetFieldValue(""Status"",""In Progress"");
				
				NewLineItemId = GetFieldValue(""Id"");
				
				inp.SetProperty(""New Line Item Id"",NewLineItemId);
				inp.SetProperty(""Add ProdName"",Inputs.GetProperty(""Product Name""));
				
				AddAttributes(inp,out);

				if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
				{
					UndoRecord();
					app.RaiseErrorText(""AddAttributes Function Execption:""+out.GetProperty(""Error Message"")+""\n"");
				}
				//WriteRecord();
  
			}
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		bc.WriteRecord();
		Outputs.SetProperty(""Id"",NewLineItemId);
	}
}
"
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new to insert line item
12/01/2021		1.1   | GURURAJ MADHAVARAO  | Added logic to recieve part num from calling function
----------------------------------------------------------------------------------------------------------*/
function AddNewLineItem(Inputs,Outputs,QBS)
{
	var app=TheApplication();
	var NewLineItemId;
	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	var bc=app.GetBusObject(""Order Entry (Sales)"").GetBusComp(""Order Entry - Line Items (Simple)"");
	try
	{
			//Setting the Error Code and Message for parent function
			Outputs.SetProperty(""Error Message"","""");
			Outputs.SetProperty(""Error Code"","""");
			with(bc)
			{
				ActivateField(""Status"");
				ActivateField(""Cfg State Code"");
				
				NewRecord(NewAfter);
				SetFieldValue(""Order Header Id"",Inputs.GetProperty(""ObjId""));
				SetFieldValue(""Product Id"", Inputs.GetProperty(""Product Id""));   
				SetFieldValue(""Parent Order Item Id"",Inputs.GetProperty(""Parent Id"")); 
				SetFieldValue(""Root Order Item Id"",Inputs.GetProperty(""RootId""));
				SetFieldValue(""Billing Account Id"",Inputs.GetProperty(""Billing Account Id""));
				SetFieldValue(""Service Account Id"",Inputs.GetProperty(""Service Account Id""));
				SetFieldValue(""Product Port Id"",Inputs.GetProperty(""Port Item Id""));
				SetFieldValue(""Cfg State Code"",""User Requested Item"");
				SetFieldValue(""Status"",""In Progress"");
				
				NewLineItemId = GetFieldValue(""Id"");
				
				inp.SetProperty(""New Line Item Id"",NewLineItemId);
				inp.SetProperty(""Add ProdName"",Inputs.GetProperty(""Product Name""));
				//Refer comment version 1.1
				inp.SetProperty(""Add Prod PartNum"",Inputs.GetProperty(""Product Part Num""));
				
				AddAttributes(inp,out);

				if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
				{
					UndoRecord();
					app.RaiseErrorText(""AddAttributes Function Execption:""+out.GetProperty(""Error Message"")+""\n"");
				}
				//WriteRecord();
  
			}
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		bc.WriteRecord();
		Outputs.SetProperty(""Id"",NewLineItemId);
	}
}
"
function AddProduct (Inputs,Outputs)
{
	var ordid=Inputs.GetProperty(""Header"");
	var oliid=Inputs.GetProperty(""Item"");
	var productid=Inputs.GetProperty(""Product"");
	var io=Inputs.GetProperty(""IO"");
	var addprodname=Inputs.GetProperty(""AddProdName"");
	var ordertype=Inputs.GetProperty(""OrderType"");

	var isssvc=TheApplication().GetService(""ISS Copy Service"");
	var rcois=TheApplication().GetService(""Remote Complex Object Instance Service"");
	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

//		Executing ISS Copy to load the current order
		with(inp){
			SetProperty(""ParentObjectId"",ordid);
			SetProperty(""IntegrationObjectName"",io);
			SetProperty(""RootId"",oliid);
			SetProperty(""ProductId"",productid);
			SetProperty(""SearchSpec"",""[Header.Id]='""+ordid+""' AND [Line Item.Root Id]='""+oliid+""'"");
		}
		isssvc.InvokeMethod(""LoadEAI"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""ISS Copy Service Load EAI Execption"");
		}

		inp.Reset();
		out.Reset();

//		Executing RCOIS Load Instance method
		with(inp){
			SetProperty(""IntObjName"",io);
			SetProperty(""ObjId"",ordid);
			SetProperty(""RootId"",oliid);
			SetProperty(""TriggerEvent"",""Y"");
			SetProperty(""Product Id"",productid);
			SetProperty(""ExternalScript"",""Y"");
		}
		rcois.InvokeMethod(""LoadInstance"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Load Instance Execption"");
		}

//		Executing the function UnresolveLinks to resolve the unresolved Links of the order

		var unRLinks=UnresolveLinks(inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			if(out.GetProperty(""Error Code"") != 7668184)
			{
				TheApplication().RaiseErrorText(""UnresolveLinks Function Execption"");
				
			}
		}
		
		if(unRLinks.GetChildCount() > 0)
		{
			inp.AddChild(unRLinks.GetChild(0).Copy());
		}

//		Executing Create Session for order with Links

		if(out.GetProperty(""CreateSession"")==""Y"")
		{
			rcois.InvokeMethod(""CreateSession"",inp,out);
		}
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Create Session Execption"");
		}

		inp.Reset();
		out.Reset();

//		Customize and add multiple products provided in the input to the order
		with(inp){
			SetProperty(""OrderId"",ordid);
			SetProperty(""LineItemId"",oliid);
			SetProperty(""AddProdName"",addprodname);
			SetProperty(""IntObjName"",io);
			SetProperty(""RootProductId"",productid);
			SetProperty(""OrderType"",ordertype);
		}

		AddMultipleProduct(inp,out,rcois,Qbs);
		
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""AddMultipleProduct Function Execption: ""+out.GetProperty(""Error Message""));
		}

		inp.Reset();
		out.Reset();

//		Sync Instance for provide order
		if(ordertype==""Provide"")
		{
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""IntObjName"",io);
			rcois.InvokeMethod(""SyncInstance"",inp,out);
		}

//		Unload Complex product Instance
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""IntObjName"",io);

		rcois.InvokeMethod(""UnloadInstance"",inp,out);
	}
	catch (e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created new
----------------------------------------------------------------------------------------------------------*/
function AddProductNonRCOIS (Inputs,Outputs)
{
	var app=TheApplication();
	var ordid=Inputs.GetProperty(""Header"");
	var oliid=Inputs.GetProperty(""Item"");
	var productid=Inputs.GetProperty(""Product"");
	var io=Inputs.GetProperty(""IO"");
	var addprodname=Inputs.GetProperty(""AddProdName"");
	var ordertype=Inputs.GetProperty(""OrderType"");
	var nonRCOISflg=Inputs.GetProperty(""NonRCOIS"");

	var Qbs=app.GetService(""STC Siebel Operation BS"");
	var ESAdapter=app.GetService(""EAI Siebel Adapter"");

	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.Reset();
		out.Reset();

//		Add multiple products without customize
		with(inp){
			SetProperty(""OrderId"",ordid);
			SetProperty(""LineItemId"",oliid);
			SetProperty(""AddProdName"",addprodname);
			SetProperty(""IntObjName"",io);
			SetProperty(""RootProductId"",productid);
			SetProperty(""OrderType"",ordertype);
		}

		AddMultipleProductNonRCOIS(inp,out,ESAdapter,Qbs);
		
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			app.RaiseErrorText(""AddMultipleProductNonRCOIS Function Execption: ""+out.GetProperty(""Error Message"")+""\n"");
		}

		inp.Reset();
		out.Reset();

	}
	catch (e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
function CallOrderSyncWF(Inputs , Outputs ,RCOIS)
{
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var OrderInstance=TheApplication().NewPropertySet();

	var WBS=TheApplication().GetService(""Workflow Process Manager"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();

		//Convert Modified Order Items to Asset
		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		inp.AddChild(out.GetChild(0).Copy());
		out.Reset();
		DMExecute.InvokeMethod(""Execute"",inp,out);


		var ModifiedAsset=out.GetChild(0).Copy();

		//Convert Original Order Items to Asset
		inp.Reset();
		out.Reset();

		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1.1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		OrderInstance=Inputs.GetChild(0).Copy();
		inp.AddChild(OrderInstance.Copy());
		DMExecute.InvokeMethod(""Execute"",inp,out);

		var OriginalAsset=out.GetChild(0).Copy();
			

		inp.Reset();
		out.Reset();
			
		//Order Header
		inp.SetProperty(""OutputIntObjectName"",io);
		inp.SetProperty(""PrimaryRowId"",ordid);
		inp.SetProperty(""SearchSpec"",""[Header.Id] = '"" +ordid+""' AND [Line Item.Id] = 'SomeBogusId'"");
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);
		var DocHeader=out.GetChild(0).Copy();



		//Sync WF Execution
		inp.Reset();
		out.Reset();
		var inp1=TheApplication().NewPropertySet();

		inp.SetProperty(""ProcessName"",""RCOIS Enhancement Delta Apply WF"");

		inp1.Reset();
		inp1=ModifiedAsset.Copy();
		inp1.SetType(""Modified Asset"");
		inp.AddChild(inp1.Copy());
			
		inp1.Reset();
		inp1=OriginalAsset.Copy();
		inp1.SetType(""Original Asset"");
		inp.AddChild(inp1.Copy());

		inp1.Reset();
		inp1=DocHeader.Copy();
		inp1.SetType(""Document Header"");
		inp.AddChild(inp1.Copy());

		var out2=TheApplication().NewPropertySet();
		inp.SetProperty(""Object Id"",ordid);
		//Sync Flag to sync order
		inp.SetProperty(""Sync"",""Y"");
		inp.SetProperty(""Order Line Item Id"",oliid);
		out2.SetType(""Delta Document"");
		out.AddChild(out2.Copy());
		out2.Reset();

		WBS.InvokeMethod(""RunProcess"",inp,out);


	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}

}
function DeleteMultipleProduct(Inputs,Outputs,RCOIS,QBS)
{
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PortItemId,PPath,addprod;
	var PlanNameArray,PlanName;
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");
	var OrderInstance=TheApplication().NewPropertySet();
	var GetRootPOrderIns=TheApplication().NewPropertySet();
	var CheckFlag=false;
	var out2=TheApplication().NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+PlanNameArray[i]+""'"");
			inp.SetProperty(""Field0"",""Id"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");	

			inp.Reset();
			out.Reset();
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);

			RCOIS.InvokeMethod(""GetInstance"",inp,out);
			if(i==0)
			{
			
				OrderInstance.AddChild(out.GetChild(0));
			}
			
			GetRootPOrderIns.AddChild(out.GetChild(0));


			inp.Reset();
			out.Reset();

			inp.SetProperty(""BusinessObject"",""Order Entry (Sales)"");
			inp.SetProperty(""BusinessComponent"",""Order Entry - Line Items"");
			inp.SetProperty(""SearchExpression"",""[Order Header Id]='""+ordid+""' AND [Product Id]='""+addprod+""'"");
			inp.SetProperty(""Field0"",""Integration Id"");

			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			PPath=out.GetProperty(""Output0"");	

		/*	inp.SetProperty(""OrderId"",ordid);
			inp.SetProperty(""LineItemId"",oliid);
			inp.SetProperty(""AddProdId"",addprod);
			inp.SetProperty(""Io"",io);
			inp.AddChild(GetRootPOrderIns.GetChild(0));
			// To get parent path to add the product	
			GetRootPath(inp,out);
			
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""GetRootPath Function Execption"");
			}

			if(out.GetProperty(""Par Rel Id"") == null || out.GetProperty(""Par Rel Id"") == '')
			{
				PortItemId=out.GetProperty(""Orig Id"");
			}
			else
			{
				PortItemId=out.GetProperty(""Par Rel Id"")
			}
			PPath=out.GetProperty(""ParentPath"");
			CheckFlag=out.GetProperty(""CheckFlag"");
			// Add the product to Order
		*/
			inp.Reset();
			out.Reset();

			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			//inp.SetProperty(""Prod Item Id"",addprod);
			//inp.SetProperty(""Name"",PlanNameArray[i]);
			//inp.SetProperty(""Product Id"",addprod);
			//inp.SetProperty(""Port Item Id"",PortItemId);
			//inp.SetProperty(""Quantity"",""1"");
			inp.SetProperty(""Path"",PPath);
			//inp.SetProperty(""AutoResolve"",""Y"");
	
			try
			{
				if(PPath !=null)
				{
					RCOIS.InvokeMethod(""RemoveItem"",inp,out);
				}
			}
			catch(a)
			{
			
				if(a.errCode == 6881438)
				{
					

					inp.Reset();
					out.Reset();
			
					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);
					inp.SetProperty(""IntObjName"",io);
		
					RCOIS.InvokeMethod(""GetDetailedReqExpl"",inp,out);

					Outputs.SetType(""DetailedExplanation"");
					Outputs.AddChild(out.Copy());
					Outputs.GetChild(j).SetType(""Mismatch ""+j);
					j++;

					inp.Reset();
					out.Reset();

					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);

					RCOIS.InvokeMethod(""RemoveFailedRequests"",inp,out);


					
				}
			}
	
			GetRootPOrderIns.RemoveChild(0);
		}

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();
		out.Reset();
		
		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""IntObjName"",io);
		inp.AddChild(OrderInstance.GetChild(0).Copy());
		
		if(ordType==""No Provide"")
		{
			CallOrderSyncWF(inp,out,RCOIS);
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""CallOrderSyncWF Function Execption"");
			}
		}
		

			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}
}
function DeleteProduct(Inputs,Outputs)
{
	var ordid=Inputs.GetProperty(""Header"");
	var oliid=Inputs.GetProperty(""Item"");
	var productid=Inputs.GetProperty(""Product"");
	var io=Inputs.GetProperty(""IO"");
	var addprodname=Inputs.GetProperty(""AddProdName"");
	var ordertype=Inputs.GetProperty(""OrderType"");

	var isssvc=TheApplication().GetService(""ISS Copy Service"");
	var rcois=TheApplication().GetService(""Remote Complex Object Instance Service"");
	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

//		Executing ISS Copy to load the current order
		inp.SetProperty(""ParentObjectId"",ordid);
		inp.SetProperty(""IntegrationObjectName"",io);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""ProductId"",productid);
		inp.SetProperty(""SearchSpec"",""[Header.Id]='""+ordid+""' AND [Line Item.Root Id]='""+oliid+""'"");
		isssvc.InvokeMethod(""LoadEAI"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""ISS Copy Service Load EAI Execption"");
		}

		inp.Reset();
		out.Reset();

//		Executing RCOIS Load Instance method

		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""TriggerEvent"",""Y"");
		inp.SetProperty(""Product Id"",productid);
		inp.SetProperty(""ExternalScript"",""Y"");
		
		rcois.InvokeMethod(""LoadInstance"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Load Instance Execption"");
		}

//		Executing the function UnresolveLinks to resolve the unresolved Links of the order

		var unRLinks=UnresolveLinks(inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			if(out.GetProperty(""Error Code"") != 7668184)
			{
				TheApplication().RaiseErrorText(""UnresolveLinks Function Execption"");
				
			}
		}
		
		if(unRLinks.GetChildCount() > 0)
		{
			inp.AddChild(unRLinks.GetChild(0).Copy());
		}

//		Executing Create Session for order with Links

		if(out.GetProperty(""CreateSession"")==""Y"")
		{
			rcois.InvokeMethod(""CreateSession"",inp,out);
		}
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Create Session Execption"");
		}

		inp.Reset();
		out.Reset();

//		Customize and add multiple products provided in the input to the order

		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""AddProdName"",addprodname);
		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""RootProductId"",productid);
		inp.SetProperty(""OrderType"",ordertype);

		DeleteMultipleProduct(inp,out,rcois,Qbs);
		
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""Delete MultipleProduct Function Execption"");
		}

		inp.Reset();
		out.Reset();

//		Sync Instance for provide order
		if(ordertype==""Provide"")
		{
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""IntObjName"",io);
			rcois.InvokeMethod(""SyncInstance"",inp,out);
		}
//		Unload Complex product Instance
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""IntObjName"",io);

		rcois.InvokeMethod(""UnloadInstance"",inp,out);


	}
	catch (e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
function GetRootPath (Inputs,Outputs,PrevIntegIdArr)
{
    var orderid, lineitemid, addprod, Io, vParProdName;
    var pName='', SearchSpec="""", checkflag=false, vProdAdminCount=0;
    var doDiscontinue=false;

    var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
    var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
    var QBS=TheApplication().GetService(""STC Siebel Operation BS"");
    with(Inputs)
    {
        orderid=GetProperty(""OrderId"");
        lineitemid=GetProperty(""LineItemId"");
        addprod=GetProperty(""AddProdId"");
        Io=GetProperty(""Io"");
        vParProdName=GetProperty(""ParentProductName"");
    }
    var inp=TheApplication().NewPropertySet();
    var out=TheApplication().NewPropertySet();
    var out1=TheApplication().NewPropertySet();
    var OrderIns=TheApplication().NewPropertySet()
    OrderIns=Inputs.GetChild(0);

    if(vParProdName != null && vParProdName != """"){
        SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced PROD Admin BC.Name]='""+vParProdName+""'"";
    }
    else{
        SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999'"";
    }
    
    try
    {
//      Setting the Error Code and Message for parent function
        Outputs.SetProperty(""Error Message"","""");
        Outputs.SetProperty(""Error Code"","""");

        inp.SetProperty(""SearchSpec"",SearchSpec);
        inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
        //To Get the relation defined in product structure
        ESiebelAdapter.InvokeMethod(""Query"",inp,out);

        var NumChild=out.GetProperty(""NumOutputObjects"");
        
        inp.Reset();
        
        with(inp){
            SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
            SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
            SetProperty(""OrderId"",orderid);
            SetProperty(""RootLineItemId"",lineitemid);
            AddChild(OrderIns.Copy());
            SetProperty(""ProdName"","""");
        }
        
        DMExecute.InvokeMethod(""Execute"",inp,out1);

        for (var i=0;i<NumChild;i++)
        {
            if(!doDiscontinue)
            {
                if(out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChildCount()>0)
                {
                    vProdAdminCount = out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
                    if(vProdAdminCount > 0)
                    {
                        pName=out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetProperty(""Name"");
                    }//end of if(vProdAdminCount > 0)
                }//end of if(out.GetChild(0)...

                    //TheApplication().RaiseErrorText(""pName:""+pName);
                    
                var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
            
                var tmpLineItem;
                for(var k=0;k<tmpChildC;k++)
                {
                    var tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
                    checkflag=false;

                    if(PrevIntegIdArr.length > 0)
                    {
                        try{
                            if(PrevIntegIdArr[addprod] != null && PrevIntegIdArr[addprod] != """" && PrevIntegIdArr[addprod] != ""undefined"")
                            {
                                if(tmpLineItem.GetProperty(""Integration Id"") == PrevIntegIdArr[addprod]){
                                    checkflag = true;
                                }
                            }
                        }
                        catch(e){}
                    }
                    if(vParProdName != null && vParProdName != """"){
                        if(tmpLineItem.GetProperty(""Action Code"") != 'Add')
                            checkflag = true;
                    }

                    //To check whether the product has parent relation id defined 
                    if(pName.length>0 && (out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != null || out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != ''))
                    {
                        if((tmpLineItem.GetProperty(""Name"") == pName) && !(checkflag))
                        {
                            PrevIntegIdArr[addprod] = tmpLineItem.GetProperty(""Integration Id"");
                            with(Outputs){
                                SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
                                SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
                                SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
                                SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
                                SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
								/* [Guru - 14122020] Added for new non RCOIS functions 
								---Start---*/
								SetProperty(""ParentId"",tmpLineItem.GetProperty(""Id""));
								SetProperty(""Billing Account Id"",tmpLineItem.GetProperty(""Billing Account Id""));
								SetProperty(""Service Account Id"",tmpLineItem.GetProperty(""Service Account Id""));
								//---End---
                                SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
                                SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
                                doDiscontinue=true; 
                                SetProperty(""CheckFlag"",doDiscontinue);
                            }         
                            break;
                        }//if((tmpLineItem.GetProp...
                    }//end of if(out.GetChild(0).GetChild(0)...
                    else
                    {//Look for product configured without Class
                        var inp2=TheApplication().NewPropertySet();
                        var out2=TheApplication().NewPropertySet();

                        with(inp2)
                        {
                            SetProperty(""BusinessObject"",""Internal Product"");
                            SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
                            SetProperty(""SearchExpression"",""[VOD Row Id]='""+out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Vod Id"")+""'"");
                            SetProperty(""Field0"",""Name"");
                        }
                        QBS.InvokeMethod(""SiebelQuery"",inp2,out2);
                        pName = out2.GetProperty(""Output0"");

                        if((tmpLineItem.GetProperty(""Name"") == pName) && !(checkflag))
                        {
                            with(Outputs){
                                PrevIntegIdArr[addprod] = tmpLineItem.GetProperty(""Integration Id"");
                                SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
                                SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
                                SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
                                SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
                                SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
								/* [Guru - 14122020] Added for new non RCOIS functions 
								---Start---*/
								SetProperty(""ParentId"",tmpLineItem.GetProperty(""Id""));
								SetProperty(""Billing Account Id"",tmpLineItem.GetProperty(""Billing Account Id""));
								SetProperty(""Service Account Id"",tmpLineItem.GetProperty(""Service Account Id""));
								//---End---
                                SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
                                SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
                                doDiscontinue=true; 
                                SetProperty(""CheckFlag"",doDiscontinue);
                            }        
                            break;
                        }
                        inp2=null;
                        out2=null;
                    }//end of else
                }//end of for(var k=0...
            }//end of if(!doDiscontinue)
            else
            {
                break;
            }
        }//end of for (var i=0;i<NumChild...
    }
    catch(e)
    {
        Outputs.SetProperty(""Error Message"",e.errText);
        Outputs.SetProperty(""Error Code"",e.errCode);
    }
    finally
    {}
}
function GetRootPath (Inputs,Outputs,PrevIntegIdArr)
{
    //[Modified:NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
    var orderid, lineitemid, addprod, Io, vParProdName;
    var pName='', SearchSpec="""", checkflag=false, vProdAdminCount=0;
    var doDiscontinue=false;

    var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
    var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
    var QBS=TheApplication().GetService(""STC Siebel Operation BS"");
    with(Inputs)
    {
        orderid=GetProperty(""OrderId"");
        lineitemid=GetProperty(""LineItemId"");
        addprod=GetProperty(""AddProdId"");
        Io=GetProperty(""Io"");
        vParProdName=GetProperty(""ParentProductName"");
    }
    var inp=TheApplication().NewPropertySet();
    var out=TheApplication().NewPropertySet();
    var out1=TheApplication().NewPropertySet();
    var OrderIns=TheApplication().NewPropertySet()
    OrderIns=Inputs.GetChild(0);

    if(vParProdName != null && vParProdName != """"){//NAVIN:For Multiple Device AddonContract]
        SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced PROD Admin BC.Name]='""+vParProdName+""'"";
    }
    else{
        SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999'"";
    }
    
    try
    {
//      Setting the Error Code and Message for parent function
        Outputs.SetProperty(""Error Message"","""");
        Outputs.SetProperty(""Error Code"","""");

        inp.SetProperty(""SearchSpec"",SearchSpec);
        inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
        //To Get the relation defined in product structure
        ESiebelAdapter.InvokeMethod(""Query"",inp,out);

        var NumChild=out.GetProperty(""NumOutputObjects"");
        
        inp.Reset();
        
        with(inp){
            SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
            SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
            SetProperty(""OrderId"",orderid);
            SetProperty(""RootLineItemId"",lineitemid);
            AddChild(OrderIns.Copy());
            SetProperty(""ProdName"","""");
        }
        
        DMExecute.InvokeMethod(""Execute"",inp,out1);

        for (var i=0;i<NumChild;i++)
        {
            if(!doDiscontinue)
            {
                if(out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChildCount()>0)
                {
                    vProdAdminCount = out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
                    if(vProdAdminCount > 0)
                    {
                        pName=out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetProperty(""Name"");
                    }//end of if(vProdAdminCount > 0)
                    else
                    {//[NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
                        pName = """";
                    }
                }//end of if(out.GetChild(0)...

                    //TheApplication().RaiseErrorText(""pName:""+pName);
                    
                var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
            
                var tmpLineItem;
                for(var k=0;k<tmpChildC;k++)
                {
                    var tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
                    checkflag=false;

                    if(PrevIntegIdArr.length > 0)
                    {
                        try{
                            if(PrevIntegIdArr[addprod] != null && PrevIntegIdArr[addprod] != """" && PrevIntegIdArr[addprod] != ""undefined"")
                            {
                                if(tmpLineItem.GetProperty(""Integration Id"") == PrevIntegIdArr[addprod]){
                                    checkflag = true;
                                }
                            }
                        }
                        catch(e){}
                    }
                    if(vParProdName != null && vParProdName != """")
                    {//[NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
                        var vAction = tmpLineItem.GetProperty(""Action Code"");
                        if(vAction != 'Add' && vAction != null  && vAction != """")
                            checkflag = true;
                    }

                    //To check whether the product has parent relation id defined 
                    if(pName.length>0 && (out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != null && out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != ''))//[NAVIN:08Jun2021:changed || to &&]
                    {
                        if((tmpLineItem.GetProperty(""Name"") == pName) && !(checkflag) && (vParProdName==null || vParProdName=="""" || vParProdName==pName)) //[NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
                        {
                            PrevIntegIdArr[addprod] = tmpLineItem.GetProperty(""Integration Id"");
                            with(Outputs){
                                SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
                                SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
                                SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
                                SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
                                SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
								/* [Guru - 14122020] Added for new non RCOIS functions 
								---Start---*/
								SetProperty(""ParentId"",tmpLineItem.GetProperty(""Id""));
								SetProperty(""Billing Account Id"",tmpLineItem.GetProperty(""Billing Account Id""));
								SetProperty(""Service Account Id"",tmpLineItem.GetProperty(""Service Account Id""));
								//---End---
                                SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
                                SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
                                doDiscontinue=true; 
                                SetProperty(""CheckFlag"",doDiscontinue);
                            }         
                            break;
                        }//if((tmpLineItem.GetProp...
                    }//end of if(out.GetChild(0).GetChild(0)...
                    else
                    {//Look for product configured without Class
                        var inp2=TheApplication().NewPropertySet();
                        var out2=TheApplication().NewPropertySet();

                        with(inp2)
                        {
                            SetProperty(""BusinessObject"",""Internal Product"");
                            SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
                            SetProperty(""SearchExpression"",""[VOD Row Id]='""+out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Vod Id"")+""'"");
                            SetProperty(""Field0"",""Name"");
                        }
                        QBS.InvokeMethod(""SiebelQuery"",inp2,out2);
                        pName = out2.GetProperty(""Output0"");

                        if((tmpLineItem.GetProperty(""Name"") == pName) && !(checkflag) && (vParProdName==null || vParProdName=="""" || vParProdName==pName)) //[NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
                        {
                            with(Outputs){
                                PrevIntegIdArr[addprod] = tmpLineItem.GetProperty(""Integration Id"");
                                SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
                                SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
                                SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
                                SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
                                SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
								/* [Guru - 14122020] Added for new non RCOIS functions 
								---Start---*/
								SetProperty(""ParentId"",tmpLineItem.GetProperty(""Id""));
								SetProperty(""Billing Account Id"",tmpLineItem.GetProperty(""Billing Account Id""));
								SetProperty(""Service Account Id"",tmpLineItem.GetProperty(""Service Account Id""));
								//---End---
                                SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
                                SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
                                doDiscontinue=true; 
                                SetProperty(""CheckFlag"",doDiscontinue);
                            }        
                            break;
                        }
                        inp2=null;
                        out2=null;
                    }//end of else
                }//end of for(var k=0...
            }//end of if(!doDiscontinue)
            else
            {
                break;
            }
        }//end of for (var i=0;i<NumChild...
    }
    catch(e)
    {
        Outputs.SetProperty(""Error Message"",e.errText);
        Outputs.SetProperty(""Error Code"",e.errCode);
    }
    finally
    {//[NAVIN:08Jun2021:MPOS Multiple Device AddonContract Issue Fix]
        ESiebelAdapter=null;
        DMExecute=null;
        QBS=null;
        inp=null;
        out=null;
        out1=null;
        OrderIns=null;
    }
}
"/**********************************************************************************************************
Purpose 		: Function Add Product Non RCOIS/ No Customize
Author 			: GURURAJ MADHAVARAO
Change Log		: New function to log error messages
***********************************************************************************************************
Date(DD/MM/YYYY)	| By		| Description of Change																		
-----------------------------------------------------------------------------------------------------------
14/12/2020		1.0   | GURURAJ MADHAVARAO	| Created
----------------------------------------------------------------------------------------------------------*/
function LogErrMsg(Inputs,Outputs)
{
	var app=TheApplication();
	var inp=app.NewPropertySet();
	var out=app.NewPropertySet();
	var logsvc=app.GetService(""STC Generic Error Handler"");

	try
	{
		inp.SetProperty(""Error Code"",Outputs.GetProperty(""Error Code""));
		inp.SetProperty(""Error Message"",Outputs.GetProperty(""Error Message""));
		inp.SetProperty(""Object Id"",Inputs.GetProperty(""Header""));
		inp.SetProperty(""Object Type"",""Order"");
		inp.SetProperty(""Object Name"",""BS-CxProduct AddDelete Generice Service"");
		logsvc.InvokeMethod(""Log Message"",inp,out);
		
	}
	catch(e)
	{
	}
	finally
	{
	}
}
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{

}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
    try
    {
        switch(MethodName)
        {
            case ""AddDeleteProduct"":
                Outputs.SetProperty(""Error Code"",""0000"");
                Outputs.SetProperty(""Error Message"",""Success"");
                if(Inputs.GetProperty(""ActionCode"")==""Add"" && (Inputs.GetProperty(""NonRCOIS"") == null || Inputs.GetProperty(""NonRCOIS"") == """" || Inputs.GetProperty(""NonRCOIS"") == ""N""))
                {
                    AddProduct(Inputs , Outputs);
                }
				/* [Guru - 14122020] Added for new non RCOIS 
				---Start---*/
				else if (Inputs.GetProperty(""ActionCode"")==""Add"" && Inputs.GetProperty(""NonRCOIS"") == ""Y"")
				{
					AddProductNonRCOIS(Inputs , Outputs);
				}
				//---End---
                else if(Inputs.GetProperty(""ActionCode"")==""Delete"")
                {
                    DeleteProduct(Inputs , Outputs);
                }
                if(Outputs.GetProperty(""Error Code"") != null && Outputs.GetProperty(""Error Code"") != """")
                {
					LogErrMsg(Inputs,Outputs);
                    TheApplication().RaiseErrorText(""AddDelete Product Function Execption: ""+Outputs.GetProperty(""Error Message""));
                }
                else
                {
                    Outputs.SetProperty(""Error Code"",""0000"");
                    Outputs.SetProperty(""Error Message"",""Success"");
                }
                return(CancelOperation);
            default:
                return(ContinueOperation);
        }

    }
    catch(e)
    {
        Outputs.SetProperty(""Error Code"",e.errCode);
        Outputs.SetProperty(""Error Message"",e.errText);
    }
    finally
    {
        //Inputs.Reset();
        //Outputs.Reset();
    }
    return (ContinueOperation);
}
function UnresolveLinks(Inputs,Outputs)
{
	var i=0;
	var tmp=0;
	var name;
	var cnt;
	var UnrsvLinks=TheApplication().NewPropertySet();
	var Out=TheApplication().NewPropertySet();
	Out=Outputs;

	var inp2=TheApplication().NewPropertySet();
	var out2=TheApplication().NewPropertySet();

	var result=TheApplication().NewPropertySet();

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");

	var bo="""",bc="""",sspec="""",ordid="""",oliid="""",field="""",idval="""";

	ordid=Inputs.GetProperty(""ObjId"");
	oliid=Inputs.GetProperty(""RootId"")

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		for(i=0;i<Outputs.GetChildCount();i++)
		{
			if (Outputs.GetChild(i).GetType()==""UnresolvedLinks"")
			{
				UnrsvLinks=Outputs.GetChild(i);
			}
			if (Outputs.GetChild(i).GetType()==""Links"")
			{
				result.AddChild(Outputs.GetChild(i).Copy());
			}
		}
		cnt=UnrsvLinks.GetChildCount();
		//Resolving the unresolved links for createsession
		for(i=0;i<UnrsvLinks.GetChildCount();i++)
		{
			//inp2.SetProperty(""BusinessComponent"",UnrsvLinks.GetChild(i).GetProperty(""BusComp""));
			bc=UnrsvLinks.GetChild(i).GetProperty(""BusComp"");
			bo=UnrsvLinks.GetChild(i).GetProperty(""BusObj"");
			sspec=UnrsvLinks.GetChild(i).GetProperty(""SEARCH_SPEC"");
			field=UnrsvLinks.GetChild(i).GetProperty(""Field"");
			idval=UnrsvLinks.GetChild(i).GetProperty(""ID"");

			if(bc==""Order Entry - Line Items"")
			{				
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			else if (bc==""Order Entry - Orders"")
			{

				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);

			}
			else
			{
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			inp2.SetProperty(""Field0"",field);
			Qbs.InvokeMethod(""SiebelQuery"",inp2,out2);

			result.GetChild(0).SetProperty(idval,out2.GetProperty(""Output0""));

			inp2.Reset();
			out2.Reset();
		
		}
		

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
	return result;
}

"
"//Your public declarations go here...  
function AddMultipleProduct(Inputs,Outputs,RCOIS,QBS)
{
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PortItemId,PPath,addprod;
	var PlanNameArray,PlanName;
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");
	var OrderInstance=TheApplication().NewPropertySet();
	var GetRootPOrderIns=TheApplication().NewPropertySet();
	var CheckFlag=false;
	var out2=TheApplication().NewPropertySet();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+PlanNameArray[i]+""'"");
			inp.SetProperty(""Field0"",""Id"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");	

			inp.Reset();
			out.Reset();
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);

			RCOIS.InvokeMethod(""GetInstance"",inp,out);
			if(i==0)
			{
			
				OrderInstance.AddChild(out.GetChild(0));
			}
			
			GetRootPOrderIns.AddChild(out.GetChild(0));


			inp.Reset();
			out.Reset();

			inp.SetProperty(""OrderId"",ordid);
			inp.SetProperty(""LineItemId"",oliid);
			inp.SetProperty(""AddProdId"",addprod);
			inp.SetProperty(""Io"",io);
			inp.AddChild(GetRootPOrderIns.GetChild(0));
			// To get parent path to add the product	
			GetRootPath(inp,out);
			
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""GetRootPath Function Execption"");
			}

			if(out.GetProperty(""Par Rel Id"") == null || out.GetProperty(""Par Rel Id"") == '')
			{
				PortItemId=out.GetProperty(""Orig Id"");
			}
			else
			{
				PortItemId=out.GetProperty(""Par Rel Id"")
			}
			PPath=out.GetProperty(""ParentPath"");
			CheckFlag=out.GetProperty(""CheckFlag"");
			// Add the product to Order
			inp.Reset();
			out.Reset();

			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""Prod Item Id"",addprod);
			inp.SetProperty(""Name"",PlanNameArray[i]);
			inp.SetProperty(""Product Id"",addprod);
			inp.SetProperty(""Port Item Id"",PortItemId);
			inp.SetProperty(""Quantity"",""1"");
			inp.SetProperty(""Parent Path"",PPath);
			inp.SetProperty(""AutoResolve"",""Y"");
	
			try
			{
				if(PortItemId != null && PPath !=null && CheckFlag)
				{
					RCOIS.InvokeMethod(""AddItem"",inp,out);
				}
			}
			catch(a)
			{
			
				if(a.errCode == 6881438)
				{
					

					inp.Reset();
					out.Reset();
			
					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);
					inp.SetProperty(""IntObjName"",io);
		
					RCOIS.InvokeMethod(""GetDetailedReqExpl"",inp,out);

					Outputs.SetType(""DetailedExplanation"");
					Outputs.AddChild(out.Copy());
					Outputs.GetChild(j).SetType(""Mismatch ""+j);
					j++;

					inp.Reset();
					out.Reset();

					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);

					RCOIS.InvokeMethod(""RemoveFailedRequests"",inp,out);


					
				}
			}
	
			GetRootPOrderIns.RemoveChild(0);
		}

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();
		out.Reset();
		
		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""IntObjName"",io);
		inp.AddChild(OrderInstance.GetChild(0).Copy());
		
		if(ordType==""No Provide"")
		{
			CallOrderSyncWF(inp,out,RCOIS);
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""CallOrderSyncWF Function Execption"");
			}
		}
		

			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}
}
"//Your public declarations go here...  
function AddProduct (Inputs,Outputs)
{
	var ordid=Inputs.GetProperty(""Header"");
	var oliid=Inputs.GetProperty(""Item"");
	var productid=Inputs.GetProperty(""Product"");
	var io=Inputs.GetProperty(""IO"");
	var addprodname=Inputs.GetProperty(""AddProdName"");
	var ordertype=Inputs.GetProperty(""OrderType"");

	var isssvc=TheApplication().GetService(""ISS Copy Service"");
	var rcois=TheApplication().GetService(""Remote Complex Object Instance Service"");
	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

//		Executing ISS Copy to load the current order
		inp.SetProperty(""ParentObjectId"",ordid);
		inp.SetProperty(""IntegrationObjectName"",io);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""ProductId"",productid);
		inp.SetProperty(""SearchSpec"",""[Header.Id]='""+ordid+""' AND [Line Item.Root Id]='""+oliid+""'"");
		isssvc.InvokeMethod(""LoadEAI"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""ISS Copy Service Load EAI Execption"");
		}

		inp.Reset();
		out.Reset();

//		Executing RCOIS Load Instance method

		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""TriggerEvent"",""Y"");
		inp.SetProperty(""Product Id"",productid);
		inp.SetProperty(""ExternalScript"",""Y"");
		
		rcois.InvokeMethod(""LoadInstance"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Load Instance Execption"");
		}

//		Executing the function UnresolveLinks to resolve the unresolved Links of the order

		var unRLinks=UnresolveLinks(inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			if(out.GetProperty(""Error Code"") != 7668184)
			{
				TheApplication().RaiseErrorText(""UnresolveLinks Function Execption"");
				
			}
		}
		
		if(unRLinks.GetChildCount() > 0)
		{
			inp.AddChild(unRLinks.GetChild(0).Copy());
		}

//		Executing Create Session for order with Links

		if(out.GetProperty(""CreateSession"")==""Y"")
		{
			rcois.InvokeMethod(""CreateSession"",inp,out);
		}
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Create Session Execption"");
		}

		inp.Reset();
		out.Reset();

//		Customize and add multiple products provided in the input to the order

		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""AddProdName"",addprodname);
		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""RootProductId"",productid);
		inp.SetProperty(""OrderType"",ordertype);

		AddMultipleProduct(inp,out,rcois,Qbs);
		
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""AddMultipleProduct Function Execption"");
		}

		inp.Reset();
		out.Reset();

//		Sync Instance for provide order
		if(ordertype==""Provide"")
		{
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""IntObjName"",io);
			rcois.InvokeMethod(""SyncInstance"",inp,out);
		}
//		Unload Complex product Instance
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""IntObjName"",io);

		rcois.InvokeMethod(""UnloadInstance"",inp,out);


	}
	catch (e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
"//Your public declarations go here...  
function CallOrderSyncWF(Inputs , Outputs ,RCOIS)
{
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var OrderInstance=TheApplication().NewPropertySet();

	var WBS=TheApplication().GetService(""Workflow Process Manager"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();

		//Convert Modified Order Items to Asset
		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		inp.AddChild(out.GetChild(0).Copy());
		out.Reset();
		DMExecute.InvokeMethod(""Execute"",inp,out);


		var ModifiedAsset=out.GetChild(0).Copy();

		//Convert Original Order Items to Asset
		inp.Reset();
		out.Reset();

		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1.1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		OrderInstance=Inputs.GetChild(0).Copy();
		inp.AddChild(OrderInstance.Copy());
		DMExecute.InvokeMethod(""Execute"",inp,out);

		var OriginalAsset=out.GetChild(0).Copy();
			

		inp.Reset();
		out.Reset();
			
		//Order Header
		inp.SetProperty(""OutputIntObjectName"",io);
		inp.SetProperty(""PrimaryRowId"",ordid);
		inp.SetProperty(""SearchSpec"",""[Header.Id] = '"" +ordid+""' AND [Line Item.Id] = 'SomeBogusId'"");
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);
		var DocHeader=out.GetChild(0).Copy();



		//Sync WF Execution
		inp.Reset();
		out.Reset();
		var inp1=TheApplication().NewPropertySet();

		inp.SetProperty(""ProcessName"",""RCOIS Enhancement Delta Apply WF"");

		inp1.Reset();
		inp1=ModifiedAsset.Copy();
		inp1.SetType(""Modified Asset"");
		inp.AddChild(inp1.Copy());
			
		inp1.Reset();
		inp1=OriginalAsset.Copy();
		inp1.SetType(""Original Asset"");
		inp.AddChild(inp1.Copy());

		inp1.Reset();
		inp1=DocHeader.Copy();
		inp1.SetType(""Document Header"");
		inp.AddChild(inp1.Copy());

		var out2=TheApplication().NewPropertySet();
		inp.SetProperty(""Object Id"",ordid);
		//Sync Flag to sync order
		inp.SetProperty(""Sync"",""Y"");
		inp.SetProperty(""Order Line Item Id"",oliid);
		out2.SetType(""Delta Document"");
		out.AddChild(out2.Copy());
		out2.Reset();

		WBS.InvokeMethod(""RunProcess"",inp,out);


	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}

}
"//Your public declarations go here...  
function GetRootPath (Inputs,Outputs)
{
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");

	var orderid=Inputs.GetProperty(""OrderId"");
	var lineitemid=Inputs.GetProperty(""LineItemId"");
	var addprod=Inputs.GetProperty(""AddProdId"");
	var Io=Inputs.GetProperty(""Io"");
	var pName='';
	var doDiscontinue=false;

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var out1=TheApplication().NewPropertySet();
	var OrderIns=TheApplication().NewPropertySet()
	OrderIns=Inputs.GetChild(0);

	
	var SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999'""
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
		//To Get the relation defined in product structure
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);

		var NumChild=out.GetProperty(""NumOutputObjects"");
		
		inp.Reset();
		
		inp.SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
		inp.SetProperty(""OrderId"",orderid);
		inp.SetProperty(""RootLineItemId"",lineitemid);
		inp.AddChild(OrderIns.Copy());
		inp.SetProperty(""ProdName"","""");
		
		DMExecute.InvokeMethod(""Execute"",inp,out1);

		for (var i=0;i<NumChild;i++)
		{
			if(!doDiscontinue)
			{
				pName=out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetProperty(""Name"");
				var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
				
				var tmpLineItem;
				for(var k=0;k<tmpChildC;k++)
				{
					var tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
				//To check whether the product has parent relation id defined 
					if(out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != null || out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != '')
					{ 
						if(tmpLineItem.GetProperty(""Name"")==pName)
						{
							
							Outputs.SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
							Outputs.SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
							Outputs.SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
							Outputs.SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
							Outputs.SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
							Outputs.SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
							Outputs.SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
							doDiscontinue=true;	
							Outputs.SetProperty(""CheckFlag"",doDiscontinue);
										
							break;
						}
						
					}
				}

			}
			else
			{
				break;
			}
		}
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}

}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	try
	{
		switch(MethodName)
		{
			case ""AddProduct"":
				Outputs.SetProperty(""Error Code"",""0000"");
				Outputs.SetProperty(""Error Message"",""Success"");
				AddProduct(Inputs , Outputs);
				if(Outputs.GetProperty(""Error Code"") != null && Outputs.GetProperty(""Error Code"") != """")
				{
					TheApplication().RaiseErrorText(""Add Product Function Execption"");
				}
				else
				{
					Outputs.SetProperty(""Error Code"",""0000"");
					Outputs.SetProperty(""Error Message"",""Success"");
				}
				return(CancelOperation);
			default:
				return(ContinueOperation);
		}

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Code"",e.errCode);
		Outputs.SetProperty(""Error Message"",e.errText);
	}
	finally
	{
		//Inputs.Reset();
		//Outputs.Reset();
	}
	return (ContinueOperation);
}
"//Your public declarations go here...  
function UnresolveLinks(Inputs,Outputs)
{
	var i=0;
	var tmp=0;
	var name;
	var cnt;
	var UnrsvLinks=TheApplication().NewPropertySet();
	var Out=TheApplication().NewPropertySet();
	Out=Outputs;

	var inp2=TheApplication().NewPropertySet();
	var out2=TheApplication().NewPropertySet();

	var result=TheApplication().NewPropertySet();

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");

	var bo="""",bc="""",sspec="""",ordid="""",oliid="""",field="""",idval="""";

	ordid=Inputs.GetProperty(""ObjId"");
	oliid=Inputs.GetProperty(""RootId"")

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		for(i=0;i<Outputs.GetChildCount();i++)
		{
			if (Outputs.GetChild(i).GetType()==""UnresolvedLinks"")
			{
				UnrsvLinks=Outputs.GetChild(i);
			}
			if (Outputs.GetChild(i).GetType()==""Links"")
			{
				result.AddChild(Outputs.GetChild(i).Copy());
			}
		}
		cnt=UnrsvLinks.GetChildCount();
		//Resolving the unresolved links for createsession
		for(i=0;i<UnrsvLinks.GetChildCount();i++)
		{
			//inp2.SetProperty(""BusinessComponent"",UnrsvLinks.GetChild(i).GetProperty(""BusComp""));
			bc=UnrsvLinks.GetChild(i).GetProperty(""BusComp"");
			bo=UnrsvLinks.GetChild(i).GetProperty(""BusObj"");
			sspec=UnrsvLinks.GetChild(i).GetProperty(""SEARCH_SPEC"");
			field=UnrsvLinks.GetChild(i).GetProperty(""Field"");
			idval=UnrsvLinks.GetChild(i).GetProperty(""ID"");

			if(bc==""Order Entry - Line Items"")
			{				
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			else if (bc==""Order Entry - Orders"")
			{

				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);

			}
			else
			{
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			inp2.SetProperty(""Field0"",field);
			Qbs.InvokeMethod(""SiebelQuery"",inp2,out2);

			result.GetChild(0).SetProperty(idval,out2.GetProperty(""Output0""));

			inp2.Reset();
			out2.Reset();
		
		}
		

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
	return result;
}

"
function AddChildProducts(Inputs,Outputs,RCOIS)
{
	var orderid=Inputs.GetProperty(""OrderId"");
	var lineitemid=Inputs.GetProperty(""LineItemId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var portaloid=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""Order Type"");
	var OrderInstance=Inputs.GetChild(0).Copy();

	var WBS=TheApplication().GetService(""Workflow Process Manager"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
	var QBS=TheApplication().GetService(""STC Siebel Operation BS"");

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var inp1=TheApplication().NewPropertySet();
	var out1=TheApplication().NewPropertySet();
	var pName="""",SearchSpec="""",parName="""",prodName="""",prodId="""",parItemId="""",parId="""",origId="""",pparRelId="""",parLineId="""",pLineId="""",PPath="""",PortItemId="""";
	var CheckFlag=false;
	var doDiscontinue=false;

	var cnt=0;

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.AddChild(OrderInstance.Copy());
		inp.SetProperty(""Portal Order Id"",portaloid);
		inp.SetProperty(""Order Id"",orderid);
		inp.SetProperty(""Order Line Id"",lineitemid);
		inp.SetProperty(""Order Type"",Inputs.GetProperty(""Order Type""));

		GetAddedParentPath(inp,out);
		var ParentStruc=out.GetChild(0);

		inp.Reset();
		out.Reset();

		if(OrderType==""No Provide"" && (portaloid !="""" || portaloid != null || typeof(portaloid)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		}
		else if (OrderType==""Provide"" && (portaloid !="""" || portaloid != null || typeof(portaloid)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		//SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND ([Line Item.STC Status] = 'InProgress' OR [Line Item.STC Status] = 'Pending') AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		inp.SetProperty(""SearchSpec"",SearchSpec);
		//To Get the Ecommerce Line Item Structure
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);
		var NumChild=out.GetProperty(""NumOutputObjects"");
		if(out.GetChild(0).GetChild(0).GetChildCount()>=1)
		{
			if(out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
			{
				cnt=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
			}
		}
		if (cnt>=1)
		{
			//TheApplication().RaiseErrorText(""No Child Item"");
		
			for(var i=0;i<cnt;i++)
			{
				PortItemId="""";
				prodName=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
				prodId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Id"");
				parItemId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Parent Order Item Id"");
				pLineId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Portal Line Item Id"");
			//Get the parent item name for the child
				
				inp1.Reset();
				out1.Reset();
	
				inp1.SetProperty(""BusinessObject"",""STC ECommerce Order BO"");
				inp1.SetProperty(""BusinessComponent"",""STC ECom Order Item BC"");
				inp1.SetProperty(""SearchExpression"",""[STC Parent Portal Order Id]='""+portaloid+""' AND [STC Portal Line Item Id]='""+parItemId+""'"");
				inp1.SetProperty(""Field0"",""STC Prod Name"");
				inp1.SetProperty(""Field1"",""STC Prod Id"");
				inp1.SetProperty(""Field2"",""STC Portal Line Item Id"");
		
				QBS.InvokeMethod(""SiebelQuery"",inp1,out1);
				parName=out1.GetProperty(""Output0"");
				parId=out1.GetProperty(""Output1"");
				parLineId=out1.GetProperty(""Output2"");
	
				if(parName ==''||parName==""""||parId ==''||parId=="""")
				{
					TheApplication().RaiseErrorText(""No parent Line Item for the mentioned Child Item"");
				}
			//Get the Relation of the Child product with the parent
				inp1.Reset();
				out1.Reset();
	
				SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+prodId+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced PROD Admin BC.Name]='""+parName+""'"";
				inp1.SetProperty(""SearchSpec"",SearchSpec);
				inp1.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
				ESiebelAdapter.InvokeMethod(""Query"",inp1,out1);
	
				var NumChild1=out1.GetProperty(""NumOutputObjects"");
				if(out1.GetChild(0).GetChild(0).GetChildCount()>=1)
				{
						NumChild1=out1.GetChild(0).GetChild(0).GetChildCount();
	
				}
				if (NumChild1<=0)
				{
					TheApplication().RaiseErrorText(""No Product Relationship"");
				}
				origId="""";pparRelId="""";
				for(var j=0;j<NumChild1;j++)
				{
					if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChildCount()>=1)
					{
						if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChildCount()>=1)
						{
							if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
							{
								if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount() >=1)
								{
									if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
									{
										origId=out1.GetChild(0).GetChild(0).GetChild(j).GetProperty(""Orig Id"");
										pparRelId=out1.GetChild(0).GetChild(0).GetChild(j).GetProperty(""Par Rel Id"");
									}
								}
							}
						}
					}
				}
				if((origId =="""" || origId=='') && (pparRelId =="""" || pparRelId==''))
				{
					inp1.Reset();
					out1.Reset();
		
					inp1.SetProperty(""OrderId"",orderid);
					inp1.SetProperty(""LineItemId"",lineitemid);
					inp1.SetProperty(""AddProdId"",prodId);
					inp1.SetProperty(""Io"",io);
					var tWrapper=TheApplication().NewPropertySet();
					tWrapper.AddChild(OrderInstance.Copy());
					inp1.AddChild(tWrapper.GetChild(0));
					// To get parent path to add the product	
					GetRootPath(inp1,out1);
					
					if(out1.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
					{
						TheApplication().RaiseErrorText(""GetRootPath Function Execption"");
					}
		
					if(out1.GetProperty(""Par Rel Id"") == null || out1.GetProperty(""Par Rel Id"") == '')
					{
						PortItemId=out1.GetProperty(""Orig Id"");
					}
					else
					{
						PortItemId=out1.GetProperty(""Par Rel Id"")
					}
					if (PortItemId==""""||PortItemId==null)
					{
						TheApplication().RaiseErrorText(""No RelationShip for the product"");
					}
					PPath=out1.GetProperty(""ParentPath"");
					CheckFlag=out1.GetProperty(""CheckFlag"");
					//TheApplication().RaiseErrorText(""Null RelationShip IDs"");
					inp1.Reset();
					out1.Reset();
		
					inp1.SetProperty(""ObjId"",orderid);
					inp1.SetProperty(""RootId"",lineitemid);
					inp1.SetProperty(""Prod Item Id"",prodId);
					inp1.SetProperty(""Name"",prodName);
					inp1.SetProperty(""Product Id"",prodId);
					inp1.SetProperty(""Port Item Id"",PortItemId);
					inp1.SetProperty(""Quantity"",""1"");
					inp1.SetProperty(""Parent Path"",PPath);
					inp1.SetProperty(""AutoResolve"",""Y"");
			
					try
					{
						if(PortItemId != null && PPath !=null && CheckFlag)
						{
							RCOIS.InvokeMethod(""AddItem"",inp1,out1);
						}
					}
					catch(a)
					{
					
						if(a.errCode == 6881438)
						{		
							inp1.Reset();
							out1.Reset();
							inp1.SetProperty(""ObjId"",orderid);
							inp1.SetProperty(""RootId"",lineitemid);
							RCOIS.InvokeMethod(""RemoveFailedRequests"",inp1,out1);
						}
					}
				}
				else
				{
					var nCount=ParentStruc.GetChildCount();
					for(var k=0;k<nCount;k++)
					{
						if(ParentStruc.GetChild(k).GetType()==parLineId)
						{
							inp1.Reset();
							out1.Reset();

							inp1.SetProperty(""ObjId"",orderid);
							inp1.SetProperty(""RootId"",lineitemid);
							inp1.SetProperty(""Prod Item Id"",prodId);
							inp1.SetProperty(""Name"",prodName);
							inp1.SetProperty(""Product Id"",prodId);
							if(pparRelId == null || pparRelId == '' ||pparRelId=="""")
							{
								inp1.SetProperty(""Port Item Id"",origId);
								PortItemId=origId;
							}
							else
							{
								inp1.SetProperty(""Port Item Id"",pparRelId);
								PortItemId=pparRelId;
							}
							//inp1.SetProperty(""Port Item Id"",PortItemId);
							inp1.SetProperty(""Quantity"",""1"");
							inp1.SetProperty(""Parent Path"",ParentStruc.GetChild(k).GetProperty(""ParentId""));
							PPath=ParentStruc.GetChild(k).GetProperty(""ParentId"");
							inp1.SetProperty(""AutoResolve"",""Y"");

							try
							{
								if(PortItemId != null && PPath !=null)
								{
									RCOIS.InvokeMethod(""AddItem"",inp1,out1);
								}
							}
							catch(a)
							{

								if(a.errCode == 6881438)
								{
									inp1.Reset();
									out1.Reset();
									inp1.SetProperty(""ObjId"",orderid);
									inp1.SetProperty(""RootId"",lineitemid);
									RCOIS.InvokeMethod(""RemoveFailedRequests"",inp1,out1);
								}
							}
						}
					}
				}
			
			}
		}
		

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
"
function AddChildProducts(Inputs,Outputs,RCOIS)
{
	var orderid=Inputs.GetProperty(""OrderId"");
	var lineitemid=Inputs.GetProperty(""LineItemId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var portaloid=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""Order Type"");
	var OrderInstance=Inputs.GetChild(0).Copy();

	var WBS=TheApplication().GetService(""Workflow Process Manager"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
	var QBS=TheApplication().GetService(""STC Siebel Operation BS"");

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var inp1=TheApplication().NewPropertySet();
	var out1=TheApplication().NewPropertySet();
	var pName="""",SearchSpec="""",parName="""",prodName="""",prodId="""",parItemId="""",parId="""",origId="""",pparRelId="""",parLineId="""",pLineId="""",PPath="""",PortItemId="""";
	var CheckFlag=false;
	var doDiscontinue=false;

	var cnt=0;

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.AddChild(OrderInstance.Copy());
		inp.SetProperty(""Portal Order Id"",portaloid);
		inp.SetProperty(""Order Id"",orderid);
		inp.SetProperty(""Order Line Id"",lineitemid);
		inp.SetProperty(""Order Type"",Inputs.GetProperty(""Order Type""));

		GetAddedParentPath(inp,out);
		var ParentStruc=out.GetChild(0);

		inp.Reset();
		out.Reset();

		if(OrderType==""No Provide"" && (portaloid !="""" || portaloid != null || typeof(portaloid)==""undefined""))
		{
			//SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
			SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		}
		else if (OrderType==""Provide"" && (portaloid !="""" || portaloid != null || typeof(portaloid)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		//SearchSpec=""[Header.STC Portal Order Id] = '""+portaloid+""' AND [Line Item.STC Parent Portal Order Id] = '""+portaloid+""' AND ([Line Item.STC Status] = 'InProgress' OR [Line Item.STC Status] = 'Pending') AND [Line Item.STC Parent Order Item Id] IS NOT NULL"";
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		inp.SetProperty(""SearchSpec"",SearchSpec);
		//To Get the Ecommerce Line Item Structure
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);
		var NumChild=out.GetProperty(""NumOutputObjects"");
		if(out.GetChild(0).GetChild(0).GetChildCount()>=1)
		{
			if(out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
			{
				cnt=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
			}
		}
		if (cnt>=1)
		{
			//TheApplication().RaiseErrorText(""No Child Item"");
		
			for(var i=0;i<cnt;i++)
			{
				PortItemId="""";
				prodName=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
				prodId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Id"");
				parItemId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Parent Order Item Id"");
				pLineId=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Portal Line Item Id"");
			//Get the parent item name for the child
				
				inp1.Reset();
				out1.Reset();
	
				inp1.SetProperty(""BusinessObject"",""STC ECommerce Order BO"");
				inp1.SetProperty(""BusinessComponent"",""STC ECom Order Item BC"");
				inp1.SetProperty(""SearchExpression"",""[STC Parent Portal Order Id]='""+portaloid+""' AND [STC Portal Line Item Id]='""+parItemId+""'"");
				inp1.SetProperty(""Field0"",""STC Prod Name"");
				inp1.SetProperty(""Field1"",""STC Prod Id"");
				inp1.SetProperty(""Field2"",""STC Portal Line Item Id"");
		
				QBS.InvokeMethod(""SiebelQuery"",inp1,out1);
				parName=out1.GetProperty(""Output0"");
				parId=out1.GetProperty(""Output1"");
				parLineId=out1.GetProperty(""Output2"");
	
				if(parName ==''||parName==""""||parId ==''||parId=="""")
				{
					TheApplication().RaiseErrorText(""No parent Line Item for the mentioned Child Item"");
				}
			//Get the Relation of the Child product with the parent
				inp1.Reset();
				out1.Reset();
	
				SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+prodId+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced PROD Admin BC.Name]='""+parName+""'"";
				inp1.SetProperty(""SearchSpec"",SearchSpec);
				inp1.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
				ESiebelAdapter.InvokeMethod(""Query"",inp1,out1);
	
				var NumChild1=out1.GetProperty(""NumOutputObjects"");
				if(out1.GetChild(0).GetChild(0).GetChildCount()>=1)
				{
						NumChild1=out1.GetChild(0).GetChild(0).GetChildCount();
	
				}
				if (NumChild1<=0)
				{
					TheApplication().RaiseErrorText(""No Product Relationship"");
				}
				origId="""";pparRelId="""";
				for(var j=0;j<NumChild1;j++)
				{
					if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChildCount()>=1)
					{
						if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChildCount()>=1)
						{
							if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
							{
								if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount() >=1)
								{
									if(out1.GetChild(0).GetChild(0).GetChild(j).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount()>=1)
									{
										origId=out1.GetChild(0).GetChild(0).GetChild(j).GetProperty(""Orig Id"");
										pparRelId=out1.GetChild(0).GetChild(0).GetChild(j).GetProperty(""Par Rel Id"");
									}
								}
							}
						}
					}
				}
				if((origId =="""" || origId=='') && (pparRelId =="""" || pparRelId==''))
				{
					inp1.Reset();
					out1.Reset();
		
					inp1.SetProperty(""OrderId"",orderid);
					inp1.SetProperty(""LineItemId"",lineitemid);
					inp1.SetProperty(""AddProdId"",prodId);
					inp1.SetProperty(""Io"",io);
					var tWrapper=TheApplication().NewPropertySet();
					tWrapper.AddChild(OrderInstance.Copy());
					inp1.AddChild(tWrapper.GetChild(0));
					// To get parent path to add the product	
					GetRootPath(inp1,out1);
					
					if(out1.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
					{
						TheApplication().RaiseErrorText(""GetRootPath Function Execption"");
					}
		
					if(out1.GetProperty(""Par Rel Id"") == null || out1.GetProperty(""Par Rel Id"") == '')
					{
						PortItemId=out1.GetProperty(""Orig Id"");
					}
					else
					{
						PortItemId=out1.GetProperty(""Par Rel Id"")
					}
					if (PortItemId==""""||PortItemId==null)
					{
						TheApplication().RaiseErrorText(""No RelationShip for the product"");
					}
					PPath=out1.GetProperty(""ParentPath"");
					CheckFlag=out1.GetProperty(""CheckFlag"");
					//TheApplication().RaiseErrorText(""Null RelationShip IDs"");
					inp1.Reset();
					out1.Reset();
		
					inp1.SetProperty(""ObjId"",orderid);
					inp1.SetProperty(""RootId"",lineitemid);
					inp1.SetProperty(""Prod Item Id"",prodId);
					inp1.SetProperty(""Name"",prodName);
					inp1.SetProperty(""Product Id"",prodId);
					inp1.SetProperty(""Port Item Id"",PortItemId);
					inp1.SetProperty(""Quantity"",""1"");
					inp1.SetProperty(""Parent Path"",PPath);
					inp1.SetProperty(""AutoResolve"",""Y"");
			
					try
					{
						if(PortItemId != null && PPath !=null && CheckFlag)
						{
							RCOIS.InvokeMethod(""AddItem"",inp1,out1);
						}
					}
					catch(a)
					{
					
						if(a.errCode == 6881438)
						{		
							inp1.Reset();
							out1.Reset();
							inp1.SetProperty(""ObjId"",orderid);
							inp1.SetProperty(""RootId"",lineitemid);
							RCOIS.InvokeMethod(""RemoveFailedRequests"",inp1,out1);
						}
					}
				}
				else
				{
					var nCount=ParentStruc.GetChildCount();
					for(var k=0;k<nCount;k++)
					{
						if(ParentStruc.GetChild(k).GetType()==parLineId)
						{
							inp1.Reset();
							out1.Reset();

							inp1.SetProperty(""ObjId"",orderid);
							inp1.SetProperty(""RootId"",lineitemid);
							inp1.SetProperty(""Prod Item Id"",prodId);
							inp1.SetProperty(""Name"",prodName);
							inp1.SetProperty(""Product Id"",prodId);
							if(pparRelId == null || pparRelId == '' ||pparRelId=="""")
							{
								inp1.SetProperty(""Port Item Id"",origId);
								PortItemId=origId;
							}
							else
							{
								inp1.SetProperty(""Port Item Id"",pparRelId);
								PortItemId=pparRelId;
							}
							//inp1.SetProperty(""Port Item Id"",PortItemId);
							inp1.SetProperty(""Quantity"",""1"");
							inp1.SetProperty(""Parent Path"",ParentStruc.GetChild(k).GetProperty(""ParentId""));
							PPath=ParentStruc.GetChild(k).GetProperty(""ParentId"");
							inp1.SetProperty(""AutoResolve"",""Y"");

							try
							{
								if(PortItemId != null && PPath !=null)
								{
									RCOIS.InvokeMethod(""AddItem"",inp1,out1);
								}
							}
							catch(a)
							{

								if(a.errCode == 6881438)
								{
									inp1.Reset();
									out1.Reset();
									inp1.SetProperty(""ObjId"",orderid);
									inp1.SetProperty(""RootId"",lineitemid);
									RCOIS.InvokeMethod(""RemoveFailedRequests"",inp1,out1);
								}
							}
						}
					}
				}
			
			}
		}
		

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
"
function AddMultipleProduct(Inputs,Outputs,RCOIS,QBS)
{
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PortItemId,PPath,addprod;
	var PlanNameArray,PlanName;
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var productid=Inputs.GetProperty(""RootProductId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var ordType=Inputs.GetProperty(""OrderType"");
	var OrderInstance=TheApplication().NewPropertySet();
	var GetRootPOrderIns=TheApplication().NewPropertySet();
	var CheckFlag=false;
	var out2=TheApplication().NewPropertySet();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		PlanName=Inputs.GetProperty(""AddProdName"");
		PlanNameArray=PlanName.split("","");
		var j=0;
		var tmpArrL=PlanNameArray.length;

		for(var i=0;i<PlanNameArray.length;i++)
		{
			inp.SetProperty(""BusinessObject"",""Internal Product"");
			inp.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp.SetProperty(""SearchExpression"",""[Name]='""+PlanNameArray[i]+""'"");
			inp.SetProperty(""Field0"",""Id"");
	
			QBS.InvokeMethod(""SiebelQuery"",inp,out);
			addprod=out.GetProperty(""Output0"");	

			inp.Reset();
			out.Reset();
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);

			RCOIS.InvokeMethod(""GetInstance"",inp,out);
			if(i==0)
			{
			
				OrderInstance.AddChild(out.GetChild(0));
			}
			
			GetRootPOrderIns.AddChild(out.GetChild(0));


			inp.Reset();
			out.Reset();

			inp.SetProperty(""OrderId"",ordid);
			inp.SetProperty(""LineItemId"",oliid);
			inp.SetProperty(""AddProdId"",addprod);
			inp.SetProperty(""Io"",io);
			inp.AddChild(GetRootPOrderIns.GetChild(0));
			// To get parent path to add the product	
			GetRootPath(inp,out);
			
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""GetRootPath Function Execption"");
			}

			if(out.GetProperty(""Par Rel Id"") == null || out.GetProperty(""Par Rel Id"") == '')
			{
				PortItemId=out.GetProperty(""Orig Id"");
			}
			else
			{
				PortItemId=out.GetProperty(""Par Rel Id"")
			}
			PPath=out.GetProperty(""ParentPath"");
			CheckFlag=out.GetProperty(""CheckFlag"");
			// Add the product to Order
			inp.Reset();
			out.Reset();

			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""Prod Item Id"",addprod);
			inp.SetProperty(""Name"",PlanNameArray[i]);
			inp.SetProperty(""Product Id"",addprod);
			inp.SetProperty(""Port Item Id"",PortItemId);
			inp.SetProperty(""Quantity"",""1"");
			inp.SetProperty(""Parent Path"",PPath);
			inp.SetProperty(""AutoResolve"",""Y"");
	
			try
			{
				if(PortItemId != null && PPath !=null && CheckFlag)
				{
					RCOIS.InvokeMethod(""AddItem"",inp,out);
				}
			}
			catch(a)
			{
			
				if(a.errCode == 6881438)
				{
					

					inp.Reset();
					out.Reset();
			
					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);
					inp.SetProperty(""IntObjName"",io);
		
					RCOIS.InvokeMethod(""GetDetailedReqExpl"",inp,out);

					Outputs.SetType(""DetailedExplanation"");
					Outputs.AddChild(out.Copy());
					Outputs.GetChild(j).SetType(""Mismatch ""+j);
					j++;

					inp.Reset();
					out.Reset();

					inp.SetProperty(""ObjId"",ordid);
					inp.SetProperty(""RootId"",oliid);

					RCOIS.InvokeMethod(""RemoveFailedRequests"",inp,out);


					
				}
			}
	
			GetRootPOrderIns.RemoveChild(0);
		}

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();
		//out.Reset();
		
		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""Portal Order Id"",Inputs.GetProperty(""Portal Order Id""));
		inp.SetProperty(""Order Type"",ordType);
		inp.AddChild(out.GetChild(0).Copy());
		out.Reset();

		AddChildProducts(inp,out,RCOIS);
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""Add Child Products Function Execption"");
		}

		inp.Reset();
		out.Reset();
		
		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""IntObjName"",io);
		inp.AddChild(OrderInstance.GetChild(0).Copy());
		
		if(ordType==""No Provide"")
		{
			CallOrderSyncWF(inp,out,RCOIS);
			if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
			{
				TheApplication().RaiseErrorText(""CallOrderSyncWF Function Execption"");
			}
		}
		

			
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}
}
function AddProduct (Inputs,Outputs)
{
	var ordid=Inputs.GetProperty(""Header"");
	var oliid=Inputs.GetProperty(""Item"");
	var productid=Inputs.GetProperty(""Product"");
	var io=Inputs.GetProperty(""IO"");
	var addprodname=Inputs.GetProperty(""AddProdName"");
	var ordertype=Inputs.GetProperty(""OrderType"");
	var POrderId=Inputs.GetProperty(""Portal Order Id"");

	var isssvc=TheApplication().GetService(""ISS Copy Service"");
	var rcois=TheApplication().GetService(""Remote Complex Object Instance Service"");
	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

//		Get Plan Comma Seperated List
		GetPlanList(Inputs,Outputs);

		addprodname=Outputs.GetProperty(""Plan List"");

		if(addprodname.length<=0)
		{
			TheApplication().RaiseErrorText(""GetPlanList Function Execption"");
		}


//		Executing ISS Copy to load the current order
		inp.SetProperty(""ParentObjectId"",ordid);
		inp.SetProperty(""IntegrationObjectName"",io);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""ProductId"",productid);
		inp.SetProperty(""SearchSpec"",""[Header.Id]='""+ordid+""' AND [Line Item.Root Id]='""+oliid+""'"");
		isssvc.InvokeMethod(""LoadEAI"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""ISS Copy Service Load EAI Execption"");
		}

		inp.Reset();
		out.Reset();

//		Executing RCOIS Load Instance method

		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""TriggerEvent"",""Y"");
		inp.SetProperty(""Product Id"",productid);
		inp.SetProperty(""ExternalScript"",""Y"");
		
		rcois.InvokeMethod(""LoadInstance"",inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Load Instance Execption"");
		}

//		Executing the function UnresolveLinks to resolve the unresolved Links of the order

		var unRLinks=UnresolveLinks(inp,out);

		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			if(out.GetProperty(""Error Code"") != 7668184)
			{
				TheApplication().RaiseErrorText(""UnresolveLinks Function Execption"");
				
			}
		}
		if(unRLinks.GetChildCount() > 0)
		{
			inp.AddChild(unRLinks.GetChild(0).Copy());
		}

//		Executing Create Session for order with Links

		if(out.GetProperty(""CreateSession"")==""Y"")
		{
			rcois.InvokeMethod(""CreateSession"",inp,out);
		}
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""RCOIS Create Session Execption"");
		}


		inp.Reset();
		out.Reset();

//		Customize and add multiple products provided in the input to the order

		inp.SetProperty(""OrderId"",ordid);
		inp.SetProperty(""LineItemId"",oliid);
		inp.SetProperty(""AddProdName"",addprodname);
		inp.SetProperty(""IntObjName"",io);
		inp.SetProperty(""RootProductId"",productid);
		inp.SetProperty(""OrderType"",ordertype);
		inp.SetProperty(""Portal Order Id"",POrderId);

		AddMultipleProduct(inp,out,rcois,Qbs);
		
		if(out.GetProperty(""Error Code"") != null && out.GetProperty(""Error Code"") != """")
		{
			TheApplication().RaiseErrorText(""AddMultipleProduct Function Execption"");
		}

		inp.Reset();
		out.Reset();

//		Sync Instance for provide order
		if(ordertype==""Provide"")
		{
			inp.SetProperty(""ObjId"",ordid);
			inp.SetProperty(""RootId"",oliid);
			inp.SetProperty(""IntObjName"",io);
			rcois.InvokeMethod(""SyncInstance"",inp,out);
		}
//		Unload Complex product Instance
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);
		inp.SetProperty(""IntObjName"",io);

		rcois.InvokeMethod(""UnloadInstance"",inp,out);


	}
	catch (e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}
function CallOrderSyncWF(Inputs , Outputs ,RCOIS)
{
	var ordid=Inputs.GetProperty(""OrderId"");
	var oliid=Inputs.GetProperty(""LineItemId"");
	var io=Inputs.GetProperty(""IntObjName"");
	var OrderInstance=TheApplication().NewPropertySet();

	var WBS=TheApplication().GetService(""Workflow Process Manager"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.Reset();
		out.Reset();
			
		inp.SetProperty(""ObjId"",ordid);
		inp.SetProperty(""RootId"",oliid);

		RCOIS.InvokeMethod(""GetInstance"",inp,out);

		inp.Reset();

		//Convert Modified Order Items to Asset
		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		inp.AddChild(out.GetChild(0).Copy());
		out.Reset();
		DMExecute.InvokeMethod(""Execute"",inp,out);


		var ModifiedAsset=out.GetChild(0).Copy();

		//Convert Original Order Items to Asset
		inp.Reset();
		out.Reset();

		inp.SetProperty(""MapName"",""RCOIS SIS OM Order to SIS OM Asset v1.1"");
		inp.SetProperty(""OutputIntObjectName"",""SIS OM Asset"");
		OrderInstance=Inputs.GetChild(0).Copy();
		inp.AddChild(OrderInstance.Copy());
		DMExecute.InvokeMethod(""Execute"",inp,out);

		var OriginalAsset=out.GetChild(0).Copy();
			

		inp.Reset();
		out.Reset();
			
		//Order Header
		inp.SetProperty(""OutputIntObjectName"",io);
		inp.SetProperty(""PrimaryRowId"",ordid);
		inp.SetProperty(""SearchSpec"",""[Header.Id] = '"" +ordid+""' AND [Line Item.Id] = 'SomeBogusId'"");
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);
		var DocHeader=out.GetChild(0).Copy();



		//Sync WF Execution
		inp.Reset();
		out.Reset();
		var inp1=TheApplication().NewPropertySet();

		inp.SetProperty(""ProcessName"",""RCOIS Enhancement Delta Apply WF"");

		inp1.Reset();
		inp1=ModifiedAsset.Copy();
		inp1.SetType(""Modified Asset"");
		inp.AddChild(inp1.Copy());
			
		inp1.Reset();
		inp1=OriginalAsset.Copy();
		inp1.SetType(""Original Asset"");
		inp.AddChild(inp1.Copy());

		inp1.Reset();
		inp1=DocHeader.Copy();
		inp1.SetType(""Document Header"");
		inp.AddChild(inp1.Copy());

		var out2=TheApplication().NewPropertySet();
		inp.SetProperty(""Object Id"",ordid);
		//Sync Flag to sync order
		inp.SetProperty(""Sync"",""Y"");
		inp.SetProperty(""Order Line Item Id"",oliid);
		out2.SetType(""Delta Document"");
		out.AddChild(out2.Copy());
		out2.Reset();

		WBS.InvokeMethod(""RunProcess"",inp,out);


	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		
	}

}
function GetAddedParentPath(Inputs,Outputs)
{
	
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");

	var orderid=Inputs.GetProperty(""Order Id"");
	var lineitemid=Inputs.GetProperty(""Order Line Id"");
	var PortalOrderId=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""Order Type"");
	var ESA=TheApplication().GetService(""EAI Siebel Adapter"");
	var SearchSpec=""""
	
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PlanList,tmp,pid,pitemid,val,pName="""";

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	
	var out1=TheApplication().NewPropertySet();
	var OrderIns=TheApplication().NewPropertySet();
	OrderIns=Inputs.GetChild(0);
	try
	{
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		Outputs.SetProperty(""Plan List"","""");

		if(OrderType==""No Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else if (OrderType==""Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		ESA.InvokeMethod(""Query"",inp,out);

		PlanList="""";
		var NumItems=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
		var poutput=out.Copy();

		inp.Reset();
		out.Reset();

		inp.SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
		inp.SetProperty(""OrderId"",orderid);
		inp.SetProperty(""RootLineItemId"",lineitemid);
		inp.AddChild(OrderIns.Copy());
		inp.SetProperty(""ProdName"","""");
		
		DMExecute.InvokeMethod(""Execute"",inp,out1);

		var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();	
		var tmpLineItem,previousId='',p=0,r=0,checkflag=false,checkflag1=false;
		var prevpitemid=new Array();
		var previntegid=new Array();
		var tDetails=TheApplication().NewPropertySet();
		var tWrapper=TheApplication().NewPropertySet();
		for(var k=0;k<tmpChildC;k++)
		{
			tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
			
			for(var i=0;i<NumItems;i++)
			{	
				tmp="""";val="""";
				checkflag=false;
				checkflag1=false;
				tmp=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
				pid=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Id"");
				pitemid=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Portal Line Item Id"");
			
				for(var q=0;q<prevpitemid.length;q++)
				{
					if(pitemid==prevpitemid[q])
						checkflag=true;

				}
				for(var r=0;r<previntegid.length;r++)
				{
					if(tmpLineItem.GetProperty(""Integration Id"")==previntegid[r])
						checkflag1=true;

				}
				if(OrderType==""No Provide"")
				{
					if(tmpLineItem.GetProperty(""Product Id"")==pid &&  tmpLineItem.GetProperty(""Action Code"")==""Add"" && !(checkflag) && !(checkflag1))
					{		
						tDetails.SetType(pitemid);
						tDetails.SetProperty(""PName"",tmp);
						tDetails.SetProperty(""PId"",pid);
						tDetails.SetProperty(""ParentId"",tmpLineItem.GetProperty(""Integration Id""));
						previntegid[r]=tmpLineItem.GetProperty(""Integration Id"");
						r++;
						prevpitemid[p]=pitemid;
						p++;
						tWrapper.AddChild(tDetails.Copy());
					}
				}
				else if(OrderType==""Provide"")
				{
					if(tmpLineItem.GetProperty(""Product Id"")==pid && !(checkflag) && !(checkflag1))
					{		
						tDetails.SetType(pitemid);
						tDetails.SetProperty(""PName"",tmp);
						tDetails.SetProperty(""PId"",pid);
						tDetails.SetProperty(""ParentId"",tmpLineItem.GetProperty(""Integration Id""));
						previntegid[r]=tmpLineItem.GetProperty(""Integration Id"");
						r++;
						prevpitemid[p]=pitemid;
						p++;
						tWrapper.AddChild(tDetails.Copy());
					}
				}
				

			}
			
		}
		Outputs.AddChild(tWrapper.Copy());
		
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}

"
function GetAddedParentPath(Inputs,Outputs)
{
	
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");

	var orderid=Inputs.GetProperty(""Order Id"");
	var lineitemid=Inputs.GetProperty(""Order Line Id"");
	var PortalOrderId=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""Order Type"");
	var ESA=TheApplication().GetService(""EAI Siebel Adapter"");
	var SearchSpec=""""
	
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PlanList,tmp,pid,pitemid,val,pName="""";

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");
	
	var out1=TheApplication().NewPropertySet();
	var OrderIns=TheApplication().NewPropertySet();
	OrderIns=Inputs.GetChild(0);
	try
	{
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		Outputs.SetProperty(""Plan List"","""");

		if(OrderType==""No Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			//SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";

		}
		else if (OrderType==""Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+orderid+""' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		ESA.InvokeMethod(""Query"",inp,out);

		PlanList="""";
		var NumItems=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
		var poutput=out.Copy();

		inp.Reset();
		out.Reset();

		inp.SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
		inp.SetProperty(""OrderId"",orderid);
		inp.SetProperty(""RootLineItemId"",lineitemid);
		inp.AddChild(OrderIns.Copy());
		inp.SetProperty(""ProdName"","""");
		
		DMExecute.InvokeMethod(""Execute"",inp,out1);

		var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();	
		var tmpLineItem,previousId='',p=0,r=0,checkflag=false,checkflag1=false;
		var prevpitemid=new Array();
		var previntegid=new Array();
		var tDetails=TheApplication().NewPropertySet();
		var tWrapper=TheApplication().NewPropertySet();
		for(var k=0;k<tmpChildC;k++)
		{
			tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
			
			for(var i=0;i<NumItems;i++)
			{	
				tmp="""";val="""";
				checkflag=false;
				checkflag1=false;
				tmp=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
				pid=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Id"");
				pitemid=poutput.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Portal Line Item Id"");
			
				for(var q=0;q<prevpitemid.length;q++)
				{
					if(pitemid==prevpitemid[q])
						checkflag=true;

				}
				for(var r=0;r<previntegid.length;r++)
				{
					if(tmpLineItem.GetProperty(""Integration Id"")==previntegid[r])
						checkflag1=true;

				}
				if(OrderType==""No Provide"")
				{
					if(tmpLineItem.GetProperty(""Product Id"")==pid &&  tmpLineItem.GetProperty(""Action Code"")==""Add"" && !(checkflag) && !(checkflag1))
					{		
						tDetails.SetType(pitemid);
						tDetails.SetProperty(""PName"",tmp);
						tDetails.SetProperty(""PId"",pid);
						tDetails.SetProperty(""ParentId"",tmpLineItem.GetProperty(""Integration Id""));
						previntegid[r]=tmpLineItem.GetProperty(""Integration Id"");
						r++;
						prevpitemid[p]=pitemid;
						p++;
						tWrapper.AddChild(tDetails.Copy());
					}
				}
				else if(OrderType==""Provide"")
				{
					if(tmpLineItem.GetProperty(""Product Id"")==pid && !(checkflag) && !(checkflag1))
					{		
						tDetails.SetType(pitemid);
						tDetails.SetProperty(""PName"",tmp);
						tDetails.SetProperty(""PId"",pid);
						tDetails.SetProperty(""ParentId"",tmpLineItem.GetProperty(""Integration Id""));
						previntegid[r]=tmpLineItem.GetProperty(""Integration Id"");
						r++;
						prevpitemid[p]=pitemid;
						p++;
						tWrapper.AddChild(tDetails.Copy());
					}
				}
				

			}
			
		}
		Outputs.AddChild(tWrapper.Copy());
		
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
}

"
function GetPlanList(Inputs,Outputs)
{
	var PortalOrderId=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""OrderType"");
	var ESA=TheApplication().GetService(""EAI Siebel Adapter"");
	var SearchSpec="""";//=Inputs.GetProperty(""SearchSpec"");
	var ordid=Inputs.GetProperty(""Header"");
	
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PlanList,tmp,pcat,ppart,val;

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");


	try
	{
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		Outputs.SetProperty(""Plan List"","""");

		if(OrderType==""No Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else if (OrderType==""Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+ordid+""' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		ESA.InvokeMethod(""Query"",inp,out);

		PlanList="""";
		var NumItems=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
		for(var i=0;i<NumItems;i++)
		{	
			tmp="""";val="""";
			tmp=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
			pcat=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Item Category"");
			ppart=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Part Code"");
			//var test=pcat.search(""Device"");
			
			/*//[NAVIN:27Feb2020:Commented Default Device Insurance Product Addition for Eshop Devices]
			if((pcat.search(""Device""))>=0)
			{
				val=MatchDeviceAndGetIns(Qbs,ppart);
				if(typeof(val)!=""undefined"")
				{
					tmp=tmp+"",""+val;
				}
			}*/
			if(i==0)
				PlanList=tmp;
			else
				PlanList=PlanList+"",""+tmp;

		}
		Outputs.SetProperty(""Plan List"",PlanList);
		
		//SortEcomLineItem(Inputs,Outputs);
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
		Outputs.SetProperty(""Plan List"","""");
	}
	finally
	{

		
	}
}
function GetPlanList(Inputs,Outputs)
{
	var PortalOrderId=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""OrderType"");
	var ESA=TheApplication().GetService(""EAI Siebel Adapter"");
	var SearchSpec="""";//=Inputs.GetProperty(""SearchSpec"");
	var ordid=Inputs.GetProperty(""Header"");
	
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PlanList,tmp,pcat,ppart,val;
	var prodCat="""", prodCatList="""", prodItemCatList="""";

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");


	try
	{
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		Outputs.SetProperty(""Plan List"","""");

		if(OrderType==""No Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			//SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Order CRM Id]='""+ordid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else if (OrderType==""Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+ordid+""' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		ESA.InvokeMethod(""Query"",inp,out);

		PlanList="""";
		var NumItems=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
		for(var i=0;i<NumItems;i++)
		{	
			tmp="""";val="""";
			tmp=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
			prodCat=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Category"");
			pcat=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Item Category"");
			ppart=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Part Code"");
			//var test=pcat.search(""Device"");
			
			/*//[NAVIN:27Feb2020:Commented Default Device Insurance Product Addition for Eshop Devices]
			if((pcat.search(""Device""))>=0)
			{
				val=MatchDeviceAndGetIns(Qbs,ppart);
				if(typeof(val)!=""undefined"")
				{
					tmp=tmp+"",""+val;
				}
			}*/
			if(i==0)
				prodCatList = prodCat;
			else
			{
				if (prodCat == ""Plan"")
					prodCatList = prodCat+"",""+prodCatList;
				else
					prodCatList = prodCatList+"",""+prodCat;
			}
			
			if(i==0)
				prodItemCatList = pcat;
			else
			{
				if (prodCat == ""Plan"")
					prodItemCatList = pcat+"",""+prodItemCatList;
				else
					prodItemCatList = prodItemCatList+"",""+pcat;
			}
			
			if(i==0)
				PlanList=tmp;
			else
			{
				if (prodCat == ""Plan"")
					PlanList=tmp+"",""+PlanList;
				else
					PlanList=PlanList+"",""+tmp;
			}
				

		}
		Outputs.SetProperty(""Plan List"", PlanList);
		Outputs.SetProperty(""ProdCatList"", prodCatList);
		Outputs.SetProperty(""ProdItemCatList"", prodItemCatList);
		//SortEcomLineItem(Inputs,Outputs);
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
		Outputs.SetProperty(""Plan List"","""");
		Outputs.SetProperty(""ProdCatList"", """");
		Outputs.SetProperty(""ProdItemCatList"", """");
	}
	finally
	{

		
	}
}
function GetPlanList(Inputs,Outputs)
{
	var PortalOrderId=Inputs.GetProperty(""Portal Order Id"");
	var OrderType=Inputs.GetProperty(""OrderType"");
	var ESA=TheApplication().GetService(""EAI Siebel Adapter"");
	var SearchSpec="""";//=Inputs.GetProperty(""SearchSpec"");
	var ordid=Inputs.GetProperty(""Header"");
	
	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var PlanList,tmp,pcat,ppart,val;

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");


	try
	{
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");
		Outputs.SetProperty(""Plan List"","""");

		if(OrderType==""No Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			//SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Order CRM Id]='""+ordid+""' AND [Line Item.STC Status] = 'InProgress' AND [Line Item.STC Order Identifier] <> 'Contractual' AND [Line Item.STC Order Identifier] <> 'Pre-Booking' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else if (OrderType==""Provide"" && (PortalOrderId !="""" || PortalOrderId != null || typeof(PortalOrderId)==""undefined""))
		{
			SearchSpec=""[Header.STC Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Parent Portal Order Id] = '""+PortalOrderId+""' AND [Line Item.STC Status] = 'Pending' AND [Line Item.STC Order Identifier] = 'Contractual' AND [Line Item.STC Order CRM Id]='""+ordid+""' AND [Line Item.STC Parent Order Item Id] IS NULL"";
		}
		else
		{
			TheApplication().RaiseErrorText(""Improper input Arguments"");
		}

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""STC ECommerce Order IO"");
		ESA.InvokeMethod(""Query"",inp,out);

		PlanList="""";
		var NumItems=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
		for(var i=0;i<NumItems;i++)
		{	
			tmp="""";val="""";
			tmp=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Name"");
			pcat=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Item Category"");
			ppart=out.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(i).GetProperty(""STC Prod Part Code"");
			//var test=pcat.search(""Device"");
			
			/*//[NAVIN:27Feb2020:Commented Default Device Insurance Product Addition for Eshop Devices]
			if((pcat.search(""Device""))>=0)
			{
				val=MatchDeviceAndGetIns(Qbs,ppart);
				if(typeof(val)!=""undefined"")
				{
					tmp=tmp+"",""+val;
				}
			}*/
			if(i==0)
				PlanList=tmp;
			else
				PlanList=PlanList+"",""+tmp;

		}
		Outputs.SetProperty(""Plan List"",PlanList);
		
		//SortEcomLineItem(Inputs,Outputs);
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
		Outputs.SetProperty(""Plan List"","""");
	}
	finally
	{

		
	}
}
function GetRootPath (Inputs,Outputs)
{
	var ESiebelAdapter=TheApplication().GetService(""EAI Siebel Adapter"");
	var DMExecute=TheApplication().GetService(""EAI Data Transformation Engine"");
	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");

	var orderid=Inputs.GetProperty(""OrderId"");
	var lineitemid=Inputs.GetProperty(""LineItemId"");
	var addprod=Inputs.GetProperty(""AddProdId"");
	var Io=Inputs.GetProperty(""Io"");
	var pName='';
	var doDiscontinue=false;

	var inp=TheApplication().NewPropertySet();
	var out=TheApplication().NewPropertySet();
	var out1=TheApplication().NewPropertySet();
	var OrderIns=TheApplication().NewPropertySet();
	OrderIns=Inputs.GetChild(0);

	
	var SearchSpec=""[RCOIS Enhanced Chid Prd Structure BC.Sub Obj Id]='""+addprod+""' AND [RCOIS Enhanced Chid Prd Structure BC.Last Vers]='999999999' AND [RCOIS Enhanced Parent Prd Structure BC.Par Rel Id] IS NULL AND [RCOIS Enhanced Parent Prd Structure BC.Last Vers]='999999999'""
	
	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		inp.SetProperty(""SearchSpec"",SearchSpec);
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhanced Admin ISS Product Deftn Custom"");
		//To Get the relation defined in product structure
		ESiebelAdapter.InvokeMethod(""Query"",inp,out);

		var NumChild=out.GetProperty(""NumOutputObjects"");
		
		inp.Reset();
		
		inp.SetProperty(""MapName"",""RCOIS Enhanced Parent Path Map v1"");
		inp.SetProperty(""OutputIntObjectName"",""RCOIS Enhancement Line Item IO"");
		inp.SetProperty(""OrderId"",orderid);
		inp.SetProperty(""RootLineItemId"",lineitemid);
		inp.AddChild(OrderIns.Copy());
		inp.SetProperty(""ProdName"","""");
		
		DMExecute.InvokeMethod(""Execute"",inp,out1);

		for (var i=0;i<NumChild;i++)
		{
			if(!doDiscontinue)
			{
				if(out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChildCount()>0)
				{
					pName=out.GetChild(0).GetChild(0).GetChild(i).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetProperty(""Name"");
				}
				var tmpChildC=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChildCount();
				
				var tmpLineItem;
				for(var k=0;k<tmpChildC;k++)
				{
					var tmpLineItem=out1.GetChild(0).GetChild(0).GetChild(0).GetChild(0).GetChild(k);
				//To check whether the product has parent relation id defined 
					if((out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != null || out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id"") != '')&& pName.length>0)
					{ 
						if(tmpLineItem.GetProperty(""Name"")==pName)
						{
							
							Outputs.SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
							Outputs.SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
							Outputs.SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
							Outputs.SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
							Outputs.SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
							Outputs.SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
							Outputs.SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
							doDiscontinue=true;	
							Outputs.SetProperty(""CheckFlag"",doDiscontinue);
										
							break;
						}
						
					}
					else
					{
						var inp2=TheApplication().NewPropertySet();
						var out2=TheApplication().NewPropertySet();

						inp2.SetProperty(""BusinessObject"",""Internal Product"");
						inp2.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
						inp2.SetProperty(""SearchExpression"",""[VOD Row Id]='""+out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Vod Id"")+""'"");
						inp2.SetProperty(""Field0"",""Name"");
						Qbs.InvokeMethod(""SiebelQuery"",inp2,out2);
						pName=out2.GetProperty(""Output0"");

						if(tmpLineItem.GetProperty(""Name"")==pName)
						{
							
							Outputs.SetProperty(""ParentPath"",tmpLineItem.GetProperty(""Integration Id""));
							Outputs.SetProperty(""RootParentPath"",tmpLineItem.GetProperty(""Root Integration Id""));
							Outputs.SetProperty(""ParentParentId"",tmpLineItem.GetProperty(""Parent Id""));
							Outputs.SetProperty(""ParentProdName"",tmpLineItem.GetProperty(""Name""));
							Outputs.SetProperty(""ActionCode"",tmpLineItem.GetProperty(""Action Code""));
							Outputs.SetProperty(""Orig Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Orig Id""));
							Outputs.SetProperty(""Par Rel Id"",out.GetChild(0).GetChild(0).GetChild(i).GetProperty(""Par Rel Id""));
							doDiscontinue=true;	
							Outputs.SetProperty(""CheckFlag"",doDiscontinue);
										
							break;
						}
						inp2=null;
						out2=null;

					}
				}

			}
			else
			{
				break;
			}
		}
	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
		pName=null;
	}

}
function MatchDeviceAndGetIns(Qbs,Devicepart)
{

	var inp1=TheApplication().NewPropertySet();
	var out1=TheApplication().NewPropertySet();

	try
	{
		var val=TheApplication().InvokeMethod(""LookupValue"",""STC_INSURANCE_DEVICES"",Devicepart);
		//var testv=val.search(""^DEVICE"");
		if((val.search(""^DEVICE""))>=0)
		{
			var DevInsPart=TheApplication().InvokeMethod(""LookupValue"",""STC_ECOM_DEVICE_INSURANCE_PART"",""STC_ECOM_DEVICE_INSURANCE_PART"");
			inp1.SetProperty(""BusinessComponent"",""Internal Product - ISS Admin"");
			inp1.SetProperty(""SearchExpression"",""[Part #]='""+DevInsPart+""'"");
			inp1.SetProperty(""BusinessObject"",""Admin ISS Product Definition"");
			inp1.SetProperty(""Field1"",""Name"");

			Qbs.InvokeMethod(""SiebelQuery"",inp1,out1);

			var pIns=out1.GetProperty(""Output1"");

			inp1.Reset();
			out1.Reset();

		}
	}
	
	catch(e)
	{
	}
	finally
	{
	}

	return pIns;
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	try
	{
		switch(MethodName)
		{
			case ""AddProduct"":
				Outputs.SetProperty(""Error Code"",""0000"");
				Outputs.SetProperty(""Error Message"",""SUCCESS"");
				AddProduct(Inputs , Outputs);
				var eC=Outputs.GetProperty(""Error Code"");
				var eM=Outputs.GetProperty(""Error Message"");
				if(eC.length > 0 && eM.length > 0)
				{
					TheApplication().RaiseErrorText(""Add Product Function Execption"");
				}
				Outputs.SetProperty(""Error Code"",""0000"");
				Outputs.SetProperty(""Error Message"",""SUCCESS"");
				
				
				return(CancelOperation);
			default:
				return(ContinueOperation);
		}

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Code"",e.errCode);
		Outputs.SetProperty(""Error Message"",e.errText);
	}
	finally
	{
		//Inputs.Reset();
		//Outputs.Reset();
	}
	return (ContinueOperation);
}
function UnresolveLinks(Inputs,Outputs)
{
	var i=0;
	var tmp=0;
	var name;
	var cnt;
	var UnrsvLinks=TheApplication().NewPropertySet();
	var Out=TheApplication().NewPropertySet();
	Out=Outputs;

	var inp2=TheApplication().NewPropertySet();
	var out2=TheApplication().NewPropertySet();

	var result=TheApplication().NewPropertySet();

	var Qbs=TheApplication().GetService(""STC Siebel Operation BS"");

	var bo="""",bc="""",sspec="""",ordid="""",oliid="""",field="""",idval="""";

	ordid=Inputs.GetProperty(""ObjId"");
	oliid=Inputs.GetProperty(""RootId"")

	try
	{
//		Setting the Error Code and Message for parent function
		Outputs.SetProperty(""Error Message"","""");
		Outputs.SetProperty(""Error Code"","""");

		for(i=0;i<Outputs.GetChildCount();i++)
		{
			if (Outputs.GetChild(i).GetType()==""UnresolvedLinks"")
			{
				UnrsvLinks=Outputs.GetChild(i);
			}
			if (Outputs.GetChild(i).GetType()==""Links"")
			{
				result.AddChild(Outputs.GetChild(i).Copy());
			}
		}
		cnt=UnrsvLinks.GetChildCount();
		//Resolving the unresolved links for createsession
		for(i=0;i<UnrsvLinks.GetChildCount();i++)
		{
			//inp2.SetProperty(""BusinessComponent"",UnrsvLinks.GetChild(i).GetProperty(""BusComp""));
			bc=UnrsvLinks.GetChild(i).GetProperty(""BusComp"");
			bo=UnrsvLinks.GetChild(i).GetProperty(""BusObj"");
			sspec=UnrsvLinks.GetChild(i).GetProperty(""SEARCH_SPEC"");
			field=UnrsvLinks.GetChild(i).GetProperty(""Field"");
			idval=UnrsvLinks.GetChild(i).GetProperty(""ID"");

			if(bc==""Order Entry - Line Items"")
			{				
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+oliid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			else if (bc==""Order Entry - Orders"")
			{

				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);

			}
			else
			{
				if(sspec.length > 0)
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""' ""+""AND ""+sspec);
				else
					inp2.SetProperty(""SearchExpression"",""[Id]='""+ordid+""'"");
				inp2.SetProperty(""BusinessObject"",bo);
				inp2.SetProperty(""BusinessComponent"",bc);
			}
			inp2.SetProperty(""Field0"",field);
			Qbs.InvokeMethod(""SiebelQuery"",inp2,out2);

			result.GetChild(0).SetProperty(idval,out2.GetProperty(""Output0""));

			inp2.Reset();
			out2.Reset();
		
		}
		

	}
	catch(e)
	{
		Outputs.SetProperty(""Error Message"",e.errText);
		Outputs.SetProperty(""Error Code"",e.errCode);
	}
	finally
	{
	}
	return result;
}

"
"#include ""eaisiebel.js""

/*
 * Configuration information
 *    : Stores the default information
 *    : Get initialized at Start
 */
 
var CONFIGNAME  = new Array;
var CONFIGVALUE = new Array;

var m_sW32StrLib;
var m_sUnixStrLib;
var m_sVendorDll;
var m_sPrimaryId;
var m_sMerchantId;
var m_oICSMethod;
var m_debug;
var m_logFile;
var m_plateform = ""Unix"";
var m_sAmount;
var m_convService;

var err = ""OK"";
var errParamCount = 0;
var errParamArray = new Array ();

var ICS2OfferFields = new Array (
               ""amount"",
               ""merchant_product_sku"",
               ""product_code"",
               ""product_name"",
               ""quantity"",
               ""tax_amount"");
               
var ICS2OBJS = new Array;

ICS2OBJS[""Authorization""] = new Object ();
ICS2OBJS[""Authorization""].OIntObjName = ""CreditCard - Authorization (CyberSource Output)"";
ICS2OBJS[""Authorization""].IIntObjName = ""CreditCard - Authorization (CyberSource Input)"";
ICS2OBJS[""Authorization""].Application = ""ics_auth"";
ICS2OBJS[""Authorization""].PrimaryComp = ""Quote"";
ICS2OBJS[""Authorization""].OutputFields = new Array (
               ""ics_rcode"",
               ""ics_rflag"",
               ""ics_rmsg"",
               ""request_id"",
               ""auth_rcode"",
               ""auth_rflag"",
               ""auth_rmsg"",
               ""auth_auth_code"",
               ""auth_auth_amount"",
               ""auth_auth_time"",
               ""auth_auth_avs"",
               ""auth_auth_response"",
               ""auth_cv_result"");

ICS2OBJS[""AuthCharge""] = new Object ();
ICS2OBJS[""AuthCharge""].OIntObjName = ""CreditCard - AuthCharge (CyberSource Output)"";
ICS2OBJS[""AuthCharge""].IIntObjName = ""CreditCard - Authorization (CyberSource Input)"";
ICS2OBJS[""AuthCharge""].Application = ""ics_auth, ics_bill"";
ICS2OBJS[""AuthCharge""].PrimaryComp = ""Quote"";
ICS2OBJS[""AuthCharge""].OutputFields = new Array (
               ""ics_rcode"",
               ""ics_rflag"",
               ""ics_rmsg"",
               ""request_id"",
               ""auth_rcode"",
               ""auth_rflag"",
               ""auth_rmsg"",
               ""auth_auth_code"",
               ""auth_auth_amount"",
               ""auth_auth_time"",
               ""auth_auth_avs"",
               ""auth_auth_response"",
               ""auth_cv_result"",
               ""bill_rcode"",
               ""bill_rflag"",
               ""bill_rmsg"",
               ""bill_bill_amount"",
               ""bill_bill_request_time"",
               ""bill_trans_ref_no"");

ICS2OBJS[""Charge""] = new Object (); 
ICS2OBJS[""Charge""].OIntObjName = ""CreditCard - Charge (CyberSource Output)"";
ICS2OBJS[""Charge""].IIntObjName = ""CreditCard - Charge (CyberSource Input)"";
ICS2OBJS[""Charge""].Application = ""ics_bill"";
ICS2OBJS[""Charge""].PrimaryComp = ""Order Entry - Orders"";
ICS2OBJS[""Charge""].OutputFields = new Array (
               ""ics_rcode"",
               ""ics_rflag"",
               ""ics_rmsg"",
               ""request_id"",
               ""bill_rcode"",
               ""bill_rflag"",
               ""bill_rmsg"",
               ""bill_bill_amount"",
               ""bill_bill_request_time"",
               ""bill_trans_ref_no"");
   
ICS2OBJS[""Refund""] = new Object ();               
ICS2OBJS[""Refund""].OIntObjName = ""CreditCard - Refund (CyberSource Output)"";
ICS2OBJS[""Refund""].IIntObjName = ""CreditCard - Refund (CyberSource Input)"";
ICS2OBJS[""Refund""].Application = ""ics_credit"";
ICS2OBJS[""Refund""].PrimaryComp = ""Order Entry - Orders"";
ICS2OBJS[""Refund""].OutputFields = new Array (
               ""ics_rcode"",
               ""ics_rflag"",
               ""ics_rmsg"",
               ""request_id"",
               ""credit_rcode"",
               ""credit_rflag"",
               ""credit_rmsg"",
               ""credit_credit_amount"",
               ""credit_credit_request_time"",
               ""credit_auth_response"",
               ""credit_trans_ref_no"");"
function CallCyberSource (inputXML, outputXML)
{
   var oXMLService = null;    // CC XML Converter service
   var oIMsg;                 // Input Siebel Message
   var oOMsg;                 // Output Siebel Message
   var oIIntObj;
   var oOIntObj;
   
   var oRequest     = null;    // oRequest ics_msg
   var oResult      = null;    // Result ics_msg
   
   var pChar;
   var icsRcode;
   var icsRflag;
   var icsRmsg;
   var requestId;
   var responseCode;
   var count;
   var errString;
   var xmlString;
   
   
   LogMessage (""\n#TRANSACTION\n------------"");
   
   // Get the XML Converter Service
   if ((oXMLService = TheApplication().GetService (""CC XML Converter"")) == null)
   {
      err = ""ERR_LOADING_BUS_SERV"";
      errParamArray[errParamCount++] = ""CC XML Converter"";
      return (err);
   }
   
   // Create new property sets
   if ((oIIntObj = TheApplication().NewPropertySet()) == null ||
       (oOIntObj = TheApplication().NewPropertySet()) == null)
   {
      err = ""ERR_CREATING_PROP_SET"";
      return (err);
   }
   
   xmlString = inputXML.GetValue();
   
   // Convert XML to integration object
   oXMLService.InvokeMethod(""XMLToPropSet"", inputXML, oIIntObj);
   
   LogMessage(""If the log ended here, it means the environment is not setup correctly."");
   
   // Create request ics_msg
   oRequest = SendCmd (""ics_init"", 0, null, null);

   if (oRequest == null)
   {
      LogMessage(""'ics_init' function returns null"");
      responseCode = 19;
   }
   else 
   {
      // Fill the request with input integration object
      FillRequestObj(oIIntObj, oRequest);

      for (count = 0; count < CONFIGNAME.length; count++)
      {
         if (SendCmd (""ics_fgetbyname"", oRequest, CONFIGNAME[count]) == """")
         {
            SendCmd (""ics_fadd"", oRequest, CONFIGNAME[count], CONFIGVALUE[count]);
            if (CONFIGNAME[count] == ""merchant_id"")
               m_sMerchantId = CONFIGVALUE[count];
         }
      }
      
      // Send request to CyberSource
      oResult = SendCmd (""ics_send"", oRequest, null, null);
      
      if (oResult == null)
      {
         SendCmd (""ics_destroy"", oRequest, null, null);
         responseCode = 19;
      }
      else
      {
         icsRcode  = SendCmd (""ics_fgetbyname"", oResult, ""ics_rcode"", null);
         icsRflag  = SendCmd (""ics_fgetbyname"", oResult, ""ics_rflag"", null);
         icsRmsg   = SendCmd (""ics_fgetbyname"", oResult, ""ics_rmsg"", null);
         
         FillOutIntObj(oResult, oOIntObj);
         responseCode = SetResponseCode(icsRflag);
      }
   }
   
   oOIntObj.SetProperty (""SiebelResponseCode"", responseCode);
   oOIntObj.SetProperty (""VendorErrorCode"", icsRflag);
   oOIntObj.SetProperty (""VendorErrorMessage"", icsRmsg);
   
   // Convert integration object to XML
   oXMLService.InvokeMethod(""PropSetToXML"", oOIntObj, outputXML);
      
   xmlString = outputXML.GetValue();
  
   if (oRequest)
   {
      SendCmd (""ics_destroy"", oRequest, null, null);
   }
   if (oResult)
   {
      SendCmd (""ics_destroy"", oResult, null, null);
   }      
}
function FillOutIntObj(oResult, oIntObj)
{
   var oObjChild;
   var oIntComp;
   var count;
   var value;
   var icsRflag;
   var siebelRespCode;

   LogMessage (""\nResults :"");
   
   oIntObj.SetType (""SiebelMessage"");
   oIntObj.SetProperty (""MessageType"", ""Integration Object"");
   oIntObj.SetProperty (""IntObjectFormat"", ""XML Hierarchical"");
   oIntObj.SetProperty (""IntObjectName"", m_oICSMethod.OIntObjName);
    
   // Create new property sets
   if ((oObjChild = TheApplication().NewPropertySet()) == null ||
       (oIntComp = TheApplication().NewPropertySet()) == null)
   {
      err = ""ERR_CREATING_PROP_SET"";
      return (err);
   }
   
   oObjChild.SetType (""ListOfRecords"");
   oIntComp.SetType (""Record"");
   oIntComp.SetProperty (""row_id"", m_sPrimaryId);
   oIntComp.SetProperty (""merchant_id"", m_sMerchantId);
   oIntComp.SetProperty (""requested_amount"", m_sAmount);
   
   for (count = 0; count < m_oICSMethod.OutputFields.length; count++)
   {
   
      value  = SendCmd (""ics_fgetbyname"", oResult, 
                        m_oICSMethod.OutputFields[count], null);
      if (value != """")
      {
         oIntComp.SetProperty (m_oICSMethod.OutputFields[count], value);
         LogMessage (""\t"" + m_oICSMethod.OutputFields[count] + "" = "" + value);
      }
   }

   icsRflag = SendCmd (""ics_fgetbyname"", oResult, ""ics_rflag"", null);
   siebelRespCode = SetResponseCode (icsRflag);
   oIntComp.SetProperty (""siebel_response_code"", siebelRespCode);

   oObjChild.AddChild (oIntComp);
   oIntObj.AddChild (oObjChild);
   			
}
function FillRequestObj(oPropSet, oRequest)
{
   	var propName   = """";
   	var propVal    = """";
   	var oIntComp   = null;
   	var oObjChild  = null;
   	var offer      = new Array;
   	var offerCount = 0;
   	var offerStr;

    if ((oObjChild = oPropSet.GetChild(0)) == null ||
        (oIntComp = oObjChild.GetChild(0)) == null)
    {
      err = ""ERR_XML_FORMAT"";
      return (err);
    }

    propName = oIntComp.GetFirstProperty();
    while (propName != """")
    {
       propVal = oIntComp.GetProperty(propName);
       
       // Check to see if it's an offer field
       var offerField = 0;
       for (var count = 0; count < ICS2OfferFields.length; count++)
       {
          if (propName == ICS2OfferFields[count])
          {
             if (propName == ""amount"")
             {
                m_sAmount = propVal;
             }
             // offer field
             offerField = 1;
             offer[offerCount] = propName + "":"" + propVal;
             offerCount++;
             break;
          }
       }
       
       if (offerField == 0)
       {
          // Check to see if it's the row id.
          if (propName == ""merchant_ref_number"")
          {
             m_sPrimaryId = propVal;
             SendCmd (""ics_fadd"", oRequest, propName, propVal);
          }
          else if ((propName == ""merchant_id"") && (propVal != """"))
          {
             m_sMerchantId = propVal;
             SendCmd (""ics_fadd"", oRequest, propName, propVal);
          }
          else if (propName == ""customer_name"")
          {
             var space = propVal.lastIndexOf("" "");
             var last = propVal.length;
             SendCmd (""ics_fadd"", oRequest, ""customer_firstname"", 
                      propVal.substring(0, space));
             SendCmd (""ics_fadd"", oRequest, ""customer_lastname"", 
                      propVal.substring(space+1));
          }
          else if (propVal != """")
          {
             SendCmd (""ics_fadd"", oRequest, propName, propVal);
          }
          LogMessage (""\t"" + propName + "" = "" + propVal);
       }
       
       propName = oIntComp.GetNextProperty();
    }

    // Construct offer Fields
    offerStr = offer.join(""^"");
    SendCmd (""ics_fadd"", oRequest, ""offer0"", offerStr);
    LogMessage (""\t"" + ""offer0 = "" + offerStr);
    
    // Set the application Name
    SendCmd (""ics_fadd"", oRequest, ""ics_applications"", m_oICSMethod.Application);
    LogMessage (""\t"" + ""ics_applications = "" + m_oICSMethod.Application);

}
function Initialize (inputXML, outputXML)
{
   var oIPropSet;
   var oOPropSet;
   var oXMLService;
   var name;
   var value;
   var xmlString;
   var count;
   var errString;

   if (GetProperty (""DEBUG"") == ""1"")
      m_debug = 1;
   else
      m_debug = 0;
   
   m_sW32StrLib = GetProperty (""W32 String Library"");
   m_sUnixStrLib = GetProperty (""Unix String Library"");
   m_logFile    = GetProperty (""Log File Name""); 
        
   LogMessage (""***Initialize***"");

   // Get the ""CC XML Converter"" Service
   if ((oXMLService = TheApplication().GetService (""CC XML Converter"")) == null)
   {
      err = ""ERR_LOADING_BUS_SERV"";
      errParamArray[errParamCount++] = ""CC XML Converter"";
      return (err);
   }

   // Get the ""Credit Card Transaction Service"" Service   
   if ((m_convService = TheApplication().GetService (""Credit Card Transaction Service"")) == null)
   {
      err = ""ERR_LOADING_BUS_SERV"";
      errParamArray[errParamCount++] = ""Credit Card Transaction Service"";
      return (err);
   }
   
   // Initialize the property sets
   if ((oIPropSet = TheApplication().NewPropertySet()) == null ||
       (oOPropSet = TheApplication().NewPropertySet()) == null)
   {
      err = ""ERR_CREATING_PROP_SET"";
      return (err);
   }
   
   xmlString = inputXML.GetValue();
   
   // Conver XML string to property set
   oXMLService.InvokeMethod(""XMLToPropSet"", inputXML, oIPropSet);
   
   name = oIPropSet.GetFirstProperty();
   for (count = 0; name != """";)
   {
      value = oIPropSet.GetProperty(name);
      
      if (name == ""Plateform"")
      {
         if (value != """")
         {
            m_plateform = value;
         }
      }
      else if (name != ""VendorDll"")
      {
         CONFIGNAME[count]  = name;
         CONFIGVALUE[count] = value;
         count++;
      }
      else 
      {
         m_sVendorDll = value;
      }
      
      name = oIPropSet.GetNextProperty();
   }

   LogMessage (""Runing on "" + m_plateform + "" Plateform"");
   
   oOPropSet.SetValue (""OK"");
   oOPropSet.SetProperty (""SiebelResponseCode"", ""1"");
   
   oXMLService.InvokeMethod(""PropSetToXML"", oOPropSet, outputXML);
   
   xmlString = outputXML.GetValue();
}
function LogMessage (Msg)
{
   if (m_debug)
   {
      var fp = Clib.fopen (m_logFile, ""at+"");
      if (fp != null)
      {
         Clib.fputs (Msg, fp);
         Clib.fputs (""\n"", fp);
         Clib.fclose (fp);
      }
   }  
}
function SendCmd (method, param0, param1, param2)
{
   var pChar;
   var bValue = new Buffer();
   var sValue = ""                                                                                                                                                                                            "";
   var oRetVal;
   var sChar;
   var length = 0;
   
   if (param1 == null)
   {
      if (m_plateform == ""Unix"")
         oRetVal = SElib.dynamicLink (m_sVendorDll, method, param0);
      else 
         oRetVal = SElib.dynamicLink (m_sVendorDll, method, CDECL, param0);
   }
   else if (param2 == null)
   {
      if (method == ""ics_fget"" || method == ""ics_fgetbyname"")
      {
          if (m_plateform == ""Unix"")
             pChar = SElib.dynamicLink (m_sVendorDll, method, param0, param1);
          else 
             pChar = SElib.dynamicLink (m_sVendorDll, method, CDECL, param0, param1);
          if (pChar != 0)
          {
             // Copying the string pointed by pChar to bValue buffer
             sChar = SElib.peek (pChar);
  	         while (sChar != 0 && length <= 255)
  	         {
  	            length++;
                    bValue.putValue(sChar,1);
  	            sChar = SElib.peek (pChar+length);
  	         }
                 bValue.cursor = 0;
	         oRetVal = bValue.getString();
          }
          else
             oRetVal = """";
      }          
      else
          oRetVal = """";
   }
   else  // method == ""ics_fadd""
   {
      var param2UTF8;
      var inputPropSet;
      var outputPropSet;
    
      // Create new property sets
      if ((inputPropSet = TheApplication().NewPropertySet()) == null ||
          (outputPropSet = TheApplication().NewPropertySet()) == null)
      {
         err = ""ERR_CREATING_PROP_SET"";
      }
      
      inputPropSet.SetProperty(""UTF16"", param2);
      m_convService.InvokeMethod(""ConvertUTF16ToUTF8"", inputPropSet, outputPropSet);
      param2UTF8 = new Buffer(outputPropSet.GetProperty(""UTF8""));
      
      if (m_plateform == ""Unix"")
         oRetVal = SElib.dynamicLink (m_sVendorDll, method, param0, param1, param2UTF8.toString());
      else
         oRetVal = SElib.dynamicLink (m_sVendorDll, method, CDECL, param0, param1, param2UTF8.toString());
   }
   
   return (oRetVal);

}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   var count;
   
   err = ""OK"";
   errParamCount = 0;
   errParamArray.length = 0;
   
   if (MethodName == ""Start"")
   {
      Initialize (Inputs, Outputs);
   }
   else if (MethodName == ""Authorization"" ||
            MethodName == ""AuthCharge""    ||
            MethodName == ""Charge""        ||
            MethodName == ""Refund"")
   {
      m_oICSMethod = ICS2OBJS[MethodName];
      CallCyberSource (Inputs, Outputs);
   }
   else
   {
      ThrowError(""The MethodName, "" + MethodName +
                 "", is not supported by CyberSource Adapter service."");
   }
   
   Outputs.SetProperty (""SiebelErrorSymbol"", err);
   for (count = 0; count < errParamCount; count++)
   {
      var key;
      Clib.sprintf (key, ""SiebelErrorParam%d"", count);
      Outputs.SetProperty (key, errParamArray[count]);
   }
   
   return (CancelOperation);
}
function SetResponseCode (rFlag)
{  
   var propSet;
   var errFlag;
   
   // Initialize the property sets
   if ((propSet = TheApplication().NewPropertySet()) == null)
   {
      err = ""ERR_CREATING_PROP_SET"";
   }
   propSet.SetValue (rFlag);
   errFlag = propSet.GetValue ();
   
   if (errFlag == ""SOK"")
   {
      return (1);
   }
   else if (errFlag == ""ETIMEOUT"")
   {
      return (21);
   }
   else if (errFlag == ""ESYSTEM"")
   {
      return (20);
   }
   else if (errFlag == ""DAVSNO"")
   {
      return (10);
   }
   else if (errFlag == ""DCARDEXPIRED"")
   {
      return (5);
   }
   else if (errFlag == ""DCARDREFUSED"")
   {
      return (8);
   }
   else if (errFlag == ""DINVALIDDATA"")
   {
      return (6);
   }
   else if (errFlag == ""DINVALIDCARD"")
   {
      return (7);
   }
   else if (errFlag == ""DMISSINGFIELD"")
   {
      return (11);
   }
   else if (errFlag == ""DNOAUTH"")
   {
      return (15);
   }
   else if (errFlag == ""DNOBILL"")
   {
      return (16);
   }
   else if (errFlag == ""DNTFDECLINED"")
   {
      return (3);
   }
   else if (errFlag == ""DCALL"")
   {
      return (2);
   }
   else
   {
      return (19);
   }
}
#include "eaisiebel.js"
function MapAccount(Inputs, Outputs) 
{

	var iDNBObj;
	var iDNBComp;
	var oDNBObj;
	var oDNBCompAccount;
	var oDNBCompSIC;
	var sicCount;
	
	
	iDNBObj=Inputs.GetIntObj (""DNB Account Update (Performance)"");

	
	oDNBObj=Outputs.CreateIntObj (""DNB Account (Performance)"");

	
	
	
	
	
	while (iDNBObj.NextInstance()) 
	{
		
		iDNBComp=iDNBObj.GetPrimaryIntComp(""DNB Account Update"");
		oDNBObj.NewInstance();
		oDNBCompAccount=oDNBObj.CreatePrimaryIntComp(""DNB Account"");
	
		
		while (iDNBComp.NextRecord ()) 
		{
			oDNBCompAccount.NewRecord();
			oDNBCompSIC=oDNBCompAccount.CreateIntComp(""DNB Account SIC"");
				
			PopulateAccntRecord(iDNBComp,oDNBCompAccount);
			PopulateSICRecord(iDNBComp,oDNBCompSIC);
			
		}
	}			
 return;
}
function PopulateAccntRecord(iDNBComp,oDNBCompAccount){

	oDNBCompAccount.SetCopySource(iDNBComp);
	
	
	// CopyFieldValue(dest,source)		
	oDNBCompAccount.CopyFieldValue(""Accounting Firm Name"",""Accounting Firm Name"");
	oDNBCompAccount.CopyFieldValue(""Annual Sales Local Currency"", ""Annual Sales Local Currency"");
	oDNBCompAccount.CopyFieldValue(""Annual Sales Local Currency CD"", ""Annual Sales Local Currency CD"");
	oDNBCompAccount.CopyFieldValue(""Bank Address"",""Bank Address"");
	oDNBCompAccount.CopyFieldValue(""Bank City"",""Bank City"");
	oDNBCompAccount.CopyFieldValue(""Bank DUNS Number"",""Bank DUNS Number"");
	oDNBCompAccount.CopyFieldValue(""Bank Name"",""Bank Name"");
	oDNBCompAccount.CopyFieldValue(""Bank State"",""Bank State"");
	oDNBCompAccount.CopyFieldValue(""Bank Zip"",""Bank Zip"");
	oDNBCompAccount.CopyFieldValue(""Base Year Employee"",""Base Year Employees"");
	oDNBCompAccount.CopyFieldValue(""Base Year Sales"",""Base Year Sales"");
	oDNBCompAccount.CopyFieldValue(""Business Name"",""Business Name"");
	oDNBCompAccount.CopyFieldValue(""Cable Telex Number"",""Cable Telex Number"");
	oDNBCompAccount.CopyFieldValue(""Carrier Router Code"",""Carrier Router Code"");
	oDNBCompAccount.CopyFieldValue(""City Code"",""City Code"");
	oDNBCompAccount.CopyFieldValue(""Continent Code"",""Continent Code"");
	oDNBCompAccount.CopyFieldValue(""Country Name"",""Country Name"");
	oDNBCompAccount.CopyFieldValue(""Country Telephone Access Code"",""Country Phone Access Code"");
	oDNBCompAccount.CopyFieldValue(""County Code"",""County Code"");
	oDNBCompAccount.CopyFieldValue(""County Name"",""County Name"");
	oDNBCompAccount.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompAccount.CopyFieldValue(""Dias Code"",""Dias Code"");
	oDNBCompAccount.CopyFieldValue(""Division Indicator"",""Division Indicator"");
	oDNBCompAccount.CopyFieldValue(""Domestic Ultimate Business Name"",""Domestic Ultimate Business Name"");
	oDNBCompAccount.CopyFieldValue(""Domestic Ultimate Country Code"",""Domestic Ultimate Country Code"");
	oDNBCompAccount.CopyFieldValue(""Domestic Ultimate DUNS"",""Domestic Ultimate DUNS Number"");
	oDNBCompAccount.CopyFieldValue(""Domestic Ultimate FIPS Country"",""Domestic Ultimate FIPS Country"");
	oDNBCompAccount.CopyFieldValue(""Domestic Ultimate State Abbrev"",""Domestic Ultimate State Abbr"");
	oDNBCompAccount.CopyFieldValue(""Employee Here"",""Employee Here"");
	oDNBCompAccount.CopyFieldValue(""Employee Here Code"",""Employee Here Code"");
	oDNBCompAccount.CopyFieldValue(""Employee Total"",""Employee Total"");
	oDNBCompAccount.CopyFieldValue(""Employee Total Code"",""Employee Total Code"");
	oDNBCompAccount.CopyFieldValue(""FIPS City Code"",""FIPS City Code"");
	oDNBCompAccount.CopyFieldValue(""FIPS Country Code"",""FIPS Country Code"");
	oDNBCompAccount.CopyFieldValue(""FIPS MSA Code"",""FIPS MSA Code"");
	oDNBCompAccount.CopyFieldValue(""FIPS Subdivision 1 Code"",""FIPS Subdivision 1 Code"");
	oDNBCompAccount.CopyFieldValue(""FIPS Subdivision 2 Code"",""FIPS Subdivision 2 Code"");
	oDNBCompAccount.CopyFieldValue(""Family Update Date"",""Familty Update Date"");
	oDNBCompAccount.CopyFieldValue(""Geocode Accuracy"",""Geocode Accuracy"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate Business Name"",""Global Ultimate Business Name"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate Country Code"",""Global Ultimate Country Code"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate DUNS"",""Global Ultimate DUNS Number"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate FIPS Country"",""Global Ultimate FIPS Country"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate Indicator"",""Global Ultimate Indicator"");
	oDNBCompAccount.CopyFieldValue(""Global Ultimate State Abbrev"",""Global Ultimate State Abbr"");
	oDNBCompAccount.CopyFieldValue(""Hierarchy Code"",""Hierarchy Code"");
	oDNBCompAccount.CopyFieldValue(""Import Export Code"",""Import Export Code"");
	oDNBCompAccount.CopyFieldValue(""Latitude"",""Latitude"");
	oDNBCompAccount.CopyFieldValue(""Legal Status"",""Legal Status"");
	oDNBCompAccount.CopyFieldValue(""Line of Business"",""Line of Business"");
	oDNBCompAccount.CopyFieldValue(""Location Type"",""Loc Type Stat Indicator"");
	oDNBCompAccount.CopyFieldValue(""Longitude"",""Longitude"");
	oDNBCompAccount.CopyFieldValue(""Mail Address"",""Mail Address"");
	oDNBCompAccount.CopyFieldValue(""Mail Address 2"",""Mail Address 2"");
	oDNBCompAccount.CopyFieldValue(""Mail City"",""Mail City"");
	oDNBCompAccount.CopyFieldValue(""Mail State"",""Mail State"");
	oDNBCompAccount.CopyFieldValue(""Mail Zip"",""Mail Zip"");
	oDNBCompAccount.CopyFieldValue(""Main Fax 2"",""Fax Number"");
	oDNBCompAccount.CopyFieldValue(""Main Phone 2"",""Telephone"");
	oDNBCompAccount.CopyFieldValue(""Major Industry Category"",""Major Industry Category"");
	oDNBCompAccount.CopyFieldValue(""Manufacturing Indicator"",""Manufacturing Indicator"");
	oDNBCompAccount.CopyFieldValue(""Minority Owned Indicator"",""Minority Owned Indicator"");
	oDNBCompAccount.CopyFieldValue(""National Identification Number"",""National Id Number 1"");
	oDNBCompAccount.CopyFieldValue(""Number of Family Members"",""Number Family Members"");
	oDNBCompAccount.CopyFieldValue(""Owns Rents"",""Owns Rents"");
	oDNBCompAccount.CopyFieldValue(""Parent HQ DUNS"",""Parent DUNS Number"");
	oDNBCompAccount.CopyFieldValue(""Parent/HQ  Name"",""Parent/HQ Name"");
	oDNBCompAccount.CopyFieldValue(""Parent/HQ Country Code"",""Parent/HQ Country Code"");
	oDNBCompAccount.CopyFieldValue(""Parent/HQ FIPS Country Code"",""Parent/HQ FIPS Country Code"");
	oDNBCompAccount.CopyFieldValue(""Parent/HQ State"",""Parent/HQ State"");
	oDNBCompAccount.CopyFieldValue(""Percent Growth Employee in 3 yr"",""Percent Growth Employee in 3 Year"");
	oDNBCompAccount.CopyFieldValue(""Percent Growth Employee in 5 yr"",""Percent Growth Employee in 5 Year"");
	oDNBCompAccount.CopyFieldValue(""Percent Growth Sales in 3 yr"",""Percent Growth Sales in 3 Year"");
	oDNBCompAccount.CopyFieldValue(""Percent Growth Sales in 5 yr"",""Percent Growth Sales in 5 Year"");
	oDNBCompAccount.CopyFieldValue(""Physical Address"",""Physical Street Address"");
	oDNBCompAccount.CopyFieldValue(""Physical City"",""Physical City"");
	oDNBCompAccount.CopyFieldValue(""Physical State"",""Physical State"");
	oDNBCompAccount.CopyFieldValue(""Physical Zip"",""Physical Zip"");
	oDNBCompAccount.CopyFieldValue(""Population Code"",""Population Code"");
	oDNBCompAccount.CopyFieldValue(""Primary Local Activity Code"",""Primary Local Activity Code"");
	oDNBCompAccount.CopyFieldValue(""Primary SIC Code"",""SIC1"");
	oDNBCompAccount.CopyFieldValue(""Public Private Indicator"",""Public Private Indicator"");
	oDNBCompAccount.CopyFieldValue(""SMSA Code"",""SMSA Code"");
	oDNBCompAccount.CopyFieldValue(""SMSA Name"",""SMSA Name"");
	oDNBCompAccount.CopyFieldValue(""Sales Volumne"",""Sales Volumne"");
	oDNBCompAccount.CopyFieldValue(""Sales Volumne Code"",""Sales Volumne Code"");
	oDNBCompAccount.CopyFieldValue(""Second Street Address"",""Second Street Address"");
	oDNBCompAccount.CopyFieldValue(""Second Trade Style"",""Second Trade Style"");
	oDNBCompAccount.CopyFieldValue(""Site Status"",""Site Status"");
	oDNBCompAccount.CopyFieldValue(""Small Business Indicator"",""Small Business Indicator"");
	oDNBCompAccount.CopyFieldValue(""Square Footage"",""Square Footage"");
	oDNBCompAccount.CopyFieldValue(""State Code"",""State Code"");
	oDNBCompAccount.CopyFieldValue(""State Name"",""State Name"");
	oDNBCompAccount.CopyFieldValue(""Subsidiary Indicator"",""Subsidiary Indicator"");
	oDNBCompAccount.CopyFieldValue(""Trade Style"",""Trade Style"");
	oDNBCompAccount.CopyFieldValue(""Trend Sales in 5 yr"",""Trend Sales in 5 Year"");
	oDNBCompAccount.CopyFieldValue(""Trend Year Employee in 3 yr"",""Trend Year Employee in 3 Year"");
	oDNBCompAccount.CopyFieldValue(""Trend Year Employee in 5 yr"",""Trend Year Employee in 5 Year"");
	oDNBCompAccount.CopyFieldValue(""Trend Year Sales in 3 yr"",""Trend Year Sales in 3 Year"");
	oDNBCompAccount.CopyFieldValue(""Year Started 1"",""Year Started"");
	
	}
function PopulateSICRecord(iDNBComp,oDNBCompSIC) 
{
	var		sic1;
	var		sic2;
	var		sic3;
	var		sic4;
	var		sic5;
	var		sic6;
	
	sic1 = iDNBComp.GetFieldValue(""SIC1"");
	sic2 = iDNBComp.GetFieldValue(""SIC2"");
	sic3 = iDNBComp.GetFieldValue(""SIC3"");
	sic4 = iDNBComp.GetFieldValue(""SIC4"");
	sic5 = iDNBComp.GetFieldValue(""SIC5"");
	sic6 = iDNBComp.GetFieldValue(""SIC6"");

	if (sic1 != null && sic1 != """" && sic1 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC1"");
	}
	
	if (sic2 != null && sic2 != """" && sic2 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC2"");
	}
	
	if (sic3 != null && sic3 != """" && sic3 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC3"");
	}
	
	if (sic4 != null && sic4 != """" && sic4 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC4"");
	}
	
	if (sic5 != null && sic5 != """" && sic5 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC5"");
	}
	
	if (sic6 != null && sic6 != """" && sic6 != ""0000"")
	{
	oDNBCompSIC.NewRecord();
	oDNBCompSIC.SetCopySource(iDNBComp);		
	oDNBCompSIC.CopyFieldValue(""DUNS Number"",""DUNS Number"");
	oDNBCompSIC.CopyFieldValue(""SIC"", ""SIC6"");
	}
		
	return;
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{	
	return EAIExecuteMap(MethodName,Inputs,Outputs);

}
#include "eaisiebel.js"
function MapContact(Inputs, Outputs) 
{

	var iDNBObj;
	var iDNBComp;
	var oDNBObj;
	var oDNBCompContact;
//	var oDNBCompSIC;
	var sicCount;
	
	
	iDNBObj=Inputs.GetIntObj (""DNB Account Update (Performance)"");

	
	oDNBObj=Outputs.CreateIntObj (""DNB Contact (Performance)"");

	
	
	
	
	
	while (iDNBObj.NextInstance()) 
	{
		
		iDNBComp=iDNBObj.GetPrimaryIntComp(""DNB Account Update"");
//		oDNBObj.NewInstance();
//		oDNBCompContact=oDNBObj.CreatePrimaryIntComp(""DNB Contact"");
	
		
		while (iDNBComp.NextRecord ()) 
		{
//			PopulateContactRecord (iDNBComp, oDNBCompContact);
			PopulateContactRecord (iDNBComp, oDNBObj);
			
//			oDNBCompAccount.NewRecord();
//			oDNBCompSIC=oDNBCompAccount.CreateIntComp(""DNB Account SIC"");
				
//			PopulateAccntRecord(iDNBComp,oDNBCompAccount);
//			PopulateSICRecord(iDNBComp,oDNBCompSIC);
			
		}
	}			
 return;
}
function PopulateContactRecord (iDNBComp, oDNBObj)
{
   var   lastName;
   var   firstName;
   var   mrc;
   var   oDNBCompMRC;
   var   oDNBCompContact;

   lastName = iDNBComp.GetFieldValue (""CEO Last Name"");
   firstName = iDNBComp.GetFieldValue (""CEO First Name"");
   mrc = iDNBComp.GetFieldValue (""CEO MRC Code"");

   if (lastName != null && lastName != """" && firstName != null && firstName != """")
   {
      oDNBObj.NewInstance();
      oDNBCompContact=oDNBObj.CreatePrimaryIntComp(""DNB Contact"");
      oDNBCompContact.NewRecord ();

      oDNBCompContact.SetCopySource (iDNBComp);

      oDNBCompContact.SetFieldValue (""CEO Indicator"", ""Y"");
      oDNBCompContact.SetFieldValue (""Reporting Level"", ""1"");

      // CopyFieldValue (dest, source)
      oDNBCompContact.CopyFieldValue (""DUNS Number"", ""DUNS Number"");
      oDNBCompContact.CopyFieldValue (""First Name"", ""CEO First Name"");
      oDNBCompContact.CopyFieldValue (""Full Name"", ""CEO Full Name"");
      oDNBCompContact.CopyFieldValue (""Gender"", ""CEO Gender Code"");
      oDNBCompContact.CopyFieldValue (""Last Name"", ""CEO Last Name"");
      oDNBCompContact.CopyFieldValue (""Middle Initial"", ""CEO Middle Initial"");
      oDNBCompContact.CopyFieldValue (""Prefix"", ""CEO Prefix"");
      oDNBCompContact.CopyFieldValue (""Primary MRC"", ""CEO MRC Code"");
      oDNBCompContact.CopyFieldValue (""Suffix"", ""CEO Suffix"");
      oDNBCompContact.CopyFieldValue (""Title"", ""CEO Title"");
      
      if (mrc != null && mrc != """")
      {
         oDNBCompMRC = oDNBCompContact.CreateIntComp(""DNB Contact MRC"");
         oDNBCompMRC.NewRecord ();
         oDNBCompMRC.SetFieldValue (""MRC Code"", mrc);
      }
   }

   lastName = iDNBComp.GetFieldValue (""First Executive Last Name"");
   firstName = iDNBComp.GetFieldValue (""First Executive First Name"");
   mrc = iDNBComp.GetFieldValue (""First Executive MRC Code"");

   if (lastName != null && lastName != """" && firstName != null && firstName != """")
   {
      oDNBObj.NewInstance();
      oDNBCompContact=oDNBObj.CreatePrimaryIntComp(""DNB Contact"");
      oDNBCompContact.NewRecord ();

      oDNBCompContact.SetCopySource (iDNBComp);

      oDNBCompContact.SetFieldValue (""CEO Indicator"", ""N"");
      oDNBCompContact.SetFieldValue (""Reporting Level"", ""2"");

      // CopyFieldValue (dest, source)
      oDNBCompContact.CopyFieldValue (""DUNS Number"", ""DUNS Number"");
      oDNBCompContact.CopyFieldValue (""First Name"", ""First Executive First Name"");
      oDNBCompContact.CopyFieldValue (""Full Name"", ""First Executive Full Name"");
      oDNBCompContact.CopyFieldValue (""Gender"", ""First Executive Gender Code"");
      oDNBCompContact.CopyFieldValue (""Last Name"", ""First Executive Last Name"");
      oDNBCompContact.CopyFieldValue (""Middle Initial"", ""First Executive Middle Initial"");
      oDNBCompContact.CopyFieldValue (""Prefix"", ""First Executive Prefix"");
      oDNBCompContact.CopyFieldValue (""Primary MRC"", ""First Executive MRC Code"");
      oDNBCompContact.CopyFieldValue (""Suffix"", ""First Executive Suffix"");
      oDNBCompContact.CopyFieldValue (""Title"", ""First Executive Title"");
      
      if (mrc != null && mrc != """")
      {
         oDNBCompMRC = oDNBCompContact.CreateIntComp(""DNB Contact MRC"");
         oDNBCompMRC.NewRecord ();
         oDNBCompMRC.SetFieldValue (""MRC Code"", mrc);
      }
   }

   lastName = iDNBComp.GetFieldValue (""Second Executive Last Name"");
   firstName = iDNBComp.GetFieldValue (""Second Executive First Name"");
   mrc = iDNBComp.GetFieldValue (""Second Executive MRC Code"");

   if (lastName != null && lastName != """" && firstName != null && firstName != """")
   {
      oDNBObj.NewInstance();
      oDNBCompContact=oDNBObj.CreatePrimaryIntComp(""DNB Contact"");
      oDNBCompContact.NewRecord ();

      oDNBCompContact.SetCopySource (iDNBComp);

      oDNBCompContact.SetFieldValue (""CEO Indicator"", ""N"");
      oDNBCompContact.SetFieldValue (""Reporting Level"", ""3"");

      // CopyFieldValue (dest, source)
      oDNBCompContact.CopyFieldValue (""DUNS Number"", ""DUNS Number"");
      oDNBCompContact.CopyFieldValue (""First Name"", ""Second Executive First Name"");
      oDNBCompContact.CopyFieldValue (""Full Name"", ""Second Executive Full Name"");
      oDNBCompContact.CopyFieldValue (""Gender"", ""Second Executive Gender Code"");
      oDNBCompContact.CopyFieldValue (""Last Name"", ""Second Executive Last Name"");
      oDNBCompContact.CopyFieldValue (""Middle Initial"", ""Second Executive Middle Initial"");
      oDNBCompContact.CopyFieldValue (""Prefix"", ""Second Executive Prefix"");
      oDNBCompContact.CopyFieldValue (""Primary MRC"", ""Second Executive MRC Code"");
      oDNBCompContact.CopyFieldValue (""Suffix"", ""Second Executive Suffix"");
      oDNBCompContact.CopyFieldValue (""Title"", ""Second Executive Title"");
      
      if (mrc != null && mrc != """")
      {
         oDNBCompMRC = oDNBCompContact.CreateIntComp(""DNB Contact MRC"");
         oDNBCompMRC.NewRecord ();
         oDNBCompMRC.SetFieldValue (""MRC Code"", mrc);
      }
   }

   lastName = iDNBComp.GetFieldValue (""Third Executive Last Name"");
   firstName = iDNBComp.GetFieldValue (""Third Executive First Name"");
   mrc = iDNBComp.GetFieldValue (""Third Executive MRC Code"");

   if (lastName != null && lastName != """" && firstName != null && firstName != """")
   {
      oDNBObj.NewInstance();
      oDNBCompContact=oDNBObj.CreatePrimaryIntComp(""DNB Contact"");
      oDNBCompContact.NewRecord ();

      oDNBCompContact.SetCopySource (iDNBComp);

      oDNBCompContact.SetFieldValue (""CEO Indicator"", ""N"");
      oDNBCompContact.SetFieldValue (""Reporting Level"", ""4"");

      // CopyFieldValue (dest, source)
      oDNBCompContact.CopyFieldValue (""DUNS Number"", ""DUNS Number"");
      oDNBCompContact.CopyFieldValue (""First Name"", ""Third Executive First Name"");
      oDNBCompContact.CopyFieldValue (""Full Name"", ""Third Executive Full Name"");
      oDNBCompContact.CopyFieldValue (""Gender"", ""Third Executive Gender Code"");
      oDNBCompContact.CopyFieldValue (""Last Name"", ""Third Executive Last Name"");
      oDNBCompContact.CopyFieldValue (""Middle Initial"", ""Third Executive Middle Initial"");
      oDNBCompContact.CopyFieldValue (""Prefix"", ""Third Executive Prefix"");
      oDNBCompContact.CopyFieldValue (""Primary MRC"", ""Third Executive MRC Code"");
      oDNBCompContact.CopyFieldValue (""Suffix"", ""Third Executive Suffix"");
      oDNBCompContact.CopyFieldValue (""Title"", ""Third Executive Title"");
      
      if (mrc != null && mrc != """")
      {
         oDNBCompMRC = oDNBCompContact.CreateIntComp(""DNB Contact MRC"");
         oDNBCompMRC.NewRecord ();
         oDNBCompMRC.SetFieldValue (""MRC Code"", mrc);
      }
   }
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{	
	return EAIExecuteMap(MethodName,Inputs,Outputs);

}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// DESCRIPTION
//    Javascript maps to Siebel Discount from Oracle Discount
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function A_Discount(InputMsg,OutputMsg)
{
    //Variable to hold the input integration object
    var OracleIntObject;
    
    //Variable to hold the output integration object
    var SiebelIntObject;
    
    //Locate the input integration object in the input message
    OracleIntObject = InputMsg.GetIntObj(""Discount - Get Oracle Discount (Oracle)"");
    
    //If the integration object exists in the input message
    if(OracleIntObject.Exists())
    {
    	//Create the output integration object in the output message
		SiebelIntObject = OutputMsg.CreateIntObj(""Discount - Get Oracle Discount (Siebel)"");
		
		while(OracleIntObject.NextInstance())
		{	
			SiebelIntObject.NewInstance();
			CopyFields(OracleIntObject, SiebelIntObject);
		}
	}
}
function CopyFields(OracleIntObject,SiebelIntObject)
{
	// Variable to hold the Oracle side integration components
	var OracleDiscountIntComp, OraclePriceBreakIntComp ;
	
	// Variable to hold the Siebel side integration Components
	var SiebelDiscountIntComp, SiebelDiscountItemIntComp;
	
	// Get the primary integration component from the OracleIntegration Object (Oracle)
	OracleDiscountIntComp = OracleIntObject.GetPrimaryIntComp(""SIE_DISCOUNT_LINES_V"");
	
	var EarliestDate = ""01/01/1980 00:00:00"";
	
			
	if(OracleDiscountIntComp.Exists())
	{
		SiebelDiscountIntComp = SiebelIntObject.CreatePrimaryIntComp(""Volume Discount"") ;
							
		while (OracleDiscountIntComp.NextRecord())
	  	{
			// Process delete operation
			if(ProcessDelete(OracleDiscountIntComp, SiebelDiscountIntComp)) return;
			
			SiebelDiscountIntComp.NewRecord();
			SiebelDiscountIntComp.SetCopySource(OracleDiscountIntComp);
			
 			// Set the operation code for this Siebel integration component.
			SetOperationCode(SiebelDiscountIntComp, OracleDiscountIntComp);
			
 			SiebelDiscountIntComp.CopyFieldValue(""Name"", ""NAME"");
 			SiebelDiscountIntComp.CopyFieldValue(""Integration Id"", ""INTEGRATION_ID"");
 			SiebelDiscountIntComp.CopyFieldValue(""Description"", ""DESCRIPTION"");
 			
 			var DStartDt = OracleDiscountIntComp.GetFieldValue(""START_DATE_ACTIVE"");
			var DEndDt = OracleDiscountIntComp.GetFieldValue(""END_DATE_ACTIVE"");
											
			if ((DStartDt == null) || (DStartDt == """"))
			{
				DStartDt = EarliestDate;
			}
					
			if ((DEndDt != null) && (DEndDt != """") &&
				(SiebeltoDate(DStartDt).getTime() > SiebeltoDate(DEndDt).getTime()))
			{
		  		DEndDt = DStartDt;
	  		}
	  		
	  		  						  				
	  		SiebelDiscountIntComp.SetFieldValue(""Start Date"", DStartDt);
	  		SiebelDiscountIntComp.SetFieldValue(""End Date"", DEndDt) ;
 		 		
	 										
				
			// SIE_PRICE_BREAK_LINES_V
			
 			OraclePriceBreakIntComp = 
 				OracleDiscountIntComp.GetIntComp(""SIE_PRICE_BREAK_LINES_V"");
 				
 			if(OraclePriceBreakIntComp.Exists())
			{
				SiebelDiscountItemIntComp = 
					SiebelDiscountIntComp.CreateIntComp(""Volume Discount Item"");
					
				while(OraclePriceBreakIntComp.NextRecord())
				{
					SiebelDiscountItemIntComp.NewRecord();
					SiebelDiscountItemIntComp.SetCopySource(OraclePriceBreakIntComp);
					
					// Set the Operation Code for this component
					SetOperationCode(SiebelDiscountItemIntComp, OraclePriceBreakIntComp);
					
					var CalculatedAmount, DiscountName;
					var Percent = OraclePriceBreakIntComp.GetFieldValue(""PERCENT"");
					var Price 	= OraclePriceBreakIntComp.GetFieldValue(""PRICE"");
					var Amount 	= OraclePriceBreakIntComp.GetFieldValue(""AMOUNT"");
					var BasePrice = OraclePriceBreakIntComp.GetFieldValue(""LIST_PRICE"");
					
					if (Percent == null || Percent =="""") 
					{
						if (Price != null && Price != """")
						{
							CalculatedAmount = BasePrice - Price;
							Percent = CalculatedAmount * (100 / BasePrice);
						}
					
						else if (Amount != null && Amount != """")
						{
							Percent = Amount * (100 / BasePrice);
						}
					}
					
					DiscountName = OraclePriceBreakIntComp.GetFieldValue(""NAME"");
					DiscountName = DiscountName	+ ""-"" + Percent + ""%"" ;
					SiebelDiscountItemIntComp.SetFieldValue(""Name"", DiscountName);
					SiebelDiscountItemIntComp.CopyFieldValue(""Integration Id"", ""INTEGRATION_ID"");
					SiebelDiscountItemIntComp.CopyFieldValue (""Minimum Quantity"", ""PRICE_BREAK_LINES_LOW_RANGE"");
					SiebelDiscountItemIntComp.CopyFieldValue(""Maximum Quantity"", ""PRICE_BREAK_LINES_HIGH_RANGE"");
					SiebelDiscountItemIntComp.SetFieldValue(""Discount Percent"", Percent);
								
				} ///~ while(OraclePriceBreakIntComp.NextRecord())
			} ///~ if(OraclePriceBreakIntComp.Exists())
		
	} ///~ while (OracleDiscountIntComp.NextRecord())
  } ///~ if (OracleDiscountIntComp.Exists())
} ///~ End of function CopyFields"
function ProcessDelete(OracleComp, SiebelComp)
{
	// If not a delete return false.
	// If delete (X or D) perform delete through COM interface.  X indicates that
	// there should be a D at a lower level.
	// 
	// For Discounts we expect deletes at price break level only.  We should see:
	//   X  Discount
	//   X  Discount Lines
	//   D  Price Break
	
	var opCode;
	
	opCode = OracleComp.GetFieldValue(""SysOp"");
	if (opCode == ""D"")
	{
		// Delete of Discount not supported.
		EAIRaiseError(TranslateMessage(""ORA_MSG_INVALID_DELETION,SIE_DISCOUNT_LINES_V""));
	}
	else if (opCode == ""X"")
	{
		// Expect delete at price break
		OracleComp = OracleComp.GetIntComp(""SIE_PRICE_BREAK_LINES_V"");
		if (!OracleComp.Exists() || !OracleComp.NextRecord())
			EAIRaiseError(TranslateMessage(
				""ORA_MSG_MISSING_COMPONENT,SIE_PRICE_BREAK_LINES_V,SIE_DISCOUNT_LINES_V""));
		
		opCode = OracleComp.GetFieldValue(""SysOp"");
		if (opCode == ""D"")
		{
			// Delete price break
					
			with (SiebelComp)
			{
				NewRecord ();
				SetCopySource(OracleComp);
				SetFieldValue(""operation"", ""upsert"");
				CopyFieldValue(""Integration Id"", ""DISCOUNT_LINE_ID"");
			}
			
			var SiebelDiscountItemIntComp = SiebelComp.CreateIntComp (""Volume Discount Item"");	
			with (SiebelDiscountItemIntComp)
			{
				NewRecord ();
				SetCopySource(OracleComp);
				SetFieldValue(""operation"", ""delete"");
				var IntegrationId = OracleComp.GetFieldValue(""DISCOUNT_LINE_ID"") + ""-"" +
					OracleComp.GetFieldValue(""PRICE_BREAK_LINES_LOW_RANGE"");
				SetFieldValue(""Integration Id"", IntegrationId);
			}	
			
			return true;
		}
		else
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_INVALID_SYSOP,""+opCode+"",SIE_PRICE_BREAK_LINES_V""));
	}
		
	else return false;  // Not a delete
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
"/**
 * This function will read the field 'SysOp' from the Oracle integration 
 * component and depending on the value of that field, we will have to
 * populate the Siebel integration component with the values
 * ""delete"" or ""upsert"". The field that should be populated in the Siebel
 * side is ""operation"".
 */
function SetOperationCode(SiebelIntComp, OracleIntComp)
{
	var opCode = OracleIntComp.GetFieldValue(""SysOp"");
	if(opCode == ""D"")
	{
		SiebelIntComp.SetFieldValue (""operation"", ""delete"");
	}
	else
		SiebelIntComp.SetFieldValue (""operation"", ""sync"");
}
function SiebeltoDate(SiebelDate)
{
	var split1 = SiebelDate.split(""/"");
	var split2 = split1[2].split("" "");
	var split3 = split2[1].split("":"");
	return new Date(split2[0], split1[0]-1, split1[1], split3[0], split3[1], split3[2]);
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function dateToString(dateObj, incr) {
	var strDate = """";
	strDate += dateObj.getMonth()+1 + ""/"" + (dateObj.getDate()+incr) + ""/"" + dateObj.getFullYear();
	strDate += "" "" + dateObj.getHours() + "":"" + dateObj.getMinutes() + "":"" + (dateObj.getSeconds() + incr);
	return strDate;
}
#include "eaisiebel.js"
"//#define INT_OBJ_NAME   ""IntObjName""
//#define ROOT_COMP_NAME ""RootCompName""

function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{	
   var INT_OBJ_NAME = ""IntObjName"";
   var ROOT_COMP_NAME = ""RootCompName"";

   var intObjName = Inputs.GetProperty (INT_OBJ_NAME);
   var rootCompName = Inputs.GetProperty (ROOT_COMP_NAME);
   
   var mapOutput = EAICreateIntMsgOut (Outputs);

   var outIntObj = mapOutput.CreateIntObj (intObjName);

   outIntObj.NewInstance ();

   var rootComp = outIntObj.CreatePrimaryIntComp (rootCompName);

   rootComp.NewRecord ();
     
   var propName = """";
   var propVal = """";
   propName = Inputs.GetFirstProperty();
   while (propName != """")
   {
      propVal = Inputs.GetProperty(propName);
      if ((propName != INT_OBJ_NAME) && (propName != ROOT_COMP_NAME))
      {
         rootComp.SetFieldValue(propName, propVal);
      }
      propName = Inputs.GetNextProperty();
   }
 
   return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if(MethodName == ""TestBS"") {
		var bsTest = TheApplication().GetService(""TECHM BS IF COMMON"");
		//if(!defined(bsTest))
       	//bsTest = TheApplication().GetService(""TECHM BS IF COMMON"");

		var mpsInp	= TheApplication().NewPropertySet();
		var mpsOp	= TheApplication().NewPropertySet();
		
		mpsInp.SetProperty(""Sub Type"",""SEQ"");
		mpsInp.SetProperty(""BC Short Name"",""NMASSOC"");
		mpsInp.SetProperty(""Prefix"","""");
		mpsInp.SetProperty(""Length"",""6"");
		mpsInp.SetProperty(""SysPrefPrefix"",""RMS"");
	
		bsTest.InvokeMethod(""Get Next Id"", mpsInp, mpsOp);

		var msNextId = mpsOp.GetProperty(""Next Id"");
		var test= ""123"";
		
		return (CancelOperation);
	} else
		return (ContinueOperation);
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
    CanInvoke = true;
	return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var msg = Inputs.GetProperty(""InputMessage"");
	var outMsg = ""What do you mean by "" + msg + ""?"";
	Outputs.SetProperty(""OutputMessage"", outMsg);
	return (CancelOperation);
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
    CanInvoke = true;
	return (CancelOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var name = Inputs.GetProperty(""Name"");
	var question = Inputs.GetProperty(""Question"");
	var hint = Inputs.GetProperty(""Hint"");	
	
	var answer = ""Dear "" + name + "", I can't answer your question ["" + question + ""]. Call 1-800-INEEDHELP."";
	Outputs.SetProperty(""Answer"", answer);
	Outputs.SetProperty(""Hint"", ""Your hint didn't help me find the answer."");
	Outputs.SetProperty(""RandomThought"", ""I think you should try Yoga."");
	return (CancelOperation);
}
function CheckActivity (Inputs, Outputs)
{
	var theApp;
	var oppBO;
	var postnBC, actionBC, oppBC;
	var oppId, employeeId;


	theApp = TheApplication();	
    oppBO = theApp.ActiveBusObject();
    oppBC = oppBO.GetBusComp(""Opportunity"");
    postnBC = oppBO.GetBusComp(""Position"");
    actionBC = oppBO.GetBusComp(""Action"");
    
    oppId = oppBC.GetFieldValue(""Id"");
    employeeId = postnBC.GetFieldValue(""Primary Employee Id"");
	
	actionBC.ClearToQuery() ;
	
	actionBC.SetSearchSpec(""Owned By Id"", employeeId);
	actionBC.ExecuteQuery();

	if (actionBC.FirstRecord())
 	   Outputs.SetProperty(""PopupMessage"", ""Y"");
 	else
 	   Outputs.SetProperty(""PopupMessage"", ""N"");

	return;
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   if (MethodName==""CheckActivity"")
   {
	    CheckActivity(Inputs,Outputs);
        return (CancelOperation);
   }
   else
	    return (ContinueOperation);
	    
}
function Func_CopyPropSet( Inputs, Outputs)
{
  var propName = """";
  var propVal = """";
  var child;

  Outputs.SetType(Inputs.GetType());
  Outputs.SetValue(Inputs.GetValue());

  propName = Inputs.GetFirstProperty();
  while (propName != """")
  {
    propVal = Inputs.GetProperty(propName);
    Outputs.SetProperty(propName, propVal);
    propName = Inputs.GetNextProperty();  
  }    

  for (var i = 0; i < Inputs.GetChildCount(); i++)
  {
  	 child = Inputs.GetChild(i);
     Outputs.AddChild(child.Copy());
  }

}
function Func_CreateSignOn(Inputs)
{
  var child;
  var grdChild;

  // Enumerate the first layer header definition  
  for (var i=0; i < Inputs.GetChildCount(); i++)
  { 
  
  	child = Inputs.GetChild(i);
  	
  	if ( child.GetType() == ""UsrLoginSegment"")
  	{  	 
  	        
		for (var j=0; j < child.GetChildCount(); j++)
		{
		    grdChild = child.GetChild(j);
		    
			if (grdChild.GetType() == ""LoginUserId"")
			{
				grdChild.SetValue(""UserId"");   
			}
			
			if (grdChild.GetType() == ""LoginCurPassword"")
			{
				grdChild.SetValue(""PASSWD"");
			}
		}
		
  	}
  	else
  	{
  	  // Remove other header definitions
  	  Inputs.RemoveChild(i--);
  	}
  	
  }

}
function Func_GenerateHeader (Inputs, Outputs)
{
  var child;

  // Enumerate the first layer header definition  
  for (var i = 0; i < Outputs.GetChildCount(); i++)
  {
  	child = Outputs.GetChild(i);
  	
  	if ( child.GetType() == ""SignonRq"")
  	{  	 
  	  // Create SignOn Segment
  	  Func_CreateSignOn(child);
  	}
  	else if (child.GetType() != ""xxxSvcRq"")
  	{
  	  // Remove other header definitions
  	  Outputs.RemoveChild(i--);
  	}
  }  
}
function Func_PreProcessBody (Inputs, Outputs)
{

  var serviceName;
  
  if (Inputs.PropertyExists(""SiebelFINSObjType""))
  {
      Func_CopyPropSet(Inputs, Outputs);
  }   
  else if (Inputs.PropertyExists(""Service Name""))
  {
  	  serviceName = Inputs.GetProperty(""Service Name"");	  	 
  	  Outputs.SetType(serviceName);
  	  Outputs.AddChild(Inputs.Copy());
  }
  else
  {
  	  Func_CopyPropSet(Inputs, Outputs);
  }  

}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
    var retVal = CancelOperation;

    if (MethodName == ""GenerateHeader"") {
  		Func_GenerateHeader(Inputs, Outputs);
    }
    else if (MethodName == ""PreProcessBody"") {
        Func_PreProcessBody(Inputs, Outputs);
    }
    else {
       retVal = ContinueOperation;
    }
    
	return (retVal);
}
function CheckForErrors(Inputs, Outputs)
{
		var errorText;

		errorText = Inputs.GetValue(); 

		if(errorText.indexOf("faultMessage"")==-1)
			Outputs.SetValue("false"");
		else
			Outputs.SetValue(""true"");

}
function DisplayErrors(Inputs, Outputs)
{
	var errorText=Inputs.GetValue();
	TheApplication().RaiseErrorText(errorText);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{

	if(MethodName==""TranslateErrors"")
	{
		TranslateErrors(Inputs, Outputs);
	}
	if(MethodName==""WriteErrosToLog"")
	{
		WriteErrosToLog(Inputs, Outputs);
	}
	if(MethodName==""DisplayErrors"")
	{
		DisplayErrors(Inputs, Outputs);
	}
	if(MethodName==""CheckForErrors"")
	{
		CheckForErrors(Inputs, Outputs);
	}
	return (CancelOperation);
}
function TranslateErrors(Inputs, Outputs)
{
	var errorMessages;
	var errorText;
	errorMessages = Inputs.GetValue();
	//var fp = Clib.fopen(""c:\\debug.log"",""w"");
	//Clib.fputs(""Input Error Message""+errorMessages+""\n\n\n"" ,fp);
	var translatedErrors;
	translatedErrors=""Following Error Has Occured in Process: "";
	var firstindex;
	var lastindex;
	var faultMessage;
	var codefindx,codelindx,argfindx,arglindx,arg,code;

			codefindx = errorMessages.indexOf(""processName"");
			if(codefindx>-1)
			{
				codelindx = errorMessages.indexOf(""&lt;"",codefindx+15);
				if(codelindx>-1)
					translatedErrors = translatedErrors + errorMessages.substring(codefindx+15, codelindx);
			}


			codefindx = errorMessages.indexOf("flowName"");
			if(codefindx>-1)
			{
				codelindx = errorMessages.indexOf(""&lt;"",codefindx+12);
				if(codelindx>-1)
					translatedErrors = translatedErrors +""\nFlow Name: ""+ errorMessages.substring(codefindx+12, codelindx);
			}

			codefindx = errorMessages.indexOf("flowContext"");
			if(codefindx>-1)
			{
				codelindx = errorMessages.indexOf(""&lt;"",codefindx+15);
				if(codelindx>-1)
					translatedErrors = translatedErrors +""\nFlow Context: ""+ errorMessages.substring(codefindx+15, codelindx);
			}

			codefindx = errorMessages.indexOf(""processCallStack"");
			if(codefindx>-1)
			{
				codelindx = errorMessages.indexOf(""&lt;"",codefindx+20);
				if(codelindx>-1)
					translatedErrors = translatedErrors +""\nProcess Call Stack: ""+ errorMessages.substring(codefindx+20, codelindx);
			}

	translatedErrors = translatedErrors +""\nError Messages: \n\n"";
	codefindx=0;
	codelindx=0
	firstindex=0;
	var count=0;
	while(true)
	{
		while(true)
		{
			firstindex = errorMessages.indexOf(""errorMessage"",firstindex);
			var tempIndx = errorMessages.indexOf(""errorMessageSet"",firstindex);
			if(firstindex != tempIndx || firstindex == -1)
				break;
			else
				firstindex = firstindex + 14;
		}
		count++;
		if(firstindex == -1)	
		{
			//Clib.fputs(""No occurence of <errorMessage>. Loop End.\n"",fp);
			break;
		}
		else
		{	lastindex = errorMessages.indexOf(""errorMessage"",firstindex+16);
			if(lastindex == -1)	
			{
				//Clib.fputs(""No occurence of </errorMessage>. Loop End\n"",fp);
				break;
			}

			faultMessage = errorMessages.substring(firstindex+16, lastindex-9);	

			codefindx = faultMessage.indexOf(""code"");
			codelindx = faultMessage.indexOf(""code"",codefindx+8);
			errorText="""";
			if(codelindx>-1)
			{
				code = faultMessage.substring(codefindx+8, codelindx-9);
				errorText = code;


				argfindx=0;
				while(true)
				{
					argfindx = faultMessage.indexOf(""argument"",argfindx);
					if(argfindx == -1)	
						break;
					arglindx = faultMessage.indexOf(""argument"",argfindx+13);
					if(arglindx == -1)	
						break;
					arg = faultMessage.substring(argfindx+13, arglindx-9);
					errorText = errorText +""|""+ arg
					argfindx = arglindx+13;
				}
				//Clib.fputs(""Translating Error Message:\n""+errorText,fp);
				var e;
				try{
					errorText = TranslateMessage_2(errorText);
				}catch(e)
				{
					//Clib.fputs(e,fp);
					errorText="""";
				}	
				//Clib.fputs(""Translated Error Message:\n""+errorText,fp);
			}		
			if(codelindx==-1 || errorText=="""")
			{
				//Clib.fputs(""No error code/ no error message present for code.Finding <text>"",fp);
				var textfindx = faultMessage.indexOf(""text&gt;"",0);
				if(textfindx>-1)
				{

					var textlindx = faultMessage.indexOf(""text&gt;"",textfindx+8);
					if(textlindx>-1)
					{
						errorText = faultMessage.substring(textfindx+8, textlindx-9);
					}
					else
					{
						errorText = ""Not able to translate <errorMessage> node as it doesnot have valid data. XML =>""+faultMessage;
					}
						//Clib.fputs(""<text> found =>""+errorText+""\n"",fp);
				}
				else
				{
					//Clib.fputs(""No <text> present in =>.""+faultMessage+"" \n"",fp);
					errorText = ""Not able to translate <errorMessage> node as it doesnot have valid data. XML =>""+faultMessage;
				}

			}
			translatedErrors = translatedErrors + ""[Error] "" + errorText  + ""\n"" ;
		}
		firstindex=lastindex+16;
	}
	//Clib.fputs(""Translation Complete. Translated Message=>\n""+translatedErrors,fp);
	Outputs.SetValue(translatedErrors);	
	//Clib.fclose(fp);
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in January 2005
	//
	// Message is a string of pipe '|' separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// CUIF_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example :
	//
	// Message:
	//   CUIF_MSG_PARENT_ACC_NOT_SYNCED|Siebel Systems|CUIF_MSG_SYNC_ACC_FIRST|Siebel Systems
	// Parameterized text:
	//   CUIF_MSG_PARENT_ACC_NOT_SYNCED=""Parent Account '%1' not synced""
	//   CUIF_MSG_SYNC_ACC_FIRST="" please Sync '%1' first.""
	// Result:
	//   ""Parent Account 'Siebel Systems' not synced please Sync 'Siebel Systems' first.""
	//
	// Warning!!!  The pipe '|' is the delimiter so if u have '|' in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""CUIF_MSG"";
	var LOVType = ""CUIF_MESSAGE"";
	
	if (Message.substring(0,8) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split('|');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,8) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,8) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function TranslateMessage_2(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created in January 2005
	//
	// Message is a string of pipe '|' separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent Name of the Message object, as defined in Siebel Tools, whose text
	// contains the acrual error messagein turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// CUIF_MSG the message is returned untranslated.  A message can have 
	// up to five parameters, %1,%2,...,%5.  You can modify the script code to support as many
	// parameters you want. 
	// An example :
	//
	// Message:
	//   CUIF_MSG_PARENT_ACC_NOT_SYNCED|Siebel Systems
	// Parameterized text:
	//   CUIF_MSG_PARENT_ACC_NOT_SYNCED=""Parent Account '%1' not synced please Sync '%1' first.""
	//   
	// Result:
	//   ""Parent Account 'Siebel Systems' not synced please Sync 'Siebel Systems' first.""
	//
	// Warning!!!  The pipe '|' is the delimiter so if u have '|' in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""UAN"";
	var category = ""Genesis Error Messages"";
	var oMessage;
	
	/*if (Message.substring(0,3) != prefix)
		// Don't translate
		return (Message);*/
	
	var pieces = Message.split('|');
	var piecesLen = pieces.length;

	switch(piecesLen)
	{
		case 1:
			oMessage = TheApplication().LookupMessage (category, pieces[0]);
			break;
		case 2:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1]);
			break;
		case 3:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1], pieces[2]);
			break;
		case 4:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1], pieces[2], pieces[3]);
			break;
		case 5:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1], pieces[2], pieces[3], pieces[4]);
			break;
		case 6:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1], pieces[2], pieces[3], pieces[4], pieces[5]);
			break;
		default:
			oMessage = TheApplication().LookupMessage (category, pieces[0], pieces[1], pieces[2], pieces[3], pieces[4], pieces[5]);
			break;
	}
	return (oMessage);
}
function WriteErrosToLog(Inputs, Outputs)
{
	var errorText=Inputs.GetProperty(""ErrorMessages"");
	var tm = Clib.localtime(Clib.time());
	var tmStr = Clib.asctime(tm);
	errorText= tmStr + "" : "" + errorText;
	var logFileName= Inputs.GetProperty(""LogFileName"");

	var fp = Clib.fopen(logFileName,""a"");
	if ( fp == null )
	{
		TheApplication().RaiseErrorText(""\aError opening file for reading.\n"");
	}
	else
	{
		Clib.fputs(errorText, fp);
	}
	Clib.fclose(fp);
}
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{

  /*
   *  The methods are intercepted in the following cases
   *  CopyQuote, CopyOrder, 
   *  ReviseCopyQuote, ReviseCopyOrder,ReviseCopyAgreement
   *
   *  However, QuoteToSalesOrder(when a quote is converted to an order)
   *  AutoAgreement,
   *  
	 */
	if (MethodName == ""Copy"")
	{
		var copyContext = Inputs.GetProperty(""CopySignalName"");
		if (copyContext == ""CopyQuote"" || 
		    copyContext == ""ReviseCopyQuote"" 
		   )
		{
			syncQuoteLineswithOracle(Inputs,Outputs);
		} 
		else if (copyContext == ""CopyOrder"" ||
		        copyContext == ""ReviseCopyOrder""
		         )
		{
			syncOrderLineswithOracle(Inputs,Outputs);
		}
		else if (copyContext == ""ReviseCopyAgreement"")
		{
		  syncAgreementLineswithOracle(Inputs,Outputs);
		}
	}
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
		return (ContinueOperation);
}
function syncAgreementLineswithOracle(Inputs, Outputs)
{

	var prodId = new Array ;
	var rootAgreementItemId = new Array;
	var sourceAgreementId = new Array;
	var sourceConfigHeader = new Array;
	var sourceConfigRevNbr = new Array;
	var svc1;
	var bOracleProduct;
	
	var sourceConfigHeader;
	var sourceConfigRevNbr
	
	var bo = TheApplication().GetBusObject(""Service Agreement"");
	var destAgreementId = Inputs.GetProperty(""RowId"");
	var bc = bo.GetBusComp(""FS Agreement Item"");

   //get the source configuration information
	try 
	{
		bc.ClearToQuery();
		
		var bcSearchStr = ""[Agreement Id] ='"" 

		bcSearchStr = bcSearchStr + destAgreementId 	                             	               
		bcSearchStr = bcSearchStr + ""'"";                             	               
		bcSearchStr = bcSearchStr + "" AND "" ;
		bcSearchStr = bcSearchStr + ""[Id]=[Root Agreement Item Id]""; //to check only for root items
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		
		var countRecs = bc.CountRecords();
		var i = 0;
		
		var isOCPi = TheApplication().NewPropertySet();
		var isOCPo = TheApplication().NewPropertySet();
		var bOracleProduct;
		var isOCPSvc;

		
		if (bc.FirstRecord())
		{
			do 
			{
				var productId = bc.GetFieldValue(""Product Id"");
				
				isOCPi.SetProperty(""BusCompName"",bc.Name())
				isOCPi.SetProperty(""ProductId"",productId);
					
				isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
				isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
		
				bOracleProduct = isOCPo.GetProperty(""IsOracleProduct"");

				if (bOracleProduct==""true"")
				{					
					prodId[i] = bc.GetFieldValue(""Root Product Id"");
					rootAgreementItemId[i] = bc.GetFieldValue(""Root Agreement Item Id"");
					sourceAgreementId[i] = bc.GetFieldValue(""Agreement Id"")
					sourceConfigHeader[i] =  bc.GetFieldValue(""External Configurator Reference 1"");
					sourceConfigRevNbr[i] = bc.GetFieldValue(""External Configurator Reference 2"");
					i++;
				}
			} while(bc.NextRecord())
		}

	 	
	    // update the rows		 	    
	    for (var k = 0; k< prodId.length; k++)
	    { 
			var indata1 =TheApplication().NewPropertySet ();
			var outdata1 = TheApplication().NewPropertySet ();
			indata1.SetProperty (""RootItemId"", rootAgreementItemId[k]);
			indata1.SetProperty (""QuoteorOrderorAgreementId"", destAgreementId);
			indata1.SetProperty(""SourceConfigHeader"",sourceConfigHeader[k]);
			indata1.SetProperty(""SourceConfigRevNbr"",sourceConfigRevNbr[k]);
			indata1.SetProperty(""BusinessObject"",bo.Name());					
			indata1.SetProperty(""BusinessComponent"",bc.Name());
			
			var svc1 = TheApplication().GetService(""CZIntegCopyConfigService"");
			svc1.InvokeMethod(""CopyOracleConfiguration"", indata1, outdata1);
	
	    }
	}
	catch  (e) 
	{
	  TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		throw e;
	}
	finally
	{
			indata1 = null;
			outdata1 = null
			svc1 = null;
		  bOracleProduct = null;
			isOCPi = null;
			isOCPo = null;
			isOCPSvc = null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;
			destAgreementId  = null;
			bo = null;
			bc = null;;
			prodId = null;
			rootAgreementItemId = null;
			sourceAgreementId =  null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;
	}
  }
function syncOrderLineswithOracle(Inputs, Outputs)
{

 	var prodId = new Array ;
	var rootOrderItemId = new Array;
	var sourceOrderId = new Array;
    var sourceConfigHeader = new Array;
    var sourceConfigRevNbr = new Array;

	var svc1;
	var bOracleProduct;
 
	var sourceConfigHeader;
	var sourceConfigRevNbr

	var searchSpec = Inputs.GetProperty(""SearchSpec"");
	var destOrderId = Inputs.GetProperty(""RowId"");
	var bo = TheApplication().GetBusObject(""Order Entry"");
	var bc = bo.GetBusComp(""Order Entry - Line Items"");

   //get the source configuration information
	try 
	{
		bc.ClearToQuery();
		
		var bcSearchStr = ""[Order Header Id] ='"" 
		/*bcSearchStr = bcSearchStr + 
		              searchSpec.substring(searchSpec.indexOf(""'"") +1,
		                     	               searchSpec.lastIndexOf(""'""))*/
		bcSearchStr = bcSearchStr + destOrderId 	                             	               
		bcSearchStr = bcSearchStr + ""'"";                             	               
		bcSearchStr = bcSearchStr + "" AND "" ;
		bcSearchStr = bcSearchStr + ""[IsRootItem] = 'Y'"";
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		
		var countRecs = bc.CountRecords();
		var i = 0;
		
	  	var isOCPi = TheApplication().NewPropertySet();
    		var isOCPo = TheApplication().NewPropertySet();
	    	var bOracleProduct;
	    	var isOCPSvc;
		
		if (bc.FirstRecord())
		{
			do 
			{
								
				var productId = bc.GetFieldValue(""Product Id"");
				
				isOCPi.SetProperty(""BusCompName"",bc.Name())
				isOCPi.SetProperty(""ProductId"",productId);
					
				isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
				isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
		
				bOracleProduct = isOCPo.GetProperty(""IsOracleProduct"");

				if (bOracleProduct == ""true"")
				{					
					prodId[i] = bc.GetFieldValue(""Root Product Id"");
					rootOrderItemId[i] = bc.GetFieldValue(""Root Order Item Id"");
					sourceOrderId[i] = bc.GetFieldValue(""Order Header Id"")
					sourceConfigHeader[i] =  bc.GetFieldValue(""External Configurator Reference 1"");
					sourceConfigRevNbr[i] = bc.GetFieldValue(""External Configurator Reference 2"");
					i++;
				}
			} while(bc.NextRecord())
		}

	 	
	    // update the rows		 	    
	    for (var k = 0; k< prodId.length; k++)
	    { 
			var indata1 =TheApplication().NewPropertySet ();
			var outdata1 = TheApplication().NewPropertySet ();
			indata1.SetProperty (""RootItemId"", rootOrderItemId[k]);
			indata1.SetProperty (""QuoteorOrderorAgreementId"", destOrderId);
			indata1.SetProperty(""SourceConfigHeader"",sourceConfigHeader[k]);
			indata1.SetProperty(""SourceConfigRevNbr"",sourceConfigRevNbr[k]);
			indata1.SetProperty(""BusinessObject"",bo.Name());					
			indata1.SetProperty(""BusinessComponent"",bc.Name());
			
			var svc1 = TheApplication().GetService(""CZIntegCopyConfigService"");
			svc1.InvokeMethod(""CopyOracleConfiguration"", indata1, outdata1);
	
	    }
  	}
	catch  (e) 
	{
		TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		throw e;
	}
	finally
	{
		indata1 = null;
		outdata1 = null
		svc1 = null;
  			bOracleProduct = null;
		isOCPi = null;
		isOCPo = null;
		isOCPSvc = null;
		sourceConfigHeader = null;
		sourceConfigRevNbr = null;
		searchSpec  = null;
		destOrderId  = null;
		bo = null;
		bc = null;;
		prodId = null;
		rootOrderItemId = null;
		sourceOrderId =  null;
		sourceConfigHeader = null;
		sourceConfigRevNbr = null;
	}
  }
function syncQuoteLineswithOracle(Inputs, Outputs)
{

	var prodId = new Array ;
	var rootQuoteItemId = new Array;
	var sourceQuoteId = new Array;
	var sourceConfigHeader = new Array;
	var sourceConfigRevNbr = new Array;
	
	var svc1;
	var bOracleProduct;
	
	var sourceConfigHeader;
	var sourceConfigRevNbr
	
	var searchSpec = Inputs.GetProperty(""SearchSpec"");
	var destQuoteId = Inputs.GetProperty(""RowId"");
	var bo = TheApplication().GetBusObject(""Quote"");
	var bc = bo.GetBusComp(""Quote Item"");

   //get the source configuration information
	try 
	{
		bc.ClearToQuery();
		
		var bcSearchStr = ""[Quote Id] ='"" 
		/*bcSearchStr = bcSearchStr + 
		              searchSpec.substring(searchSpec.indexOf(""'"") +1,
		                     	               searchSpec.lastIndexOf(""'""))*/
		bcSearchStr = bcSearchStr + destQuoteId 	                             	               
		bcSearchStr = bcSearchStr + ""'"";                             	               
		bcSearchStr = bcSearchStr + "" AND "" ;
		bcSearchStr = bcSearchStr + ""[IsRootItem] = 'Y'"";
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		
		var countRecs = bc.CountRecords();
		var i = 0;
		
		var isOCPi = TheApplication().NewPropertySet();
		var isOCPo = TheApplication().NewPropertySet();
		var bOracleProduct;
		var isOCPSvc;

		
		if (bc.FirstRecord())
		{
			do 
			{
										
				var productId = bc.GetFieldValue(""Product Id"");
				
				isOCPi.SetProperty(""BusCompName"",bc.Name())
				isOCPi.SetProperty(""ProductId"",productId);
					
				isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
				isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
		
				bOracleProduct = isOCPo.GetProperty(""IsOracleProduct"");

				if (bOracleProduct == ""true"")
				{					
					prodId[i] = bc.GetFieldValue(""Root Product Id"");
					rootQuoteItemId[i] = bc.GetFieldValue(""Root Quote Item Id"");
					sourceQuoteId[i] = bc.GetFieldValue(""Quote Id"")
					sourceConfigHeader[i] =  bc.GetFieldValue(""External Configurator Reference 1"");
					sourceConfigRevNbr[i] = bc.GetFieldValue(""External Configurator Reference 2"");
					i++;
				}
			} while(bc.NextRecord())
		}

	 	
    // update the rows		 	    
    for (var k = 0; k< prodId.length; k++)
    { 
		var indata1 =TheApplication().NewPropertySet ();
		var outdata1 = TheApplication().NewPropertySet ();
		indata1.SetProperty (""RootItemId"", rootQuoteItemId[k]);
		indata1.SetProperty (""QuoteorOrderorAgreementId"", destQuoteId);
		indata1.SetProperty(""SourceConfigHeader"",sourceConfigHeader[k]);
		indata1.SetProperty(""SourceConfigRevNbr"",sourceConfigRevNbr[k]);
		indata1.SetProperty(""BusinessObject"",bo.Name());					
		indata1.SetProperty(""BusinessComponent"",bc.Name());
		
		var svc1 = TheApplication().GetService(""CZIntegCopyConfigService"");
		svc1.InvokeMethod(""CopyOracleConfiguration"", indata1, outdata1);
				
	    }
	}
	catch  (e) 
	{
	  TheApplication().RaiseErrorText(e.toString());
	//	TheApplication().Trace(e.toString());
		throw e;
	}
	finally
	{

			indata1 = null;
			outdata1 = null
			svc1 = null;
	  	bOracleProduct = null;
			isOCPi = null;
			isOCPo = null;
			isOCPSvc = null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;
			searchSpec  = null;
			destQuoteId  = null;
			bo = null;
			bc = null;
			prodId = null;
			rootQuoteItemId = null;
			sourceQuoteId =  null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;

	}
  }
"var existingRootItems = new Array;

//when saving as a favorite, the process of obtaining the
//destination quote is slightly different - it is
//not available in the input property set
//get the source fro quote bo, and
//get the destination from template header bc



//when there are existing items in a quote or an order
//we need to keep track of those items so we do not
//run copy config on existing line items







"
"//this is a compare function need to sort
//the elements in the existing items array
//so that a binary search can be performed to
//see if copy config needs to be called
//on existing items.
function ListCompareFunction(Item1, Item2)
{
  var val1= Item1;
  var val2= Item2;
  return Clib.strcmpi(Item1,Item2);
}
"
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{

  //For saving as favorites,
  //quote and order are both stored in 
  //S_DOC_QUOTE(header) and S_QUOTE_ITEM(line item).  Therefore the same
  //routine should work fine.

  if (MethodName == ""SaveAsTemplate"") // this saving as favorites
  {
    syncFavQuoteTemplateLineswithOracle(Inputs, Outputs);
  }
  //restoring from favorites
  //either adding from individual lines or adding all the lines
  else if (MethodName = ""OrderTemplate"" || MethodName == ""OrderTemplateSelectItems"") //restoring from favorites
  {
	   syncTargetLineswithOracle(Inputs, Outputs);
  }

  

	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
  
  //when there are existing items in a quote or an order
  //we need to keep track of those items so we do not
  //run copy config on existing line items 
  
  if (MethodName == ""OrderTemplate"" || MethodName == ""OrderTemplateSelectItems"") // on restoring from Favourites
  {
    var SysPrefName =  ""Enable AIA OrderToCash"";
    var SysPrefVal;
    var SysPrefBo = TheApplication().GetBusObject(""System Preferences"");
    var SysPrefBc = SysPrefBo.GetBusComp(""System Preferences"");
    SysPrefBc.ClearToQuery();
    SysPrefBc.ActivateField(""Value"");
    SysPrefBc.SetViewMode(AllView);
    SysPrefBc.SetSearchSpec(""Name"", SysPrefName);
    SysPrefBc.ExecuteQuery( ForwardOnly );

    if (SysPrefBc.FirstRecord())
    {
        SysPrefVal = SysPrefBc.GetFieldValue(""Value"");
    }
    if(SysPrefVal == ""TRUE"")
    {
        storeAllexistingRootItems(Inputs,Outputs)
    }    
  }
  
   return (ContinueOperation);
}
function getDestOrderorQuoteId(Inputs, Outputs)
{

	try
	{
		var destId;
		
		 //template name is unique, so querying by template
		 //name should be good.		
		var sourceName = Inputs.GetProperty(""TemplateName"");
		
		//saving from either quotes or orders as favorites uses
		//the same business objects and business components
		var templatebo = TheApplication().GetBusObject(""Quote"");
		var templatebc = templatebo.GetBusComp(""Quote Catalog - Template Header"");

		var templateSearch = ""[Name] = '"" + sourceName + ""'"";
		templateSearch = templateSearch + "" AND "" ;
		templateSearch = templateSearch + ""[Quote Type] = 'Template'"";
		
		templatebc.ClearToQuery();
		templatebc.SetSearchExpr(templateSearch);
		templatebc.ExecuteQuery();
	
		var countRecs = templatebc.CountRecords();
		if (templatebc.FirstRecord())
		{
			destId = templatebc.GetFieldValue(""Quote Number"");
		}
		
		return destId;
	}
	catch  (e) 
	{
	//	TheApplication().Trace(e.toString());
		throw e;
	}
	finally
	{
		 countRecs = null;
		 templatebo = null;
		 templatebc=null;
		 templateSearch = null;
	}

	
}
function storeAllexistingRootItems(Inputs, Outputs)
{
	var prodId = new Array ;
	var srcrootQuoteorOrderItemId = new Array;
	var sourceConfigHeader = new Array;
	var sourceConfigRevNbr = new Array;
	
	var svc1;
	var bOracleProduct;
	
	var sourceConfigHeader;
	var sourceConfigRevNbr
	var srcQuoteorOrderId = Inputs.GetProperty(""TargetRowId"");
	
	var bo;
	var bc;
	var fromBusComp;
	var fromBusObj;
	var bcSearchStr
	var rootItemIdColName;
    
   //get the source configuration information
	try 
	{
	
 	 fromBusComp = Inputs.GetProperty(""FromBusCompName"");

  	if (fromBusComp == ""Quote"")
  	{
			bo = TheApplication().GetBusObject(""Quote"");
			bc = bo.GetBusComp(""Quote Item"");
			bcSearchStr = ""[Quote Id] ='"" ;
			rootItemIdColName = ""Root Quote Item Id"";
	  }
	  else 
	  {
	  	bo = TheApplication().GetBusObject(""Order Entry"");
	  	bc = bo.GetBusComp(""Order Entry - Line Items""); 
	  	bcSearchStr = ""[Order Header Id] ='"";
			rootItemIdColName = ""Root Order Item Id"";
	  }
		 
		bc.ClearToQuery();

		bcSearchStr = bcSearchStr + srcQuoteorOrderId;
		bcSearchStr = bcSearchStr + ""'"";                             	               
		bcSearchStr = bcSearchStr + "" AND "" ;
		bcSearchStr = bcSearchStr + ""[IsRootItem] = 'Y'"";
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		
		var countRecs = bc.CountRecords();
		var i = 0;
		
		var isOCPi = TheApplication().NewPropertySet();
		var isOCPo = TheApplication().NewPropertySet();
		var bOracleProduct;
		var isOCPSvc;
		
		//collect all existing items
		if (bc.FirstRecord())
		{
			do 
			{
							
				var productId = bc.GetFieldValue(""Product Id"");
			
				isOCPi.SetProperty(""BusCompName"",""Template Item"")
				isOCPi.SetProperty(""ProductId"",productId);
				
				var isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
				isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
	
				bOracleProduct = isOCPo.GetProperty(""IsOracleProduct"");
	
				if (bOracleProduct == ""true"")
				{					
					existingRootItems[i] = bc.GetFieldValue(rootItemIdColName);
					i++;
				}
			} while(bc.NextRecord())
		}
	}
	catch (e) 
	{
	//	TheApplication().Trace(e.toString());
	  TheApplication().RaiseErrorText(e.toString());
		throw e;
	}
	finally
	{
		bOracleProduct = null;
		bcSearchStr = null;
		bo = null;
		bc = null;
	}
	 	 
}
"//this routine gets executed when
//saving an order or quote as a favorite.
function syncFavQuoteTemplateLineswithOracle(Inputs, Outputs)
{

	var prodId = new Array ;
	var rootQuoteItemId = new Array;
	var sourceConfigHeader = new Array;
	var sourceConfigRevNbr = new Array;
	
	var svc1;
	var bOracleProduct;
	
	var sourceConfigHeader;
	var sourceConfigRevNbr
	var destQuoteId;
	
	var bo;
	var bc;
	  
	  //get the source configuration information
	try 
	{
	
		var bo = TheApplication().GetBusObject(""Quote"");
		var bc = bo.GetBusComp(""Quote Item"");
	
	   //get the destination quote id by looking up
	   //templates(favorites) by its name.  Names are
	   //unique and we should be ok here.	
	  	destQuoteId = getDestOrderorQuoteId(Inputs, Outputs)
	
		bc.ClearToQuery();
		
		var bcSearchStr = ""[Quote Id] ='"" 
		bcSearchStr = bcSearchStr + destQuoteId 	                             	               
		bcSearchStr = bcSearchStr + ""'"";                             	               
		bcSearchStr = bcSearchStr + "" AND "" ;
		bcSearchStr = bcSearchStr + ""[IsRootItem] = 'Y'"";
		bc.SetSearchExpr(bcSearchStr);
		bc.ExecuteQuery();
		
		var countRecs = bc.CountRecords();
		var i = 0;
		
		//get all the records for which copy config needs
		//to be called.  Get only the root, the two columns,
		//External Configurator Reference 1 and 
		//External Configurator Reference 2 will have the
		//same values anyway for all the lines in a particular
		//quote/order
	
	    var isOCPi = TheApplication().NewPropertySet();
	    var isOCPo = TheApplication().NewPropertySet();
	    var bOracleProduct;
	    var isOCPSvc;
	    
		if (bc.FirstRecord())
		{
			do 
			{
							
				var productId = bc.GetFieldValue(""Product Id"");
			
				isOCPi.SetProperty(""BusCompName"",""Template Item"")
				isOCPi.SetProperty(""ProductId"",productId);
				
				isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
				isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
	
				bOracleProduct = 		isOCPo.GetProperty(""IsOracleProduct"");
	
				if (bOracleProduct==""true"")
				{					
					prodId[i] = bc.GetFieldValue(""Root Product Id"");
					rootQuoteItemId[i] = bc.GetFieldValue(""Root Quote Item Id"");
					sourceConfigHeader[i] =  bc.GetFieldValue(""External Configurator Reference 1"");
					sourceConfigRevNbr[i] = bc.GetFieldValue(""External Configurator Reference 2"");
					i++;
				}
			} while(bc.NextRecord())
		}
	
	 	
		
	   // update the rows		 	    
	   for (var k = 0; k< prodId.length; k++)
	   { 
				var indata1 =TheApplication().NewPropertySet ();
				var outdata1 = TheApplication().NewPropertySet ();
				indata1.SetProperty (""RootItemId"", rootQuoteItemId[k]);
				indata1.SetProperty (""QuoteorOrderorAgreementId"", destQuoteId);
				indata1.SetProperty(""SourceConfigHeader"",sourceConfigHeader[k]);
				indata1.SetProperty(""SourceConfigRevNbr"",sourceConfigRevNbr[k]);
				indata1.SetProperty(""BusinessObject"",bo.Name());					
				indata1.SetProperty(""BusinessComponent"",bc.Name());
				
				var svc1 = TheApplication().GetService(""CZIntegCopyConfigService"");
				svc1.InvokeMethod(""CopyOracleConfiguration"", indata1, outdata1);
				
	    }
	}
	catch  (e) 
	{
	//	TheApplication().Trace(e.toString());
		TheApplication().RaiseErrorText(e.toString());
		throw e;
	}
	finally
	{
	
		indata1 = null;
		outdata1 = null
		svc1 = null;
		bOracleProduct = null;
		isOCPi = null;
		isOCPo = null;
		isOCPSvc = null;
		sourceConfigHeader = null;
		sourceConfigRevNbr = null;
		destQuoteId  = null;
		bo = null;
		bc = null;
		prodId = null;
		rootQuoteItemId = null;
		sourceConfigHeader = null;
		sourceConfigRevNbr = null;

	}
  }
"//this routine gets executed when
//retoring a favorite into an order or quote 
function syncTargetLineswithOracle(Inputs, Outputs)
{

		var prodId = new Array ;
		var rootQuoteorOrderItemId = new Array;
		var sourceConfigHeader = new Array;
		var sourceConfigRevNbr = new Array;
		
		
				  
    var destQuoteorOrderId = Inputs.GetProperty(""TargetRowId"");	                       

		var svc1;
		var bOracleProduct;
		
		var sourceConfigHeader;
		var sourceConfigRevNbr
		var bo;
		var bc;
		var fromBusComp;
		var fromBusObj;
		var bcSearchStr;
		var rootItemIdColName;

    //get the target configuration information
		try 
		{
		
		  fromBusObj = Inputs.GetProperty(""FromBusObjName"");
			fromBusComp = Inputs.GetProperty(""FromBusCompName"");

			if (fromBusComp == ""Quote"")
	  	{
				bo = TheApplication().GetBusObject(""Quote"");
				bc = bo.GetBusComp(""Quote Item"");
				bcSearchStr = ""[Quote Id] ='"" ;
				rootItemIdColName = ""Root Quote Item Id"";
		  }
		  else 
		  {
		  	bo = TheApplication().GetBusObject(""Order Entry (Sales)"");
		  	bc = bo.GetBusComp(""Order Entry - Line Items""); 
		  	bcSearchStr = ""[Order Header Id] ='"";
				rootItemIdColName = ""Root Order Item Id"";
		  }

			bc.ClearToQuery();
			
			bcSearchStr = bcSearchStr + destQuoteorOrderId 	                             	               
			bcSearchStr = bcSearchStr + ""'"";                             	               
			bcSearchStr = bcSearchStr + "" AND "" ;
			bcSearchStr = bcSearchStr + ""[IsRootItem] = 'Y'"";
			bc.SetSearchExpr(bcSearchStr);
			bc.ExecuteQuery();
			
			var countRecs = bc.CountRecords();
			var i = 0;
			
			var isOCPi = TheApplication().NewPropertySet();
			var isOCPo = TheApplication().NewPropertySet();
			var bOracleProduct ;
			var isOCPSvc;
	  	    
			if (bc.FirstRecord())
			{
				do 
				{
								
					var productId = bc.GetFieldValue(""Product Id"");
					
					isOCPi.SetProperty(""BusCompName"",bc.Name())
					isOCPi.SetProperty(""ProductId"",productId);
						
					isOCPSvc = TheApplication().GetService(""CZSessionManagement"");
					isOCPSvc.InvokeMethod(""IsOracleConfigurableProduct"", isOCPi, isOCPo);
			
					bOracleProduct = isOCPo.GetProperty(""IsOracleProduct"");

					if (bOracleProduct == ""true"")
					{			

						//check to see if this is a newly added item
						//existing items are stored in the array existingRootItems
						
						var rootItemId = bc.GetFieldValue(rootItemIdColName);
						Clib.qsort(existingRootItems, ListCompareFunction);
						var found = Clib.bsearch(rootItemId,existingRootItems,ListCompareFunction)
						
						//only if this was not existing and was newly 
						//added when selected from favorites
						
						if (found == null)
						{
							prodId[i] = bc.GetFieldValue(""Root Product Id"");
							rootQuoteorOrderItemId[i] = bc.GetFieldValue(rootItemIdColName);
							sourceConfigHeader[i] =  bc.GetFieldValue(""External Configurator Reference 1"");
							sourceConfigRevNbr[i] = bc.GetFieldValue(""External Configurator Reference 2"");
							i++;
						}
					}
				} while(bc.NextRecord())
			}
	
		 	
		 	for (var l = 0; l< existingRootItems.length; l++)
		 	{
		 	  existingRootItems[i]= null;
		 	}
		 	
			// update the rows		 	    
			for (var k = 0; k< prodId.length; k++)
			{ 
				var indata1 =TheApplication().NewPropertySet ();
				var outdata1 = TheApplication().NewPropertySet ();
				indata1.SetProperty (""RootItemId"", rootQuoteorOrderItemId[k]);
				indata1.SetProperty (""QuoteorOrderorAgreementId"", destQuoteorOrderId);
				indata1.SetProperty(""SourceConfigHeader"",sourceConfigHeader[k]);
				indata1.SetProperty(""SourceConfigRevNbr"",sourceConfigRevNbr[k]);
				indata1.SetProperty(""BusinessObject"",bo.Name());					
				indata1.SetProperty(""BusinessComponent"",bc.Name());
				
				var svc1 = TheApplication().GetService(""CZIntegCopyConfigService"");
				svc1.InvokeMethod(""CopyOracleConfiguration"", indata1, outdata1);
			
			}
	    }
		catch  (e) 
		{
		//	TheApplication().Trace(e.toString());
		 	TheApplication().RaiseErrorText(e.toString());
			throw e;
		}
		finally
		{

			indata1 = null;
			outdata1 = null
			svc1 = null;
			svc1 = null;
	  	bOracleProduct = null;
			isOCPi = null;
			isOCPo = null;
			isOCPSvc = null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;
			destQuoteorOrderId  = null;
			bo = null;
			bc = null;
			prodId = null;
			rootQuoteorOrderItemId = null;
			sourceConfigHeader = null;
			sourceConfigRevNbr = null;
		  fromBusComp = null;
		  fromBusObj = null;
		  bcSearchStr = null;
		  rootItemIdColName=null;
	
		}
  }
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""ISS_TIME"") {		
	}	
		
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if (MethodName == ""iss_predelete"") {
		TheApplication().SetProfileAttr (""IDS_PREDELETE"", Inputs.GetProperty (""XML String""));		
		TheApplication().SetProfileAttr (""IDS_IDT"", """");
		TheApplication().SetProfileAttr (""IDS_SYSTEM"", """");
		TheApplication().SetProfileAttr (""IDS_IO_NAME"", """");
		TheApplication().SetProfileAttr (""IDS_LOADFILE"", """");
		TheApplication().SetProfileAttr (""IDS_PAGE_SIZE"", """");
		TheApplication().SetProfileAttr (""IDS_IO_ID"", """");
		TheApplication().SetProfileAttr (""IDS_URL"", """");
						
		return (CancelOperation);
	}  else if (MethodName == ""iss_prewrite"") {
		TheApplication().SetProfileAttr (""IDS_PREWRITE"", Inputs.GetProperty (""XML String""));		
		TheApplication().SetProfileAttr (""IDS_IDT"", """");
		TheApplication().SetProfileAttr (""IDS_SYSTEM"", """");
		TheApplication().SetProfileAttr (""IDS_IO_NAME"", """");
		TheApplication().SetProfileAttr (""IDS_LOADFILE"", """");
		TheApplication().SetProfileAttr (""IDS_PAGE_SIZE"", """");
		TheApplication().SetProfileAttr (""IDS_IO_ID"", """");
		TheApplication().SetProfileAttr (""IDS_URL"", """");
						
		return (CancelOperation);
	}  else if (MethodName == ""iss_reset"") {
		TheApplication().SetProfileAttr (""IDS_IDT"", """");
		TheApplication().SetProfileAttr (""IDS_SYSTEM"", """");
		TheApplication().SetProfileAttr (""IDS_IO_NAME"", """");
		TheApplication().SetProfileAttr (""IDS_LOADFILE"", """");
		TheApplication().SetProfileAttr (""IDS_PAGE_SIZE"", """");
		TheApplication().SetProfileAttr (""IDS_PREDELETE"", """");
		TheApplication().SetProfileAttr (""IDS_PREWRITE"", """");
		TheApplication().SetProfileAttr (""IDS_IO_ID"", """");
		TheApplication().SetProfileAttr (""IDS_URL"", """");
		
		return (CancelOperation);
	}
	
	return (ContinueOperation);
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// CREATOR		:	CAROLINE M.
// LAST UPDATED	:	12/28/2000
//
// DESCRIPTION
//    Javascript maps from Oracle Organization to Siebel Inventory Location
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyIntegrationObjectData (OracleIntObject, SiebelIntObject)
{
	var OracleOrgIntComp, SiebelInvLocIntComp;

	OracleOrgIntComp = OracleIntObject.GetPrimaryIntComp (""SIE_INVLOC_V"");

	if (OracleOrgIntComp.Exists ())
	{
		// INVENTORY LOCATION

		SiebelInvLocIntComp = SiebelIntObject.CreatePrimaryIntComp (""FS Inventory Location OraCon"");

		while (OracleOrgIntComp.NextRecord ())
		{
			 
			 
				SiebelInvLocIntComp.NewRecord ();
				SiebelInvLocIntComp.SetCopySource (OracleOrgIntComp);
				
				SiebelInvLocIntComp.CopyFieldValue (""Integration Id"", ""ORGANIZATION_ID"");
				SiebelInvLocIntComp.CopyFieldValue (""Inventory Name"",""NAME"");
				SiebelInvLocIntComp.SetFieldValue (""Inventory Type"",  ""Warehouse"");
			 
			
			// ORGANIZATION
			
			var SiebelOrgIntComp = SiebelInvLocIntComp.CreateIntComp(""FS Inventory Location OraCon_Organization"");
			
			 
			 
				SiebelOrgIntComp.NewRecord ();
				SiebelOrgIntComp.SetCopySource (OracleOrgIntComp);
				SiebelOrgIntComp.CopyFieldValue (""Organization Integration Id"", ""OPERATING_UNIT"");
				SiebelOrgIntComp.SetFieldValue (""IsPrimaryMVG"",""Y"");
			 
						
		}
	}
	else
	{
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_MISSING_COMPONENT,SIE_INVLOC_V,InvLoc  - Get Oracle Org (Oracle)""));
	}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function UpsertSiebelInvLoc (InputMsg, OutputMsg)
{
	var SiebelIntObject;
	var OracleIntObject;

	OracleIntObject = InputMsg.GetIntObj(""InvLoc - Get Oracle Org (Oracle)"");

	if (OracleIntObject.Exists ())
	{
		SiebelIntObject = OutputMsg.CreateIntObj (""InvLoc - Get Oracle Org (Siebel)"");

		while (OracleIntObject.NextInstance ())
		{
			SiebelIntObject.NewInstance ();

			CopyIntegrationObjectData (OracleIntObject, SiebelIntObject);
		}
	}
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2001, Siebel Systems, Inc., All rights reserved.
//
// CREATOR		:	CAROLINE M.
// LAST UPDATED	:	12/28/2000
//
// DESCRIPTION
//    Javascript maps from Oracle Organization to Siebel Inventory Location
//
///////////////////////////////////////////////////////////////////////////////

#include ""eaisiebel.js"""
function CopyIntegrationObjectData (OracleIntObject, SiebelIntObject)
{
	var OracleOrgIntComp, SiebelInvLocIntComp;

	OracleOrgIntComp = OracleIntObject.GetPrimaryIntComp (""SIE_INVLOC_V"");

	if (OracleOrgIntComp.Exists ())
	{
		// INVENTORY LOCATION

		SiebelInvLocIntComp = SiebelIntObject.CreatePrimaryIntComp (""FS Inventory Location OraCon"");

		while (OracleOrgIntComp.NextRecord ())
		{
			 
			 
				SiebelInvLocIntComp.NewRecord ();
				SiebelInvLocIntComp.SetCopySource (OracleOrgIntComp);
				
				SiebelInvLocIntComp.CopyFieldValue (""Integration Id"", ""ORGANIZATION_ID"");
				SiebelInvLocIntComp.CopyFieldValue (""Inventory Name"",""NAME"");
				SiebelInvLocIntComp.SetFieldValue (""Inventory Type"",  ""Warehouse"");
		 
			
			// ORGANIZATION
			
			var SiebelOrgIntComp = SiebelInvLocIntComp.CreateIntComp(""FS Inventory Location OraCon_Organization"");
			
			 
		 
				SiebelOrgIntComp.NewRecord ();
				SiebelOrgIntComp.SetCopySource (OracleOrgIntComp);
				SiebelOrgIntComp.CopyFieldValue (""Organization Integration Id"", ""OPERATING_UNIT"");
				SiebelOrgIntComp.SetFieldValue (""IsPrimaryMVG"",""Y"");
		 
						
		}
	}
	else
	{
		EAIRaiseError(TranslateMessage(
			""ORA_MSG_MISSING_COMPONENT,SIE_INVLOC_V,InvLoc  - Get Oracle Org (Oracle)""));
	}
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	return EAIExecuteMap(MethodName, Inputs, Outputs);
}
function TranslateMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ORA_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ORA_MSG"";
	var LOVType = ""ORACLE_CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
"
function UpsertSiebelInvLoc (InputMsg, OutputMsg)
{
	var SiebelIntObject;
	var OracleIntObject;

	OracleIntObject = InputMsg.GetIntObj(""InvLoc - Get Oracle11i Org (Oracle)"");

	if (OracleIntObject.Exists ())
	{
		SiebelIntObject = OutputMsg.CreateIntObj (""InvLoc - Get Oracle11i Org (Siebel)"");

		while (OracleIntObject.NextInstance ())
		{
			SiebelIntObject.NewInstance ();

			CopyIntegrationObjectData (OracleIntObject, SiebelIntObject);
		}
	}
}
"// (declarations)

// List of hardcoded strings

// IO Identifiers
var mstrOutputIOName                            = ""LSMCSetAllocatedExpenseItem"";
var mstrOutputTypeListOfExpenseItems            = ""ListOfLSMCSetAllocatedExpenseItem"";
var mstrOutputTypeExpenseItem                   = ""Expense Item"";

var mstrTypeListOfExpenseItemEmployees          = ""ListOfLS MC Employee Expense Item"";
var mstrTypeListOfExpenseItemContacts           = ""ListOfLS MC Contact Expense Item"";
var mstrTypeListOfBudgetContacts                = ""ListOfLS MC Budget Contact"";
var mstrTypeListOfExpenseItemContactAllocations = ""ListOfLS MC Contact Expense Item Allocation"";

var mstrTypeExpenseItemContactAllocation        = ""LS MC Contact Expense Item Allocation"";

// BC [LS MC Contact Expense Item Allocation]
var mstrPropertyAllocatedAmount                 = ""Allocated Amount"";
var mstrPropertyDescription                     = ""Description"";
var mstrPropertyReportingState                  = ""Reporting State"";

// BC [LS MC Budget Contact]
var mstrPropertyBudgetState                     = ""Budget State"";

// BC [Expense Item]
var mstrPropertyAllocationDate                  = ""LS MC Allocation Date"";
var mstrPropertyAllocationStatusCode            = ""LS MC Allocation Status Code"";
var mstrPropertyTransactionState                = ""LS MC Transaction State"";
var mstrPropertyComplianceFlag                  = ""LS MC Compliance Flag"";
var mstrPropertyConvertedAmount                 = ""Amount"";
var mstrPropertyExpenseItemType                 = ""Expense Item Type"";
var mstrPropertyExchangeRate                    = ""Exchange Rate""

// Texts for Allocation Status (Have to be kept in synch with the LICs 
// of the LOV Type ""LS_MC_STATUS"")
var mstrLICAllocated                            = ""Allocated"";
var mstrLICNoAllocationNeeded                   = ""Allocation Not Needed"";
var mstrLICNotAllocated                         = ""Not Allocated"";

// Texts for Allocation Description (not through LOV)
var mstrDescNoAllocationDefined                 = ""No Allocation rules defined for this state"";
var mstrDescAllocationPerformed                 = ""Allocation performed"";
var mstrDescAllocationNotNeeded                 = ""No Alocation required"";"
function AllocateExpenseItem (oPSInExpenseItem, oPSOutExpenseItem)
{
 // =======================================================================
 // Purpose:   Performs the allocation of expenses to contacts in accordance with
 //            Marketing Compliance for Pharmaceutical companies
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // Arguments:
 //  Inputs - Propertyset with the following structure
 //
 //    Type = <ExpenseItem>
 //       p[LS MC Compliance Flag]    = Y -> A Compliance relevant expense
 //                                     N -> Not a compliance relevant expense
 //       p[Converted Amount]         = Amount to be expensed
 //       p[Expense Item Type]        = Type of the item (only evaluated whether ""Gift"" or not)
 //       p[LS MC Transaction State]  = two kletter code of the state of the transaction (not evaluated)
 //       p[...]                      = other (not evaluated) properties
 //       ChildPS[0.0.0.0] Type = <ListOfExpenseItemContacts>
 //          ChildPS[0.0.0.0.0] Type = <ExpenseItemContact>
 //             p[...]      = other (not evaluated) properties
 //             ChildPS[0.0.0.0.0.0] Type = <ListOfBudgetContacts>
 //                ChildPS[0.0.0.0.0.0.0] Type = <BudgetContact>
 //                   p[Budget State] = two letter code for the reporting state
 //                   p[...]          = other (not evaluated) properties
 //       ChildPS[0.0.0.1] Type = <ListOfExpenseItemEmployees>
 //          ChildPS[0.0.0.1.0] Type = <ExpenseItemEmployee>
 //             p[...]                = other (not evaluated) properties (We evaluate only the number
 //                                     employee records)
 // --------------------------------------------------------------------------      
 //  Outputs - Propertyset with the following structure
 //
 //    Type = <ExpenseItem>
 //       p[LS MC Allocation Date]        = Date of the Allocation
 //       p[LS MC Allocation Status Code] = Status code of the Allocation
 //                                         Allocation Not Required
 //                                         Allocated
 //                                         Not Allocated (= Predefault)
 //       p[...]
 //       ChildPS[0.0.0.0] Type = <ListOfExpenseItemContacts>
 //          ChildPS[0.0.0.0.0] Type = <ExpenseItemContact>
 //             p[...]
 //             ChildPS[0.0.0.0.0.0] Type = <ListOfExpenseItemContactAllocations>
 //                ChildPS[0.0.0.0.0.0] Type = <ExpenseItemContactAllocation>
 //                   p[Allocated Amount]
 //                   p[Description]
 //                   p[Reporting State]
 //                   p[...]
 //
 // =======================================================================
 // History:
 //  Date     Author    Description
 //  11/28/05 wback      original creation
 // =======================================================================

 // Extract some base values from the input propertyset
 var currTotalAmount;
 var nExchangeRate        = """";
 var strExpenseItemType   = oPSInExpenseItem.GetProperty(mstrPropertyExpenseItemType);
 var strTransactionState  = oPSInExpenseItem.GetProperty(mstrPropertyTransactionState);
 var strComplianceFlag    = oPSInExpenseItem.GetProperty( mstrPropertyComplianceFlag );
 
 var oPSInListOfContacts  = oPSInExpenseItem.GetChild(0);
 var oPSInListOfEmployees = oPSInExpenseItem.GetChild(1);

 var oPSOutListOfContacts = TheApplication().NewPropertySet();
 oPSOutListOfContacts.SetType(oPSInListOfContacts.GetType());
 
 var numEmployees         = oPSInListOfEmployees.GetChildCount() +1;
 var numContacts          = oPSInListOfContacts.GetChildCount();
 var blnAlloc             = false;    // Has an Allocation been performed
 var blnResult            = false;        // Return value of the Allocation rule
 var blnCompliance        = false;        // Is the expense item compliance relevant
 
 // Calculate the converted Expense Total
 if (oPSInExpenseItem.PropertyExists(mstrPropertyExchangeRate))
 {
  nExchangeRate = oPSInExpenseItem.GetProperty(mstrPropertyExchangeRate);
 }
 if (nExchangeRate == """")
 {
  nExchangeRate = ""1"";
 }
 currTotalAmount = oPSInExpenseItem.GetProperty(mstrPropertyConvertedAmount) * nExchangeRate
 
 if (oPSInExpenseItem.GetProperty( mstrPropertyComplianceFlag ) == ""Y"")
 {
  // Customers can write here their own code to determine,
  // whether a certain expense item is compliance relevant.
  blnCompliance = true;
 } 

 for (var i = 0; i < numContacts; i++)
 {
  // Process each individual contact
  var oPSInContact = oPSInListOfContacts.GetChild(i);
  var oPSOutContact = TheApplication().NewPropertySet();
  oPSOutContact.SetType(oPSInContact.GetType());
  oPSOutContact.SetProperty(""Id"", oPSInContact.GetProperty(""Id""));
    //CopyProperties(oPSInContact, oPSOutContact);
  
  if (oPSInContact.GetChildCount() > 0)
  {
   var oPSInListOfBudgets = oPSInContact.GetChild(0);
   var oPSOutListOfAllocations = TheApplication().NewPropertySet();
   oPSOutListOfAllocations.SetType( mstrTypeListOfExpenseItemContactAllocations );
   
   var numBudgets = oPSInListOfBudgets.GetChildCount();
   for (var j = 0; j < numBudgets; j++)
   {
    // Evaluate the budget state call the corresponding allocation rule
    var oPSInBudget = oPSInListOfBudgets.GetChild(j);
    var strReportingState = oPSInBudget.GetProperty(mstrPropertyBudgetState);
    var oPSOutAllocation = TheApplication().NewPropertySet();
    oPSOutAllocation.SetType( mstrTypeExpenseItemContactAllocation );
    oPSOutAllocation.SetProperty(mstrPropertyDescription, mstrDescAllocationNotNeeded);
    oPSOutAllocation.SetProperty(mstrPropertyAllocatedAmount, ""0.00"");
    
    if (strComplianceFlag == ""Y"")
    {
     switch (strReportingState)
     {
      case ""CA"":
       // California allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      case ""DC"":
       // D.C. allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      case ""ME"":
       // Maine allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      case ""MN"":
       // Minnesota allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      case ""VT"":
       // Vermont allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      case ""WV"":
       // West Virginia allocation rules - you might want to call your own function instead
       blnResult = AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
      default:
       // Default allocation rule: - you might want to call your own function instead
       blnResult = AllocationRule_Default(currTotalAmount, strExpenseItemType, strTransactionState, 
                                     numEmployees,    numContacts,        oPSOutAllocation);
       break;
       
     }
    }
    else
    {
     blnResult = false;
    }
    oPSOutAllocation.SetProperty(mstrPropertyReportingState, strReportingState);
    if (blnResult)
    {
     // Save the fact that we allocated at least for ONE contact
     blnAlloc = true;
    }
    oPSOutListOfAllocations.AddChild(oPSOutAllocation);
   }
   oPSOutContact.AddChild(oPSOutListOfAllocations);
  }
  oPSOutListOfContacts.AddChild(oPSOutContact);
 }
 oPSOutExpenseItem.AddChild(oPSOutListOfContacts);
 if (blnAlloc)
 {
  // Since we performed the allocation for at least ONE contact, we will set
  // the status to ""Allocated""
  oPSOutExpenseItem.SetProperty( mstrPropertyAllocationStatusCode,mstrLICAllocated)
 }
 else
 {
  // Since we did not perform any allocation, we will set
  // the status to ""Allocation Not Needed""
  oPSOutExpenseItem.SetProperty( mstrPropertyAllocationStatusCode,mstrLICNoAllocationNeeded)
 }
}
function AllocateExpenses(Inputs, Outputs)
{
 // =======================================================================
 // Purpose:   Shell for Allocation of expenses to contacts in accordance with
 //            Marketing Compliance for Pharmaceutical companies
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // Arguments:
 //  Inputs - Propertyset with the following structure (IO: )
 //
 //    ChildPS[0] Type = ""Siebel Message""
 //       p[MessageType]     = ""Integration Object""
 //       p[IntObjectName]   = ""LSMCGetUnallocatedExpenseItem""
 //       p[IntObjectFormat] = ""Siebel Hierarchical""
 //       ChildPS[0.0] Type = ""ListOfLSMCGetUnallocatedExpenseItem""
 //          ChildPS[0.0.0] = Type = ""Expense Item""
   //             p[LS MC Compliance Flag]
   //             p[Amount]
   //             p[Exchange Rate]
   //             p[Expense Item Type]
   //             p[LS MC Transaction State]
 //             p[...]
 //             ChildPS[0.0.0.0] Type = <ListOfExpenseItemContacts>
 //                ChildPS[0.0.0.0.0] Type = <ExpenseItemContact>
 //                   p[...]
 //                   ChildPS[0.0.0.0.0.0] Type = <ListOfBudgetContacts>
 //                      ChildPS[0.0.0.0.0.0.0] Type = <BudgetContact>
 //                         p[Budget State]
 //                         p[...]
 //             ChildPS[0.0.0.1] Type = <ListOfExpenseItemEmployees>
 //                ChildPS[0.0.0.1.0] Type = <ExpenseItemEmployee>
 //                   p[...]
 // --------------------------------------------------------------------------      
 //  Outputs - Propertyset with the following structure (IO: )
   //
 //    ChildPS[0] Type = ""Siebel Message""
 //       p[MessageType]     = ""Integration Object""
 //       p[IntObjectName]   = ...
 //       p[IntObjectFormat] = ""Siebel Hierarchical""
 //       ChildPS[0.0] Type = <ListOfExpenseItems>
 //          ChildPS[0.0.0] = Type = <ExpenseItem>
 //             p[LS MC Allocation Date]
   //             p[LS MC Allocation Status Code]
 //             p[...]
 //             ChildPS[0.0.0.0] Type = <ListOfExpenseItemContacts>
 //                ChildPS[0.0.0.0.0] Type = <ExpenseItemContact>
 //                   p[...]
 //                   ChildPS[0.0.0.0.0.0] Type = <ListOfExpenseItemContactAllocations>
 //                      ChildPS[0.0.0.0.0.0] Type = <ExpenseItemContactAllocation>
 //                         p[Allocated Amount]
 //                         p[Description]
 //                         p[Reporting State]
 //                         p[...]
   //
 // =======================================================================
 // History:
 //  Date     Author    Description
 //  11/22/05 wback      original creation
 // =======================================================================
 
 // -----------------------------------------------------------------------
 // There are three main steps:
 //   1. Evaluating the Input property set
 //   2. Process ""hardcoded"" Allocation rules
 //   3. Format the Output property set
 // The steps 2 and 3 are done partially in AllocateExpenseItem (i.e. for an individual
 // expense item)
 // -----------------------------------------------------------------------
 
 // ----------------------------------------------
 // 1. Evaluating the Input property set
 //    We have to perform the following sub-steps:
 //    1.1 Extract the child property set containing the Expense Items
 //    1.2 Process each of the expense items:
 //    1.2.1. Call AllocateExpense (i.e. for an individual expense item) with 
 //    1.2.2. Set the returned Output Propertyset 
 // ----------------------------------------------
  
 // Extract the collection of expense items from the input propertyset and
 // assign it to oPSInListOfExpenseItems
 var oPSInSiebelMessage      = Inputs.GetChild(0);
 var oPSInListOfExpenseItems = oPSInSiebelMessage.GetChild(0);        // ListOfExpenseItems
 var nExpenseItems           = oPSInListOfExpenseItems.GetChildCount();   // Number of Expense Items
 var now                     = new Date();
 var TimeStamp               = now.toLocaleString()
 
mstrLICAllocated             = TheApplication().InvokeMethod(""LookupValue"",""LS_MC_STATUS"", ""Allocated"");
mstrLICNoAllocationNeeded    = TheApplication().InvokeMethod(""LookupValue"",""LS_MC_STATUS"", ""Allocation Not Needed"");
mstrLICNotAllocated          = TheApplication().InvokeMethod(""LookupValue"",""LS_MC_STATUS"", ""Not Allocated"");


 // In any case, we have to create the shell for the OutputPS
 
 // Outputs = TheApplication().NewPropertySet();
 var oPSOutSiebelMessage       = TheApplication().NewPropertySet();
 oPSOutSiebelMessage.SetType(""SiebelMessage"");
 oPSOutSiebelMessage.SetProperty(""MessageId"", oPSInSiebelMessage.GetProperty(""MessageId""));
 oPSOutSiebelMessage.SetProperty(""MessageType"", ""Integration Object"");
 oPSOutSiebelMessage.SetProperty(""IntObjectName"", mstrOutputIOName);
 oPSOutSiebelMessage.SetProperty(""IntObjectFormat"", ""Siebel Hierarchical"");
  
 var oPSOutListOfExpenseItems  = TheApplication().NewPropertySet();
 oPSOutListOfExpenseItems.SetType( mstrOutputTypeListOfExpenseItems );
 
 
 // Is there at least ONE expense item to process?
 if (nExpenseItems > 0)
 {
  // There is at least ONE Expense item definition
  
  for ( var nExpenseItemCounter = 0; 
        nExpenseItemCounter < nExpenseItems; 
        nExpenseItemCounter++ )
  {
   
   // Extract exactly ONE expense item for processing
     var oPSInExpenseItem  = oPSInListOfExpenseItems.GetChild(nExpenseItemCounter);
     var oPSOutExpenseItem = TheApplication().NewPropertySet();
     oPSOutExpenseItem.SetType( mstrOutputTypeExpenseItem );
     oPSOutExpenseItem.SetProperty(""Id"", oPSInExpenseItem.GetProperty(""Id""));
     //CopyProperties(oPSInExpenseItem, oPSOutExpenseItem);
   
   // Get the actual Date-Time stamp
     now = new Date();
     TimeStamp = now.toLocaleString();

   // Pre-build the output property (-sub-) set
   BuildOutputExpenseItem(oPSInExpenseItem, oPSOutExpenseItem, TimeStamp);
     
     // We have to call the allocation engine 
     // for exactly ONE expense item
     AllocateExpenseItem(oPSInExpenseItem, oPSOutExpenseItem);
     
     // Add the definitions to the Output
     oPSOutListOfExpenseItems.AddChild(oPSOutExpenseItem);
  }
 }
 oPSOutSiebelMessage.AddChild(oPSOutListOfExpenseItems);
 Outputs.AddChild(oPSOutSiebelMessage);
}
function AllocationRule_CA(currTotalAmount, strExpenseItemType, strTransactionState, numEmployees, numContacts, oPSAlloc)
{
 // =======================================================================
 // Purpose:   Performs the allocation of expenses to contacts in accordance with
 //            Marketing Compliance for Pharmaceutical companies
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // Arguments:
 // Input:
 //  currTotalAmount      = Total Amount expensed
 //    strExpenseItemType   = Type of the expense item (We only evaluate ""Gift"")
 //    strTransactionState  = State, where the transaction took place (not evaluated here)
 //    numEmployees         = Number of employees (incl. reporter of expenses)
 //    numContacts          = Number of ""entertained"" Health Care Professionals
 // Output (By reference):
 //    oPSAlloc - Propertyset holding the definition of one specific Allocation
 //                This is an output property set with the following defined Properties:
 //       mstrPropertyAllocatedAmount  (e.g.: ""Allocated Amount"")
 //       mstrPropertyDescription      (e.g.: ""Description"")
 //       [mstrPropertyReportingState]   (e.g.: ""Reporting State"")
 // =======================================================================
 
 var currAllocated = 0.00;
 
 if (strExpenseItemType == ""Gifts"")
 {
  // State Rules II
  if (numContacts > 0)
  {
   currAllocated = currTotalAmount / numContacts;
  }
 }
 else
 { 
  // State Rule I
  var numTotal = numEmployees + numContacts;
  if (numTotal > 0) 
  {
   currAllocated = currTotalAmount / numTotal;
  }
 }
 oPSAlloc.SetProperty(mstrPropertyDescription, mstrDescAllocationPerformed);
 oPSAlloc.SetProperty(mstrPropertyAllocatedAmount, currAllocated.toString());
 
 return (true);
}
function AllocationRule_Default (currTotalAmount, strExpenseItemType, strTransactionState, numEmployees, numContacts, oPSAlloc)
{
 // =======================================================================
 // Purpose:   Performs the allocation of expenses to contacts in accordance with
 //            Marketing Compliance for Pharmaceutical companies
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // Arguments:
 // Input:
 //  currTotalAmount      = Total Amount expensed
 //    strExpenseItemType   = Type of the expense item (We only evaluate ""Gift"")
 //    strTransactionState  = State, where the transaction took place (not evaluated here)
 //    numEmployees         = Number of employees (incl. reporter of expenses)
 //    numContacts          = Number of ""entertained"" Health Care Professionals
 // Output (By reference):
 //    oPSAlloc - Propertyset holding the definition of one specific Allocation
 //                This is an output property set with the following defined Properties:
 //       mstrPropertyAllocatedAmount  (e.g.: ""Allocated Amount"")
 //       mstrPropertyDescription      (e.g.: ""Description"")
 //       [mstrPropertyReportingState]   (e.g.: ""Reporting State"")
 // =======================================================================
 
 oPSAlloc.SetProperty(mstrPropertyDescription, mstrDescNoAllocationDefined);
 oPSAlloc.SetProperty(mstrPropertyAllocatedAmount, ""0.00"");
 return (false);
}
function BuildOutputExpenseItem(oPSIn, oPSOut, TimeStamp)
{
 // =======================================================================
 // Purpose:   Builds the structure of the Output property sub set for 
 //            an expense item using the input property set as template.
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // oPSOut.SetType(""Expense Item"");
 oPSOut.SetProperty(""Id"", oPSIn.GetProperty(""Id""));
// oPSOut.SetProperty(mstrPropertyAllocationDate, TimeStamp);
 oPSOut.SetProperty(mstrPropertyAllocationStatusCode, mstrLICNoAllocationNeeded);
}
function CopyProperties(oPSSrc, oPSTrg)
{
   var propName = """";
   var propVal = """";

   propName = oPSSrc.GetFirstProperty();

   // stay in loop if the property name is not null
   // or a null string
   while ((propName != """") && (propName != null)) 
   {
  oPSTrg.SetProperty(propName, oPSSrc.GetProperty(propName));
      propName = oPSSrc.GetNextProperty();
   }
}
"
function Disclaimer()
{
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // =======================================================================
 // Please be aware that all references to property names and the expected/
 // provided structure of property sets are hardcoded.
 // If relevant modifications are made to the IOs, the corresponding
 // changes/additions must be made manually to the code. 
 // Please see the (declarations) section for definitions of strings used in the code
 // =======================================================================
 // The code provided in the Business Service ""MarketingComplianceExpenseAllocation]
 // is only the absolute minimum code required to test the data exchange with the 
 // Expense Item Allocation Engine. Only the bare minimum of error handling is implemented.
 // Nevertheless, the code can give to developers an idea, how to implement their
 // own Allocation Engine in eScript.
 // =======================================================================
 // Siebel is in no way responsible for any damages resulting directly or 
 // indirectly from this code.
 // =======================================================================
 // Please keep in mind that this code is used primarily for testing. The currently 
 // implemented version branches always to the same rules algorithm, AllocationRule_CA().
 // To implement different algorithms, you can easily add your own functions for the 
 // individual states.
 // =======================================================================
 
}
"
"
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // History:
 // Date     Author   Description
 // 11/22/05 wback    original creation
 // =======================================================================
 if (MethodName == ""Allocate"")
 {
  // Allow the method ""Allocate"" to be invoked
  CanInvoke = true;
 }
 return (ContinueOperation);
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
 // =======================================================================
 // I M P O R T A N T   N O T E :
 // Please read the comment in Disclaimer()
 // =======================================================================
 // History:
 // Date     Author   Description
 // 11/22/05 wback    original creation
 // =======================================================================
 if (MethodName == ""Allocate"")
 {

  // Call the function ""AllocateExpenses""
  AllocateExpenses (Inputs, Outputs);
  Inputs.Reset();
  Inputs = Outputs.Copy();

  // Prevent a call to the C++ code
  return (CancelOperation);
 }
 return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if(MethodName == ""GetIntObjOutput"")
	{
		var GetIntObjOutputSoapOut_clnparameters = TheApplication().NewPropertySet();
		GetIntObjOutputSoapOut_clnparameters.SetType(""GetIntObjOutputSoapOut:parameters"");
		GetIntObjOutputSoapOut_clnparameters.SetProperty(""MessageId"", """");
		GetIntObjOutputSoapOut_clnparameters.SetProperty(""MessageType"", ""Integration Object"");
		GetIntObjOutputSoapOut_clnparameters.SetProperty(""IntObjectFormat"", ""Siebel Hierarchical"");
		GetIntObjOutputSoapOut_clnparameters.SetProperty(""IntObjectName"", ""GetIntObjOutputResponse_1"");
		Outputs.AddChild(GetIntObjOutputSoapOut_clnparameters);
		
		var ListOfGetIntObjOutputResponse_1 = TheApplication().NewPropertySet();
		ListOfGetIntObjOutputResponse_1.SetType(""ListOfGetIntObjOutputResponse_1"");	
		GetIntObjOutputSoapOut_clnparameters.AddChild(ListOfGetIntObjOutputResponse_1);	
		
		
		var GetIntObjOutputResponse = TheApplication().NewPropertySet();
		GetIntObjOutputResponse.SetType(""GetIntObjOutputResponse"");	
		ListOfGetIntObjOutputResponse_1.AddChild(GetIntObjOutputResponse);	
		
		var ListOfGetIntObjOutputResult = TheApplication().NewPropertySet();
		ListOfGetIntObjOutputResult.SetType(""ListOfGetIntObjOutputResult"");	
		GetIntObjOutputResponse.AddChild(ListOfGetIntObjOutputResult);
		
		var GetIntObjOutputResult = TheApplication().NewPropertySet();
		GetIntObjOutputResult.SetType(""GetIntObjOutputResult"");	
		ListOfGetIntObjOutputResult.AddChild(GetIntObjOutputResult);
		
		var ListOfListOfAccountInterface = TheApplication().NewPropertySet();
		ListOfListOfAccountInterface.SetType(""ListOfListOfAccountInterface"");	
		GetIntObjOutputResult.AddChild(ListOfListOfAccountInterface);
		
		var ListOfAccountInterface = TheApplication().NewPropertySet();
		ListOfAccountInterface.SetType(""ListOfAccountInterface"");	
		ListOfListOfAccountInterface.AddChild(ListOfAccountInterface);
		
		var ListOfAccount = TheApplication().NewPropertySet();
		ListOfAccount.SetType(""ListOfAccount"");	
		ListOfAccountInterface.AddChild(ListOfAccount);
		
		var Account = TheApplication().NewPropertySet();
		Account.SetType(""Account"");	
		ListOfAccount.AddChild(Account);
		
		var ListOfAccount_0 = TheApplication().NewPropertySet();
		ListOfAccount_0.SetType(""ListOfAccount_0"");	
		Account.AddChild(ListOfAccount_0);
		
		var Account_0 = TheApplication().NewPropertySet();
		Account_0.SetType(""Account_0"");
		Account_0.SetProperty(""Type"", ""Tester"");
		Account_0.SetProperty(""AccountId"", ""10-12345"");	
		Account_0.SetProperty(""Name"", ""Fido Dido"");
		Account_0.SetProperty(""AccountStatus"", ""Active"");
		ListOfAccount_0.AddChild(Account_0);
		
		var ListOfListOfAccountAddressInterface = TheApplication().NewPropertySet();
		ListOfListOfAccountAddressInterface.SetType(""ListOfListOfAccountAddressInterface"");	
		Account_0.AddChild(ListOfListOfAccountAddressInterface);
		
		var ListOfAccountAddressInterface = TheApplication().NewPropertySet();
		ListOfAccountAddressInterface.SetType(""ListOfAccountAddressInterface"");	
		ListOfListOfAccountAddressInterface.AddChild(ListOfAccountAddressInterface);
		
		var ListOfAccountAddress = TheApplication().NewPropertySet();
		ListOfAccountAddress.SetType(""ListOfAccountAddress"");	
		ListOfAccountAddressInterface.AddChild(ListOfAccountAddress);
		
		var AccountAddress = TheApplication().NewPropertySet();
		AccountAddress.SetType(""AccountAddress"");	
		ListOfAccountAddress.AddChild(AccountAddress);
		
		var ListOfAccountAddress_0 = TheApplication().NewPropertySet();
		ListOfAccountAddress_0.SetType(""ListOfAccountAddress_0"");	
		AccountAddress.AddChild(ListOfAccountAddress_0);
		
		var AccountAddress_0 = TheApplication().NewPropertySet();
		AccountAddress_0.SetType(""AccountAddress_0"");
		AccountAddress_0.SetProperty(""Address"", ""2211 BridgePointe Pkwy"");	
		ListOfAccountAddress_0.AddChild(AccountAddress_0);
		
		var AccountAddress_0_2 = TheApplication().NewPropertySet();
		AccountAddress_0_2.SetType(""AccountAddress_0"");
		AccountAddress_0_2.SetProperty(""Address"", ""2207 BridgePointe Pkwy"");	
		ListOfAccountAddress_0.AddChild(AccountAddress_0_2);

		return (CancelOperation);	
	}
	else if(MethodName == ""echo"")
	{
		Outputs.SetProperty("faultactor"","""")
		Outputs.SetProperty("faultcode"",""soap:Client"")
		Outputs.SetProperty("faultstring"",""Server did not recognize the value of HTTP Header SOAPAction: http://www.siebel.com/atf/echo/soapFault."")
		Outputs.SetProperty("faultactor"","""")
		
		var ps = TheApplication().NewPropertySet();
		ps.SetType(""_XMLHierarchy"");
		
		var ps1 = TheApplication().NewPropertySet();
		ps1.SetType(""detail"");
		
		ps.AddChild(ps1);
		
		Outputs.AddChild(ps);
		return (CancelOperation);	
		
	}
	return (ContinueOperation);
}
function Init(Inputs, Outputs)
{
	with(Outputs)
	{
		SetProperty(""Account Id"","""");
		SetProperty(""Address"","""");
		SetProperty(""Address Name"","""");
		SetProperty(""Attr 1"","""");
		SetProperty(""Attr 2"","""");
		SetProperty(""Attr 3"","""");
		SetProperty(""Block No"","""");
		SetProperty(""Building Name"","""");
		SetProperty(""City"","""");
		SetProperty(""Contact Id"","""");
		SetProperty(""Country"","""");
		SetProperty(""Date Of Birth"","""");
		SetProperty(""Email Address"","""");
		SetProperty(""First Name"","""");
		SetProperty(""Flat No"","""");
		SetProperty(""Gender"","""");
		SetProperty(""Governorate"","""");
		SetProperty(""ID Type"","""");
		SetProperty(""ID#"","""");
		SetProperty(""Last Name"","""");
		SetProperty(""MSISDN"","""");
		SetProperty(""Middle Name"","""");
		SetProperty(""Program Name"","""");
		SetProperty(""Road No"","""");
		SetProperty(""Street Address"","""");
		SetProperty(""Street Address 2"","""");
		SetProperty(""Title"","""");
		SetProperty(""Name"","""");
		SetProperty(""Tier"", """");
		SetProperty(""Postal Code"", """");
		SetProperty(""Work Phone"", """");
		SetProperty(""Age"", """");
		SetProperty(""Product Name"", """");
		SetProperty(""Redemption Type"", """");
		SetProperty(""Product Name Accrual"", """");
		SetProperty(""Points"", """");
		SetProperty(""List Price"","""");
		SetProperty(""STC Redem Points"","""");
		SetProperty(""Attr 4"","""");
		//LMS Bug Fixes below
		SetProperty(""STC Transfer Points"","""");
		SetProperty(""STC Transfer To Member"","""");
		SetProperty(""STC Transfer To Member Id"","""");
		SetProperty(""STC Transfer To Member Number"","""");
		SetProperty(""Program Id"","""");
		SetProperty(""STC Transfer To Member Program Id"","""");
		//LMS Bug Fixes above
		/*[31Jul2016][NAVINR][LoyaltyAirmiles_Phase2]*/
		SetProperty(""Parent Member Id"","""");
		SetProperty(""STC Airline Partner Name"","""");
		SetProperty(""STC Partner Id"","""");
		SetProperty(""STC Airline FFP Number"","""");
		SetProperty(""STC External Points"","""");
		SetProperty(""STCRedemptionPointReadOnlyFlag"","""");
		/*[31Jul2016][NAVINR][LoyaltyAirmiles_Phase2]*/
		
	}
	return (CancelOperation);
}
function PreInsert(Inputs, Outputs)
{

}
function Query(Inputs, Outputs)
{

}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	if( MethodName == ""Init"")
	{
		Init(Inputs, Outputs);
		return (CancelOperation);
	}
	else
	{
		return (CancelOperation);
	}
}
"var mstrDebugFile    = ""D:\\Propertysets.log"";
var err = ""OK"";"
function Debug_LogData(DataString, file) 
{ 
   // ---------------------------------------------------------------- 
   // Use the Debug_PropertySetToFile(PropSet, fileName, title) API  
   // and the Debug_TextToFile(fileName, text) API in your script. 
   // Note that fileName must be double slashed, as demonstrated in the examples below: 
   // Debug_PropertySetToFile(InputsPS, ""c:\\temp\\PSexport.txt"", ""Input Propertyset""); 
   // Debug_TextToFile(""c:\\temp\\MyLog.txt"", ""MyText""); 
   // ---------------------------------------------------------------- 
   try { 
      var fp = Clib.fopen (file, ""at+"");
      if (fp != null)
      {
         Clib.fputs (DataString, fp);
         Clib.fputs (""\n"", fp);
         Clib.fclose (fp);
      }
   } 
   catch (e){ 
   	  // no action 
   } 
}
function Disclaimer() 
 { 
    // ======================================================================= 
    // I M P O R T A N T   N O T E : 
    // ======================================================================= 
    // Please be aware that all references to property names and the expected provided structure of property sets are hardcoded. 
    // If relevant modifications are made to the IOs, the corresponding changes/additions must be made manually to the code. 
    // Please see the (declarations) section for definitions of strings used in the code 
    // ======================================================================= 
    // Oracle is in no way responsible for any damages resulting directly or indirectly from this code. 
    // ======================================================================= 
        
 }
function ExecutePostLaunchWorkflow (Inputs, Outputs)
{
	var CustomIO                 = Inputs.GetChild(0);  
 	var ChildCustomIO            = CustomIO.GetChild(0);   
    var grandChildCustomIO       = ChildCustomIO.GetChild(0); 
    var CustomWorkflowIO		 = grandChildCustomIO.GetChild(0);
    var CustomWorkflowType		 = CustomWorkflowIO.GetType();
    var nChildren				 = CustomWorkflowIO.GetChildCount(); 
	var isSegmentExists		     = "false""; 
	var jobID					 = """";
	var jobState				 = """";
    
    //Get the Inputs
    var CampaignId = CustomWorkflowIO.GetProperty(""Campaign Id"");
    Inputs.SetProperty(""Campaign Id"", CampaignId);
    var StageId = CustomWorkflowIO.GetProperty(""Stage Id"");
    Inputs.SetProperty(""Stage Id"", StageId);
	if (nChildren > 0)  
    {  
       for ( var nChildrenCounter = 0;  
             nChildrenCounter < nChildren;  
             nChildrenCounter++ )  
       { 
		    var IOType  = CustomWorkflowIO.GetChild(nChildrenCounter).GetType(); 
		    if (IOType == ""ListOfSegment Virtual"")
		    {
		    	var SegVirt = CustomWorkflowIO.GetChild(nChildrenCounter).GetChild(0);
		    	var SegVirtType=SegVirt.GetType();
		    	var segPath = SegVirt.GetProperty(""Segment Path"");
		    	Inputs.SetProperty(""Segment Path"", segPath);
				if(segPath != """")
				{
					isSegmentExists	= ""true"";
				}
		    }
		    if (IOType == ""ListOfSegment Tree Virtual"")
		    {
		    	var SegTreeVirt = CustomWorkflowIO.GetChild(nChildrenCounter).GetChild(0);
		    	var segTreePath = SegTreeVirt.GetProperty(""Segment Tree Path"");
		    	Inputs.SetProperty(""Segment Tree Path"", segTreePath);
				if(segTreePath != """")
				{
					isSegmentExists	= ""true"";
				}
		    }
		}
	}

	//Get the sessionId from the Analytics Server
	//Logon(Inputs, Outputs);
	if(isSegmentExists == ""true"")
	{ 
	Logon(Inputs, Outputs);

	var sessionID = Outputs.GetProperty(""sessionID"");
	Inputs.SetProperty(""sessionID"", sessionID);
	
	//Call the saveResultSet
	SaveResultSet(Inputs, Outputs);
	jobID = Outputs.GetProperty(""jobID"");	
	jobState = Outputs.GetProperty(""jobState"");
	}
	
	while(jobState == ""Running"" || jobState == ""Queued"")
	{
		// Assume we are running on UNIX
		// If libc.so does not load (or any exception), we are running 
		// on NT and make the WIN32 call
		// Sleep for 2 seconds
		try
		{
		    SElib.dynamicLink(""libc.so"", ""sleep"", 5)
		}
		catch(e)
		{
		    SElib.dynamicLink(""kernel32.dll"", ""Sleep"", STDCALL, 5000)
		} 
		Inputs.SetProperty(""jobID"", jobID);
		GetJobInfo(Inputs, Outputs);
		jobState = Outputs.GetProperty(""jobState"");
	}	
	
	if(jobState == ""Error"")
	{
		var errorMessage = Outputs.GetProperty(""errorMessage"");
		Outputs.SetProperty(""Success Flag"", ""N"");
		Outputs.SetProperty(""errorMessage"", errorMessage);
	}
	else
	{
		Outputs.SetProperty(""Success Flag"", ""Y"");
		Outputs.SetProperty(""errorMessage"", """");
	}
}
function ExecutePostLoadWorkflow (Inputs, Outputs)
{
 	var CustomIO                 = Inputs.GetChild(0);  
 	var ChildCustomIO            = CustomIO.GetChild(0);   
    var grandChildCustomIO       = ChildCustomIO.GetChild(0); 
    var CustomWorkflowIO		 = grandChildCustomIO.GetChild(0);
    var CustomWorkflowType		 = CustomWorkflowIO.GetType();
    var nChildren				 = CustomWorkflowIO.GetChildCount(); 
    
    var CampaignId = CustomWorkflowIO.GetProperty(""Campaign Id"");
    
    //Get the handle to the Campaign BC
    var CampaignBO = TheApplication().GetBusObject(""Campaign"");
    var CampaignBC = CampaignBO.GetBusComp(""Campaign"");    
     
    //Get the treatment info  
    CampaignBC.ActivateField(""Primary Treatment Id"");
    CampaignBC.SetSearchSpec(""Id"",CampaignId);
    CampaignBC.SetViewMode(AllView);
    CampaignBC.ExecuteQuery();
    var TreatmentID = CampaignBC.GetFieldValue(""Primary Treatment Id"");
    
    CampaignBC = null;
    CampaignBO = null;

	//Get the Offder BC
    var OfferBO = TheApplication().GetBusObject(""Offer"");
    var OfferBC = OfferBO.GetBusComp(""Offer"");    
    
    //Get the priority
    OfferBC.ActivateField(""Priority"");
    OfferBC.SetSearchSpec(""Id"",TreatmentID);
    OfferBC.SetViewMode(AllView);
    OfferBC.ExecuteQuery();
    var rec= OfferBC.FirstRecord();
    while(rec)
    {
    	var Priority = OfferBC.GetFieldValue(""Priority"");
    	rec = OfferBC.NextRecord();
    }
       
    OfferBC = null;
    OfferBO = null;
    
    Outputs.SetProperty(""Success Flag"", ""Y"");
	Outputs.SetProperty(""errorMessage"", ""None"");   
}
function ExecutePreLoadWorkflow (Inputs, Outputs)
{
	Debug_LogData(""Inside ExecutePreLoadWorkflow"", mstrDebugFile);

 	var CustomIO                 = Inputs.GetChild(0);  
 	var ChildCustomIO            = CustomIO.GetChild(0);   
    var grandChildCustomIO       = ChildCustomIO.GetChild(0); 
    var CustomWorkflowIO		 = grandChildCustomIO.GetChild(0);
    var CustomWorkflowType		 = CustomWorkflowIO.GetType();
    var nChildren				 = CustomWorkflowIO.GetChildCount(); 
	var isSegmentExists		     = "false""; 
	var jobID					 = """";
	var jobState				 = """";
    
    //Get the inputs
    var CampaignId = CustomWorkflowIO.GetProperty(""Campaign Id"");
    Inputs.SetProperty(""Campaign Id"", CampaignId);
    var StageId = CustomWorkflowIO.GetProperty(""Stage Id"");
    Inputs.SetProperty(""Stage Id"", StageId);
	if (nChildren > 0)  
    {  
       for ( var nChildrenCounter = 0;  
             nChildrenCounter < nChildren;  
             nChildrenCounter++ )  
       { 
		    var IOType  = CustomWorkflowIO.GetChild(nChildrenCounter).GetType(); 
		    if (IOType == ""ListOfSegment Virtual"")
		    {
		    	var SegVirt = CustomWorkflowIO.GetChild(nChildrenCounter).GetChild(0);
		    	var SegVirtType=SegVirt.GetType();
		    	var segPath = SegVirt.GetProperty(""Segment Path"");
		    	Inputs.SetProperty(""Segment Path"", segPath);
				if(segPath != """")
				{
					isSegmentExists	= ""true"";
				}	
		    }
		    if (IOType == ""ListOfSegment Tree Virtual"")
		    {
		    	var SegTreeVirt = CustomWorkflowIO.GetChild(nChildrenCounter).GetChild(0);
		    	var segTreePath = SegTreeVirt.GetProperty(""Segment Tree Path"");
		    	Inputs.SetProperty(""Segment Tree Path"", segTreePath);
				if(segTreePath != """")
				{
					isSegmentExists	= ""true"";
				}
		    }
		}
	}

	//Get the sessionId from the Analytics Server
	//Logon(Inputs, Outputs);
	if(isSegmentExists == ""true"")
	{
	Logon(Inputs, Outputs);

	var sessionID = Outputs.GetProperty(""sessionID"");
	Inputs.SetProperty(""sessionID"", sessionID);
	
	//Call the saveResultSet
	SaveResultSet(Inputs, Outputs);
	jobID = Outputs.GetProperty(""jobID"");
	jobState = Outputs.GetProperty(""jobState"");
	}
	
	while(jobState == ""Running"" || jobState == ""Queued"")
	{
		// Assume we are running on UNIX
		// If libc.so does not load (or any exception), we are running 
		// on NT and make the WIN32 call
		// Sleep for 2 seconds
		try
		{
		    SElib.dynamicLink(""libc.so"", ""sleep"", 5)
		}
		catch(e)
		{
		    SElib.dynamicLink(""kernel32.dll"", ""Sleep"", STDCALL, 5000)
		} 
		Inputs.SetProperty(""jobID"", jobID);
		GetJobInfo(Inputs, Outputs);
		jobState = Outputs.GetProperty(""jobState"");
	}	
	
	if(jobState == ""Error"")
	{
		var errorMessage = Outputs.GetProperty(""errorMessage"");
		Outputs.SetProperty(""Success Flag"", ""N"");
		Outputs.SetProperty(""errorMessage"", errorMessage);
	}
	else
	{
		Outputs.SetProperty(""Success Flag"", ""Y"");
		Outputs.SetProperty(""errorMessage"", """");
	}
	
}
function GetJobInfo(Inputs, Outputs)
{
	var userName	 = ""sadmin"";
	var userPassword = ""sadmin"";
 	
	var svcJob      		= TheApplication().GetService(""JobManagementServiceSoap"");
	var wsInputJob 			= TheApplication().NewPropertySet();
	var wsOutputJob 		= TheApplication().NewPropertySet();
	var getJobInfoInput 	= TheApplication().NewPropertySet(); // IO
	var ListOfJobInfo		= TheApplication().NewPropertySet(); 
	var getJobInfo	 		= TheApplication().NewPropertySet(); // IC
	
	// set Type and property for IC saveResultSet
	getJobInfo.SetType(""getJobInfo""); 			
	getJobInfo.SetProperty(""sessionID"", Inputs.GetProperty(""sessionID""));
	getJobInfo.SetProperty(""jobID"", Inputs.GetProperty(""jobID""));
		
	// Set types for ListOfsaveResultSet and root IO
	ListOfJobInfo.SetType(""ListOfgetJobInfo"");
	getJobInfoInput.SetType(""getJobInfoIn:parameters"");
	
	// assemble input property set for the service, bottom up
	ListOfJobInfo.AddChild(getJobInfo);
	getJobInfoInput.AddChild(ListOfJobInfo);
	wsInputJob.AddChild(getJobInfoInput);
	
	//Invoke the service
	try
	{
		svcJob.InvokeMethod(""getJobInfo"", wsInputJob, wsOutputJob);
	}
	catch(e)
	{
		if (wsOutputJob.GetChildCount() > 0) 
		{
			var faultString = wsOutputJob.GetProperty("faultstring"");
			Outputs.SetProperty(""jobState"", ""Error"");
			Outputs.SetProperty(""errorMessage"", faultString);									
		}
	}
	
	//Get the Job Id from the output
	if (wsOutputJob.GetChildCount() > 0) 
	{
		var saveResultIOOutput = wsOutputJob.GetChild(0);
		if (saveResultIOOutput.GetType() == ""getJobInfoOut:parameters"") 
		{
			if (saveResultIOOutput.GetChildCount() > 0)
			{
				var ListOfsaveResultSetOutput = saveResultIOOutput.GetChild(0);
				if (ListOfsaveResultSetOutput.GetType() == ""sawsoap:jobInfo"") 
				{
					if (ListOfsaveResultSetOutput.GetChildCount() > 0)
					{
						var saveResultSetOutput = ListOfsaveResultSetOutput.GetChild(0);
						if (saveResultSetOutput.GetType() == ""jobStats"")
						{
							var jobID = saveResultSetOutput.GetChild(0).GetValue();
							Outputs.SetProperty(""jobID"", jobID);
							var jobState = saveResultSetOutput.GetChild(3).GetValue();
							Outputs.SetProperty(""jobState"", jobState);
							if (jobState == ""Error"")
							{	
								var exceptionOutput = saveResultSetOutput.GetChild(8);
								var excOutMsg="""";
								var excOutMsg1="""";
								if (exceptionOutput.GetType() == ""exception"")
								{
									var exceptionMsg = exceptionOutput.GetChild(0).GetValue();
									excOutMsg = exceptionOutput.GetChild(1);
									if (excOutMsg.GetType() == ""exception"")
									{
										excOutMsg1 = excOutMsg.GetChild(0).GetValue();
									}
								}
								var ExpDispMsg=	exceptionMsg + "" "" + excOutMsg1;
								Outputs.SetProperty(""errorMessage"", ExpDispMsg);									
							}
						}												
					}
				}
			}
		}
	}
}
function Logon(Inputs, Outputs)
{
	var userName	 = ""sadmin"";
	var userPassword = ""sadmin"";
 	
	var svcLogon    = TheApplication().GetService(""SAWSessionServiceSoap"");
	var wsInput 	= TheApplication().NewPropertySet();
	var wsOutput 	= TheApplication().NewPropertySet();
	var logonInput 	= TheApplication().NewPropertySet(); // IO
	var ListOflogon = TheApplication().NewPropertySet(); // Lof IC Logon
	var logon 		= TheApplication().NewPropertySet(); // IC
	
	// set Type and property for IC logon
	logon.SetType(""logon""); 			
	logon.SetProperty(""name"", userName);
	logon.SetProperty(""password"", userPassword);
	
	// Set types for LOflogon and root IO
	ListOflogon.SetType(""ListOflogon"");
	logonInput.SetType(""logonIn:parameters"");
	
	// assemble input property set for the service, bottom up
	ListOflogon.AddChild(logon);
	logonInput.AddChild(ListOflogon);
	wsInput.AddChild(logonInput);
	
	//Invoke the service
	try
	{
		svcLogon.InvokeMethod(""logon"", wsInput, wsOutput);
	}
	catch(e)
	{
		if (wsOutput.GetChildCount() > 0) 
		{
			var faultString = wsOutput.GetProperty("faultstring"");
			Outputs.SetProperty(""jobState"", ""Error"");
			Outputs.SetProperty(""errorMessage"", faultString);									
		}
		else
		{
			Outputs.SetProperty(""jobState"", ""Error"");
			Outputs.SetProperty(""errorMessage"", ""Login Failed"");
		}
	}
	
	//Retrieve sessionID from wsOutput
	//		->logonResult(""logonOut:parameters"")
	//			->ListOflogonResult(""ListOflogon"")
	//				->logonResult(""logonResult""), [""sessionID""]

	if (wsOutput.GetChildCount() > 0)
	{
	var logonResultIOOutput = wsOutput.GetChild(0);
		if (logonResultIOOutput.GetType() == ""logonOut:parameters"") 
		{
			if (logonResultIOOutput.GetChildCount() > 0) 			
			{
				var ListOflogonResultOutput = logonResultIOOutput.GetChild(0);
				if (ListOflogonResultOutput.GetType() == ""ListOflogonResult"") {
					if (ListOflogonResultOutput.GetChildCount() > 0) 
					{
						var logonResultOutput = ListOflogonResultOutput.GetChild(0);
						if (logonResultOutput.GetType() == ""logonResult"")
						{
							var sessionID = logonResultOutput.GetProperty(""sessionID"");
							Outputs.SetProperty(""sessionID"", sessionID);
						}
					}
				}
			}
		}
	}	

}
function SaveResultSet(Inputs, Outputs)
{
	var userName	 = ""sadmin"";
	var userPassword = ""sadmin"";
 	
	var svcJob      		= TheApplication().GetService(""JobManagementServiceSoap"");
	var wsInputJob 			= TheApplication().NewPropertySet();
	var wsOutputJob 		= TheApplication().NewPropertySet();
	var saveResultSetInput 	= TheApplication().NewPropertySet(); // IO
	var ListOfsaveResultSet = TheApplication().NewPropertySet(); 
	var saveResultSet 		= TheApplication().NewPropertySet(); // IC
	
	// set Type and property for IC saveResultSet
	saveResultSet.SetType(""saveResultSet""); 			
	saveResultSet.SetProperty(""sessionID"", Inputs.GetProperty(""sessionID""));
	var segPath = Inputs.GetProperty(""Segment Path"");
	if (segPath != """")
	{
		saveResultSet.SetProperty(""segmentPath"", segPath);
	}
	var segTreePath = Inputs.GetProperty(""Segment Tree Path"");
	if (segTreePath != """")
	{
		saveResultSet.SetProperty(""treeNodePath"", segTreePath);
	}
	
	// Set types for ListOfsaveResultSet and root IO
	ListOfsaveResultSet.SetType(""ListOfsaveResultSet"");
	saveResultSetInput.SetType(""saveResultSetIn:parameters"");
	
	// assemble input property set for the service, bottom up
	ListOfsaveResultSet.AddChild(saveResultSet);
	saveResultSetInput.AddChild(ListOfsaveResultSet);
	wsInputJob.AddChild(saveResultSetInput);
	
	//Invoke the service
	try
	{
		svcJob.InvokeMethod(""saveResultSet"", wsInputJob, wsOutputJob);
	}
	catch(e)
	{
		if (wsOutputJob.GetChildCount() > 0) 
		{
			var faultString = wsOutputJob.GetProperty("faultstring"");
			Outputs.SetProperty(""jobState"", ""Error"");
			Outputs.SetProperty(""errorMessage"", faultString);									
		}
	}
	
	//Get the Job Id from the output
	if (wsOutputJob.GetChildCount() > 0) 
	{
		var saveResultIOOutput = wsOutputJob.GetChild(0);
		if (saveResultIOOutput.GetType() == ""saveResultSetOut:parameters"") 
		{
			if (saveResultIOOutput.GetChildCount() > 0)
			{
				var ListOfsaveResultSetOutput = saveResultIOOutput.GetChild(0);
				if (ListOfsaveResultSetOutput.GetType() == ""sawsoap:jobInfo"") 
				{
					if (ListOfsaveResultSetOutput.GetChildCount() > 0) {
						var saveResultSetOutput = ListOfsaveResultSetOutput.GetChild(0);
						if (saveResultSetOutput.GetType() == ""jobStats"")
						{
							var jobID = saveResultSetOutput.GetChild(0).GetValue();
							Outputs.SetProperty(""jobID"", jobID);
							var jobState = saveResultSetOutput.GetChild(3).GetValue();
							Outputs.SetProperty(""jobState"", jobState);
													
						}
					}
				}
			}
		}
	}

}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
    if (MethodName == ""ExecutePreLoadWorkflow"")  
    {  
       CanInvoke = true;  
    } 
    else if (MethodName == ""ExecutePostLoadWorkflow"")  
    {  
       CanInvoke = true;  
    } 
    else if (MethodName == ""ExecutePostLaunchWorkflow"")  
    {  
       CanInvoke = true;  
    }  
    return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   
  if (MethodName == ""ExecutePreLoadWorkflow"")
   {
   
       // Call the function ""ExecutePreLoadWorkflow""
       ExecutePreLoadWorkflow (Inputs, Outputs);
                    
       // Prevent a call to the C++ code
       return (CancelOperation);
   }
   else if (MethodName == ""ExecutePostLoadWorkflow"")
   {
   
       // Call the function ""ExecutePostLoadWorkflow""
       ExecutePostLoadWorkflow (Inputs, Outputs);
       
       // Prevent a call to the C++ code
       return (CancelOperation);
   }
   else if (MethodName == ""ExecutePostLaunchWorkflow"")
   {
   
       // Call the function ""ExecutePostLaunchWorkflow""
       ExecutePostLaunchWorkflow (Inputs, Outputs);
       
       // Prevent a call to the C++ code
       return (CancelOperation);
   } 
   
   return (ContinueOperation);  

}
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
	var a = 3;
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	var a = 3;
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var a = 3;
	return (ContinueOperation);
}
function Service_InvokeMethod (MethodName, Inputs, Outputs)
{
	var a = 3;
}
function Service_PreCanInvokeMethod (MethodName, &CanInvoke)
{
	var a = 3;
	return (ContinueOperation);
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
	var a = 3;
	return (ContinueOperation);
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 6 $
//      $Date: 01/15/01 10:29a $
//    $Author: S.Garg $ of last update
//
// CREATOR:    P. Lim
//
// DESCRIPTION
//    Javascript maps from Siebel Order & Quote to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
/* This function shared by ""Simulate Order"" and ""Create Order"" */"
function ConvertMonth(cardExpMonth)
{ // general utility function
	var nMonth; 
	if ( cardExpMonth == ""January"" )
		{
			nMonth = ""01"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""February"" )
		{
			nMonth = ""02"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""March"" )
		{
			nMonth = ""03"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""April"" )
		{
			nMonth = ""04"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""May"" )
		{
			nMonth = ""05"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""June"" )
		{
			nMonth = ""06"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""July"" )
		{
			nMonth = ""07"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""August"" )
		{
			nMonth = ""08"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""September"" )
		{
			nMonth = ""09"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""October"" )
		{
			nMonth = ""10"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""November"" )
		{
			nMonth = ""11"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""December"" )
		{
			nMonth = ""12"";
			return nMonth ;
		}
	else
		{
			nMonth = ""01"";
			return nMonth ;
		}
}
function Create77SAP46COrder_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{ // referenced by script CreateSAP46COrder_SiebelToBAPI
   /*
    * Input Objects' Integration Components
    *   Order Object (SAP 46C Order)
    *     Order (order)
    *       Order Line Item (item)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 46C Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *       ORDER_PARTNERS
    *       ORDER_ITEMS_IN
    *       ORDER_PARTNERS
    *		ORDER_CONDITIONS_IN
    *		ORDER_CFGS_INST
    *		ORDER_CFGS_REF
    *		ORDER_CFGS_VALUE
    *		ORDER_SCHEDULES_IN
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     	""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",      		""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   	""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",		""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",	""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", 	""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iCardComp; // Card (Payments)
   var iItemComp;  // Order Line Item
   var iAttrComp;  // Item Attribute Component

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component
   var oCFDCfgInstComp;
   var oCFDCfgValComp;
   var oCFDCfgRefComp;
   var oCFDScheduleComp;
   var oCFDCondValComp;


   /*
    * Find and create top-level integration object
    */
   iOrderObj    = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
              var IntId = iOrderComp.GetFieldValue (""Integration Id"");
              EAIRaiseError(LocalizeMessage(""ERR_MSG_ORDER_ALREADY_SUBMITTED,""+IntId+""""));

         }
        
         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         /*
         	*CR # 12-79SPMF to add validation for Sales Area in SAP
         */
         var salesOrg  = iOrderComp.GetFieldValue (""SAP Sales Organization (MO)"");
         var distChannel  = iOrderComp.GetFieldValue (""SAP Distribution Channel (MO)"");
         var division  = iOrderComp.GetFieldValue (""SAP Division (MO)"");
         if ((salesOrg != """") && (distChannel != """") && (division != """") )
         	 	{
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
         	 	}
//nbc    else
//nbc     		{
//nbc     			EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+salesOrg+"",""+distChannel+"",""+division+""""));
//nbc      		}
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO_C"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO_C"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         
         if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            {
               oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            }
            
         
         var date = iOrderComp.GetFieldValue ( ""Pricing Date"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", date );
         

         /*
          * Write ""ORDER_PARTNERS"" component  
          */
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         if (payerId == null || payerId == """")
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId );
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId );
         	}
         
         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

		/*
		 * Read and update Credit Card Info
		 *
		 */
		 iCardComp = iOrderComp.GetIntComp (""Payments"");
		 if (iCardComp.NextRecord ())
		 {
		 var ccType = cCardLM.Translate (iCardComp.GetFieldValue (""Payment Type""));
		 var ccNum = iCardComp.GetFieldValue (""Account Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iCardComp);
		 		var cardExpDate = iCardComp.GetFieldValue ( ""Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iCardComp.GetFieldValue (""Expiration Year"" );
		 				var cardExpMonth  = iCardComp.GetFieldValue (""Expiration Month"" );
		 				var cardExpDay;
		 				
		 				var nMonth = ConvertMonth (cardExpMonth);
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	}
		 }
         /*
          * Read ""Order Line Item"" Integration Component
          */
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         oCFDCondValComp = oCFDImportComp.CreateIntComp (""ORDER_CONDITIONS_IN"");
         oCFDCfgValComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_VALUE"", oCFDImportComp);       
         oCFDCfgRefComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_REF"", oCFDImportComp);         
         oCFDCfgInstComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_INST"", oCFDImportComp);
         oCFDScheduleComp = oCFDImportComp.CreateIntComp (""ORDER_SCHEDULES_IN"", oCFDImportComp);                  
         while (iItemComp.NextRecord ())
         {
/*            var posVariable =""00000"";

              Clib.sprintf(posVariable,""%06.6s"",iItemComp.GetFieldValue(""Line Number""));
            var itemNumber = posVariable;
                  
            var parentItemNum =  iItemComp.GetFieldValue (""Parent Order Item Id"");                  
            if((parentItemNum == null) || (parentItemNum ==""""))
            {*/
            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            var itemNumber = iItemComp.GetFieldValue(""Line Number"");
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number""); 
            //oCFDItemComp.SetFieldValue (""HG_LV_ITEM"",     ""000000"");
            oCFDItemComp.SetFieldValue (""PO_ITM_NO"",      itemNumber);
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
           

            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");

		 		oCFDCondValComp.NewRecord();
		 		oCFDCondValComp.SetCopySource (iItemComp);           
           
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            var itemPrice = iItemComp.GetFieldValue ( ""Item Price"" );            
            
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	itemPrice = itemPrice / 10; // to fix SAP multiplication bug
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""PN00"");
            	//oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
                oCFDCondValComp.SetFieldValue (""COND_VALUE"",     itemPrice);
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                
            }
            else
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""PR00"");
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                             	
		 //Fright Value only if Siebel is Pricing Master		

            if ((  siebelPrice != 0) || (  priceList != """" ))
            var siebelFreight = iItemComp.GetFieldValue(""Freight Amount"");
		 if ((siebelFreight != 0) || (siebelFreight != """"))
		 {oCFDCondValComp.NewRecord();
		 oCFDCondValComp.SetCopySource (iItemComp);  
            
            {
             	var siebelFreight = siebelFreight / 10;// to fix SAP multiplication bug
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""KF00"");
                oCFDCondValComp.SetFieldValue (""COND_VALUE"",     siebelFreight);
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                                
			}
			}
            oCFDScheduleComp.NewRecord ();
            oCFDScheduleComp.SetCopySource  (iItemComp);
            oCFDScheduleComp.CopyFieldValue (""SCHED_LINE"",     ""Line Number"");
            oCFDScheduleComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);            
            oCFDScheduleComp.CopyFieldValue (""REQ_QTY"",     ""Quantity Requested"");            
            oCFDScheduleComp.CopyFieldValue (""REQ_DATE"",     ""Due Date"");            

/*
            oCFDCfgRefComp.NewRecord ();
            oCFDCfgRefComp.SetCopySource  (iItemComp);
            oCFDCfgRefComp.SetFieldValue (""POSEX"",     itemNumber);
            oCFDCfgRefComp.SetFieldValue (""CONFIG_ID"",     itemNumber);            
            oCFDCfgRefComp.SetFieldValue (""ROOT_ID"",     itemNumber);            


            oCFDCfgInstComp.NewRecord ();
            oCFDCfgInstComp.SetCopySource  (iItemComp);
            oCFDCfgInstComp.SetFieldValue (""INST_ID"",     itemNumber);
            oCFDCfgInstComp.SetFieldValue (""CONFIG_ID"",   itemNumber);            
            oCFDCfgInstComp.SetFieldValue (""OBJ_TYPE"",     ""MARA"");            
            oCFDCfgInstComp.SetFieldValue (""OBJ_KEY"",     ""MATERIAL"");            
            oCFDCfgInstComp.SetFieldValue (""QUANTITY"",     ""1"");            


           
      
                    
          // Read ""Order Line Item Attribute Value"" Integration Component
          
         iAttrComp    = iItemComp.GetIntComp        (""Order Item XA"");

         
         while (iAttrComp.NextRecord ())
         {

            oCFDCfgValComp.NewRecord ();
            oCFDCfgValComp.SetCopySource  (iAttrComp);
            oCFDCfgValComp.CopyFieldValue (""CHARC"",     ""Name"");
            oCFDCfgValComp.CopyFieldValue (""VALUE"",     ""Value"");
            oCFDCfgValComp.CopyFieldValue (""CHARC_TXT"", ""Description"");
            oCFDCfgValComp.SetFieldValue (""INST_ID"", itemNumber);
            oCFDCfgValComp.SetFieldValue (""CONFIG_ID"", itemNumber);
		}
		
}  // end if condition for Parent item num  
*/   
         } //order items read
      }
      
   }
}
function CreateOrder ()
{ // referenced by script QuoteToOrderSubmit
	var OrgBusObject = TheApplication().GetBusObject(""Order Entry"");
	var SABusComp = OrgBusObject.GetBusComp(""Order Entry - Orders"");
	var orderType= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE"", ""Sales Order"");
    var orderCode= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE_CODE"", ""Sales"");
	
	SABusComp.NewRecord(0);
	SABusComp.SetFieldValue			(""Active"",				""Y"");
    SABusComp.SetFieldValue 		(""Order Type"",   		orderType);	
	SABusComp.SetFieldValue 		(""Order Type Code"",   	orderCode);	
	// SABusComp.SetFieldValue			(""Price List Id"",		priceList);
	SABusComp.WriteRecord();
	return SABusComp.GetFieldValue	(""Id"");
	
}
function CreateSAP46COrder_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Create SAP 46C Order
   /* Input Objects' Integration Components
    *   BAPI Export (SAP 46C Order - Create SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 46C Order)
    *     Order (oOrder)
    *     
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;   	// BAPI Order instance
   var iExportComp; 	// BAPI Export Parameters
   var iReturnComp; 	// BAPI Return component
   var iItemComp;	   	// BAPI Line Items
   var iIItemComp;	   	// BAPI Inpout Line Items ( ""ORDER_ITEMS_IN"") To fetch Pricing Master Info
   var iSchedItemComp; 	// BAPI Schedule Line Items

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oRFCOrderComp;  // Create Output for RFC_* Table
   var oItemComp;      // Order Line Item
   var oRFCItemComp;   // Output Line Item for RFC_* Table to store pricing info
   var oSchedItemComp  // Schedule Line Item

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj(""SAP 46C Order - Create SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 46C Order"");

   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iOrderObj.GetPrimaryIntComp (""Export Parameters"");
      if (iExportComp.NextRecord ())
      {
      
         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iExportComp);
         
         
		 
		 oOrderComp.SetFieldValue 		(""As Of Date"", 		Timestamp());
		 oOrderComp.SetFieldValue 		(""EAI Sync Date"", 		Timestamp());

         oOrderComp.CopyFieldValue 		(""Integration Id"",  ""SALESDOCUMENT"");
         
         iReturnComp = iExportComp.GetIntComp   (""RETURN"");
         while (iReturnComp.NextRecord ())
         {
            var errorType = iReturnComp.GetFieldValue (""TYPE"");
            if (errorType == ""E"")
            {
            	oOrderComp.SetCopySource  (iReturnComp);
            	oOrderComp.CopyFieldValue (""Back Office Error Text"", ""MESSAGE"");
            	break;
            }
          }         
      }
   }
}
function CreateSAP46COrder_SiebelToBAPI (inputMsg, outputMsg)
{ // referenced by workflow Order - Create SAP 46C Order
   /* Uses same map as CreateFromData() */
   Create77SAP46COrder_SiebelToBAPI (inputMsg, outputMsg,
                                        ""SAP 46C Order"",
                                        ""SAP 46C Order - Create SAP Order (BAPI Input)"");
}
function CreateSAP46COrder_SiebelToBAPICOMMIT (inputMsg, outputMsg)
{  // referenced by workflow Order - Create SAP 46C Order
	/*
	 * Set up EAI Output Message Objects
	 */
	 var oCommitObj;	// BAPI instance
	 var oCommitComp;	// BAPI Component
	 
	oCommitObj	= outputMsg.CreateIntObj (""Account - Commit SAP 46C Transaction (BAPI Input)"");
    oCommitObj.NewInstance();
    oCommitComp = oCommitObj.CreatePrimaryIntComp (""Import Parameters"");
    oCommitComp.NewRecord ();
   
}
function GetDaysInAMonth(nMonth, nYear)
{ // general utility function

	// Jan, Mar, May, Jul, Aug, Oct, Dec have 31 days each
	// Apr, Jun, Sept, Nov have 30 days each
	// Feb, for now, has 28 days.
	var daysInMonth = new Array(31,28,31,30,31,30,31,31,30,31,30,31);
	var nCurrentDays;


	// Only February can be either 28 or 29, depending on whether the year is a leap year
	if (nMonth == 2)
	{
		// If the year is divisible by 4, it is a leap year
		if (nYear%4 == 0)
		{
			// If the year is a century, then it should be divisible by 400 to be a leap year.
			if (nYear%100 == 0)
			{
				// If it is a century and divisible by 400, it is a leap year.
				if (nYear%400 == 0) { nCurrentDays = 29;}

				// If it is a century and NOT divisible by 400 (e.g. 1900), it is NOT a leap year.
				else	{ nCurrentDays = 28;}
			}
		
			// If it is not a century and divisible by 4, it is a leap year.
			else { nCurrentDays = 29;}
		}

		// If a year is NOT divisible by 4, it is not a leap year
		else { nCurrentDays = 28; }
	}


	// If the month is NOT Feb, calculating days in a month is straight-forward.
	// eScript array index starts with 0, not 1.
	else
	{ nCurrentDays = daysInMonth[nMonth - 1]; }

	return nCurrentDays;

}
function GetOrderId (orderId)
{ // Called from script OrderStatus
	var OrdBusObject = TheApplication().GetBusObject(""Order Entry"");
	var OrdBusComp = OrdBusObject.GetBusComp(""Order Entry - Orders"");
	
	OrdBusComp.ClearToQuery();
	OrdBusComp.SetViewMode (AllView); // 12-8NF9TR
	OrdBusComp.SetSearchSpec(""Integration Id"", orderId);
	OrdBusComp.ActivateField(""Id"");
	OrdBusComp.ExecuteQuery();
	
	if(OrdBusComp.FirstRecord())
	{
	   return OrdBusComp.GetFieldValue(""Id"");
	}
      	else
           return null;
	
}
function GetSAP46CGetDetailedList_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Get Detailed List SAP 46C Order
   /*
    * Input Objects' Integration Components
    *   BAPI Export (SAP 46C Order - Get Detailed List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *           Order Item Delivery Item (deliv)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 46C Order)
    *     Order (oOrder)
    *       Get Status Output
    *       Get Status Header
    *         Get Status Item
    *           Get Status Item Delivery Item
    *       Order Line Item
    *         Order Line Item Action
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGSOrderObj;        // BAPI Order instance
   var iGSExportComp;      // BAPI Export Parameters
   var iGSHeaderComp;      // BAPI Order Headers for Document Numbers ***
   var iGSItemComp;        // BAPI Order Item Data for Document Numbers ***
   var iGSCondComp; 	   // BAPI Condition Records
   var iGSScheduleComp;    // BAPI Order Schedule Lines for Document Numbers ***
   var iGSHeaderStatusComp;// BAPI Header Status for Document Numbers ***
   var iGSItemStatusComp;  // BAPI item Status for Document Numbers ***
   var iGSDocFlowComp;     // BAPI Document Flows for Document Numbers ***
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;        // Siebel Orderinstance
   var oOrderComp;       // Order
   var oItemComp;        // Order Line Item
   var oScheduleComp;    // Order Line Item Action
   var oDelivComp;       // Order Line Item Action
   var oDocFlowComp;     // Order XA
      

   /*
    * Find and create top-level integration object
    */
   iGSOrderObj = inputMsg.GetIntObj(""SAP 46C Order - Get Detailed List (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 46C Order"");

   /*
    * Read int object instances from EAI message
    */

   while (iGSOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oOrderObj.NewInstance ();
      
      /*
       * Create ""Order"" component
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      /*
       * Read ""Export Parameters"" component
       */
      iGSExportComp = iGSOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
   
      if (iGSExportComp.NextRecord())
      {
         /*
          * Read ""Order Header"" component
          */
         iGSHeaderComp = iGSExportComp.GetIntComp (""ORDER_HEADERS_OUT"");
         
         if (iGSHeaderComp.NextRecord ())
         {
            /*
             * Update ""Order"" component
             */
            oOrderComp.SetCopySource  (iGSHeaderComp);
            
            // EAI Lookup code ""SAP Currency""
            var currencyCode = currencyLM.Translate (iGSHeaderComp.GetFieldValue (""CURRENCY""));
   
            if (currencyCode != null && currencyCode != """")
              {     
                 oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
              }     
            oOrderComp.CopyFieldValue (""Requested Ship Date"",     ""REQ_DATE_H"");
            oOrderComp.CopyFieldValue (""Integration Id"",          ""DOC_NUMBER"");
            oOrderComp.CopyFieldValue (""Account Order Number"",    ""PURCH_NO"");
            
            // Delivery Block
            var sapDelBlock = iGSHeaderComp.GetFieldValue ( ""DLV_BLOCK"" );
		    var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
		    oOrderComp.SetFieldValue (""Delivery Block"",          delBlock);
		    
		    // Billing Block
		    //var sapBillBlock = iGSHeaderComp.GetFieldValue ( ""BILL_BLOCK"" );
		    //var billBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
		    //oOrderComp.SetFieldValue (""Billing Block"",          billBlock);
		    
		    var salesdoc =  iGSHeaderComp.GetFieldValue (""DOC_NUMBER"");
                    
        
         iGSHeaderStatusComp = iGSExportComp.GetIntComp (""ORDER_STATUSHEADERS_OUT"");
         
         if (iGSHeaderStatusComp.NextRecord ())
         {
           
           	 oOrderComp.SetCopySource  (iGSHeaderStatusComp);
   	      // Overall processing status of document
			 var sapOStatus = iGSHeaderStatusComp.GetFieldValue ( ""PRC_STAT_H"" );
        	 if ( sapOStatus == ""C"" )
           		{
           			oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Closed""));
           		}
            		else if ( sapOStatus == ""B"" )
           		{
              		oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Partially Shipped""));	
           		}
            	  		else 
           			{
           	   			oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Open""));             	 
            		} 
                     
         // Delivery status
			 var sapDStatus = iGSHeaderStatusComp.GetFieldValue ( ""DELIV_STAT"" );
        	 if ( sapDStatus == ""C"" )
        		{
       	    		oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Closed""));
           		}
            		else if ( sapDStatus == ""B"" )
           		{
              		oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Partially Shipped""));	
           		}
              			else 
           			{
           	   			oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Open""));             	 
            		}               	                    
            
         } 
                           	                    
	      /*
           * Item
           */
          
          iGSItemComp = iGSExportComp.GetIntComp (""ORDER_ITEMS_OUT"");

          
          oItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
                      
          while (iGSItemComp.NextRecord ())
           	 {
         	     //var parItemnum = iGSItemComp.GetFieldValue (""HG_LV_ITEM"");
         	     //if (parItemnum == ""000000"" || parItemnum == """") // remove this if clause in case you want to get Child Component of Configurable Materials
				//{               
               
            	 var itemMaterial = iGSItemComp.GetFieldValue (""MATERIAL"");
               
              	 oItemComp.NewRecord ();
               	 oItemComp.SetCopySource (iGSItemComp);
               	 var itemnum  = iGSItemComp.GetFieldValue (""ITM_NUMBER"");
            	 var qtyReq   = iGSItemComp.GetFieldValue (""REQ_QTY"");
             	 var itemReqDate 	   = iGSItemComp.GetFieldValue (""REQ_DATE"");
            	 oItemComp.CopyFieldValue (""Product Integration Id"", ""MATERIAL"");
               	 oItemComp.CopyFieldValue (""Line Number"",            ""ITM_NUMBER"");
               	 oItemComp.CopyFieldValue (""Description"",            ""SHORT_TEXT"");
               	 var itemUOM = iGSItemComp.GetFieldValue (""SALES_UNIT"");
		       	 oItemComp.CopyFieldValue (""Product Unit of Measure"",""SALES_UNIT"");
                 oItemComp.SetFieldValue (""Quantity Requested"", qtyReq);
				 oItemComp.CopyFieldValue (""Quantity Shipped"",  ""REF_QTY"");
                 oItemComp.SetFieldValue (""Due Date"", itemReqDate);
				 oItemComp.CopyFieldValue (""NRC CxTotal"", ""NET_VALUE""); // nbc 7.8.2 
              
            	 var condFlag = false;
		         iGSCondComp = iGSExportComp.GetIntComp (""ORDER_CONDITIONS_OUT"");	                 
                 while (iGSCondComp.NextRecord ())
                 {
                  oItemComp.SetCopySource (iGSCondComp);
                 	if ((iGSCondComp.GetFieldValue (""ITM_NUMBER"") == itemnum)) 
                  		{
                 			if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""PN00""))
                 			 {	var netPrice = 0;
                 				var netValue = 0;
                 				if (itemUOM == (iGSCondComp.GetFieldValue (""COND_D_UNT"")))
                					{oItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 	oItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
									oItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); // nbc 7.8.2 SAP 4x Net Price
                 					}
                 			  	else
              						{netValue = (iGSCondComp.GetFieldValue (""CONDVALUE""));
                 					 	if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 	 	 		 oItemComp.SetFieldValue  (""Unit Price"",   netPrice);
               	 			 	 			 oItemComp.SetFieldValue  (""Adjusted List Price"",   netPrice);
										     oItemComp.SetFieldValue  (""Net Price"",   netPrice); //nbc 7.8.2 SAP 4x Net Price
               	 			 	 			}
               	 			 	 	}
               	 			 	condFlag = true;
               	 	     	}
               	 		
               	   			if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""PR00"") && (condFlag == false))
	               				{	
                 					var netPrice= 0;
                 					var netValue = 0;
                 					if (itemUOM == (iGSCondComp.GetFieldValue (""COND_D_UNT"")))
                 			    		{oItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 		oItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
										oItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); //nbc 7.8.2 SAP 4x Net Price										
                 						}
                 					else
                 						{ netValue = (iGSCondComp.GetFieldValue (""CONDVALUE""));
                 			 	  		if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 		  		oItemComp.SetFieldValue  (""Unit Price"",  netPrice);
               	 			 	      		oItemComp.SetFieldValue  (""Adjusted List Price"",  netPrice); 
											oItemComp.SetFieldValue  (""Net Price"",  netPrice); //nbc 7.8.2 SAP 4x Net Price
               	 			 	      		}
               	 			 	 		}
               	 		 		}
               	 		
               	 	if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""KF00""))
                 		{
                 		 oItemComp.CopyFieldValue  (""Freight Amount"",   ""CONDVALUE"");
               	 		}
               	 			
               	 	if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""UTXJ""))
                 		{
                 		 oItemComp.CopyFieldValue  (""Tax Amount"",   ""CONDVALUE"");
               	 		}
               	 	} // end if ((iGSCondComp.GetFieldValue (""ITM_NUMBER"") == itemnum)) 
               	 } // end while (iGSCondComp.NextRecord ())
		 
                 iGSItemStatusComp = iGSExportComp.GetIntComp (""ORDER_STATUSITEMS_OUT"");
                 while (iGSItemStatusComp.NextRecord ())
           	     {
           	       oItemComp.SetCopySource  (iGSItemStatusComp);
           	        var iStatusItemNum = iGSItemStatusComp.GetFieldValue (""ITM_NUMBER"");
           	        if (iStatusItemNum == itemnum)
           	        {
           	          var sapStatus = iGSItemStatusComp.GetFieldValue ( ""DLV_STAT_I"" );
		 	          var itemStatus= TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_ITEM_DELIV_STATUS"", sapStatus);
                      oItemComp.SetFieldValue (""Delivery Status"",        itemStatus);
                    }
                  }

          // Item Schedule

		         iGSScheduleComp = iGSExportComp.GetIntComp (""ORDER_SCHEDULES_OUT"");
		         oScheduleComp   = oItemComp.CreateIntComp (""Order Entry - Line Item Actions"");
                 while (iGSScheduleComp.NextRecord ())
           	      { 
           	       var itemnum2  = iGSScheduleComp.GetFieldValue (""ITM_NUMBER"");
                   var schednum = iGSScheduleComp.GetFieldValue (""SCHED_LINE"");
                   var intId;
                   if (itemnum2 == itemnum)
                   {
           
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSScheduleComp);
                
                    intId = inputId + ""-"" + itemnum2 + ""-"" + schednum;
                    oScheduleComp.SetFieldValue (""Line Item Action Number"",     intId);
                    oScheduleComp.SetFieldValue (""Integration Id"",     intId);
                    oScheduleComp.CopyFieldValue (""Actual Start Date"",           ""GI_DATE"");
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",               ""CONFIR_QTY"");
                    var reqDate = iGSScheduleComp.GetFieldValue ( ""REQ_DATE"");
                    oScheduleComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                
                   } 
           	     }
           	   

          	/*	
             * Item Document Flow
			 */
			 
		 		 iGSDocFlowComp = iGSExportComp.GetIntComp (""ORDER_FLOWS_OUT"");
                   var prevDoc = null;
                   var prevItem = null;

				while (iGSDocFlowComp.NextRecord ())
           	      { 
           	       var itemnum3 = null; 
				   var docCat = iGSDocFlowComp.GetFieldValue (""DOCCATEGOR"");          	      
         	       var ordernum2  = iGSDocFlowComp.GetFieldValue (""PRECSDDOC"");
                   var subqDoc  = iGSDocFlowComp.GetFieldValue (""SUBSSDDOC"");
                   var subqItem = iGSDocFlowComp.GetFieldValue (""SUBSITDOC"");
         	       
           	       itemnum3   = iGSDocFlowComp.GetFieldValue (""PREDITDOC"");
                   if ((itemnum3 == itemnum) && (docCat == ""J""))
 					{
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSDocFlowComp);
                    var itemActionNum = subqDoc + ""-"" + subqItem ;
                    oScheduleComp.SetFieldValue  (""Line Item Action Number"",  itemActionNum);
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",       ""REF_QTY"");
                    oScheduleComp.CopyFieldValue (""Planned Start Date"",       ""CREAT_DATE"");
                    oScheduleComp.SetFieldValue  (""Integration Id"",  itemActionNum);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Delivery"");
                
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                    prevDoc = subqDoc;
                    prevItem = subqItem;
                    }
                    
                    
                    else if ((docCat == ""R"") && (prevDoc == ordernum2) && (prevItem == itemnum3))
                    {
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSDocFlowComp);
                    var itemActionNum1 = subqDoc + ""-"" + subqItem ;
                    oScheduleComp.SetFieldValue  (""Line Item Action Number"",  itemActionNum1);
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",       ""REF_QTY"");
                    oScheduleComp.CopyFieldValue (""Planned Start Date"",       ""CREAT_DATE"");
                    oScheduleComp.SetFieldValue  (""Integration Id"",  itemActionNum1);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Ship"");
                
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                    prevDoc = subqDoc;
                    prevItem = subqItem;
					}
                    
                  }

	        }
	      //} // endif for (parItemnum == ""000000"") 
		}
 	 }
                
   }
}
function GetSAP46CGetDetailedList_SiebelToBAPI (inputMsg, outputMsg)
{  // referenced by workflow Order - Get Detailed List SAP 46C Order
   /* Input Objects' Integration Components
    *   Order Object (SAP 46C Order)
    *     Order
    *
    * Output Object's Integration Components:
    *   BAPI Import (SAP 46C Order - Get Detailed List (BAPI Input))
    *     Import Parameters
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;    // Siebel Order instance
   var iOrderComp;   // Order

   /*
    * Set up EAI Output Message objects
    */
   var oGSObj;           // BAPI instance
   var oGSImportComp;    // Import Parameters
   var oGSSalesDocComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (""SAP 46C Order"");
   oGSObj    = outputMsg.CreateIntObj (""SAP 46C Order - Get Detailed List (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Get Status"" object
       */
      oGSObj.NewInstance ();

      /*
       * Read ""Order"" component
       iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");

       */
      iOrderComp      = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oGSImportComp   = oGSObj.CreatePrimaryIntComp (""Import Parameters"");

      
      if (iOrderComp.NextRecord ())
      {

          
         oGSImportComp.NewRecord ();
         oGSImportComp.SetCopySource  (iOrderComp);
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-ADDRESS"",   ""X""); 
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-BILLPLAN"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-BUSINESS"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CONFIGURE"", ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CONTRACT"",  ""X""); 
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CREDCARD"",  ""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-FLOW"",      ""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-HEADER"",    ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-INCOMP_LOG"",""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-ITEM"",      ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-PARTNER"",   ""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDCOND"",    ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDCOND_ADD"",""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDSCHEDULE"",""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-STATUS_H"",  ""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-STATUS_I"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-TEXT"",      ""X""); 
         oGSImportComp.SetFieldValue (""I_MEMORY_READ"",         ""A"");
         oGSSalesDocComp = oGSImportComp.CreateIntComp (""SALES_DOCUMENTS"");         
         oGSSalesDocComp.NewRecord ();
         oGSSalesDocComp.SetCopySource  (iOrderComp);
         oGSSalesDocComp.CopyFieldValue (""VBELN"", ""Integration Id"");
      
      }

   }   
}
function LocalizeMessage(Message)
{ // general utility function
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function OrderStatus (inputMsg,outputMsg )
{ // referenced from workflow Order - Change SAP 46C Order Status
	// var theApp = TheApplication();
	
   /* Input Objects' Integration Components
	*   Order IDOC (SAP 46C Order Status (IDOC 4x))
	*
	*/

   
   /*
	* Set up EAI Input Message objects
	*/
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iORDERComp; // IDOC Order Header
	
   /*
    * Set up EAI Output Message objects (Dummy)
    */
   var oOrderObj;      // Order object instance
   var oOrderComp;     // Order (header)
   var oOrderItemComp; // Order Item (item)
	
   /*
	* Find and create top-level integration object
	*/
	iIDOCObj    = inputMsg.GetIntObj (""SAP 46C Order Status (IDOC 4x)"");
	oOrderObj = outputMsg.CreateIntObj (""SAP 46C Order"");
	
   /*
	* Read int object instances from EAI message
	*/
	while (iIDOCObj.NextInstance ())
	{
	   
       /*
		* Read virtual root component that IDOC RFC Adapter populates
		*/
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		oOrderObj.NewInstance ();
		oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
		iIDOCComp.NextRecord ();

	   /*
		* Read ""ORDER"" component
		*/
        iORDERComp = iIDOCComp.GetIntComp (""E2EDK01005"");
		if (iORDERComp.NextRecord ())
		    {
			   
			    var orderNo = iORDERComp.GetFieldValue ( ""BELNR"" );
			    var orderId;
				
				orderId = GetOrderId(orderNo);
				
				outputMsg.SetArgument (""Object Id"", orderId);
                
				var wfManager = TheApplication().GetService(""EAI Business Integration Manager (Server Request)"");
    
    			var input = TheApplication().NewPropertySet();
		    	var output = TheApplication().NewPropertySet();
		    	input.SetProperty(""ProcessName"", ""Order - Get Detailed List SAP 46C Order"");
    			input.SetProperty(""RowId"", orderId);
    			wfManager.InvokeMethod(""RunProcess"", input, output);
    			// TheApplication().MsgBox(""Get Status WF Invoked Sucessfully"");
    		}	
	

	}

}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   return EAIExecuteMap (MethodName, Inputs, Outputs);
}
"
function Simulate77SAP46COrder_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{ // referenced by script SimulateSAP46COrder_SiebelToBAPI
   /*
    * Input Objects' Integration Components
    *   Order Object (SAP 46C Order)
    *     Order Entry - Orders (order header)
    *       Order Entry - Line Items (item)
    *        Order Item XA (attributes)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 46C Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *      ORDER_HEADER_IN
    *       ORDER_PARTNERS
    *       ORDER_CCARD
    *       ORDER_ITEMS_IN
    *		ORDER_CFGS_INST
    *		ORDER_CFGS_REF
    *		ORDER_CFGS_VALUE
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     	""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",      		""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   	""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",		""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",	""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", 	""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iCardComp; // Payments
   var iItemComp;  // Order Line Item
   var iAttrComp;  // Item Attribute Component

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component
   var oCFDCfgInstComp;
   var oCFDCfgValComp;
   var oCFDCfgRefComp;


   /*
    * Find and create top-level integration object
    */
   iOrderObj    = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
              var IntId = iOrderComp.GetFieldValue (""Integration Id"");
              EAIRaiseError(LocalizeMessage(""ERR_MSG_ORDER_ALREADY_SUBMITTED,""+IntId+""""));

         }
        
         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         /*
         	*CR # 12-79SPMF to add validation for Sales Area in SAP
         */
         var salesOrg  = iOrderComp.GetFieldValue (""SAP Sales Organization (MO)"");
         var distChannel  = iOrderComp.GetFieldValue (""SAP Distribution Channel (MO)"");
         var division  = iOrderComp.GetFieldValue (""SAP Division (MO)"");
         if ((salesOrg != """") && (distChannel != """") && (division != """") )
			{
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
			}
		else
			{
         		EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+salesOrg+"",""+distChannel+"",""+division+""""));
         	}
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         
         if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            {
               oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            }
            
         
         var date = iOrderComp.GetFieldValue ( ""Pricing Date"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", date );
         

         /*
          * Write ""ORDER_PARTNERS"" component  
          */
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         if (payerId == null || payerId == """")
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId );
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId );
         	}
         
         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

		/*
		 * Read and update Credit Card Info
		 *
		 */
		 iCardComp = iOrderComp.GetIntComp (""Payments"");
      if (iCardComp.NextRecord ())
      {
		 var ccType = cCardLM.Translate (iCardComp.GetFieldValue (""Payment Type""));
		 var ccNum = iCardComp.GetFieldValue ( ""Account Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iCardComp);
		 		var cardExpDate = iCardComp.GetFieldValue ( ""Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iCardComp.GetFieldValue (""Expiration Year"" );
		 				var cardExpMonth  = iCardComp.GetFieldValue (""Expiration Month"" );
		 				var cardExpDay;
		 				
		 				var nMonth = ConvertMonth (cardExpMonth);
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	}
	   }
         /*
          * Read ""Order Line Item"" Integration Component
          */
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         //oCFDCondValComp = oCFDImportComp.CreateIntComp (""ORDER_CONDITIONS_IN"");
         oCFDCfgValComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_VALUE"", oCFDImportComp);       
         oCFDCfgRefComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_REF"", oCFDImportComp);         
         oCFDCfgInstComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_INST"", oCFDImportComp);
         //oCFDScheduleComp = oCFDImportComp.CreateIntComp (""ORDER_SCHEDULES_IN"", oCFDImportComp);                  
         while (iItemComp.NextRecord ())
         {
            var itemNum =  iItemComp.GetFieldValue (""Line Number"");
/*           var Posex_Hilfsvariable =""00000"";

            Clib.sprintf(Posex_Hilfsvariable,""%06.6s"",iItemComp.GetFieldValue(""Line Number""));
            var itemNumber = Posex_Hilfsvariable;
                  
            var parentItemNum =  iItemComp.GetFieldValue (""Parent Order Item Id"");                  
            if((parentItemNum == null) || (parentItemNum ==""""))
            {*/
            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            var itemNumber = iItemComp.GetFieldValue(""Line Number"");
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number"");
            //oCFDItemComp.SetFieldValue (""HG_LV_ITEM"",     ""000000"");
            oCFDItemComp.CopyFieldValue (""PO_ITM_NO"",      ""Line Number"");
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
              var plant = iItemComp.GetFieldValue (""Source Inventory Location"");
              //if (plant == """")
              //{EAIRaiseError(""Please Specify Plant in Item # "" + itemNumber);}
            
            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");
            oCFDItemComp.CopyFieldValue (""REQ_DATE"",       ""Due Date"");
            oCFDItemComp.SetFieldValue  (""DATE_TYPE"",      ""1"");
            oCFDItemComp.CopyFieldValue (""REQ_QTY"",        ""Quantity Requested"");
	            
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PN00"");
            	oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
			    oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     ""Item Price"");
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            	
             	oCFDItemComp.SetFieldValue  (""CD_TYPE3"",      ""KF00"");
                oCFDItemComp.CopyFieldValue (""CD_VALUE3"",     ""Freight Amount"");
  


            }
            else
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PR00"");
                // oCFDItemValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);  
                                           	
//}  // end if condition for Parent item num

/*
            oCFDCfgRefComp.NewRecord ();
            oCFDCfgRefComp.SetCopySource  (iItemComp);
            oCFDCfgRefComp.SetFieldValue (""POSEX"",     itemNumber);
            oCFDCfgRefComp.SetFieldValue (""CONFIG_ID"",     itemNumber);            
            oCFDCfgRefComp.SetFieldValue (""ROOT_ID"",     itemNumber);            


            oCFDCfgInstComp.NewRecord ();
            oCFDCfgInstComp.SetCopySource  (iItemComp);
            oCFDCfgInstComp.SetFieldValue (""INST_ID"",     itemNumber);
            oCFDCfgInstComp.SetFieldValue (""CONFIG_ID"",   itemNumber);            
            oCFDCfgInstComp.SetFieldValue (""OBJ_TYPE"",     ""MARA"");            
            oCFDCfgInstComp.SetFieldValue (""OBJ_KEY"",     ""MATERIAL"");            
            oCFDCfgInstComp.SetFieldValue (""QUANTITY"",     ""1"");            

*/
           
      
                    /*
          * Read ""Order Line Item Attribute Value"" Integration Component
          */
/*         iAttrComp    = iItemComp.GetIntComp        (""Order Item XA"");

         
         while (iAttrComp.NextRecord ())
         {

            oCFDCfgValComp.NewRecord ();
            oCFDCfgValComp.SetCopySource  (iAttrComp);
            oCFDCfgValComp.CopyFieldValue (""CHARC"",     ""Name"");
            oCFDCfgValComp.CopyFieldValue (""VALUE"",     ""Value"");
            oCFDCfgValComp.CopyFieldValue (""CHARC_TXT"", ""Description"");
            oCFDCfgValComp.SetFieldValue (""INST_ID"", itemNumber);
            oCFDCfgValComp.SetFieldValue (""CONFIG_ID"", itemNumber);
		}
  */   
         } //order items read
      }
      
   }
}
function SimulateSAP46COrder_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Simulate SAP 46C Order
   /* Input Objects' Integration Components
    *   BAPI Export (SAP 46C Order - Simulate SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 46C Order)
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM 	 = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");
   var ccStatusLM	 = new CSSEAIValueMap (""SAP Credit Card Approval Code"", ""Siebel Inbound"");
   var cCardLM	 	 = new CSSEAIValueMap (""SAP Credit Card Type"", ""Siebel Inbound"");
  

   /*
    * Set up EAI Input Message objects
    */
   var iSimOrderObj;   // BAPI Order instance
   var iSimExportComp; // BAPI Export Parameters
   var iSimItemComp;   // BAPI Order Items
   var iSimIItemComp;  // BAPI Order Input Item Comp to retieve value for Fix Pricing flag
   var iSchedItemComp; // BAPI Schedule Line Items
   var iSimCCardComp;  // BAPI Credit Card Export Comp

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oCardComp;	   // Order Card Payment Comp
   var oOutputComp; // Simulate Output RFC_*
   var oItemComp;   // Simulate Item Output RFC_*
   var oSimItemComp;   // Simulate Item
   // var oItemComp;      // Item
   var oSchedItemComp; // Schedule Line Item

   /*
    * Find and create top-level integration object
    */
   iSimOrderObj = inputMsg.GetIntObj (""SAP 46C Order - Simulate SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 46C Order"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iSimOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      /*
       * Read ""Export Parameters"" component
       */
      iSimExportComp = iSimOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      if (iSimExportComp.NextRecord ())
      {
         
         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iSimExportComp);
         oOrderComp.SetFieldValue(""As Of Date"", Timestamp());
		 
         var sapDelBlock = iSimExportComp.GetFieldValue ( ""SHIP_TO_PARTY-DLV_BLOCK"" );
		 var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
         oOrderComp.SetFieldValue (""Delivery Block"",     delBlock);
         
         // sapBlock 		= null;
         var sapBillBlock = iSimExportComp.GetFieldValue ( ""BILLING_PARTY-BILL_BLOCK"" );
		 var billBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
         oOrderComp.SetFieldValue (""Billing Block"",     billBlock);

		 // oOrderComp.CopyFieldValue (""Billing Block"",      ""BILLING_PARTY-BILL_BLOCK"");
         var errorMessage = iSimExportComp.GetFieldValue ( ""RETURN-MESSAGE"");
         if (errorMessage == null)
         oOrderComp.SetFieldValue (""Back Office Error Text"", "" "");
         else
         oOrderComp.CopyFieldValue (""Back Office Error Text"",     ""RETURN-MESSAGE"");
		 
		 
         // var currencyCode = currencyLM.Translate (iSimExportComp.GetFieldValue (""SOLD TO PARTY-CURRENCY""));
         
         // if (currencyCode != null && currencyCode != """")
            // {
              // oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
            // }

         var returnCode = iSimExportComp.GetFieldValue (""RETURN-CODE"");
         
         if ( (returnCode == ""V1154"") || (returnCode == ""V1038"") )
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""N"");
            }
         else
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""Y"");
            }

		// Just to Store Order Id so that Net Price at Item Table can be stored for Pricing Ref Purpose.
      	//oOutputComp = oOrderComp.CreateIntComp (""Order Entry - Get SAP Order Status Header"");
      	//oOutputComp.NewRecord();
      	//oOutputComp.SetFieldValue (""Input Id"", inputId);
        //oOutputComp.SetFieldValue (""Order Number"", inputId);

         /*
          * Read ""ORDER_CCARD_EX"" component
          */
		 
		  iSimCCardComp = iSimExportComp.GetIntComp (""ORDER_CCARD_EX"");
		  oCardComp = oOrderComp.CreateIntComp (""Payments"", false);
          var cardStatus;
          var cardLineNo = 0;
          while (iSimCCardComp.NextRecord())
          {
         	 cardStatus = iSimCCardComp.GetFieldValue ( ""CC_STAT_EX"");
         	 if ( cardStatus != null && cardStatus != """" )
         	 {
         	 oCardComp.NewRecord ();
             oCardComp.SetCopySource  (iSimCCardComp);
         	 
         	 	cardLineNo++;
         		var cardIntId = inputId + ""-"" + cardLineNo; 
         		oCardComp.SetFieldValue ( ""Integration Id"", cardIntId);
         	 
         	 	oOrderComp.SetCopySource (iSimCCardComp);
         		
         	 	oCardComp.CopyFieldValue (""Account Number"", ""CC_NUMBER"");
         		oCardComp.CopyFieldValue (""Card Holder"", ""CC_NAME"");
         	 	oCardComp.CopyFieldValue (""Authorization Date"", ""AUTH_DATE"");
           	 	oCardComp.CopyFieldValue (""Authorization Code"", ""CC_AUTTH_NO"");
           	 	// oCardComp.CopyFieldValue (""Credit Card Approval Code"", ""AUTH_REFNO"");
           	 	//oCardComp.CopyFieldValue (""Transaction Amount"", ""CC_RE_AMOUNT"");
          	 	oCardComp.CopyFieldValue (""Transaction Amount"", ""AUTHAMOUNT"");
           	 	//var ccStatus = ccStatusLM.Translate (iSimCCardComp.GetFieldValue (""CC_STAT_EX""));
           	 	//var LDccStatus = TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ccStatus);
           	 	var ccStat = iSimCCardComp.GetFieldValue ( ""CC_STAT_EX"");
           	 	var ccReact = iSimCCardComp.GetFieldValue ( ""CC_REACT"");
           	 	
           	 	if (ccStat == ""C"")
           	 		{ if (ccReact == ""A"")
           	 			{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""Authorized"") );}
           	 		  else
           	 		  	{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""Declined"") );}
           	 		 }
           	 	else
           	 		{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""AVS Failed"") );}
           	 	// oCardComp.SetFieldValue (""Payment Status"", LDccStatus );         		
				oCardComp.CopyFieldValue (""Expiration Date"", ""CC_VALID_T"" );
				oCardComp.CopyFieldValue (""Transaction Message"", ""CC_REACT_T"" );
				var expDate = iSimCCardComp.GetFieldValue (""CC_VALID_T"");
				// var array = expDate.split(""/"");
         		var expMonth = expDate.substring(0,2);
         		if (expMonth < 10)
         			{expMonth = expDate.substring(1,2);}
         		var expYear = expDate.substring(6,10);
         		oCardComp.SetFieldValue (""Expiration Month"", expMonth );
				oCardComp.SetFieldValue (""Expiration Year"", expYear );
				var paymentMethod = TheApplication().InvokeMethod (""LookupValue"", ""PAYMENT_METHOD_CODE"", ""Credit Card"");
                oCardComp.SetFieldValue  (""Payment Method"",   paymentMethod);
				var cardType = cCardLM.Translate (iSimCCardComp.GetFieldValue (""CC_TYPE""));
           	 	var LDCardType = TheApplication().InvokeMethod (""LookupValue"", ""PAYMENT_TYPE_CODE"", cardType);
           	 	oCardComp.SetFieldValue	 (""Payment Type"", LDCardType);
         	 }
          }
         		


         /*
          * Read ""ORDERS_ITEMS_OUT"" component
          */

         iSimItemComp = iSimExportComp.GetIntComp (""ORDER_ITEMS_OUT"");
         iSimIItemComp = iSimExportComp.GetIntComp ( ""ORDER_ITEMS_IN"");
         oSimItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
         while (iSimItemComp.NextRecord ())
         {
            var parItemnum = iSimItemComp.GetFieldValue ( ""HG_LV_ITEM"" );
            if (parItemnum == null || parItemnum == ""000000"" || parItemnum == """") // please comment this if statement if you want to support child componenets of Config Product
            {
            oSimItemComp.NewRecord ();
            oSimItemComp.SetCopySource  (iSimItemComp);
            
            iSimIItemComp.NextRecord ();
            
            var fixPrice = iSimIItemComp.GetFieldValue ( ""PURCH_NO_C"" );
                        
            
		    var netVal          = iSimItemComp.GetFieldValue (""SUBTOTAL_2""); // nbc
			// start - adjustment to SAP bug (nbc)
			if (fixPrice == ""X"") 
			 { 
				netVal = netVal / 10; 
			 } 
			// End - adjustment to SAP bug (nbc)
            var qtyReq			= iSimItemComp.GetFieldValue (""REQ_QTY"");
            var netTax		= null;
            if ( qtyReq != 0 )
             {
            	var netPrice 		= netVal / qtyReq ; 
             }
            
            if (fixPrice != ""X"")
             {
            	oSimItemComp.SetFieldValue    (""Adjusted List Price"",         netPrice);
            	oSimItemComp.CopyFieldValue   (""Tax Amount"",                ""SUBTOTAL_5"");	
            	oSimItemComp.CopyFieldValue   (""Freight Amount"",            ""SUBTOTAL_4"");
				oSimItemComp.SetFieldValue    (""Net Price"",   	   	netPrice); //nbc
             }
            else
            {
				oSimItemComp.CopyFieldValue   (""Tax Amount"",                ""SUBTOTAL_5"");	
            	oSimItemComp.SetFieldValue    (""Freight Amount"",            ""0"");
				oSimItemComp.SetFieldValue    (""Net Price"",      	netPrice); //nbc
            }
            
            
            var itemReqDate = iSimItemComp.GetFieldValue (""DLV_DATE""); 
            var itemnum = iSimItemComp.GetFieldValue (""ITM_NUMBER"");
            var itemCurrency = currencyLM.Translate (iSimItemComp.GetFieldValue (""CURRENCY""));
            
            oSimItemComp.SetFieldValue     (""Currency Code"",             itemCurrency );                   
            oSimItemComp.CopyFieldValue    (""Line Number"",                ""ITM_NUMBER"");
            oSimItemComp.CopyFieldValue    (""Quantity Requested"",        ""REQ_QTY"");
            oSimItemComp.CopyFieldValue    (""Product Integration Id"",        ""MATERIAL"");
            oSimItemComp.CopyFieldValue    (""Source Inventory Location"",        ""PLANT"");
			oSimItemComp.SetFieldValue     (""NRC CxTotal"",        netVal); // nbc
            
            
                  
           /*
            * Read ""ORDER_SCHEDULE_EX"" component
            */
            
            iSchedItemComp = iSimExportComp.GetIntComp   (""ORDER_SCHEDULE_EX"");
            oSchedItemComp = oSimItemComp.CreateIntComp (""Order Entry - Line Item Actions"", false);
		
			var firstScheduleLine = 1;
			
        
            while (iSchedItemComp.NextRecord ())
             {
               var itemnum2  = iSchedItemComp.GetFieldValue (""ITM_NUMBER"");
               var schednum = iSchedItemComp.GetFieldValue (""SCHED_LINE"");
               var intId;
               if (itemnum2 == itemnum)
               {
           
                oSchedItemComp.NewRecord ();
                oSchedItemComp.SetCopySource  (iSchedItemComp);
                
                intId = inputId + ""-"" + itemnum2 + ""-"" + schednum;
               
                // oSchedItemComp.SetFieldValue (""Integration Id"",             intId);
                oSchedItemComp.CopyFieldValue (""Quantity"",                   ""REQ_QTY"");
                oSchedItemComp.SetFieldValue (""Line Item Action Number"",     intId);
                // oSchedItemComp.SetFieldValue  (""Quantity"",     qtyReq);                
                oSchedItemComp.CopyFieldValue (""Actual Start Date"",           ""GI_DATE"");
                oSchedItemComp.CopyFieldValue (""Confirmed Qty"",               ""CONFIR_QTY"");
                var reqDate = iSchedItemComp.GetFieldValue ( ""REQ_DATE"");
                oSchedItemComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                // Checking for First Schedule Line, as it contains actual Req Delivery Date and setting it for Item Req Delv Date
                if ( firstScheduleLine == 1 )
                	{
                		oSimItemComp.SetFieldValue    (""Due Date"",      reqDate );
                	}
                firstScheduleLine++;
                
                var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
                   oSchedItemComp.SetFieldValue  (""Line Item Action Type"",   shipValue);

                // oSchedItemComp.SetFieldValue  (""Line Item Action Type"",      ""Schedule"");
                }
             }
			} //endif (parItemnum == ""000000"" || parItemnum == """")

         }

      }
   }
}
function SimulateSAP46COrder_SiebelToBAPI (inputMsg, outputMsg)
{  // referenced by workflow Order - Simulate SAP 46C Order
   /* Uses same map as CreateFromData() */
   Simulate77SAP46COrder_SiebelToBAPI (inputMsg, outputMsg, 
                                        ""SAP 46C Order"", 
                                        ""SAP 46C Order - Simulate SAP Order (BAPI Input)"");
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", d.getMonth()+1, d.getDate(), d.getFullYear(), d.getHours(), d.getMinutes(), d.getSeconds()); 
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 6 $
//      $Date: 01/15/01 10:29a $
//    $Author: S.Garg $ of last update
//
// CREATOR:    P. Lim
//
// DESCRIPTION
//    Javascript maps from Siebel Order & Quote to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
/* This function shared by ""Simulate Order"" and ""Create Order"" */"
function ConvertMonth(cardExpMonth)
{ // general utility function
	var nMonth; 
	if ( cardExpMonth == ""January"" )
		{
			nMonth = ""01"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""February"" )
		{
			nMonth = ""02"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""March"" )
		{
			nMonth = ""03"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""April"" )
		{
			nMonth = ""04"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""May"" )
		{
			nMonth = ""05"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""June"" )
		{
			nMonth = ""06"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""July"" )
		{
			nMonth = ""07"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""August"" )
		{
			nMonth = ""08"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""September"" )
		{
			nMonth = ""09"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""October"" )
		{
			nMonth = ""10"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""November"" )
		{
			nMonth = ""11"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""December"" )
		{
			nMonth = ""12"";
			return nMonth ;
		}
	else
		{
			nMonth = ""01"";
			return nMonth ;
		}
}
function Create77SAP47Order_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{ // referenced by script CreateSAP47Order_SiebelToBAPI
   /*
    * Input Objects' Integration Components
    *   Order Object (SAP 47 Order)
    *     Order (order)
    *       Order Line Item (item)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 47 Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *       ORDER_PARTNERS
    *       ORDER_ITEMS_IN
    *       ORDER_PARTNERS
    *		ORDER_CONDITIONS_IN
    *		ORDER_CFGS_INST
    *		ORDER_CFGS_REF
    *		ORDER_CFGS_VALUE
    *		ORDER_SCHEDULES_IN
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     	""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",      		""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   	""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",		""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",	""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", 	""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iCardComp; // Card (Payments)
   var iItemComp;  // Order Line Item
   var iAttrComp;  // Item Attribute Component

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component
   var oCFDCfgInstComp;
   var oCFDCfgValComp;
   var oCFDCfgRefComp;
   var oCFDScheduleComp;
   var oCFDCondValComp;


   /*
    * Find and create top-level integration object
    */
   iOrderObj    = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
              var IntId = iOrderComp.GetFieldValue (""Integration Id"");
              EAIRaiseError(LocalizeMessage(""ERR_MSG_ORDER_ALREADY_SUBMITTED,""+IntId+""""));

         }
        
         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         /*
         	*CR # 12-79SPMF to add validation for Sales Area in SAP
         */
         var salesOrg  = iOrderComp.GetFieldValue (""SAP Sales Organization (MO)"");
         var distChannel  = iOrderComp.GetFieldValue (""SAP Distribution Channel (MO)"");
         var division  = iOrderComp.GetFieldValue (""SAP Division (MO)"");
         if ((salesOrg != """") && (distChannel != """") && (division != """") )
         	 	{
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
         	 		oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
         	 	}
//nbc    else
//nbc     		{
//nbc     			EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+salesOrg+"",""+distChannel+"",""+division+""""));
//nbc      		}
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO_C"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO_C"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         
         if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            {
               oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            }
            
         
         var date = iOrderComp.GetFieldValue ( ""Pricing Date"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", date );
         

         /*
          * Write ""ORDER_PARTNERS"" component  
          */
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         if (payerId == null || payerId == """")
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId );
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId );
         	}
         
         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

		/*
		 * Read and update Credit Card Info
		 *
		 */
		 iCardComp = iOrderComp.GetIntComp (""Payments"");
		 if (iCardComp.NextRecord ())
		 {
		 var ccType = cCardLM.Translate (iCardComp.GetFieldValue (""Payment Type""));
		 var ccNum = iCardComp.GetFieldValue (""Account Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iCardComp);
		 		var cardExpDate = iCardComp.GetFieldValue ( ""Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iCardComp.GetFieldValue (""Expiration Year"" );
		 				var cardExpMonth  = iCardComp.GetFieldValue (""Expiration Month"" );
		 				var cardExpDay;
		 				
		 				var nMonth = ConvertMonth (cardExpMonth);
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	}
		 }
         /*
          * Read ""Order Line Item"" Integration Component
          */
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         oCFDCondValComp = oCFDImportComp.CreateIntComp (""ORDER_CONDITIONS_IN"");
         oCFDCfgValComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_VALUE"", oCFDImportComp);       
         oCFDCfgRefComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_REF"", oCFDImportComp);         
         oCFDCfgInstComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_INST"", oCFDImportComp);
         oCFDScheduleComp = oCFDImportComp.CreateIntComp (""ORDER_SCHEDULES_IN"", oCFDImportComp);                  
         while (iItemComp.NextRecord ())
         {
/*            var posVariable =""00000"";

              Clib.sprintf(posVariable,""%06.6s"",iItemComp.GetFieldValue(""Line Number""));
            var itemNumber = posVariable;
                  
            var parentItemNum =  iItemComp.GetFieldValue (""Parent Order Item Id"");                  
            if((parentItemNum == null) || (parentItemNum ==""""))
            {*/
            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            var itemNumber = iItemComp.GetFieldValue(""Line Number"");
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number""); 
            //oCFDItemComp.SetFieldValue (""HG_LV_ITEM"",     ""000000"");
            oCFDItemComp.SetFieldValue (""PO_ITM_NO"",      itemNumber);
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
           

            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");

		 		oCFDCondValComp.NewRecord();
		 		oCFDCondValComp.SetCopySource (iItemComp);           
           
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            var itemPrice = iItemComp.GetFieldValue ( ""Item Price"" );            
            
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	itemPrice = itemPrice / 10; // to fix SAP multiplication bug
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""PN00"");
            	//oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
                oCFDCondValComp.SetFieldValue (""COND_VALUE"",     itemPrice);
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                
            }
            else
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""PR00"");
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                             	
		 //Fright Value only if Siebel is Pricing Master		

            if ((  siebelPrice != 0) || (  priceList != """" ))
            var siebelFreight = iItemComp.GetFieldValue(""Freight Amount"");
		 if ((siebelFreight != 0) || (siebelFreight != """"))
		 {oCFDCondValComp.NewRecord();
		 oCFDCondValComp.SetCopySource (iItemComp);  
            
            {
             	var siebelFreight = siebelFreight / 10;// to fix SAP multiplication bug
             	oCFDCondValComp.SetFieldValue  (""COND_TYPE"",      ""KF00"");
                oCFDCondValComp.SetFieldValue (""COND_VALUE"",     siebelFreight);
                oCFDCondValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);                                
			}
			}
            oCFDScheduleComp.NewRecord ();
            oCFDScheduleComp.SetCopySource  (iItemComp);
            oCFDScheduleComp.CopyFieldValue (""SCHED_LINE"",     ""Line Number"");
            oCFDScheduleComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);            
            oCFDScheduleComp.CopyFieldValue (""REQ_QTY"",     ""Quantity Requested"");            
            oCFDScheduleComp.CopyFieldValue (""REQ_DATE"",     ""Due Date"");            

/*
            oCFDCfgRefComp.NewRecord ();
            oCFDCfgRefComp.SetCopySource  (iItemComp);
            oCFDCfgRefComp.SetFieldValue (""POSEX"",     itemNumber);
            oCFDCfgRefComp.SetFieldValue (""CONFIG_ID"",     itemNumber);            
            oCFDCfgRefComp.SetFieldValue (""ROOT_ID"",     itemNumber);            


            oCFDCfgInstComp.NewRecord ();
            oCFDCfgInstComp.SetCopySource  (iItemComp);
            oCFDCfgInstComp.SetFieldValue (""INST_ID"",     itemNumber);
            oCFDCfgInstComp.SetFieldValue (""CONFIG_ID"",   itemNumber);            
            oCFDCfgInstComp.SetFieldValue (""OBJ_TYPE"",     ""MARA"");            
            oCFDCfgInstComp.SetFieldValue (""OBJ_KEY"",     ""MATERIAL"");            
            oCFDCfgInstComp.SetFieldValue (""QUANTITY"",     ""1"");            


           
      
                    
          // Read ""Order Line Item Attribute Value"" Integration Component
          
         iAttrComp    = iItemComp.GetIntComp        (""Order Item XA"");

         
         while (iAttrComp.NextRecord ())
         {

            oCFDCfgValComp.NewRecord ();
            oCFDCfgValComp.SetCopySource  (iAttrComp);
            oCFDCfgValComp.CopyFieldValue (""CHARC"",     ""Name"");
            oCFDCfgValComp.CopyFieldValue (""VALUE"",     ""Value"");
            oCFDCfgValComp.CopyFieldValue (""CHARC_TXT"", ""Description"");
            oCFDCfgValComp.SetFieldValue (""INST_ID"", itemNumber);
            oCFDCfgValComp.SetFieldValue (""CONFIG_ID"", itemNumber);
		}
		
}  // end if condition for Parent item num  
*/   
         } //order items read
      }
      
   }
}
function CreateOrder ()
{ // referenced by script QuoteToOrderSubmit
	var OrgBusObject = TheApplication().GetBusObject(""Order Entry"");
	var SABusComp = OrgBusObject.GetBusComp(""Order Entry - Orders"");
	var orderType= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE"", ""Sales Order"");
    var orderCode= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE_CODE"", ""Sales"");
	
	SABusComp.NewRecord(0);
	SABusComp.SetFieldValue			(""Active"",				""Y"");
    SABusComp.SetFieldValue 		(""Order Type"",   		orderType);	
	SABusComp.SetFieldValue 		(""Order Type Code"",   	orderCode);	
	// SABusComp.SetFieldValue			(""Price List Id"",		priceList);
	SABusComp.WriteRecord();
	return SABusComp.GetFieldValue	(""Id"");
	
}
function CreateSAP47Order_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Create SAP 47 Order
   /* Input Objects' Integration Components
    *   BAPI Export (SAP 47 Order - Create SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 47 Order)
    *     Order (oOrder)
    *     
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;   	// BAPI Order instance
   var iExportComp; 	// BAPI Export Parameters
   var iReturnComp; 	// BAPI Return component
   var iItemComp;	   	// BAPI Line Items
   var iIItemComp;	   	// BAPI Inpout Line Items ( ""ORDER_ITEMS_IN"") To fetch Pricing Master Info
   var iSchedItemComp; 	// BAPI Schedule Line Items

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oRFCOrderComp;  // Create Output for RFC_* Table
   var oItemComp;      // Order Line Item
   var oRFCItemComp;   // Output Line Item for RFC_* Table to store pricing info
   var oSchedItemComp  // Schedule Line Item

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj(""SAP 47 Order - Create SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 47 Order"");

   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iOrderObj.GetPrimaryIntComp (""Export Parameters"");
      if (iExportComp.NextRecord ())
      {
      
         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iExportComp);
         
         
		 
		 oOrderComp.SetFieldValue 		(""As Of Date"", 		Timestamp());
		 oOrderComp.SetFieldValue 		(""EAI Sync Date"", 		Timestamp());

         oOrderComp.CopyFieldValue 		(""Integration Id"",  ""SALESDOCUMENT"");
         
         iReturnComp = iExportComp.GetIntComp   (""RETURN"");
         while (iReturnComp.NextRecord ())
         {
            var errorType = iReturnComp.GetFieldValue (""TYPE"");
            if (errorType == ""E"")
            {
            	oOrderComp.SetCopySource  (iReturnComp);
            	oOrderComp.CopyFieldValue (""Back Office Error Text"", ""MESSAGE"");
            	break;
            }
          }         
      }
   }
}
function CreateSAP47Order_SiebelToBAPI (inputMsg, outputMsg)
{ // referenced by workflow Order - Create SAP 47 Order
   /* Uses same map as CreateFromData() */
   Create77SAP47Order_SiebelToBAPI (inputMsg, outputMsg,
                                        ""SAP 47 Order"",
                                        ""SAP 47 Order - Create SAP Order (BAPI Input)"");
}
function CreateSAP47Order_SiebelToBAPICOMMIT (inputMsg, outputMsg)
{  // referenced by workflow Order - Create SAP 47 Order
	/*
	 * Set up EAI Output Message Objects
	 */
	 var oCommitObj;	// BAPI instance
	 var oCommitComp;	// BAPI Component
	 
	oCommitObj	= outputMsg.CreateIntObj (""Account - Commit SAP 47 Transaction (BAPI Input)"");
    oCommitObj.NewInstance();
    oCommitComp = oCommitObj.CreatePrimaryIntComp (""Import Parameters"");
    oCommitComp.NewRecord ();
   
}
function GetDaysInAMonth(nMonth, nYear)
{ // general utility function

	// Jan, Mar, May, Jul, Aug, Oct, Dec have 31 days each
	// Apr, Jun, Sept, Nov have 30 days each
	// Feb, for now, has 28 days.
	var daysInMonth = new Array(31,28,31,30,31,30,31,31,30,31,30,31);
	var nCurrentDays;


	// Only February can be either 28 or 29, depending on whether the year is a leap year
	if (nMonth == 2)
	{
		// If the year is divisible by 4, it is a leap year
		if (nYear%4 == 0)
		{
			// If the year is a century, then it should be divisible by 400 to be a leap year.
			if (nYear%100 == 0)
			{
				// If it is a century and divisible by 400, it is a leap year.
				if (nYear%400 == 0) { nCurrentDays = 29;}

				// If it is a century and NOT divisible by 400 (e.g. 1900), it is NOT a leap year.
				else	{ nCurrentDays = 28;}
			}
		
			// If it is not a century and divisible by 4, it is a leap year.
			else { nCurrentDays = 29;}
		}

		// If a year is NOT divisible by 4, it is not a leap year
		else { nCurrentDays = 28; }
	}


	// If the month is NOT Feb, calculating days in a month is straight-forward.
	// eScript array index starts with 0, not 1.
	else
	{ nCurrentDays = daysInMonth[nMonth - 1]; }

	return nCurrentDays;

}
function GetOrderId (orderId)
{ // Called from script OrderStatus
	var OrdBusObject = TheApplication().GetBusObject(""Order Entry"");
	var OrdBusComp = OrdBusObject.GetBusComp(""Order Entry - Orders"");
	
	OrdBusComp.ClearToQuery();
	OrdBusComp.SetViewMode (AllView); // 12-8NF9TR
	OrdBusComp.SetSearchSpec(""Integration Id"", orderId);
	OrdBusComp.ActivateField(""Id"");
	OrdBusComp.ExecuteQuery();
	
	if(OrdBusComp.FirstRecord())
	{
	   return OrdBusComp.GetFieldValue(""Id"");
	}
      	else
           return null;
	
}
function GetSAP47GetDetailedList_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Get Detailed List SAP 47 Order
   /*
    * Input Objects' Integration Components
    *   BAPI Export (SAP 47 Order - Get Detailed List (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *           Order Item Delivery Item (deliv)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 47 Order)
    *     Order (oOrder)
    *       Get Status Output
    *       Get Status Header
    *         Get Status Item
    *           Get Status Item Delivery Item
    *       Order Line Item
    *         Order Line Item Action
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGSOrderObj;        // BAPI Order instance
   var iGSExportComp;      // BAPI Export Parameters
   var iGSHeaderComp;      // BAPI Order Headers for Document Numbers ***
   var iGSItemComp;        // BAPI Order Item Data for Document Numbers ***
   var iGSCondComp; 	   // BAPI Condition Records
   var iGSScheduleComp;    // BAPI Order Schedule Lines for Document Numbers ***
   var iGSHeaderStatusComp;// BAPI Header Status for Document Numbers ***
   var iGSItemStatusComp;  // BAPI item Status for Document Numbers ***
   var iGSDocFlowComp;     // BAPI Document Flows for Document Numbers ***
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;        // Siebel Orderinstance
   var oOrderComp;       // Order
   var oItemComp;        // Order Line Item
   var oScheduleComp;    // Order Line Item Action
   var oDelivComp;       // Order Line Item Action
   var oDocFlowComp;     // Order XA
      

   /*
    * Find and create top-level integration object
    */
   iGSOrderObj = inputMsg.GetIntObj(""SAP 47 Order - Get Detailed List (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 47 Order"");

   /*
    * Read int object instances from EAI message
    */

   while (iGSOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oOrderObj.NewInstance ();
      
      /*
       * Create ""Order"" component
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      /*
       * Read ""Export Parameters"" component
       */
      iGSExportComp = iGSOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
   
      if (iGSExportComp.NextRecord())
      {
         /*
          * Read ""Order Header"" component
          */
         iGSHeaderComp = iGSExportComp.GetIntComp (""ORDER_HEADERS_OUT"");
         
         if (iGSHeaderComp.NextRecord ())
         {
            /*
             * Update ""Order"" component
             */
            oOrderComp.SetCopySource  (iGSHeaderComp);
            
            // EAI Lookup code ""SAP Currency""
            var currencyCode = currencyLM.Translate (iGSHeaderComp.GetFieldValue (""CURRENCY""));
   
            if (currencyCode != null && currencyCode != """")
              {     
                 oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
              }     
            oOrderComp.CopyFieldValue (""Requested Ship Date"",     ""REQ_DATE_H"");
            oOrderComp.CopyFieldValue (""Integration Id"",          ""DOC_NUMBER"");
            oOrderComp.CopyFieldValue (""Account Order Number"",    ""PURCH_NO"");
            
            // Delivery Block
            var sapDelBlock = iGSHeaderComp.GetFieldValue ( ""DLV_BLOCK"" );
		    var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
		    oOrderComp.SetFieldValue (""Delivery Block"",          delBlock);
		    
		    // Billing Block
		    //var sapBillBlock = iGSHeaderComp.GetFieldValue ( ""BILL_BLOCK"" );
		    //var billBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
		    //oOrderComp.SetFieldValue (""Billing Block"",          billBlock);
		    
		    var salesdoc =  iGSHeaderComp.GetFieldValue (""DOC_NUMBER"");
                    
        
         iGSHeaderStatusComp = iGSExportComp.GetIntComp (""ORDER_STATUSHEADERS_OUT"");
         
         if (iGSHeaderStatusComp.NextRecord ())
         {
           
           	 oOrderComp.SetCopySource  (iGSHeaderStatusComp);
   	      // Overall processing status of document
			 var sapOStatus = iGSHeaderStatusComp.GetFieldValue ( ""PRC_STAT_H"" );
        	 if ( sapOStatus == ""C"" )
           		{
           			oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Closed""));
           		}
            		else if ( sapOStatus == ""B"" )
           		{
              		oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Partially Shipped""));	
           		}
            	  		else 
           			{
           	   			oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Open""));             	 
            		} 
                     
         // Delivery status
			 var sapDStatus = iGSHeaderStatusComp.GetFieldValue ( ""DELIV_STAT"" );
        	 if ( sapDStatus == ""C"" )
        		{
       	    		oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Closed""));
           		}
            		else if ( sapDStatus == ""B"" )
           		{
              		oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Partially Shipped""));	
           		}
              			else 
           			{
           	   			oOrderComp.SetFieldValue ( ""Delivery Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_DELIVERY_STATUS"", ""Open""));             	 
            		}               	                    
            
         } 
                           	                    
	      /*
           * Item
           */
          
          iGSItemComp = iGSExportComp.GetIntComp (""ORDER_ITEMS_OUT"");

          
          oItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
                      
          while (iGSItemComp.NextRecord ())
           	 {
         	     //var parItemnum = iGSItemComp.GetFieldValue (""HG_LV_ITEM"");
         	     //if (parItemnum == ""000000"" || parItemnum == """") // remove this if clause in case you want to get Child Component of Configurable Materials
				//{               
               
            	 var itemMaterial = iGSItemComp.GetFieldValue (""MATERIAL"");
               
              	 oItemComp.NewRecord ();
               	 oItemComp.SetCopySource (iGSItemComp);
               	 var itemnum  = iGSItemComp.GetFieldValue (""ITM_NUMBER"");
            	 var qtyReq   = iGSItemComp.GetFieldValue (""REQ_QTY"");
             	 var itemReqDate 	   = iGSItemComp.GetFieldValue (""REQ_DATE"");
            	 oItemComp.CopyFieldValue (""Product Integration Id"", ""MATERIAL"");
               	 oItemComp.CopyFieldValue (""Line Number"",            ""ITM_NUMBER"");
               	 oItemComp.CopyFieldValue (""Description"",            ""SHORT_TEXT"");
               	 var itemUOM = iGSItemComp.GetFieldValue (""SALES_UNIT"");
		       	 oItemComp.CopyFieldValue (""Product Unit of Measure"",""SALES_UNIT"");
                 oItemComp.SetFieldValue (""Quantity Requested"", qtyReq);
				 oItemComp.CopyFieldValue (""Quantity Shipped"",  ""REF_QTY"");
                 oItemComp.SetFieldValue (""Due Date"", itemReqDate);
				 oItemComp.CopyFieldValue (""NRC CxTotal"", ""NET_VALUE""); // nbc 7.8.2 
              
            	 var condFlag = false;
		         iGSCondComp = iGSExportComp.GetIntComp (""ORDER_CONDITIONS_OUT"");	                 
                 while (iGSCondComp.NextRecord ())
                 {
                  oItemComp.SetCopySource (iGSCondComp);
                 	if ((iGSCondComp.GetFieldValue (""ITM_NUMBER"") == itemnum)) 
                  		{
                 			if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""PN00""))
                 			 {	var netPrice = 0;
                 				var netValue = 0;
                 				if (itemUOM == (iGSCondComp.GetFieldValue (""COND_D_UNT"")))
                					{oItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 	oItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
									oItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); // nbc 7.8.2 SAP 4x Net Price
                 					}
                 			  	else
              						{netValue = (iGSCondComp.GetFieldValue (""CONDVALUE""));
                 					 	if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 	 	 		 oItemComp.SetFieldValue  (""Unit Price"",   netPrice);
               	 			 	 			 oItemComp.SetFieldValue  (""Adjusted List Price"",   netPrice);
										     oItemComp.SetFieldValue  (""Net Price"",   netPrice); //nbc 7.8.2 SAP 4x Net Price
               	 			 	 			}
               	 			 	 	}
               	 			 	condFlag = true;
               	 	     	}
               	 		
               	   			if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""PR00"") && (condFlag == false))
	               				{	
                 					var netPrice= 0;
                 					var netValue = 0;
                 					if (itemUOM == (iGSCondComp.GetFieldValue (""COND_D_UNT"")))
                 			    		{oItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 		oItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
										oItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); //nbc 7.8.2 SAP 4x Net Price										
                 						}
                 					else
                 						{ netValue = (iGSCondComp.GetFieldValue (""CONDVALUE""));
                 			 	  		if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 		  		oItemComp.SetFieldValue  (""Unit Price"",  netPrice);
               	 			 	      		oItemComp.SetFieldValue  (""Adjusted List Price"",  netPrice); 
											oItemComp.SetFieldValue  (""Net Price"",  netPrice); //nbc 7.8.2 SAP 4x Net Price
               	 			 	      		}
               	 			 	 		}
               	 		 		}
               	 		
               	 	if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""KF00""))
                 		{
                 		 oItemComp.CopyFieldValue  (""Freight Amount"",   ""CONDVALUE"");
               	 		}
               	 			
               	 	if ((iGSCondComp.GetFieldValue (""COND_TYPE"") == ""UTXJ""))
                 		{
                 		 oItemComp.CopyFieldValue  (""Tax Amount"",   ""CONDVALUE"");
               	 		}
               	 	} // end if ((iGSCondComp.GetFieldValue (""ITM_NUMBER"") == itemnum)) 
               	 } // end while (iGSCondComp.NextRecord ())
		 
                 iGSItemStatusComp = iGSExportComp.GetIntComp (""ORDER_STATUSITEMS_OUT"");
                 while (iGSItemStatusComp.NextRecord ())
           	     {
           	       oItemComp.SetCopySource  (iGSItemStatusComp);
           	        var iStatusItemNum = iGSItemStatusComp.GetFieldValue (""ITM_NUMBER"");
           	        if (iStatusItemNum == itemnum)
           	        {
           	          var sapStatus = iGSItemStatusComp.GetFieldValue ( ""DLV_STAT_I"" );
		 	          var itemStatus= TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_ITEM_DELIV_STATUS"", sapStatus);
                      oItemComp.SetFieldValue (""Delivery Status"",        itemStatus);
                    }
                  }

          // Item Schedule

		         iGSScheduleComp = iGSExportComp.GetIntComp (""ORDER_SCHEDULES_OUT"");
		         oScheduleComp   = oItemComp.CreateIntComp (""Order Entry - Line Item Actions"");
                 while (iGSScheduleComp.NextRecord ())
           	      { 
           	       var itemnum2  = iGSScheduleComp.GetFieldValue (""ITM_NUMBER"");
                   var schednum = iGSScheduleComp.GetFieldValue (""SCHED_LINE"");
                   var intId;
                   if (itemnum2 == itemnum)
                   {
           
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSScheduleComp);
                
                    intId = inputId + ""-"" + itemnum2 + ""-"" + schednum;
                    oScheduleComp.SetFieldValue (""Line Item Action Number"",     intId);
                    oScheduleComp.SetFieldValue (""Integration Id"",     intId);
                    oScheduleComp.CopyFieldValue (""Actual Start Date"",           ""GI_DATE"");
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",               ""CONFIR_QTY"");
                    var reqDate = iGSScheduleComp.GetFieldValue ( ""REQ_DATE"");
                    oScheduleComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                
                   } 
           	     }
           	   

          	/*	
             * Item Document Flow
			 */
			 
		 		 iGSDocFlowComp = iGSExportComp.GetIntComp (""ORDER_FLOWS_OUT"");
                   var prevDoc = null;
                   var prevItem = null;

				while (iGSDocFlowComp.NextRecord ())
           	      { 
           	       var itemnum3 = null; 
				   var docCat = iGSDocFlowComp.GetFieldValue (""DOCCATEGOR"");          	      
         	       var ordernum2  = iGSDocFlowComp.GetFieldValue (""PRECSDDOC"");
                   var subqDoc  = iGSDocFlowComp.GetFieldValue (""SUBSSDDOC"");
                   var subqItem = iGSDocFlowComp.GetFieldValue (""SUBSITDOC"");
         	       
           	       itemnum3   = iGSDocFlowComp.GetFieldValue (""PREDITDOC"");
                   if ((itemnum3 == itemnum) && (docCat == ""J""))
 					{
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSDocFlowComp);
                    var itemActionNum = subqDoc + ""-"" + subqItem ;
                    oScheduleComp.SetFieldValue  (""Line Item Action Number"",  itemActionNum);
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",       ""REF_QTY"");
                    oScheduleComp.CopyFieldValue (""Planned Start Date"",       ""CREAT_DATE"");
                    oScheduleComp.SetFieldValue  (""Integration Id"",  itemActionNum);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Delivery"");
                
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                    prevDoc = subqDoc;
                    prevItem = subqItem;
                    }
                    
                    
                    else if ((docCat == ""R"") && (prevDoc == ordernum2) && (prevItem == itemnum3))
                    {
                    oScheduleComp.NewRecord ();
                    oScheduleComp.SetCopySource  (iGSDocFlowComp);
                    var itemActionNum1 = subqDoc + ""-"" + subqItem ;
                    oScheduleComp.SetFieldValue  (""Line Item Action Number"",  itemActionNum1);
                    oScheduleComp.CopyFieldValue (""Confirmed Qty"",       ""REF_QTY"");
                    oScheduleComp.CopyFieldValue (""Planned Start Date"",       ""CREAT_DATE"");
                    oScheduleComp.SetFieldValue  (""Integration Id"",  itemActionNum1);
                    var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Ship"");
                
                    oScheduleComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                    prevDoc = subqDoc;
                    prevItem = subqItem;
					}
                    
                  }

	        }
	      //} // endif for (parItemnum == ""000000"") 
		}
 	 }
                
   }
}
function GetSAP47GetDetailedList_SiebelToBAPI (inputMsg, outputMsg)
{  // referenced by workflow Order - Get Detailed List SAP 47 Order
   /* Input Objects' Integration Components
    *   Order Object (SAP 47 Order)
    *     Order
    *
    * Output Object's Integration Components:
    *   BAPI Import (SAP 47 Order - Get Detailed List (BAPI Input))
    *     Import Parameters
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;    // Siebel Order instance
   var iOrderComp;   // Order

   /*
    * Set up EAI Output Message objects
    */
   var oGSObj;           // BAPI instance
   var oGSImportComp;    // Import Parameters
   var oGSSalesDocComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (""SAP 47 Order"");
   oGSObj    = outputMsg.CreateIntObj (""SAP 47 Order - Get Detailed List (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Get Status"" object
       */
      oGSObj.NewInstance ();

      /*
       * Read ""Order"" component
       iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");

       */
      iOrderComp      = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oGSImportComp   = oGSObj.CreatePrimaryIntComp (""Import Parameters"");

      
      if (iOrderComp.NextRecord ())
      {

          
         oGSImportComp.NewRecord ();
         oGSImportComp.SetCopySource  (iOrderComp);
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-ADDRESS"",   ""X""); 
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-BILLPLAN"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-BUSINESS"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CONFIGURE"", ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CONTRACT"",  ""X""); 
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-CREDCARD"",  ""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-FLOW"",      ""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-HEADER"",    ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-INCOMP_LOG"",""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-ITEM"",      ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-PARTNER"",   ""X""); 
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDCOND"",    ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDCOND_ADD"",""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-SDSCHEDULE"",""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-STATUS_H"",  ""X"");
         oGSImportComp.SetFieldValue (""I_BAPI_VIEW-STATUS_I"",  ""X"");
      // oGSImportComp.SetFieldValue (""I_BAPI_VIEW-TEXT"",      ""X""); 
         oGSImportComp.SetFieldValue (""I_MEMORY_READ"",         ""A"");
         oGSSalesDocComp = oGSImportComp.CreateIntComp (""SALES_DOCUMENTS"");         
         oGSSalesDocComp.NewRecord ();
         oGSSalesDocComp.SetCopySource  (iOrderComp);
         oGSSalesDocComp.CopyFieldValue (""VBELN"", ""Integration Id"");
      
      }

   }   
}
function LocalizeMessage(Message)
{ // general utility function
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function OrderStatus (inputMsg,outputMsg )
{ // referenced from workflow Order - Change SAP 47 Order Status
	// var theApp = TheApplication();
	
   /* Input Objects' Integration Components
	*   Order IDOC (SAP 47 Order Status (IDOC 4x))
	*
	*/

   
   /*
	* Set up EAI Input Message objects
	*/
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iORDERComp; // IDOC Order Header
	
   /*
    * Set up EAI Output Message objects (Dummy)
    */
   var oOrderObj;      // Order object instance
   var oOrderComp;     // Order (header)
   var oOrderItemComp; // Order Item (item)
	
   /*
	* Find and create top-level integration object
	*/
	iIDOCObj    = inputMsg.GetIntObj (""SAP 47 Order Status (IDOC 4x)"");
	oOrderObj = outputMsg.CreateIntObj (""SAP 47 Order"");
	
   /*
	* Read int object instances from EAI message
	*/
	while (iIDOCObj.NextInstance ())
	{
	   
       /*
		* Read virtual root component that IDOC RFC Adapter populates
		*/
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		oOrderObj.NewInstance ();
		oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
		iIDOCComp.NextRecord ();

	   /*
		* Read ""ORDER"" component
		*/
        iORDERComp = iIDOCComp.GetIntComp (""E2EDK01005"");
		if (iORDERComp.NextRecord ())
		    {
			   
			    var orderNo = iORDERComp.GetFieldValue ( ""BELNR"" );
			    var orderId;
				
				orderId = GetOrderId(orderNo);
				
				outputMsg.SetArgument (""Object Id"", orderId);
                
				var wfManager = TheApplication().GetService(""EAI Business Integration Manager (Server Request)"");
    
    			var input = TheApplication().NewPropertySet();
		    	var output = TheApplication().NewPropertySet();
		    	input.SetProperty(""ProcessName"", ""Order - Get Detailed List SAP 47 Order"");
    			input.SetProperty(""RowId"", orderId);
    			wfManager.InvokeMethod(""RunProcess"", input, output);
    			// TheApplication().MsgBox(""Get Status WF Invoked Sucessfully"");
    		}	
	

	}

}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   return EAIExecuteMap (MethodName, Inputs, Outputs);
}
"
function Simulate77SAP47Order_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{ // referenced by script SimulateSAP47Order_SiebelToBAPI
   /*
    * Input Objects' Integration Components
    *   Order Object (SAP 47 Order)
    *     Order Entry - Orders (order header)
    *       Order Entry - Line Items (item)
    *        Order Item XA (attributes)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 47 Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *      ORDER_HEADER_IN
    *       ORDER_PARTNERS
    *       ORDER_CCARD
    *       ORDER_ITEMS_IN
    *		ORDER_CFGS_INST
    *		ORDER_CFGS_REF
    *		ORDER_CFGS_VALUE
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     	""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",      		""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   	""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",		""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",	""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", 	""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iCardComp; // Payments
   var iItemComp;  // Order Line Item
   var iAttrComp;  // Item Attribute Component

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDSchedComp;		// For EPrice CR 
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component
   var oCFDCfgInstComp;
   var oCFDCfgValComp;
   var oCFDCfgRefComp;


   /*
    * Find and create top-level integration object
    */
   iOrderObj    = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
              var IntId = iOrderComp.GetFieldValue (""Integration Id"");
              EAIRaiseError(LocalizeMessage(""ERR_MSG_ORDER_ALREADY_SUBMITTED,""+IntId+""""));

         }
        
         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         /*
         	*CR # 12-79SPMF to add validation for Sales Area in SAP
         */
         var salesOrg  = iOrderComp.GetFieldValue (""SAP Sales Organization (MO)"");
         var distChannel  = iOrderComp.GetFieldValue (""SAP Distribution Channel (MO)"");
         var division  = iOrderComp.GetFieldValue (""SAP Division (MO)"");
         if ((salesOrg != """") && (distChannel != """") && (division != """") )
			{
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
				oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
			}
		else
			{
         		EAIRaiseError(LocalizeMessage(""ERR_MSG_SALES_AREA_NOT_FOUND,""+salesOrg+"",""+distChannel+"",""+division+""""));
         	}
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         
         if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            {
               oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            }
            
         
         var date = iOrderComp.GetFieldValue ( ""Pricing Date"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", date );
         

         /*
          * Write ""ORDER_PARTNERS"" component  
          */
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         if (payerId == null || payerId == """")
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId );
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId );
         	}
         
         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

		/*
		 * Read and update Credit Card Info
		 *
		 */
		 iCardComp = iOrderComp.GetIntComp (""Payments"");
      if (iCardComp.NextRecord ())
      {
		 var ccType = cCardLM.Translate (iCardComp.GetFieldValue (""Payment Type""));
		 var ccNum = iCardComp.GetFieldValue ( ""Account Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iCardComp);
		 		var cardExpDate = iCardComp.GetFieldValue ( ""Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iCardComp.GetFieldValue (""Expiration Year"" );
		 				var cardExpMonth  = iCardComp.GetFieldValue (""Expiration Month"" );
		 				var cardExpDay;
		 				
		 				var nMonth = ConvertMonth (cardExpMonth);
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	}
	   }
         /*
          * Read ""Order Line Item"" Integration Component
          */
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         //oCFDCondValComp = oCFDImportComp.CreateIntComp (""ORDER_CONDITIONS_IN"");
         oCFDCfgValComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_VALUE"", oCFDImportComp);       
         oCFDCfgRefComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_REF"", oCFDImportComp);         
         oCFDCfgInstComp = oCFDImportComp.CreateIntComp (""ORDER_CFGS_INST"", oCFDImportComp);
         // For EPrice CR
         oCFDSchedComp = oCFDImportComp.CreateIntComp (""ORDER_SCHEDULE_IN"", oCFDImportComp);                  
         while (iItemComp.NextRecord ())
         {
            var itemNum =  iItemComp.GetFieldValue (""Line Number"");
/*           var Posex_Hilfsvariable =""00000"";

            Clib.sprintf(Posex_Hilfsvariable,""%06.6s"",iItemComp.GetFieldValue(""Line Number""));
            var itemNumber = Posex_Hilfsvariable;
                  
            var parentItemNum =  iItemComp.GetFieldValue (""Parent Order Item Id"");                  
            if((parentItemNum == null) || (parentItemNum ==""""))
            {*/
            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            var itemNumber = iItemComp.GetFieldValue(""Line Number"");
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number"");
            //oCFDItemComp.SetFieldValue (""HG_LV_ITEM"",     ""000000"");
            oCFDItemComp.CopyFieldValue (""PO_ITM_NO"",      ""Line Number"");
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
              var plant = iItemComp.GetFieldValue (""Source Inventory Location"");
              //if (plant == """")
              //{EAIRaiseError(""Please Specify Plant in Item # "" + itemNumber);}
            
            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");
            /* For EPrice CR
            oCFDItemComp.CopyFieldValue (""REQ_DATE"",       ""Due Date"");
            oCFDItemComp.SetFieldValue  (""DATE_TYPE"",      ""1"");
            oCFDItemComp.CopyFieldValue (""REQ_QTY"",        ""Quantity Requested"");*/
	            
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PN00"");
            	oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
			    oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     ""Item Price"");
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            	
             	oCFDItemComp.SetFieldValue  (""CD_TYPE3"",      ""KF00"");
                oCFDItemComp.CopyFieldValue (""CD_VALUE3"",     ""Freight Amount"");
  


            }
            else
            {
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PR00"");
            }
            
            //For EPrice CR
            oCFDSchedComp.NewRecord ();
            oCFDSchedComp.SetCopySource  (iItemComp);
            oCFDSchedComp.SetFieldValue (""DATE_TYPE"",     ""1"");
            oCFDSchedComp.CopyFieldValue (""REQ_DATE"",     ""Due Date"");
            oCFDSchedComp.CopyFieldValue (""REQ_QTY"",      ""Quantity Requested"");
            oCFDSchedComp.CopyFieldValue (""ITM_NUMBER"",      ""Line Number"");
            oCFDSchedComp.CopyFieldValue (""SCHED_LINE"",      ""0001"");
                   
            
                // oCFDItemValComp.SetFieldValue (""ITM_NUMBER"",     itemNumber);  
                                           	
//}  // end if condition for Parent item num

/*
            oCFDCfgRefComp.NewRecord ();
            oCFDCfgRefComp.SetCopySource  (iItemComp);
            oCFDCfgRefComp.SetFieldValue (""POSEX"",     itemNumber);
            oCFDCfgRefComp.SetFieldValue (""CONFIG_ID"",     itemNumber);            
            oCFDCfgRefComp.SetFieldValue (""ROOT_ID"",     itemNumber);            


            oCFDCfgInstComp.NewRecord ();
            oCFDCfgInstComp.SetCopySource  (iItemComp);
            oCFDCfgInstComp.SetFieldValue (""INST_ID"",     itemNumber);
            oCFDCfgInstComp.SetFieldValue (""CONFIG_ID"",   itemNumber);            
            oCFDCfgInstComp.SetFieldValue (""OBJ_TYPE"",     ""MARA"");            
            oCFDCfgInstComp.SetFieldValue (""OBJ_KEY"",     ""MATERIAL"");            
            oCFDCfgInstComp.SetFieldValue (""QUANTITY"",     ""1"");            

*/
           
      
                    /*
          * Read ""Order Line Item Attribute Value"" Integration Component
          */
/*         iAttrComp    = iItemComp.GetIntComp        (""Order Item XA"");

         
         while (iAttrComp.NextRecord ())
         {

            oCFDCfgValComp.NewRecord ();
            oCFDCfgValComp.SetCopySource  (iAttrComp);
            oCFDCfgValComp.CopyFieldValue (""CHARC"",     ""Name"");
            oCFDCfgValComp.CopyFieldValue (""VALUE"",     ""Value"");
            oCFDCfgValComp.CopyFieldValue (""CHARC_TXT"", ""Description"");
            oCFDCfgValComp.SetFieldValue (""INST_ID"", itemNumber);
            oCFDCfgValComp.SetFieldValue (""CONFIG_ID"", itemNumber);
		}
  */   
         } //order items read
      }
      
   }
}
function SimulateSAP47Order_BAPIToSiebel (inputMsg, outputMsg)
{  // referenced by workflow Order - Simulate SAP 47 Order
   /* Input Objects' Integration Components
    *   BAPI Export (SAP 47 Order - Simulate SAP Order (BAPI Output))
    *     Export Parameters (output)
    * Output Object's Integration Components:
    *   Order Object (SAP 47 Order)
    * Set up EAI Lookup objects
    */
   var currencyLM 	 = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");
   var ccStatusLM	 = new CSSEAIValueMap (""SAP Credit Card Approval Code"", ""Siebel Inbound"");
   var cCardLM	 	 = new CSSEAIValueMap (""SAP Credit Card Type"", ""Siebel Inbound"");

   // * Set up EAI Input Message objects
   var iSimOrderObj;   // BAPI Order instance
   var iSimExportComp; // BAPI Export Parameters
   var iSimItemComp;   // BAPI Order Items
   var iSimIItemComp;  // BAPI Order Input Item Comp to retieve value for Fix Pricing flag
   var iSchedItemComp; // BAPI Schedule Line Items
   var iCondComp;	   //For EPrice CR
   var iSimCCardComp;  // BAPI Credit Card Export Comp

   var inputId = inputMsg.GetArgument (""Siebel Order Id"");
   //* Set up EAI Output Message objects
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oCardComp;	   // Order Card Payment Comp
   var oOutputComp; // Simulate Output RFC_*
   var oItemComp;   // Simulate Item Output RFC_*
   var oSimItemComp;   // Simulate Item
   // var oItemComp;      // Item
   var oSchedItemComp; // Schedule Line Item

   //* Find and create top-level integration object
   iSimOrderObj = inputMsg.GetIntObj (""SAP 47 Order - Simulate SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 47 Order"");

    //* Read int object instances from EAI message
   while (iSimOrderObj.NextInstance ())
   {
      oOrderObj.NewInstance ();
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      oOrderComp.SetFieldValue (""Id"", inputId);
      iSimExportComp = iSimOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      if (iSimExportComp.NextRecord ())
      {
         oOrderComp.SetCopySource  (iSimExportComp);
         oOrderComp.SetFieldValue(""As Of Date"", Timestamp());
         var sapDelBlock = iSimExportComp.GetFieldValue ( ""SHIP_TO_PARTY-DLV_BLOCK"" );
		 var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
         oOrderComp.SetFieldValue (""Delivery Block"",     delBlock);
         var sapBillBlock = iSimExportComp.GetFieldValue ( ""BILLING_PARTY-BILL_BLOCK"" );
		 var billBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
         oOrderComp.SetFieldValue (""Billing Block"",     billBlock);
         var errorMessage = iSimExportComp.GetFieldValue ( ""RETURN-MESSAGE"");
         if (errorMessage == null)
         oOrderComp.SetFieldValue (""Back Office Error Text"", "" "");
         else
         oOrderComp.CopyFieldValue (""Back Office Error Text"",     ""RETURN-MESSAGE"");

         var returnCode = iSimExportComp.GetFieldValue (""RETURN-CODE"");
         
         if ( (returnCode == ""V1154"") || (returnCode == ""V1038"") )
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""N"");
            }
         else
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""Y"");
            }

          //* Read ""ORDER_CCARD_EX"" component
		  iSimCCardComp = iSimExportComp.GetIntComp (""ORDER_CCARD_EX"");
		  oCardComp = oOrderComp.CreateIntComp (""Payments"", false);
          var cardStatus;
          var cardLineNo = 0;
          while (iSimCCardComp.NextRecord())
          {
         	 cardStatus = iSimCCardComp.GetFieldValue ( ""CC_STAT_EX"");
         	 if ( cardStatus != null && cardStatus != """" )
         	 {
         	 oCardComp.NewRecord ();
             oCardComp.SetCopySource  (iSimCCardComp);
         	 
         	 	cardLineNo++;
         		var cardIntId = inputId + ""-"" + cardLineNo; 
         		oCardComp.SetFieldValue ( ""Integration Id"", cardIntId);
         	 	oOrderComp.SetCopySource (iSimCCardComp);
         	 	oCardComp.CopyFieldValue (""Account Number"", ""CC_NUMBER"");
         		oCardComp.CopyFieldValue (""Card Holder"", ""CC_NAME"");
         	 	oCardComp.CopyFieldValue (""Authorization Date"", ""AUTH_DATE"");
           	 	oCardComp.CopyFieldValue (""Authorization Code"", ""CC_AUTTH_NO"");
           	 	// oCardComp.CopyFieldValue (""Credit Card Approval Code"", ""AUTH_REFNO"");
           	 	//oCardComp.CopyFieldValue (""Transaction Amount"", ""CC_RE_AMOUNT"");
          	 	oCardComp.CopyFieldValue (""Transaction Amount"", ""AUTHAMOUNT"");
           	 	var ccStat = iSimCCardComp.GetFieldValue ( ""CC_STAT_EX"");
           	 	var ccReact = iSimCCardComp.GetFieldValue ( ""CC_REACT"");
           	 	
           	 	if (ccStat == ""C"")
           	 		{ if (ccReact == ""A"")
           	 			{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""Authorized"") );}
           	 		  else
           	 		  	{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""Declined"") );}
           	 		 }
           	 	else
           	 		{ oCardComp.SetFieldValue (""Payment Status"", TheApplication().InvokeMethod (""LookupValue"", ""FUNDRQ_STATUS"", ""AVS Failed"") );}
   				oCardComp.CopyFieldValue (""Expiration Date"", ""CC_VALID_T"" );
				oCardComp.CopyFieldValue (""Transaction Message"", ""CC_REACT_T"" );
				var expDate = iSimCCardComp.GetFieldValue (""CC_VALID_T"");
         		var expMonth = expDate.substring(0,2);
         		if (expMonth < 10)
         			{expMonth = expDate.substring(1,2);}
         		var expYear = expDate.substring(6,10);
         		oCardComp.SetFieldValue (""Expiration Month"", expMonth );
				oCardComp.SetFieldValue (""Expiration Year"", expYear );
				var paymentMethod = TheApplication().InvokeMethod (""LookupValue"", ""PAYMENT_METHOD_CODE"", ""Credit Card"");
                oCardComp.SetFieldValue  (""Payment Method"",   paymentMethod);
				var cardType = cCardLM.Translate (iSimCCardComp.GetFieldValue (""CC_TYPE""));
           	 	var LDCardType = TheApplication().InvokeMethod (""LookupValue"", ""PAYMENT_TYPE_CODE"", cardType);
           	 	oCardComp.SetFieldValue	 (""Payment Type"", LDCardType);
         	 }
          }

          //* Read ""ORDERS_ITEMS_OUT"" component
         iSimItemComp = iSimExportComp.GetIntComp (""ORDER_ITEMS_OUT"");
         iSimIItemComp = iSimExportComp.GetIntComp ( ""ORDER_ITEMS_IN"");
         oSimItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
         while (iSimItemComp.NextRecord ())
         {
            var parItemnum = iSimItemComp.GetFieldValue ( ""HG_LV_ITEM"" );
            if (parItemnum == null || parItemnum == ""000000"" || parItemnum == """") // please comment this if statement if you want to support child componenets of Config Product
            {
            oSimItemComp.NewRecord ();
            oSimItemComp.SetCopySource  (iSimItemComp);
            iSimIItemComp.NextRecord ();
            var fixPrice = iSimIItemComp.GetFieldValue ( ""PURCH_NO_C"" );
		    var netVal          = iSimItemComp.GetFieldValue (""SUBTOTAL_2""); // nbc
		    var itemUOM 		= iSimItemComp.GetFieldValue (""SALES_UNIT""); // For EPrice CR
		    var qtyReq			= iSimItemComp.GetFieldValue (""REQ_QTY"");
     	    var itemReqDate = iSimItemComp.GetFieldValue (""DLV_DATE""); 
            var itemnum = iSimItemComp.GetFieldValue (""ITM_NUMBER"");
            var itemCurrency = currencyLM.Translate (iSimItemComp.GetFieldValue (""CURRENCY""));
            oSimItemComp.SetFieldValue     (""Currency Code"",             itemCurrency );                   
            oSimItemComp.CopyFieldValue    (""Line Number"",                ""ITM_NUMBER"");
            //oSimItemComp.CopyFieldValue    (""Quantity Requested"",        ""REQ_QTY"");
            oSimItemComp.SetFieldValue    (""Quantity Requested"",        qtyReq);
            oSimItemComp.CopyFieldValue    (""Product Integration Id"",        ""MATERIAL"");
            oSimItemComp.CopyFieldValue    (""Source Inventory Location"",        ""PLANT"");
            var netTax		= null;
                      
            // For EPrice CR
            var condFlag = false;
            iCondComp = iSimExportComp.GetIntComp (""ORDER_CONDITION_EX"");
            while (iCondComp.NextRecord ())
            {
             oSimItemComp.SetCopySource  (iCondComp);
             if ((iCondComp.GetFieldValue (""ITM_NUMBER"") == itemnum)) 
             {
             if ((iCondComp.GetFieldValue (""COND_TYPE"") == ""PN00""))
                 			 {	var netPrice = 0;
                 				var netValue = 0;
                 				if (itemUOM == (iCondComp.GetFieldValue (""COND_UNIT"")))
                					{
                					if (fixPrice != ""X"")
            						{ 
                					oSimItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 	oSimItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
									oSimItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); // nbc 7.8.2 SAP 4x Net Price
									oSimItemComp.CopyFieldValue     (""NRC CxTotal"", ""CONDVALUE"");
									}
									else
									{
									var sNetPrice = iCondComp.GetFieldValue (""COND_VALUE"");
									var netPrice = sNetPrice /10;
									var netVal = netPrice * qtyReq;
									oSimItemComp.SetFieldValue    (""Net Price"",      	netPrice);
									oSimItemComp.SetFieldValue     (""NRC CxTotal"", netVal);
									}
                 					}
                 			  	else
              						{netValue = (iCondComp.GetFieldValue (""CONDVALUE""));
                 					 	if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 		 		if (fixPrice != ""X"")
            								{ 
                 			 	 	 		 oSimItemComp.SetFieldValue  (""Unit Price"",   netPrice);
               	 			 	 			 oSimItemComp.SetFieldValue  (""Adjusted List Price"",   netPrice);
										     oSimItemComp.SetFieldValue  (""Net Price"",   netPrice); //nbc 7.8.2 SAP 4x Net Price
										     oSimItemComp.CopyFieldValue     (""NRC CxTotal"", ""CONDVALUE"");
										     }
										     else
										     {
										     var sNetPrice = iCondComp.GetFieldValue (""COND_VALUE"");
											 var netPrice = sNetPrice /10;
											 var netVal = netPrice * qtyReq;
											 oSimItemComp.SetFieldValue    (""Net Price"",      	netPrice);
											 oSimItemComp.SetFieldValue     (""NRC CxTotal"", netVal);
										     }
               	 			 	 			}
               	 			 	 	}
               	 			 	condFlag = true;
               	 	     	}          	 		
               	   			if ((iCondComp.GetFieldValue (""COND_TYPE"") == ""PR00"") && (condFlag == false))
	               				{	
                 					var netPrice= 0;
                 					var netValue = 0;
                 					if (itemUOM == (iCondComp.GetFieldValue (""COND_UNIT"")))
                 			    		{
                 			    		if (fixPrice != ""X"")
            							{ 
                 			    		oSimItemComp.CopyFieldValue  (""Unit Price"",   ""COND_VALUE"");
                 				 		oSimItemComp.CopyFieldValue  (""Adjusted List Price"",   ""COND_VALUE"");
										oSimItemComp.CopyFieldValue  (""Net Price"",   ""COND_VALUE""); //nbc 7.8.2 SAP 4x Net Price										
										oSimItemComp.CopyFieldValue     (""NRC CxTotal"", ""CONDVALUE"");
										}
										else
										{
										var sNetPrice = iCondComp.GetFieldValue (""COND_VALUE"");
										var netPrice = sNetPrice /10;
										var netVal = netPrice * qtyReq;
										oSimItemComp.SetFieldValue    (""Net Price"",      	netPrice);
										oSimItemComp.SetFieldValue     (""NRC CxTotal"", netVal);
										}
                 						}
                 					else
                 						{ netValue = (iCondComp.GetFieldValue (""CONDVALUE""));
                 			 	  		if (netValue != 0)
                 			 		 		{netPrice = (netValue / qtyReq); 
                 			 		 		if (fixPrice != ""X"")
            								{ 
                 			 		  		oSimItemComp.SetFieldValue  (""Unit Price"",  netPrice);
               	 			 	      		oSimItemComp.SetFieldValue  (""Adjusted List Price"",  netPrice); 
											oSimItemComp.SetFieldValue  (""Net Price"",  netPrice); //nbc 7.8.2 SAP 4x Net Price
											oSimItemComp.CopyFieldValue     (""NRC CxTotal"", ""CONDVALUE"");
											}
											else
											{
											var sNetPrice = iCondComp.GetFieldValue (""COND_VALUE"");
											var netPrice = sNetPrice /10;
											var netVal = netPrice * qtyReq;
											oSimItemComp.SetFieldValue    (""Net Price"",      	netPrice);
											oSimItemComp.SetFieldValue     (""NRC CxTotal"", netVal);
											}
               	 			 	      		}
               	 			 	 		}
               	 		 		}
               	 		
               	 	if ((iCondComp.GetFieldValue (""COND_TYPE"") == ""KF00""))
                 		{
                 		if (fixPrice != ""X"")
            			{
                 		 oSimItemComp.CopyFieldValue  (""Freight Amount"",   ""CONDVALUE"");
                 		 }
                 		 else
                 		 {
                 		 oSimItemComp.SetFieldValue  (""Freight Amount"",   ""0"");
                 		 }
               	 		}
               	 			
               	 	if ((iCondComp.GetFieldValue (""COND_TYPE"") == ""UTXJ""))
                 		{
                 		 oSimItemComp.CopyFieldValue  (""Tax Amount"",   ""CONDVALUE"");
               	 		}
           } //if
           } //while
                        
            //* Read ""ORDER_SCHEDULE_EX"" component
            iSchedItemComp = iSimExportComp.GetIntComp   (""ORDER_SCHEDULE_EX"");
            oSchedItemComp = oSimItemComp.CreateIntComp (""Order Entry - Line Item Actions"", false);
			var firstScheduleLine = 1;
            while (iSchedItemComp.NextRecord ())
             {
               var itemnum2  = iSchedItemComp.GetFieldValue (""ITM_NUMBER"");
               var schednum = iSchedItemComp.GetFieldValue (""SCHED_LINE"");
               var schedQty = iSchedItemComp.GetFieldValue (""REQ_QTY"");
               var intId;
               if (itemnum2 == itemnum)
               {
           
                oSchedItemComp.NewRecord ();
                oSchedItemComp.SetCopySource  (iSchedItemComp);
                intId = inputId + ""-"" + itemnum2 + ""-"" + schednum;
                //oSchedItemComp.CopyFieldValue (""Quantity"",                   ""REQ_QTY"");
                oSchedItemComp.SetFieldValue (""Quantity"",                   schedQty);
                oSchedItemComp.SetFieldValue (""Line Item Action Number"",     intId);
                oSchedItemComp.CopyFieldValue (""Actual Start Date"",           ""GI_DATE"");
                oSchedItemComp.CopyFieldValue (""Confirmed Qty"",               ""CONFIR_QTY"");
                var reqDate = iSchedItemComp.GetFieldValue ( ""REQ_DATE"");
                oSchedItemComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                // Checking for First Schedule Line, as it contains actual Req Delivery Date and setting it for Item Req Delv Date
                if ( firstScheduleLine == 1 )
                	{
                		oSimItemComp.SetFieldValue    (""Due Date"",      reqDate );
                	}
                firstScheduleLine++;
                
                var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
                   oSchedItemComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
                }
             }
			} //endif (parItemnum == ""000000"" || parItemnum == """")
         }
      }
   }
}
function SimulateSAP47Order_SiebelToBAPI (inputMsg, outputMsg)
{  // referenced by workflow Order - Simulate SAP 47 Order
   /* Uses same map as CreateFromData() */
   Simulate77SAP47Order_SiebelToBAPI (inputMsg, outputMsg, 
                                        ""SAP 47 Order"", 
                                        ""SAP 47 Order - Simulate SAP Order (BAPI Input)"");
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", d.getMonth()+1, d.getDate(), d.getFullYear(), d.getHours(), d.getMinutes(), d.getSeconds()); 
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 6 $
//      $Date: 01/15/01 10:29a $
//    $Author: S.Garg $ of last update
//
// CREATOR:    P. Lim
//
// DESCRIPTION
//    Javascript maps from Siebel Order & Quote to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
/* This function shared by ""Simulate Order"" and ""Create Order"" */"
function ConvertMonth(cardExpMonth)
{
	var nMonth; 
	if ( cardExpMonth == ""January"" )
		{
			nMonth = ""01"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""February"" )
		{
			nMonth = ""02"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""March"" )
		{
			nMonth = ""03"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""April"" )
		{
			nMonth = ""04"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""May"" )
		{
			nMonth = ""05"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""June"" )
		{
			nMonth = ""06"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""July"" )
		{
			nMonth = ""07"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""August"" )
		{
			nMonth = ""08"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""September"" )
		{
			nMonth = ""09"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""October"" )
		{
			nMonth = ""10"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""November"" )
		{
			nMonth = ""11"";
			return nMonth ;
		}
	else if ( cardExpMonth == ""December"" )
		{
			nMonth = ""12"";
			return nMonth ;
		}
	else
		{
			nMonth = ""01"";
			return nMonth ;
		}
}
function CreateOrder ()
{
	var OrgBusObject = TheApplication().GetBusObject(""Order Entry"");
	var SABusComp = OrgBusObject.GetBusComp(""Order Entry - Orders"");
	var orderType= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE"", ""Sales Order"");
    var orderCode= TheApplication().InvokeMethod (""LookupValue"", 	""FS_ORDER_TYPE_CODE"", ""Sales"");
	
	SABusComp.NewRecord(0);
	SABusComp.SetFieldValue			(""Active"",				""Y"");
    SABusComp.SetFieldValue 		(""Order Type"",   		orderType);	
	SABusComp.SetFieldValue 		(""Order Type Code"",   	orderCode);	
	// SABusComp.SetFieldValue			(""Price List Id"",		priceList);
	SABusComp.WriteRecord();
	return SABusComp.GetFieldValue	(""Id"");
	
}
function CreateSAP4xOrder_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (SAP 4x Order - Create SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 4x Order)
    *     Order (oOrder)
    *     
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;   	// BAPI Order instance
   var iExportComp; 	// BAPI Export Parameters
   var iItemComp;	   	// BAPI Line Items
   var iIItemComp;	   	// BAPI Inpout Line Items ( ""ORDER_ITEMS_IN"") To fetch Pricing Master Info
   var iSchedItemComp; 	// BAPI Schedule Line Items

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oRFCOrderComp;  // Create Output for RFC_* Table
   var oItemComp;      // Order Line Item
   var oRFCItemComp;   // Output Line Item for RFC_* Table to store pricing info
   var oSchedItemComp  // Schedule Line Item

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj(""SAP 4x Order - Create SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order(Sync)"");

   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iExportComp = iOrderObj.GetPrimaryIntComp (""Export Parameters"");
      if (iExportComp.NextRecord ())
      {
      
         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iExportComp);
         
         
		 
		 oOrderComp.SetFieldValue 		(""As Of Date"", 		Timestamp());

         oOrderComp.CopyFieldValue 		(""Integration Id"",  ""SALESDOCUMENT"");
         
         var sapDelBlock 	= iExportComp.GetFieldValue	( ""SHIP_TO_PARTY-DLV_BLOCK"" );
		 var delBlock 		= TheApplication().InvokeMethod	(""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
         var sapBillBlock	= iExportComp.GetFieldValue	( ""BILLING_PARTY-BILL_BLOCK"" );
		 var billBlock 		= TheApplication().InvokeMethod	(""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
         oOrderComp.SetFieldValue 		(""Billing Block"",     		billBlock);
		 oOrderComp.SetFieldValue 		(""Delivery Block"",    		delBlock);
         oOrderComp.CopyFieldValue		(""Back Office Error Text"",  ""RETURN-MESSAGE"");
         var submitFailure = iExportComp.GetFieldValue ( ""RETURN-MESSAGE"");
         if ( submitFailure == null || submitFailure == """")
         	{
         		oOrderComp.SetFieldValue 		(""EAI Sync Date"", 	Timestamp());
         		var submitStatus  = TheApplication().InvokeMethod	(""LookupValue"", ""EAI_ORDER_SYNC_STATUS"", ""Created in Back Office"");
         		oOrderComp.SetFieldValue(""Back Office Process Status"",    		submitStatus);
         	}
         else
         	{
         		var submitStatus  = TheApplication().InvokeMethod	(""LookupValue"", ""EAI_ORDER_SYNC_STATUS"", ""Error on Creating"");
         		oOrderComp.SetFieldValue(""Back Office Process Status"",    		submitStatus);
         	}
         
         	
         var salesdoc =  iExportComp.GetFieldValue (""SALESDOCUMENT"");
		 var currencyCode = currencyLM.Translate (iExportComp.GetFieldValue (""SOLD_TO_PARTY-CURRENCY""));
		 if (currencyCode != null && currencyCode != """")
          {
            // oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
            // SGARG 08/29/2001 : Removed as Sold to Party Currency code can be different from Document Currency Code which is not part of output of this BAPI but is of Get Status BAPI
            // So Siebel Order Currency will be updated in GetStatus Map only
          }
		 // Return Number can be different depending on the customization and other factors
         if ( (iExportComp.GetFieldValue (""RETURN-ID"") == ""V1"") && ((iExportComp.GetFieldValue (""RETURN-NUMBER"") == ""154"") || (iExportComp.GetFieldValue (""RETURN-NUMBER"") == ""38"") ) )
         
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""N"");
            }
         else
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""Y"");
            }

		 oRFCOrderComp = oOrderComp.CreateIntComp (""Order Entry - Get SAP Order Status Header"");
      	 oRFCOrderComp.NewRecord();
      	 oRFCOrderComp.SetFieldValue (""Input Id"", inputId);
         oRFCOrderComp.SetFieldValue (""Order Number"", inputId);

         /*
          * Read ""ORDERS_ITEMS_OUT"" component
          */

         iItemComp = iExportComp.GetIntComp   (""ORDER_ITEMS_OUT"");
         iIItemComp = iExportComp.GetIntComp   (""ORDER_ITEMS_IN"");
         oItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
         oRFCItemComp   =  oRFCOrderComp.CreateIntComp ( ""Order Entry - Get SAP Order Status Item"", false);

         while (iItemComp.NextRecord ())
         {
            oItemComp.NewRecord ();
            oItemComp.SetCopySource     (iItemComp);
            iIItemComp.NextRecord ();
            
            var fixPrice = iIItemComp.GetFieldValue ( ""PURCH_NO_C"" );
            var currencyCodeitem = currencyLM.Translate (iItemComp.GetFieldValue (""CURRENCY""));
            var intIdItem;
            
            var itemnum  = iItemComp.GetFieldValue (""ITM_NUMBER"");
            
            var intIdItem = salesdoc + ""-"" + itemnum;
            
            if (currencyCodeitem != null && currencyCodeitem != """")
            {
              // oItemComp.SetFieldValue  (""Currency Code"", currencyCodeitem);
              // can't set at item level at Currency at Item level is Calculated field
            }
            
            var totPrice       = iItemComp.GetFieldValue (""NET_VALUE"");
            var qtyReq			= iItemComp.GetFieldValue(""REQ_QTY"");
            
            if ( qtyReq != 0)
            {
            	var netPrice 		= totPrice / qtyReq;
            }
            
            if (fixPrice != ""X"")
            {
            	oItemComp.SetFieldValue    (""Adjusted List Price"",         netPrice);
            	oItemComp.CopyFieldValue    (""Freight Amount"",             	""SUBTOTAL_4"");
            }
            else
            {
            	// we don't want to update Freight if Siebel is Pricing Master.
            	oItemComp.SetFieldValue    (""Freight Amount"",             	""0"" );
            }
            	
            var itemReqDate = iItemComp.GetFieldValue (""DLV_DATE"");
            var itemCurrency = currencyLM.Translate (iItemComp.GetFieldValue (""CURRENCY""));
            
            oItemComp.SetFieldValue     (""Currency Code"",             	itemCurrency );                            
            oItemComp.CopyFieldValue    (""Tax Amount"",                 	""SUBTOTAL_5"");
            oItemComp.SetFieldValue     (""SAP 4x Net Price"",       		totPrice);
            oItemComp.SetFieldValue     (""Integration Id"",            	intIdItem);
            oItemComp.SetFieldValue     (""Order Header Id"",             inputId);
            // oItemComp.CopyFieldValue    (""Due Date"",      				""DLV_DATE"");
            oItemComp.CopyFieldValue    (""Line Number"",                ""ITM_NUMBER"");
            oItemComp.SetFieldValue     (""Quantity Requested"",        	qtyReq);
            oItemComp.CopyFieldValue    (""Product Integration Id"",      ""MATERIAL"");
            oItemComp.CopyFieldValue    (""Source Inventory Location"",   ""PLANT"");
           /*
           	* This section was added to dump Pricing Values in RFC_* table for comparison purpose in 
           	* Bus Comp Freight & Tax Calculated fields ( Pls see ""SAP 4x Freight"" & ""SAP 4x Tax"" Fields in ""Order Entry - Line Items"" Bus Comp)
           	*/
            oRFCItemComp.NewRecord ();
            oRFCItemComp.SetCopySource  (iItemComp);
            oRFCItemComp.SetFieldValue (""Input Id"" , 		inputId );
            oRFCItemComp.SetFieldValue (""Requested Quantity"" , qtyReq );
            
            oRFCItemComp.CopyFieldValue (""Item Number"", 	""ITM_NUMBER"");
            oRFCItemComp.SetFieldValue (""Net Value"", 		totPrice );
			oRFCItemComp.SetFieldValue (""Net Price"", 		netPrice );            

            
            
   
           /*
            * Read ""ORDER_SCHEDULE_EX"" component
            */
            iSchedItemComp = iExportComp.GetIntComp   (""ORDER_SCHEDULE_EX"");
            oSchedItemComp = oItemComp.CreateIntComp (""Order Entry - Line Item Actions"", false);
			var firstScheduleLine = 1;
         
            while (iSchedItemComp.NextRecord ())
             {
               var itemnum2  = iSchedItemComp.GetFieldValue (""ITM_NUMBER"");
               var schednum  = iSchedItemComp.GetFieldValue (""SCHED_LINE"");
               var intId;
               var shipValue = TheApplication().InvokeMethod (""LookupValue"",   ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
               if (itemnum2 == itemnum)
               {
                oSchedItemComp.NewRecord ();
                oSchedItemComp.SetCopySource  (iSchedItemComp);
                intId = salesdoc + ""-"" + itemnum2 + ""-"" + schednum;
                oSchedItemComp.SetFieldValue  (""Line Item Action Number"",		intId);
                oSchedItemComp.SetFieldValue  (""Line Number"",					itemnum2);
                oSchedItemComp.SetFieldValue  (""Order Header Id"",     			inputId);
                oSchedItemComp.SetFieldValue  (""Integration Id"",     			intId);
                oSchedItemComp.SetFieldValue  (""Quantity"",     					qtyReq);                
                oSchedItemComp.CopyFieldValue (""Confirmed Qty"",                 ""CONFIR_QTY"");
                oSchedItemComp.CopyFieldValue (""Actual Start Date"",             ""REQ_DATE"");
                var reqDate = iSchedItemComp.GetFieldValue ( ""REQ_DATE"");
                oSchedItemComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                // Checking for First Schedule Line, as it contains actual Req Delivery Date and setting it for Item Req Delv Date
                if ( firstScheduleLine == 1 )
                	{
                		oItemComp.SetFieldValue    (""Due Date"",      reqDate );
                	}
                firstScheduleLine++;
                
                // oSchedItemComp.SetFieldValue  (""Planned Start Date"",      		itemReqDate );
                oSchedItemComp.SetFieldValue  (""Line Item Action Type"",   		shipValue);
                }
             }

         }
      }
   }
}
function CreateSAP4xOrder_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Uses same map as CreateFromData() */
   CreateSimulateSAP4xOrder_SiebelToBAPI (inputMsg, outputMsg,
                                        ""SAP 4x Order"",
                                        ""SAP 4x Order - Create SAP Order (BAPI Input)"");
}
"/*
function CreateSimulateSAP4xOrder_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{
   **
    * Input Objects' Integration Components
    *   Order Object (SAP 4x Order)
    *     Order (order)
    *       Order Line Item (item)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 4x Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *       ORDER_PARTNERS
    *       ORDER_ITEMS_IN
    *       ORDER_PARTNERS
    **

   **
    * Set up EAI Lookup maps
    **
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     	""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",      		""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   	""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",		""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",	""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", 	""Siebel Outbound"");

   **
    * Set up EAI Input Message objects
    **
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iItemComp;  // Order Line Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   **
    * Set up EAI Output Message objects
    **
    
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component


   **
    * Find and create top-level integration object
    **
    
   iOrderObj    = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   **
    * Read int object instances from EAI message
    **
    
   while (iOrderObj.NextInstance ())
   {
      **
       * Create ""Order"" object in output message
       **
       
      oCFDOrderObj.NewInstance ();

      **
       * Read ""Order"" component
       **
       
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
      {
         **
          * Return an error if Integration Id is not null
          **
          
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
              var IntId = iOrderComp.GetFieldValue (""Integration Id"");
              EAIRaiseError(LocalizeMessage(""ERR_MSG_ORDER_ALREADY_SUBMITTED,""+IntId+""""));

         }
        
         **
          * Write ""Import Parameters"" component
          **
          
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COLLECT_NO"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_OFF"",  null);
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_METHOD"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_SUPPLEM"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GROUP"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_DIST"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_LIST"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DLV_BLOCK"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-BILL_BLOCK"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-ORD_REASON"", null);
         
         if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            {
               oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            }
            
         
         var date = iOrderComp.GetFieldValue ( ""Pricing Date"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", date );
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP1"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP2"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP3"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP4"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP5"",  null);
         

         **
          * Write ""ORDER_PARTNERS"" component  
          **
          
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         if (payerId == null || payerId == """")
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId );
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId );
         	}
         
         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

		**
		 * Read and update Credit Card Info
		 *
		 **
		 var ccType = cCardLM.Translate (iOrderComp.GetFieldValue (""Credit Card Name""));
		 var ccNum = iOrderComp.GetFieldValue ( ""Credit Card Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iOrderComp);
		 		var cardExpDate = iOrderComp.GetFieldValue ( ""Credit Card Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iOrderComp.GetFieldValue (""Credit Card Expiration Year"" );
		 				var cardExpMonth  = iOrderComp.GetFieldValue (""Credit Card Expiration Month"" );
		 				var cardExpDay;
		 				
		 				var nMonth = ConvertMonth (cardExpMonth);
		 				// EAIRaiseError(""ERR_MSG_ORDER_ALREADY_SUBMITTED"");
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 				// oCFDCardComp.SetFieldValue (""CC_VALID_T"", ""05/31/2004 00:00:00"" );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Credit Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Credit Card Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	}
         **
          * Read ""Order Line Item"" Integration Component
          **
          
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         
         while (iItemComp.NextRecord ())
         {

            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number"");
            oCFDItemComp.CopyFieldValue (""HG_LV_ITEM"",     null);
            oCFDItemComp.CopyFieldValue (""PO_ITM_NO"",      ""null"");
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            oCFDItemComp.CopyFieldValue (""CUST_MAT"",       null);
            oCFDItemComp.CopyFieldValue (""BATCH"",          null);
            oCFDItemComp.CopyFieldValue (""DLV_GROUP"",      null);
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
            
            oCFDItemComp.CopyFieldValue (""REASON_REJ"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_BLOCK"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_DATE"",      null);
            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.CopyFieldValue (""STORE_LOC"",      null);
            oCFDItemComp.CopyFieldValue (""TARGET_QTY"",     null);
            oCFDItemComp.CopyFieldValue (""TARGET_QU"",      null);
            oCFDItemComp.CopyFieldValue (""REQ_QTY"",        ""Quantity Requested"");
            // var baseUOM = iItemComp.GetFieldValue (""Unit of Measure"");
            // var baseUOMLI = TheApplication().InvokeMethod (""LookupValue"", ""UNIT_OF_MEASURE "", baseUOM);
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""ITEM_CATEG"",     null);
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");
            oCFDItemComp.CopyFieldValue (""REQ_DATE"",       ""Due Date"");
            oCFDItemComp.SetFieldValue  (""DATE_TYPE"",      ""1"");
            oCFDItemComp.CopyFieldValue (""REQ_TIME"",       null);
           
           
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PN00"");
            	oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
                oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     ""Item Price"");
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            // Transfer Siebel Header freight only in case of Siebel is Pricing Master
            oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CD_TYPE1"",   ""HB00"");
         	oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CD_VALUE1"",  ""Freight"");
         	oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CD_P_UNT1"",   ""1"");
         	oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CD_D_UNT1"",  uomLM.Translate(iOrderComp.GetFieldValue(""Unit of Measure"")));
           	}
           else
           {
           		oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PB00"");	
           		// oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     null);
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            }
            
                           
           
           
           
            oCFDItemComp.CopyFieldValue (""PRC_GROUP1"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP2"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP3"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP4"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP5"",     null);
            oCFDItemComp.CopyFieldValue (""PROD_HIERA"",     null);
            oCFDItemComp.CopyFieldValue (""MATL_GROUP"",     null);
                 
         } //order items read
      }
      
   }
}
*/"
function GetDaysInAMonth(nMonth, nYear)
{

	// Jan, Mar, May, Jul, Aug, Oct, Dec have 31 days each
	// Apr, Jun, Sept, Nov have 30 days each
	// Feb, for now, has 28 days.
	var daysInMonth = new Array(31,28,31,30,31,30,31,31,30,31,30,31);
	var nCurrentDays;


	// Only February can be either 28 or 29, depending on whether the year is a leap year
	if (nMonth == 2)
	{
		// If the year is divisible by 4, it is a leap year
		if (nYear%4 == 0)
		{
			// If the year is a century, then it should be divisible by 400 to be a leap year.
			if (nYear%100 == 0)
			{
				// If it is a century and divisible by 400, it is a leap year.
				if (nYear%400 == 0) { nCurrentDays = 29;}

				// If it is a century and NOT divisible by 400 (e.g. 1900), it is NOT a leap year.
				else	{ nCurrentDays = 28;}
			}
		
			// If it is not a century and divisible by 4, it is a leap year.
			else { nCurrentDays = 29;}
		}

		// If a year is NOT divisible by 4, it is not a leap year
		else { nCurrentDays = 28; }
	}


	// If the month is NOT Feb, calculating days in a month is straight-forward.
	// eScript array index starts with 0, not 1.
	else
	{ nCurrentDays = daysInMonth[nMonth - 1]; }

	return nCurrentDays;

}
function GetOrderId (orderId)
{
	var OrdBusObject = TheApplication().GetBusObject(""Order Entry"");
	var OrdBusComp = OrdBusObject.GetBusComp(""Order Entry - Orders"");
	
	OrdBusComp.ClearToQuery();
	OrdBusComp.SetViewMode (AllView);
	OrdBusComp.SetSearchSpec(""Integration Id"", orderId);
	OrdBusComp.ActivateField(""Id"");
	OrdBusComp.ExecuteQuery();
	
	if(OrdBusComp.FirstRecord())
	{
	   return OrdBusComp.GetFieldValue(""Id"");
	}
      	else
           return null;
	
}
function GetSAP4xOrderStatus_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (SAP 4x Order - Get SAP Order Status (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *           Order Item Delivery Item (deliv)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 4x Order(Get Status))
    *     Order (oOrder)
    *       Get Status Output
    *       Get Status Header
    *         Get Status Item
    *           Get Status Item Delivery Item
    *       Order Line Item
    *         Order Line Item Action
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGSOrderObj;   // BAPI Order instance
   var iGSExportComp; // BAPI Export Parameters
   var iGSHeaderComp; // BAPI Order Header
   var iGSItemComp;   // BAPI Order Item
   var iGSDelivComp;  // BAPI Order Item Delivery Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;     // Siebel Orderinstance
   var oOrderComp;    // Order
   var oItemComp;     // Order Line Item
   var oDelivComp;    // Order Line Item Action
   //var oGSOutputComp; // Create Output
   //var oGSHeaderComp; // Create Header
   //var oGSItemComp;   // Create Item
   //var oGSDelivComp;  // Create Item Delivery Item


   /*
    * Find and create top-level integration object
    */
   iGSOrderObj = inputMsg.GetIntObj(""SAP 4x Order - Get Status SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order(Get Status)"");

   /*
    * Read int object instances from EAI message
    */

   while (iGSOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oOrderObj.NewInstance ();
      
      /*
       * Create ""Order"" component
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      /*
       * Read ""Export Parameters"" component
       */
      iGSExportComp = iGSOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      /*
       * Create the output component. Defer creation if the ""Export Parameters"" component
       * does not exist.
       *
       */
      //oGSOutputComp = oOrderComp.CreateIntComp (""Get Status Output"", iGSExportComp.Exists());
      if (iGSExportComp.NextRecord())
      {
         var errorMessage = iGSExportComp.GetFieldValue ( ""RETURN-MESSAGE"");
         /*
          * Read ""Order Header"" component
          */
         iGSHeaderComp = iGSExportComp.GetIntComp (""Order Header"");
         //oGSHeaderComp = oOrderComp.CreateIntComp (""Get Status Header"", iGSHeaderComp.Exists());

         // Singleton entry in input - 'if' is symbolic of not looping
         if (iGSHeaderComp.NextRecord ())
         {
           
            /*
             * Update ""Order"" component
             */
            oOrderComp.SetCopySource  (iGSHeaderComp);
            
            // EAI Lookup code ""SAP Currency""
            var currencyCode = currencyLM.Translate (iGSHeaderComp.GetFieldValue (""CURRENCY""));
   
            if (currencyCode != null && currencyCode != """")
              {     
                 oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
              }     
                 
                 // We are checking the status the order;
				 // hence, set only the As Of Date/Status Date to now.
				 oOrderComp.SetFieldValue(""As Of Date"", Timestamp());
				 oOrderComp.SetFieldValue(""Back Office Error Text"", errorMessage);
                 
                 oOrderComp.CopyFieldValue (""Requested Ship Date"",     ""REQ_DATE_H"");
                 var sapBlock = iGSHeaderComp.GetFieldValue ( ""DLV_BLOCK"" );
			     var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapBlock);
                 oOrderComp.SetFieldValue (""Delivery Block"",          delBlock);
                 //oOrderComp.CopyFieldValue (""Delivery Status"",         ""DLV_STAT_H"");
                 // oOrderComp.CopyFieldValue (""Order Date"",              ""DOC_DATE"");
                 var sapStatus = iGSHeaderComp.GetFieldValue ( ""PRC_STAT_H"" );
                 if ( sapStatus == ""C"" )
                 	{
                 		oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Closed""));
                 	}
                 else if ( sapStatus == ""B"" )
                 	{
                 		oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Partially Shipped""));	
                 	}
                 else 
                 	{
                 		oOrderComp.SetFieldValue ( ""Status"" , 	TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_STATUS"", ""Open""));	
                 	}	
                 oOrderComp.CopyFieldValue (""Integration Id"",           ""DOC_NUMBER"");
               	 oOrderComp.CopyFieldValue (""Account Order Number"",     ""PURCH_NO"");               	 
               	                	                 
                 
                 var salesdoc =  iGSHeaderComp.GetFieldValue (""DOC_NUMBER"");
            /*
             * Read ""Order Item"" component
             */
            iGSItemComp = iGSHeaderComp.GetIntComp (""Order Item"");
            
            //oGSItemComp = oGSHeaderComp.CreateIntComp (""Get Status Item"", iGSItemComp.Exists());
            oItemComp   = oOrderComp.CreateIntComp (""Order Entry - Line Items"", iGSItemComp.Exists());
            while (iGSItemComp.NextRecord ())
            {
               
               /*
                * Write ""Order Line Item"" component
                */
               /*
                 NOTES: 
                 1. REF_QTY stores QTY submitted to next document (in this case, the deliveries).
                 So, this is equivalent to sum(item.DLV_QTY)
                 2. P Lim 5/28/99. Force prices into SAP. Do not update S_ORDER_ITEM.UNI_PRI (discount price).
                 SAP Line Items view will show Siebel prices AND SAP prices on same list view.
                 item.NET_PRICE UNIT_PRI
                 3. SAP columns not mapped to S_ORDER_ITEM (and exposed in SAP Line Items applet):
                 CUM_CF_QTY    NUMBER(15)
                 COND_P_UNT    VARCHAR2(5)
                 COND_UNIT     VARCHAR2(3)
               */
               
               var itemMaterial = iGSItemComp.GetFieldValue (""MATERIAL"");
               
               oItemComp.NewRecord ();
               oItemComp.SetCopySource  (iGSItemComp);
               
               var intIdItem;
            
               var itemnum  = iGSItemComp.GetFieldValue (""ITM_NUMBER"");
            
               var intIdItem = salesdoc + ""-"" + itemnum;
               
                
                var netVal		       = iGSItemComp.GetFieldValue (""NET_VALUE"");
                var qtyReq 			   = iGSItemComp.GetFieldValue (""REQ_QTY"");
                var netPrice 	       = netVal / qtyReq;
                var itemReqDate 	   = iGSItemComp.GetFieldValue (""REQ_DATE"");
               
               oItemComp.SetFieldValue  (""Product Integration Id"", itemMaterial);
               oItemComp.SetFieldValue  (""Order Header Id"", inputId );
               oItemComp.CopyFieldValue (""Line Number"",            ""ITM_NUMBER"");
               oItemComp.SetFieldValue (""Quantity Requested"",       qtyReq);
               oItemComp.CopyFieldValue (""Quantity Shipped"",       ""REF_QTY"");
               oItemComp.CopyFieldValue (""Due Date"",               ""REQ_DATE"");
               oItemComp.CopyFieldValue (""Description"",            ""SHORT_TEXT"");
			   var sapStatus = iGSItemComp.GetFieldValue ( ""DLV_STAT_I"" );
			   var itemStatus= TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_ITEM_DELIV_STATUS"", sapStatus);
               oItemComp.SetFieldValue (""Delivery Status"",        itemStatus);
               oItemComp.SetFieldValue    (""Unit Price"",   netPrice);
               oItemComp.SetFieldValue    (""Adjusted List Price"",   netPrice);
               oItemComp.SetFieldValue    (""SAP 4x Net Price"",   	netVal);
               oItemComp.CopyFieldValue (""Product Unit of Measure"",""SALES_UNIT"");
               oItemComp.SetFieldValue  (""Integration Id"",         intIdItem);

               
               /*
                * Read ""Order Item Delivery Item"" component
                */
               var loop = 0;
               iGSDelivComp = iGSItemComp.GetIntComp (""Order Item Delivery Item"");
               oDelivComp   = oItemComp.CreateIntComp   (""Order Entry - Line Item Actions(Delivery Status)"", iGSDelivComp.Exists());
               
               while (iGSDelivComp.NextRecord ())
               {
               var delivNum = null;
               var delivItem = null;
               
               // loop++;
               delivNum  = iGSDelivComp.GetFieldValue (""DELIV_NUMB"");
               delivItem  = iGSDelivComp.GetFieldValue (""DELIV_ITEM"");
               // var delivLineNum = iGSDelivComp.GetFieldValue (""ITM_NUMBER"");
               if ( delivNum != null ) 
                  {
                //  oDelivComp   = oItemComp.CreateIntComp   (""Order Entry - Line Item Actions(Delivery Status)"", iGSDelivComp.Exists());
                
                                  
                  /*
                   * Write ""Item Delivery Item"" component
                   */
                  
                  oDelivComp.NewRecord ();
                  oDelivComp.SetCopySource  (iGSDelivComp);
                  
                  var itemActionNum = delivNum + ""-"" + delivItem;
                  // var itemActionNum1 = intIdItem + loop;
                  
                  oDelivComp.CopyFieldValue (""Confirmed Qty"",       ""DLV_QTY"");                  
                  oDelivComp.CopyFieldValue (""Planned Start Date"",       ""DELIV_DATE"");
                  oDelivComp.SetFieldValue  (""Line Item Action Number"",  itemActionNum);
                  oDelivComp.SetFieldValue  (""Quantity"",  qtyReq);
                  oDelivComp.SetFieldValue  (""Integration Id"",  itemActionNum);
                  // oDelivComp.SetFieldValue  (""Id"",  itemActionNum1);
                  oDelivComp.SetFieldValue  (""Order Header Id"",  inputId);
                  var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Delivery"");
                  // TheApplication().MsgBox ("foo is: "" + foo);
                  oDelivComp.SetFieldValue  (""Line Item Action Type"",   shipValue);

   				  // oDelivComp.SetFieldValue  (""Line Item Action Type"",   ""Delivery"");
                  }
              }
            }
         }
      }
   }
}
function GetSAP4xOrderStatus_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Order Object (SAP 4x Order(Get Status))
    *     Order
    *
    * Output Object's Integration Components:
    *   BAPI Import (SAP 4x Order - Get Status SAP Order (BAPI Input))
    *     Import Parameters
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;    // Siebel Order instance
   var iOrderComp;   // Order

   /*
    * Set up EAI Output Message objects
    */
   var oGSObj;         // BAPI instance
   var oGSImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (""SAP 4x Order(Get Status)"");
   oGSObj    = outputMsg.CreateIntObj (""SAP 4x Order - Get Status SAP Order (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Get Status"" object
       */
      oGSObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oGSImportComp = oGSObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iOrderComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGSImportComp.NewRecord ();
         oGSImportComp.SetCopySource  (iOrderComp);
         oGSImportComp.CopyFieldValue (""SALESDOCUMENT"", ""Integration Id"");
      }
   }
}
function LocalizeMessage(Message)
{
	// Function to perform message language translation and parameterization.
	//
	// Created by Richard Exley - November 2000
	//
	// Message is a string of comma separate tokens and parameters.  
	// Tokens begin with <prefix>.  
	// The tokens represent language independent LOV codes of type 
	// <LOVType> which in turn map to translated 
	// parameterized message texts.  If the input message does not start with
	// ERR_MSG the message is returned untranslated.  A message can have 
	// up to nine parameters, %1,%2,...,%9.  An example from the Oracle Connector:
	//
	// Message:
	//   ORA_MSG_MISSING_CONTACT,A. K. Parker,ORA_MSG_INVALID_STATUS,Re-opened,A. K. Parker
	// Parameterized text:
	//   ORA_MSG_MISSING_CONTACT=""Contact for account %1 is missing.""
	//   ORA_MSG_INVALID_STATUS=""%1 is an invalid status for %2.""
	// Result:
	//   ""Contact for account A. K. Parker is missing. Re-opened is an invalid status for A. K. Parker.""
	//
	// Warning!!!  The comma is the delimiter so commas in the parameters will 
	// cause undesirable results and so steps should be taken to avoid them.
	//
	// Note: LOV Display values are limited to 30 characters and so in some cases
	// you may need to combine two tokens to get the behavior you require.

	var prefix = ""ERR_MSG"";
	var LOVType = ""CONNECTOR_MESSAGE"";
	
	if (Message.substring(0,7) != prefix)
		// Don't translate
		return (Message);
	
	var pieces = Message.split(',');
	var tokeni=0;
	var i=1;
	var oMessage="""";
	
	while (tokeni < pieces.length)
	{
		i=tokeni + 1;

		// Lookup error token in LOV table to get translated error text
	 	var LOVText = TheApplication().InvokeMethod (
	 		""LookupValue"", LOVType, pieces[tokeni]);
		
		if (LOVText == """")
		{
	  		// No token in LOV table so append untranslated token and parameters
	  		oMessage=oMessage+pieces[tokeni]+"" "";
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				oMessage=oMessage+pieces[i]+"" "";
				i++;
			}
		}
		else
		{
			// Read parameters
			var params = new Array("""","""","""","""","""","""","""","""","""");
			var paramsi = 0;
	  		while(i < pieces.length)
	  		{
	    		if (pieces[i].substring(0,7) == prefix) break;
				params[paramsi]=pieces[i];
				paramsi++;
				i++;
			}

			// Insert parameters into message and append to output

			// Split LOVText to find parameter place holders %1,%2,...
			var msgpieces=LOVText.split(""%"");
			var mpi;
			oMessage = oMessage + msgpieces[0];

			for (mpi = 1; mpi < msgpieces.length; mpi++)
			{
				paramsi = msgpieces[mpi].substring(0,1);
				if ((Clib.isdigit(paramsi)) && (paramsi > 0))
					// Parameter place holder so append parameter and rest of message piece
					oMessage = oMessage + params[paramsi-1] + msgpieces[mpi].substring(1);
				else
					// Not a parameter place holder so just append % and piece
					oMessage = oMessage + ""%"" + msgpieces[mpi];
			}
			oMessage = oMessage + "" "";
		}
		
		// Set token to next piece
		tokeni=i;
	}
	
	return (oMessage);
}
function OrderStatus (inputMsg,outputMsg )
{
	// var theApp = TheApplication();
	
   /* Input Objects' Integration Components
	*   Order IDOC (SAP 4x Order Status (IDOC))
	*
	*/

   
   /*
	* Set up EAI Input Message objects
	*/
	var iIDOCObj;   // IDOC instance
	var iIDOCComp;  // top level IDOC segment
	var iORDERComp; // IDOC Order Header
	
   /*
    * Set up EAI Output Message objects (Dummy)
    */
   var oOrderObj;      // Order object instance
   var oOrderComp;     // Order (header)
   var oOrderItemComp; // Order Item (item)
	
   /*
	* Find and create top-level integration object
	*/
	iIDOCObj    = inputMsg.GetIntObj (""SAP 4x Order Status (IDOC 4x)"");
	oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order"");
	
   /*
	* Read int object instances from EAI message
	*/
	while (iIDOCObj.NextInstance ())
	{
	   
       /*
		* Read virtual root component that IDOC RFC Adapter populates
		*/
		iIDOCComp = iIDOCObj.GetPrimaryIntComp (""Idoc Segments"");
		oOrderObj.NewInstance ();
		oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
		iIDOCComp.NextRecord ();

	   /*
		* Read ""ORDER"" component
		*/
        iORDERComp = iIDOCComp.GetIntComp (""E2EDK01005"");
		if (iORDERComp.NextRecord ())
		    {
			   
			    var orderNo = iORDERComp.GetFieldValue ( ""BELNR"" );
			    var orderId;
				
				orderId = GetOrderId(orderNo);
				
				outputMsg.SetArgument (""Object Id"", orderId);
                
				var wfManager = TheApplication().GetService(""EAI Business Integration Manager (Server Request)"");
    
    			var input = TheApplication().NewPropertySet();
		    	var output = TheApplication().NewPropertySet();
		    	input.SetProperty(""ProcessName"", ""Order - Get SAP 4x Order Status"");
    			input.SetProperty(""RowId"", orderId);
    			wfManager.InvokeMethod(""RunProcess"", input, output);
    			// TheApplication().MsgBox(""Get Status WF Invoked Sucessfully"");
    		}	
	

	}

}
function OrderToQuote (inputMsg, outputMsg)
{
   /* Input Object's Integration Components:
    *   SAP 4x Order
    *     Order Entry - Orders (header)
    *       Order Entry - Line Items (item)
    *
    *
    * Input Objects' Integration Components
    *   SAP 4x Quote
    *     Quote (header)
    *       Quote Item (item)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;      // Order object instance
   var iOrderComp;     // Order (header)
   var iOrderItemComp; // Order Item (item)
   var iOrderCardComp;	   // Order Card Payment Comp
   var iOrderIActComp; // Order Item Action (sched lines)

   /*
    * Set up EAI Output Message objects
    */
   var oQuoteObj;      // Quote object instance
   var oQuoteComp;     // Quote (header)
   var oQuoteItemComp; // Quote Item (item)
   var oQuoteIActComp; // Quote Item Action (sched lines)

   // Get quote number that started all this
   var quoteNumber = inputMsg.GetArgument (""Quote Id"");
   
   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (""SAP 4x Order(Sync)"");
   oQuoteObj = outputMsg.CreateIntObj (""SAP 4x Quote(Sync)"");

   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
      * Read ""Order Header"" component
      */
      iOrderComp = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oQuoteObj.NewInstance ();
      oQuoteComp = oQuoteObj.CreatePrimaryIntComp (""Quote"");
      while (iOrderComp.NextRecord ())
      {
         oQuoteComp.NewRecord ();
         oQuoteComp.SetCopySource  (iOrderComp);
         var quoteNumber = iOrderComp.GetFieldValue (""Id"");
         // oQuoteComp.CopyFieldValue (""Bill To Account Integration Id"", ""Bill To Account Integration Id"");
         oQuoteComp.CopyFieldValue (""Billing Block"",      ""Billing Block"");
         oQuoteComp.CopyFieldValue (""Delivery Block"",      ""Delivery Block"");
         oQuoteComp.CopyFieldValue (""Credit Check Passed Flag"", ""Credit Status"" );
         oQuoteComp.SetFieldValue  (""Last Validated SAP Date"", Timestamp());
         oQuoteComp.SetFieldValue  (""Id"", 		quoteNumber);
         oQuoteComp.CopyFieldValue (""Currency Code"",      ""Currency Code"");
         var errorMsg = iOrderComp.GetFieldValue (""Back Office Error Text"");
         if ( errorMsg == null || errorMsg == """")
         	{
         		oQuoteComp.SetFieldValue (""EAI Error Message"",      "" "" );
         	}
         else
         	{
         		oQuoteComp.SetFieldValue (""EAI Error Message"",      errorMsg );
         	}
         oQuoteComp.CopyFieldValue (""EAI Error Message"",      ""Back Office Error Text"");
         // oQuoteComp.CopyFieldValue (""Requested Ship Date"", 
         /*
          * Order Card Comp to Quote Card Fields
         */
         
         iOrderCardComp = iOrderComp.GetIntComp (""Payments"");

         while (iOrderCardComp.NextRecord ())
         {
         oQuoteComp.SetCopySource  (iOrderCardComp);

         oQuoteComp.CopyFieldValue ( ""Credit Card Number"", ""Account Number"" );
         oQuoteComp.CopyFieldValue ( ""Credit Card Transaction Time"", ""Authorization Date"" );
         oQuoteComp.CopyFieldValue ( ""Credit Card Transaction ID"", ""Credit Card Transaction ID"" );
         oQuoteComp.CopyFieldValue ( ""Credit Card Authorization Code"", ""Authorization Code"" );
         oQuoteComp.CopyFieldValue ( ""Credit Card Transaction Amount"", ""Transaction Amount"" );
         oQuoteComp.CopyFieldValue ( ""Credit Card Transaction Status"", ""Payment Status"" );
        }

         /*
         * Read the ""Quote Item"" component
         */
         iOrderItemComp = iOrderComp.GetIntComp (""Order Entry - Line Items"");
         oQuoteItemComp = oQuoteComp.CreateIntComp (""Quote Item"", false);

         while (iOrderItemComp.NextRecord ())
         {
            // var lineNo = iOrderItemComp.GetFieldValue ( ""Line Number"" );
            // var lineId = quoteNumber + ""-"" + lineNo ;
            oQuoteItemComp.NewRecord ();
            oQuoteItemComp.SetCopySource  (iOrderItemComp);

            // oQuoteItemComp.CopyFieldValue (""Currency Code"",           ""Currency Code""); // Calculated from Header
            
            var fixPrice = iOrderItemComp.GetFieldValue ( ""Fix Price Flag"");
            oQuoteItemComp.CopyFieldValue (""Freight Amount"",   ""Freight Amount"");
            oQuoteItemComp.SetFieldValue ( ""Quote Id"",       quoteNumber);
            oQuoteItemComp.CopyFieldValue (""Line Number"",   ""Line Number"");
            var ReqQty = iOrderItemComp.GetFieldValue (""Quantity Requested"");
            oQuoteItemComp.CopyFieldValue    (""Source Inventory Location"",        ""Source Inventory Location"");
            
            var NetPrice = iOrderItemComp.GetFieldValue (""SAP 4x Net Price"");
            var UnitNetPrice = NetPrice / ReqQty;
            
            oQuoteItemComp.SetFieldValue (""Quantity Requested"", ReqQty );
            oQuoteItemComp.SetFieldValue (""Net Price"", NetPrice );
            if ( fixPrice != ""Y"" )
            {
            	oQuoteItemComp.SetFieldValue (""Adjusted List Price"", UnitNetPrice);
            }	
            oQuoteItemComp.CopyFieldValue (""Tax Amt"",                 ""Tax Amount"");

            /*
            * Read the ""Quote Item - Schedule Lines"" component
            */
            iOrderIActComp = iOrderItemComp.GetIntComp (""Order Entry - Line Item Actions"");
            oQuoteIActComp = oQuoteItemComp.CreateIntComp (""Quote - SAP 4x Schedule Line Item"", oQuoteComp);
			
			var schedNo = null;
            while (iOrderIActComp.NextRecord ())
            {
               schedNo = schedNo + 1 ;
               // var schedNo = iOrderIActComp.GetFieldValue ( ""Line Item Action Number"" );
               // var schedId = lineId + ""-"" + schedNo ;
               oQuoteIActComp.NewRecord ();
               oQuoteIActComp.SetCopySource  (iOrderIActComp);

               oQuoteIActComp.CopyFieldValue (""Required Delivery Date"",       ""Planned Start Date"");
               // oQuoteIActComp.SetFieldValue (""Line Item Action Type"",   ""Schedule"");
               oQuoteIActComp.SetFieldValue (""Schedule Line No"", schedNo );
               oQuoteIActComp.CopyFieldValue (""Confirmed Date"",      ""Actual Start Date"");
               oQuoteIActComp.CopyFieldValue (""Required Qty"",                ""Quantity"");
               oQuoteIActComp.CopyFieldValue (""Confirmed Qty"",                ""Confirmed Qty"");
               oQuoteIActComp.SetFieldValue ( ""Quote Id"",     quoteNumber);
               // oQuoteIActComp.SetFieldValue ( ""Item Line No"",     lineNo);
            }
         }
      }
   }
}
function QuoteToOrder (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   SAP 4x Quote
    *     Quote (header)
    *       Quote Item (item)
    *
    * Output Object's Integration Components:
    *   SAP 4x Order
    *     Order Entry - Orders (header)
    *       Order Entry - Line Items (item)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iQuoteObj;      // Quote object instance
   var iQuoteComp;     // Quote (header)
   var iQuoteItemComp; // Quote Item (item)

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Order object instance
   var oOrderComp;     // Order (header)
   var oOrderItemComp; // Order Item (item)
  
   // Should we create an Order?
   var createorder = inputMsg.GetArgument (""Create Order"");

   /*
    * Find and create top-level integration object
    */
   iQuoteObj = inputMsg.GetIntObj (""SAP 4x Quote"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order(Quote)"");

   /*
    * Read int object instances from EAI message
    */
   while (iQuoteObj.NextInstance ())
   {
      /*
      * Read ""Quote Header"" component
      */
      iQuoteComp = iQuoteObj.GetPrimaryIntComp (""Quote"");
      oOrderObj.NewInstance ();
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      while (iQuoteComp.NextRecord ())
      {
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iQuoteComp);
         oOrderComp.CopyFieldValue (""Account Integration Id"", ""Account Integration Id"");
         oOrderComp.SetFieldValue  (""Active"",             ""Y"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""Bill To Account Integration Id"");
         oOrderComp.CopyFieldValue (""Contact First Name"", ""Contact First Name"");
         oOrderComp.CopyFieldValue (""Contact Last Name"", ""Contact Last Name"");
         oOrderComp.CopyFieldValue (""Contact Work Phone #"", ""Contact Work Phone #"");
         oOrderComp.CopyFieldValue (""Currency Code"", ""Currency Code"");
         oOrderComp.CopyFieldValue (""Freight"",            ""Freight Total"");
         oOrderComp.CopyFieldValue (""Price List Id"",      ""Price List Id"");
         oOrderComp.CopyFieldValue (""Freight Terms"",      ""Freight Terms"");
         oOrderComp.CopyFieldValue (""Freight Terms Info"", ""Freight Terms Info"");
         // oOrderComp.CopyFieldValue ( ""Id"",                 ""Id""); 
         var quoteNum = iQuoteComp.GetFieldValue (""Quote Number"");
         oOrderComp.SetFieldValue ( ""Order Number"",       quoteNum); 
         // var orderType= TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_TYPE"", ""Sales Order"");
         oOrderComp.SetFieldValue ( ""Order Type"",         ""Sales Order"");   //Maybe this should map from Quote Type?
         // oOrderComp.SetFieldValue ( ""Order Type"",         orderType);   //Maybe this should map from Quote Type?
         oOrderComp.CopyFieldValue (""Partial Ship"",       ""Partial Ship"");
         oOrderComp.SetFieldValue ( ""Integration Id"",      null);
         oOrderComp.CopyFieldValue (""Payment Term"",       ""Payment Term"");
         oOrderComp.CopyFieldValue (""Pricing Date"",       ""Pricing Date"");
         var poNumber = iQuoteComp.GetFieldValue ( ""Purchase order Number"" );
         if ( poNumber == null )
         {
         	oOrderComp.SetFieldValue (""Account Order Number"", quoteNum );
         }
         else
         {
         	oOrderComp.SetFieldValue (""Account Order Number"", poNumber );
         }
         oOrderComp.CopyFieldValue (""Payer Account Integration Id"",       ""Payer Account Integration Id"");
         oOrderComp.CopyFieldValue (""Quote Id"",           ""Id"");
         oOrderComp.CopyFieldValue (""Requested Ship Date"", ""Requested Ship Date"");
         oOrderComp.CopyFieldValue (""SAP Distribution Channel (MO)"", ""SAP Distribution Channel (MO)"");
         oOrderComp.CopyFieldValue (""SAP Division (MO)"", ""SAP Division (MO)"");
         oOrderComp.CopyFieldValue (""SAP Sales Organization (MO)"", ""SAP Sales Organisation (MO)"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""Ship To Account Integration Id"");
         
         
         oOrderComp.CopyFieldValue (""Credit Card Holder"", ""Credit Card Holder"");
         var cCard = iQuoteComp.GetFieldValue ( ""Credit Card Name"");
         // var cCardType = TheApplication().InvokeMethod (""LookupValue"", ""PAY_ACCNT_CD"", cCard);
         oOrderComp.SetFieldValue (""Credit Card Name"", cCard );
         oOrderComp.CopyFieldValue (""Credit Card Number"", ""Credit Card Number"");
         // CR# 12-9RTEQV ( Change Expiration Date to Month & Year)
         //oOrderComp.CopyFieldValue (""Credit Card Expiration Date"", ""Credit Card Expiration Date"");
         oOrderComp.CopyFieldValue (""Credit Card Expiration Month"", ""Credit Card Expiration Month"");
		 oOrderComp.CopyFieldValue (""Credit Card Expiration Year"", ""Credit Card Expiration Year"");

         
         /*
         * Read the ""Quote Item"" component
         */
         iQuoteItemComp = iQuoteComp.GetIntComp (""Quote Item"");
         oOrderItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", oOrderComp);

         while (iQuoteItemComp.NextRecord ())
         {
            oOrderItemComp.NewRecord ();
            oOrderItemComp.SetCopySource  (iQuoteItemComp);

            oOrderItemComp.CopyFieldValue (""Description"",             ""Description"");
            oOrderItemComp.CopyFieldValue (""Due Date"",                ""Requested Delivery Date"");
            // oOrderItemComp.CopyFieldValue (""Freight Amount"",          ""Freight Amount"");
            oOrderItemComp.CopyFieldValue (""Item Price"",              ""Item Price"");
            oOrderItemComp.CopyFieldValue (""Line Number"",             ""Line Number"");
            oOrderItemComp.CopyFieldValue (""Note"",                    ""Note"");
            oOrderItemComp.SetFieldValue ( ""Order Number"",            quoteNum);
            // oOrderItemComp.SetFieldValue ( ""Order Header Id"",         ordernumber);
            oOrderItemComp.CopyFieldValue (""Partial Ship"",            ""Partial Ship"");
            oOrderItemComp.CopyFieldValue (""Pricing Comments"",        ""Pricing Comments"");
            oOrderItemComp.CopyFieldValue (""Product Integration Id"",  ""Product Integration Id"");
            oOrderItemComp.CopyFieldValue (""Unit of Measure"", 		  ""Unit of Measure"");
            oOrderItemComp.CopyFieldValue (""Quantity Requested"",      ""Quantity Requested"");
            oOrderItemComp.CopyFieldValue (""Source Inventory Location"", ""Source Inventory Location"");
            // oOrderItemComp.CopyFieldValue (""Tax Amount"",                 ""Tax Amt"");
            oOrderItemComp.CopyFieldValue (""Unit Price"",              ""Unit Price"");
            
         }
      }
   }
}
function QuoteToOrderSubmit (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   SAP 4x Quote
    *     Quote (header)
    *       Quote Item (item)
    *
    * Output Object's Integration Components:
    *   SAP 4x Order
    *     Order Entry - Orders (header)
    *       Order Entry - Line Items (item)
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iQuoteObj;      // Quote object instance
   var iQuoteComp;     // Quote (header)
   var iQuoteOrgComp;  // Quote Organization Comp (MVG Association)
   var iQuoteItemComp; // Quote Item (item)

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Order object instance
   var oOrderComp;     // Order (header)
   var oOrderOrgComp;  // Order Organization Comp (MVG Association)
   var oOrderItemComp; // Order Item (item)
   var oOrderCardComp; // Order Card Comp (Payment Comp)
  
   // Should we create an Order?
   // var createorder = inputMsg.GetArgument (""Create Order"");

   /*
    * Find and create top-level integration object
    */
   iQuoteObj = inputMsg.GetIntObj (""SAP 4x Quote"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order(Quote)"");

   /*
    * Read int object instances from EAI message
    */
   while (iQuoteObj.NextInstance ())
   {
      /*
      * Read ""Quote Header"" component
      */
      iQuoteComp = iQuoteObj.GetPrimaryIntComp (""Quote"");
      oOrderObj.NewInstance ();
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      while (iQuoteComp.NextRecord ())
      {
         oOrderComp.NewRecord ();
         oOrderComp.SetCopySource  (iQuoteComp);
         oOrderComp.CopyFieldValue (""Account Id"",            ""Account Id"");
         oOrderComp.CopyFieldValue (""Bill To Account Id"",            ""Bill To Account Id"");
         oOrderComp.CopyFieldValue (""Ship To Account Id"",            ""Ship To Account Id"");
         oOrderComp.CopyFieldValue (""Primary Payer Account Id"",            ""Payer Account Id"");
         oOrderComp.SetFieldValue  (""Active"",             ""Y"");
         oOrderComp.CopyFieldValue (""Contact Id"", ""Contact Id"");
         oOrderComp.CopyFieldValue (""Price List Id"", ""Price List Id"");
         oOrderComp.CopyFieldValue (""Discount"", ""Discount"");
         oOrderComp.CopyFieldValue (""Discount Amount"", ""Discount Amount"");
         oOrderComp.CopyFieldValue (""Discount Reason"", ""Discount Reason"");
         oOrderComp.CopyFieldValue (""Price List"", ""Price List"");
         // oOrderComp.CopyFieldValue (""Payment Method"", ""Payment Method"");
         oOrderComp.CopyFieldValue (""Currency Code"", ""Currency Code"");
         oOrderComp.CopyFieldValue (""Freight"",            ""Freight Total"");
         oOrderComp.CopyFieldValue (""Freight Terms"",      ""Freight Terms"");
         oOrderComp.CopyFieldValue (""Freight Terms Info"", ""Freight Terms Info"");
		 var orgId = iQuoteComp.GetFieldValue (""Primary Organization Id"");
         // var priceList = iQuoteComp.GetFieldValue ( ""Price List Id"");
         // oOrderComp.SetFieldValue ( ""Order Date"",); don't forget this - should be today()

         // Only for Create
         var ordernumber = """";
        
            // This is to workaround the problem where the pre-default on Order Number
            // does not take effect through the Siebel Adapter.
            
            
            ordernumber = CreateOrder();

            outputMsg.SetArgument (""Object Id"", ordernumber);
        
         
         oOrderComp.SetFieldValue ( ""Id"",                 ordernumber); 
         // oOrderComp.SetFieldValue ( ""Order Number"",       ordernumber); 

         var orderType= TheApplication().InvokeMethod (""LookupValue"", ""FS_ORDER_TYPE"", ""Sales Order"");
         oOrderComp.SetFieldValue (""Order Type"",   orderType);
         oOrderComp.CopyFieldValue (""Primary Organization Id"",       ""Primary Organization Id"");
         // oOrderComp.CopyFieldValue (""Primary Organization"",      	 ""Primary Organization"");
         oOrderComp.CopyFieldValue (""Partial Ship"",       ""Partial Ship"");
         oOrderComp.SetFieldValue ( ""Integration Id"",      null);
         oOrderComp.CopyFieldValue (""Payment Term"",       ""Payment Term"");
         // Not there in Quoute ??? oOrderComp.CopyFieldValue (""Pricing Date"",       ""Pricing Date"");
         var poNumber = iQuoteComp.GetFieldValue ( ""Purchase order Number"" );
         if ( poNumber == null )
         {
         	oOrderComp.SetFieldValue (""Account Order Number"", ordernumber );
         }
         else
         {
         	oOrderComp.SetFieldValue (""Account Order Number"", poNumber );
         }	

         // oOrderComp.CopyFieldValue (""Payer Account Integration Id"",       	""Payer Account Integration Id"");
         oOrderComp.CopyFieldValue (""Quote Id"",           						""Id"");
         oOrderComp.CopyFieldValue (""Requested Ship Date"", 						""Requested Ship Date"");
         // Credit Card Comp Mapping
         var paymentType = iQuoteComp.GetFieldValue (""Credit Card Name"");
         var ccNumber = iQuoteComp.GetFieldValue (""Credit Card Number"");
         if ((paymentType != """") && (ccNumber != """"))
         {
            oOrderCardComp = oOrderComp.CreateIntComp (""Payments"");
            oOrderCardComp.NewRecord ();
            oOrderCardComp.SetCopySource (iQuoteComp);
            oOrderCardComp.CopyFieldValue (""Account Number"",      					""Credit Card Number"");
            // oOrderCardComp.CopyFieldValue (""Credit Card Transaction ID"",               ""Credit Card Transaction ID"");
            oOrderCardComp.CopyFieldValue (""Authorization Code"",              	""Credit Card Authorization Code"");
            oOrderCardComp.CopyFieldValue (""Transaction Amount"",           ""Credit Card Transaction Amount"");
            oOrderCardComp.CopyFieldValue (""Payment Status"",           ""Credit Card Transaction Status"");
            oOrderCardComp.CopyFieldValue (""Expiration Month"",             ""Credit Card Expiration Month"");
            oOrderCardComp.CopyFieldValue (""Expiration Year"",              ""Credit Card Expiration Year"");
            // CR# 12-9RTEQV ( Change Expiration Date to Month & Year)
            // oOrderComp.CopyFieldValue (""Credit Card Expiration Date"",              ""Credit Card Expiration Date"");
            oOrderCardComp.CopyFieldValue (""Card Holder"",              			""Credit Card Holder"");
            oOrderCardComp.CopyFieldValue (""Payment Type"",              		""Credit Card Name"");
            // oOrderComp.SetFieldValue  (""Credit Card Name"",              			""Visa"");
            // oOrderComp.CopyFieldValue (""Credit Card Transaction Response Code"",    ""Credit Card Transaction Response Code"");
            var paymentMethod = TheApplication().InvokeMethod (""LookupValue"", ""PAYMENT_METHOD_CODE"", ""Credit Card"");
            oOrderCardComp.SetFieldValue  (""Payment Method"",   paymentMethod);
         }
      
        /*	
         *	Read the ""Quote_Organization"" Component for Copying Organization 
         */
         iQuoteOrgComp = iQuoteComp.GetIntComp(""Quote_Organization"");
         oOrderOrgComp = oOrderComp.CreateIntComp (""Order Entry - Orders_Organization"");
         
         while (iQuoteOrgComp.NextRecord())
         {
         	oOrderOrgComp.NewRecord ();
         	oOrderOrgComp.SetCopySource (iQuoteOrgComp);
         	
         	oOrderOrgComp.CopyFieldValue ( ""IsPrimaryMVG"",			""IsPrimaryMVG"");
         	oOrderOrgComp.CopyFieldValue ( ""Organization Id"",		""Organization Id"");
         }
        
         /*
         * Read the ""Quote Item"" component
         */
         iQuoteItemComp = iQuoteComp.GetIntComp (""Quote Item"");
         oOrderItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false );

         while (iQuoteItemComp.NextRecord ())
         {
            oOrderItemComp.NewRecord ();
            oOrderItemComp.SetCopySource  (iQuoteItemComp);
			//    EAIRaiseError(""ERR_MSG_ORDER_ALREADY_SUBMITTED"");	  
            oOrderItemComp.CopyFieldValue (""Base Price"",              		""Base Price"");
            oOrderItemComp.CopyFieldValue (""Class Registration Number"", 	""Class Registration Number"");
            // oOrderItemComp.CopyFieldValue (""Covered Product"",         		""Covered Product"");
            oOrderItemComp.CopyFieldValue (""Description"",             		""Description"");
            oOrderItemComp.CopyFieldValue (""Discount Amount"",       ""Discount Amount"");
            
            oOrderItemComp.CopyFieldValue (""Discount Percent"",       		""Discount Percent"");
            oOrderItemComp.CopyFieldValue (""Due Date"",                		""Requested Delivery Date"");
            oOrderItemComp.CopyFieldValue (""Effective Pricing Period Id"", 	""Period Id"");
            oOrderItemComp.CopyFieldValue (""Freight Amount"",          		""Freight Amount"");
            oOrderItemComp.CopyFieldValue (""Unit Price"",              		""Unit Price"");
            oOrderItemComp.CopyFieldValue (""Item Price"",     				""Item Price"");
            oOrderItemComp.CopyFieldValue (""Adjusted List Price"",     		""Adjusted List Price"");
            oOrderItemComp.CopyFieldValue (""Line Number"",             		""Line Number"");
            oOrderItemComp.CopyFieldValue (""Note"",                    		""Note"");
            // oOrderItemComp.SetFieldValue ( ""Order Number"",            		ordernumber);
            oOrderItemComp.SetFieldValue ( ""Order Header Id"",         		ordernumber);
            oOrderItemComp.SetFieldValue ( ""Order Type"",              		orderType);
            oOrderItemComp.CopyFieldValue (""Partial Ship"",            		""Partial Ship"");
            oOrderItemComp.CopyFieldValue (""Pricing Comments"",        		""Pricing Comments"");
            // oOrderItemComp.CopyFieldValue (""Product"",                 		""Product"");
            oOrderItemComp.CopyFieldValue (""Product Id"",              		""Product Id"");
            // oOrderItemComp.CopyFieldValue (""Product Integration Id"",  		""Product Integration Id"");
            // oOrderItemComp.CopyFieldValue (""Product Unit of Measure"", 		""Unit of Measure"");
            oOrderItemComp.CopyFieldValue (""Quantity Requested"",      		""Quantity"");
            // oOrderItemComp.CopyFieldValue (""Ship To Account Integration Id"",""Ship To Account Integration Id"");
            oOrderItemComp.CopyFieldValue (""Source Inventory Location"", 	""Source Inventory Location"");
            // oOrderItemComp.CopyFieldValue (""Source Inventory Loc Id"", 		""Source Inventory Location Id"");
            oOrderItemComp.CopyFieldValue (""Volume Discount Item"", 	""Volume Discount Item"");
            oOrderItemComp.CopyFieldValue (""Volume Discount Item Id"", 	""Volume Discount Item Id"");
            // oOrderItemComp.CopyFieldValue (""Exclude Pricing Flag"", 	""Exclude Pricing Flag"");
            oOrderItemComp.CopyFieldValue (""Volume Upsell Item"", 	""Volume Upsell Item"");
            oOrderItemComp.CopyFieldValue (""Volume Upsell Item Id"", 	""Volume Upsell Item Id"");
            oOrderItemComp.CopyFieldValue (""Volume Discount Id"", 	""Volume Discount Id"");
            oOrderItemComp.CopyFieldValue (""Volume Upsell Message"", 	""Volume Upsell Message"");
            oOrderItemComp.CopyFieldValue (""Price List Id"", 	""Price List Id"");
            oOrderItemComp.CopyFieldValue (""Discount Source"", 	""Discount Source"");
            oOrderItemComp.CopyFieldValue (""Asset Id"", 	""Covered Asset Id"");
            oOrderItemComp.CopyFieldValue (""Volume Discount Method"", 	""Volume Discount Method"");
            oOrderItemComp.CopyFieldValue (""Write-In Product"", 	""Write-In Product"");
            // oOrderItemComp.CopyFieldValue (""Product Port Id"", 	""Product Port Id"");
            oOrderItemComp.CopyFieldValue (""Prod Item Id"", 	""Prod Item Id"");
            oOrderItemComp.CopyFieldValue (""Promotion Item Flag"", 	""Promotion Item Flag"");
            oOrderItemComp.CopyFieldValue (""Covered Product Id"", 	""Covered Product Id"");
            // oOrderItemComp.CopyFieldValue (""Parent Order Item Id"", 	""Parent Quote Item Id"");
            // oOrderItemComp.CopyFieldValue (""Root Order Item Id"", 	""Root Quote Item Id"");
            // oOrderItemComp.CopyFieldValue (""Root Product Id"", 	""Root Product Id"");
            
            
            // EAI Insert Position		AFTER
            // Calculate PriceAll Pre Final Method Invoke 0		RefreshParentMvgBC
            // Calculate Price Post Method Invoke 0		UpdateServicePrice
            // Pricing Enabled		Y
            // Order Header Id
            oOrderItemComp.CopyFieldValue (""Tax Amount"",                 	""Tax Amt"");
           
		}
      }
   }
}
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   return EAIExecuteMap (MethodName, Inputs, Outputs);
}
"
"/*
function SimulateSAP4xOrder_BAPIToSiebel (inputMsg, outputMsg)
{
   ** Input Objects' Integration Components
    *   BAPI Export (SAP 4x Order - Simulate SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (SAP 4x Order)
    *     Order (oOrder)
    *       Simulate Output
    *		Simulate Item
    *		Order Item
    **

   **
    * Set up EAI Lookup objects
    **
    
   var currencyLM 	 = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");
   var ccStatusLM	 = new CSSEAIValueMap (""SAP Credit Card Approval Code"", ""Siebel Inbound"");
   var cCardLM	 	 = new CSSEAIValueMap (""SAP Credit Card Type"", ""Siebel Inbound"");
  

   **
    * Set up EAI Input Message objects
    **
    
   var iSimOrderObj;   // BAPI Order instance
   var iSimExportComp; // BAPI Export Parameters
   var iSimItemComp;   // BAPI Order Items
   var iSimIItemComp;  // BAPI Order Input Item Comp to retieve value for Fix Pricing flag
   var iSchedItemComp; // BAPI Schedule Line Items
   var iSimCCardComp;  // BAPI Credit Card Export Comp

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   **
    * Set up EAI Output Message objects
    **
    
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oOutputComp; // Simulate Output RFC_*
   var oItemComp;   // Simulate Item Output RFC_*
   var oSimItemComp;   // Simulate Item
   // var oItemComp;      // Item
   var oSchedItemComp; // Schedule Line Item

   **
    * Find and create top-level integration object
    **
    
   iSimOrderObj = inputMsg.GetIntObj (""SAP 4x Order - Simulate SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""SAP 4x Order(Sync)"");
   
   **
    * Read int object instances from EAI message
    **
    
   while (iSimOrderObj.NextInstance ())
   {
      **
       * Create ""Order"" object
       **
       
      oOrderObj.NewInstance ();

      **
       * Create ""Order"" component in output message
       **
       
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order Entry - Orders"");
      oOrderComp.NewRecord ();
      
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      **
       * Read ""Export Parameters"" component
       **
       
      iSimExportComp = iSimOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      if (iSimExportComp.NextRecord ())
      {
         
         **
          * Update ""Order"" component
          **
          
         oOrderComp.SetCopySource  (iSimExportComp);
         oOrderComp.SetFieldValue(""As Of Date"", Timestamp());
		 
         var sapDelBlock = iSimExportComp.GetFieldValue ( ""SHIP_TO_PARTY-DLV_BLOCK"" );
		 var delBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_DELIV_BLOCK"", sapDelBlock);
         oOrderComp.SetFieldValue (""Delivery Block"",     delBlock);
         
         // sapBlock 		= null;
         var sapBillBlock = iSimExportComp.GetFieldValue ( ""BILLING_PARTY-BILL_BLOCK"" );
		 var billBlock = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_HEADER_BILL_BLOCK"", sapBillBlock);
         oOrderComp.SetFieldValue (""Billing Block"",     billBlock);

		 // oOrderComp.CopyFieldValue (""Billing Block"",      ""BILLING_PARTY-BILL_BLOCK"");
         oOrderComp.CopyFieldValue (""Back Office Error Text"",     ""RETURN-MESSAGE"");
		 
		 
         // var currencyCode = currencyLM.Translate (iSimExportComp.GetFieldValue (""SOLD TO PARTY-CURRENCY""));
         
         // if (currencyCode != null && currencyCode != """")
            // {
              // oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
            // }

         var returnCode = iSimExportComp.GetFieldValue (""RETURN-CODE"");
         
         if ( (returnCode == ""V1154"") || (returnCode == ""V1038"") )
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""N"");
            }
         else
            {
              oOrderComp.SetFieldValue (""Credit Status"",             ""Y"");
            }

		// Just to Store Order Id so that Net Price at Item Table can be stored for Pricing Ref Purpose.
      	oOutputComp = oOrderComp.CreateIntComp (""Order Entry - Get SAP Order Status Header"");
      	oOutputComp.NewRecord();
      	oOutputComp.SetFieldValue (""Input Id"", inputId);
        oOutputComp.SetFieldValue (""Order Number"", inputId);

         **
          * Read ""ORDER_CCARD_EX"" component
          **
          
		 	 
		  iSimCCardComp = iSimExportComp.GetIntComp (""ORDER_CCARD_EX"");
          var cardStatus;
          while (iSimCCardComp.NextRecord())
          {
         	 cardStatus = iSimCCardComp.GetFieldValue ( ""CC_STAT_EX"");
         	 if ( cardStatus != null && cardStatus != """" )
         	 {
         	 	oOrderComp.SetCopySource (iSimCCardComp);
         		
         	 	oOrderComp.CopyFieldValue (""Credit Card Number"", ""CC_NUMBER"");
         		// oOrderComp.CopyFieldValue (""Credit Card Holder"", ""CC_NAME"");
         	 	oOrderComp.CopyFieldValue (""Credit Card Transaction Time"", ""AUTH_DATE"");
           	 	oOrderComp.CopyFieldValue (""Credit Card Transaction ID"", ""CC_AUTTH_NO"");
           	 	oOrderComp.CopyFieldValue (""Credit Card Approval Code"", ""AUTH_REFNO"");
           	 	oOrderComp.CopyFieldValue (""Credit Card Transaction Amount"", ""AUTHAMOUNT"");
           	 	var ccStatus = ccStatusLM.Translate (iSimCCardComp.GetFieldValue (""CC_STAT_EX""));
           	 	oOrderComp.SetFieldValue (""Credit Card Transaction Status"", ccStatus );         		
				oOrderComp.CopyFieldValue (""Credit Card Expiration Date"", ""CC_VALID_T"" );
           	 	
           	 	
         	 }
          }
         		


         **
          * Read ""ORDERS_ITEMS_OUT"" component
          **
          

         iSimItemComp = iSimExportComp.GetIntComp (""ORDER_ITEMS_OUT"");
         iSimIItemComp = iSimExportComp.GetIntComp ( ""ORDER_ITEMS_IN"");
         oSimItemComp = oOrderComp.CreateIntComp (""Order Entry - Line Items"", false);
         oItemComp   =  oOutputComp.CreateIntComp ( ""Order Entry - Get SAP Order Status Item"", false);
         while (iSimItemComp.NextRecord ())
         {
            oSimItemComp.NewRecord ();
            oSimItemComp.SetCopySource  (iSimItemComp);
            
            iSimIItemComp.NextRecord ();
            
            var fixPrice = iSimIItemComp.GetFieldValue ( ""PURCH_NO_C"" );
                        
            
		    var netVal          = iSimItemComp.GetFieldValue (""NET_VALUE"");
            var qtyReq			= iSimItemComp.GetFieldValue (""REQ_QTY"");
            var netTax		= null;
            if ( qtyReq != 0 )
             {
            	var netPrice 		= netVal / qtyReq ; 
             }
            
            if (fixPrice != ""X"")
             {
            	oSimItemComp.SetFieldValue    (""Adjusted List Price"",         netPrice);
            	oSimItemComp.CopyFieldValue   (""Tax Amount"",                ""SUBTOTAL_5"");	
            	oSimItemComp.CopyFieldValue   (""Freight Amount"",            ""SUBTOTAL_4"");
       			oSimItemComp.SetFieldValue    (""SAP 4x Net Price"",      	netVal);
             }
            else
            {
            	oSimItemComp.SetFieldValue    (""Fix Price Flag"", ""Y"" );
            	oSimItemComp.CopyFieldValue   (""Tax Amount"",                ""SUBTOTAL_5"");	
            	oSimItemComp.SetFieldValue    (""Freight Amount"",            ""0"");
       			oSimItemComp.SetFieldValue    (""SAP 4x Net Price"",      	netVal);
            }
            
            
            var itemReqDate = iSimItemComp.GetFieldValue (""DLV_DATE""); 
            var itemnum = iSimItemComp.GetFieldValue (""ITM_NUMBER"");
            var itemCurrency = currencyLM.Translate (iSimItemComp.GetFieldValue (""CURRENCY""));
            
            oSimItemComp.SetFieldValue     (""Currency Code"",             itemCurrency );                   
            oSimItemComp.CopyFieldValue    (""Product Unit of Measure"",    ""SALES_UNIT"");
            oSimItemComp.CopyFieldValue    (""Line Number"",                ""ITM_NUMBER"");
            oSimItemComp.SetFieldValue     (""Order Header Id"",             inputId);
            oSimItemComp.CopyFieldValue    (""Quantity Requested"",        ""REQ_QTY"");
            oSimItemComp.CopyFieldValue    (""Product Integration Id"",        ""MATERIAL"");
            oSimItemComp.CopyFieldValue    (""Source Inventory Location"",        ""PLANT"")
            
            oItemComp.NewRecord ();
            oItemComp.SetCopySource  (iSimItemComp);
            oItemComp.SetFieldValue (""Input Id"" , inputId );
            oItemComp.CopyFieldValue (""Item Number"", ""ITM_NUMBER"");
            oItemComp.CopyFieldValue (""Requested Quantity"", ""REQ_QTY"");
            oItemComp.SetFieldValue (""Net Value"", netVal );
            
            oItemComp.SetFieldValue (""Net Price"", netPrice );
            
         

            
           **
            * Read ""ORDER_SCHEDULE_EX"" component
            **
            
            
            iSchedItemComp = iSimExportComp.GetIntComp   (""ORDER_SCHEDULE_EX"");
            oSchedItemComp = oSimItemComp.CreateIntComp (""Order Entry - Line Item Actions"", false);
		
			var firstScheduleLine = 1;
			
        
            while (iSchedItemComp.NextRecord ())
             {
               var itemnum2  = iSchedItemComp.GetFieldValue (""ITM_NUMBER"");
               var schednum = iSchedItemComp.GetFieldValue (""SCHED_LINE"");
               var intId;
               if (itemnum2 == itemnum)
               {
           
                oSchedItemComp.NewRecord ();
                oSchedItemComp.SetCopySource  (iSchedItemComp);
                
                intId = inputId + ""-"" + itemnum2 + ""-"" + schednum;
               
                // oSchedItemComp.SetFieldValue (""Integration Id"",             intId);
                oSchedItemComp.CopyFieldValue (""Quantity"",                   ""REQ_QTY"");
                oSchedItemComp.SetFieldValue (""Line Item Action Number"",     intId);
                oSchedItemComp.SetFieldValue  (""Line Number"",     itemnum);
                oSchedItemComp.SetFieldValue  (""Order Header Id"",     inputId);
                // oSchedItemComp.SetFieldValue  (""Quantity"",     qtyReq);                
                oSchedItemComp.CopyFieldValue (""Actual Start Date"",           ""GI_DATE"");
                oSchedItemComp.CopyFieldValue (""Confirmed Qty"",               ""CONFIR_QTY"");
                var reqDate = iSchedItemComp.GetFieldValue ( ""REQ_DATE"");
                oSchedItemComp.SetFieldValue (""Planned Start Date"" ,          reqDate);
                // Checking for First Schedule Line, as it contains actual Req Delivery Date and setting it for Item Req Delv Date
                if ( firstScheduleLine == 1 )
                	{
                		oSimItemComp.SetFieldValue    (""Due Date"",      reqDate );
                	}
                firstScheduleLine++;
                
                var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Schedule"");
                  // TheApplication().MsgBox ("foo is: "" + foo);
                  oSchedItemComp.SetFieldValue  (""Line Item Action Type"",   shipValue);

                // oSchedItemComp.SetFieldValue  (""Line Item Action Type"",      ""Schedule"");
                }
             }


         }

      }
   }
}
*/"
function SimulateSAP4xOrder_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Uses same map as CreateFromData() */
   CreateSimulateSAP4xOrder_SiebelToBAPI (inputMsg, outputMsg, 
                                        ""SAP 4x Order"", 
                                        ""SAP 4x Order - Simulate SAP Order (BAPI Input)"");
}
function SimulateSAP4xQuoteToOrder_SiebelToBAPI (inputMsg, outputMsg)

{
   /*
    * Input Objects' Integration Components
    *   Order Object (SAP 4x Order)
    *     Order (order)
    *       Order Line Item (item)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (SAP 4x Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *       ORDER_PARTNERS
    *       ORDER_ITEMS_IN
    *       ORDER_PARTNERS
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     ""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",       ""Siebel Outbound"");
   var cCardLM	   = EAIGetValueMap (""SAP Credit Card Type"",""Siebel Outbound"");
   var currencyLM  = EAIGetValueMap (""SAP Currency Code"",	""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   ""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", ""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iItemComp;  // Order Line Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;        // BAPI Order instance
   var oCFDImportComp;      // BAPI Import parameters
   var oCFDItemComp;        // BAPI Order Item
   var oCFDPartnerComp;     // BAPI Order Partners
   var oCFDCardComp;     	// BAPI Card Component


   /*
    * Find and create top-level integration object
    */
   iOrderObj    = inputMsg.GetIntObj (""SAP 4x Order(Quote)"");
   oCFDOrderObj = outputMsg.CreateIntObj (""SAP 4x Order - Simulate SAP Order (BAPI Input)"");
 
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp     = iOrderObj.GetPrimaryIntComp (""Order Entry - Orders"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
     
      if (iOrderComp.NextRecord ())
         {
         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         
         var priceList =  null;
         var currencyCode = currencyLM.Translate (iOrderComp.GetFieldValue (""Currency Code""));
         priceList = iOrderComp.GetFieldValue (""Price List Id"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"",   orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CURRENCY"",  currencyCode );
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COLLECT_NO"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division (MO)"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_OFF"",  null);
         if (iOrderComp.GetFieldValue (""Requested Ship Date"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",   ""Requested Ship Date"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"",       ""Order Date"");
            }
         // oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"", ""Requested Ship Date"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         if (iOrderComp.GetFieldValue (""Account Order Number"") != """")
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",   ""Account Order Number"");
               
            }
         else
            {
               oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",       ""Order Number"");
            }
         
         
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_METHOD"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_SUPPLEM"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Order Number"");
         
         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"", EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                                                       iOrderComp.GetFieldValue (""Contact Last Name"")));
         }         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GROUP"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_DIST"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_LIST"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-INCOTERMS1"", incotermsLM.Translate (iOrderComp.GetFieldValue(""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-PMNTTRMS"",   payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DLV_BLOCK"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-BILL_BLOCK"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-ORD_REASON"", null);
         // Partial Delivery Mapping Commented as Partial Ship Flag is not exposed in Quote UI. Once it has been exposed just decomment following code.
         // if (iOrderComp.GetFieldValue (""Partial Ship"") != ""Y"")
            // {
               // oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       ""X"");
            // }
         // else
            // {
               // oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",       null);
            // }
            
         
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", ""Pricing Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP1"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP2"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP3"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP4"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP5"",  null);
         

         /*
          * Write ""ORDER_PARTNERS"" component  
          */
                  
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");

         var soldtoparty =  iOrderComp.GetFieldValue (""Account Integration Id"");
         var array = soldtoparty.split("":"");
         var AccountIntId = array[0];
         var payerId = iOrderComp.GetFieldValue (""Payer Account Integration Id"");
         
         
         oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         if ( payerId == null || payerId == """" )
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", AccountIntId);
         	}
         else
         	{
         		oCFDPartnerComp.SetFieldValue (""PARTN_NUMB"", payerId);
         	}
         	

         // Bill to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

	    	/*
		 * Read and update Credit Card Info
		 *
		 */
		 var ccType = cCardLM.Translate (iOrderComp.GetFieldValue (""Credit Card Name""));
		 var ccNum = iOrderComp.GetFieldValue ( ""Credit Card Number"");
		 if ( ccNum != null && ccNum != """" )
		 
		 	{
		 		oCFDCardComp = oCFDImportComp.CreateIntComp (""ORDER_CCARD"");
		 		oCFDCardComp.NewRecord();
		 		oCFDCardComp.SetCopySource (iOrderComp);
		 		var cardExpDate = iOrderComp.GetFieldValue ( ""Credit Card Expiration Date"");
		 		if ( cardExpDate == null || cardExpDate == """" )
		 			{
		 				var cardExpYear	= iOrderComp.GetFieldValue (""Credit Card Expiration Year"" );
		 				var cardExpMonth  = iOrderComp.GetFieldValue (""Credit Card Expiration Month"" );
		 				var nMonth = ConvertMonth (cardExpMonth); // 12-9RTEQV
		 				var cardExpDay;
		 				cardExpDay = GetDaysInAMonth(nMonth, cardExpYear);
		 				// Modification for CR # 12-9RTEQV( Instead of Expiration Date now we are using Month & Year Seoerately)
		 				// if ( cardExpMonth < 10 )
		 					// {
		 					//	var cardExpFullDate = ""0"" + cardExpMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 					// }
		 				// else
		 				// 	{
		 						var cardExpFullDate = nMonth + ""/"" + cardExpDay + ""/"" + cardExpYear + "" 00:00:00"";
		 				// 	}
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpFullDate );
		 			}
		 		else
		 			{
		 				oCFDCardComp.SetFieldValue (""CC_VALID_T"", cardExpDate );
		 			}
		 			
		 		oCFDCardComp.SetFieldValue		(""CC_TYPE"", 		ccType);
		 		oCFDCardComp.SetFieldValue		(""CC_NUMBER"", 		ccNum );
		 		oCFDCardComp.CopyFieldValue		(""CC_NAME"", 		""Credit Card Holder"" );
				oCFDCardComp.CopyFieldValue		(""AUTHAMOUNT"", 		""Credit Card Transaction Amount"" );
		 		oCFDCardComp.SetFieldValue		(""CURRENCY"", 		currencyCode );
		 	} 
	     
         /*
          * Read ""Order Line Item"" Integration Component
          */
         iItemComp    = iOrderComp.GetIntComp        (""Order Entry - Line Items"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         
         while (iItemComp.NextRecord ())
         {

            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number"");
            oCFDItemComp.CopyFieldValue (""HG_LV_ITEM"",     null);
            oCFDItemComp.CopyFieldValue (""PO_ITM_NO"",      ""null"");
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            oCFDItemComp.CopyFieldValue (""CUST_MAT"",       null);
            oCFDItemComp.CopyFieldValue (""BATCH"",          null);
            oCFDItemComp.CopyFieldValue (""DLV_GROUP"",      null);
            
            if (iItemComp.GetFieldValue (""Partial Ship"") != ""Y"")
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""C"");
                }
            else
                {
                   oCFDItemComp.SetFieldValue (""PART_DLV"",       ""D"");
                }
            var qty;
            var SAPQty;
            qty = iItemComp.GetFieldValue ( ""Quantity Requested"" );
            SAPQty = qty ;
            oCFDItemComp.CopyFieldValue (""REASON_REJ"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_BLOCK"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_DATE"",      null);
            oCFDItemComp.CopyFieldValue (""PLANT"",          ""Source Inventory Location"");
            oCFDItemComp.CopyFieldValue (""STORE_LOC"",      null);
            oCFDItemComp.CopyFieldValue (""TARGET_QTY"",     null);
            oCFDItemComp.CopyFieldValue (""TARGET_QU"",      null);
            oCFDItemComp.SetFieldValue (""REQ_QTY"",        SAPQty);
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""ITEM_CATEG"",     null);
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");
            oCFDItemComp.CopyFieldValue (""REQ_DATE"",       ""Due Date"");
            oCFDItemComp.SetFieldValue  (""DATE_TYPE"",      ""1"");
            oCFDItemComp.CopyFieldValue (""REQ_TIME"",       null);
           
            
            var siebelPrice = iItemComp.GetFieldValue ( ""Unit Price"" );
            if ((  siebelPrice != 0) || (  priceList != """" ))
            
            {
             	oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PN00"");
            	oCFDItemComp.SetFieldValue  (""PURCH_NO_C"",     ""X"");
                oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     ""Item Price"");
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CD_TYPE1"",   ""HD00"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CD_VALUE1"",  ""Freight"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CD_P_UNT1"",   ""1"");
         // oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-CD_D_UNT1"",  uomLM.Translate(iOrderComp.GetFieldValue(""Product Unit of Measure"")));
            }
           else
           {
           		oCFDItemComp.SetFieldValue  (""CD_TYPE2"",      ""PB00"");	
           		// oCFDItemComp.CopyFieldValue (""CD_VALUE2"",     null);
            	oCFDItemComp.SetFieldValue  (""CD_P_UNT2"",     ""1"");
            	oCFDItemComp.SetFieldValue  (""CD_D_UNT2"",     uomLM.Translate (iItemComp.GetFieldValue (""Unit of Measure"")));
           }
           
          
            oCFDItemComp.CopyFieldValue (""PRC_GROUP1"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP2"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP3"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP4"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP5"",     null);
            oCFDItemComp.CopyFieldValue (""PROD_HIERA"",     null);
            oCFDItemComp.CopyFieldValue (""MATL_GROUP"",     null);
                 
         } 
      }
      
   }
}
"/**
 ** User-defined function that returns System Date/Time
 ** in the format understandable by Siebel adapter
 **/
function Timestamp()
{
 	var d = Date.fromSystem(Clib.time());
 
 	// Return date in the format MM/DD/YYYY HH:MM:SS
 	return Clib.rsprintf(""%02d/%02d/%04d %02d:%02d:%02d"", d.getMonth()+1, d.getDate(), d.getFullYear(), d.getHours(), d.getMinutes(), d.getSeconds()); 
}
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    P. Lim
//
// DESCRIPTION
//    Javascript maps from Siebel Order to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
/* This function shared by ""Simulate Order"" and ""Create Order"" */
"
function CreateSAPOrder_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Order - Create SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (Order - Create SAP Order (Siebel))
    *     Order (oOrder)
    *       Create Output
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iCFDOrderObj;   // BAPI Order instance
   var iCFDExportComp; // BAPI Export Parameters

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oCFDOutputComp; // Create Output

   /*
    * Find and create top-level integration object
    */
   iCFDOrderObj = inputMsg.GetIntObj(""Order - Create SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""Order - Create SAP Order (Siebel)"");

   /*
    * Read int object instances from EAI message
    */
   while (iCFDOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      oOrderComp.NewRecord();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iCFDExportComp = iCFDOrderObj.GetPrimaryIntComp (""Export Parameters"");
      oCFDOutputComp = oOrderComp.CreateIntComp (""Create Output"", oOrderComp);
      if (iCFDExportComp.NextRecord ())
      {
         /*
          * Write ""Create Output"" component
          */
         oCFDOutputComp.NewRecord ();
         oCFDOutputComp.SetCopySource  (iCFDExportComp);
         oCFDOutputComp.SetFieldValue  (""Input Id"",     inputId);
         oCFDOutputComp.CopyFieldValue (""Bill To Customer"",  ""BILLING_PARTY-PAYER"");
         oCFDOutputComp.CopyFieldValue (""Bill To Name"",      ""BILLING_PARTY-NAME"");
         oCFDOutputComp.CopyFieldValue (""Order Number"",      ""SALESDOCUMENT"");
         oCFDOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oCFDOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oCFDOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oCFDOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oCFDOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");
         oCFDOutputComp.CopyFieldValue (""Ship To Customer"",  ""SHIP_TO_PARTY-SHIP_TO"");
         oCFDOutputComp.CopyFieldValue (""Ship To Name"",      ""SHIP_TO_PARTY-NAME"");
         oCFDOutputComp.CopyFieldValue (""Sold To Customer"",  ""SOLD_TO_PARTY-SOLD_TO"");
         oCFDOutputComp.CopyFieldValue (""Sold To Name"",      ""SOLD_TO_PARTY-NAME"");

         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iCFDExportComp);
         oOrderComp.CopyFieldValue (""Integration Id"",                 ""SALESDOCUMENT"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""SHIP_TO_PARTY-SHIP_TO"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""BILLING_PARTY-PAYER"");

         var currencyCode = currencyLM.Translate (iCFDExportComp.GetFieldValue (""SOLD_TO_PARTY-CURRENCY""));
         if (currencyCode != null && currencyCode != """")
            oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
      }
   }
}
"
function CreateSAPOrder_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Uses same map as CreateFromData() */
   CreateSimulateSAPOrder_SiebelToBAPI (inputMsg, outputMsg,
                                        ""Order - Create SAP Order (Siebel)"",
                                        ""Order - Create SAP Order (BAPI Input)"");
}
"
function CreateSimulateSAPOrder_SiebelToBAPI (inputMsg, outputMsg, InputIntObjName, OutputIntObjName)
{
   /*
    * Input Objects' Integration Components
    *   Order Object (Order - Create SAP Order (Siebel))
    *     Order (order)
    *       Order Line Item (item)
    *
    * Output Object's Integration Components:
    *   BAPI Import Object (Order - Create SAP Order (BAPI Import))
    *     Import Parameters
    *       ORDER_PARTNERS
    *       ORDER_ITEMS_IN
    */

   /*
    * Set up EAI Lookup maps
    */
   var orderTypeLM = EAIGetValueMap (""SAP Order Types"",     ""Siebel Outbound"");
   var incotermsLM = EAIGetValueMap (""SAP Incoterms"",       ""Siebel Outbound"");
   var payTermsLM  = EAIGetValueMap (""SAP Payment Terms"",   ""Siebel Outbound"");
   var uomLM       = EAIGetValueMap (""SAP Unit of Measure"", ""Siebel Outbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;  // Order object instance
   var iOrderComp; // Order
   var iItemComp;  // Order Line Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oCFDOrderObj;    // BAPI Order instance
   var oCFDImportComp;  // BAPI Import parameters
   var oCFDItemComp;    // BAPI Order Item
   var oCFDPartnerComp; // BAPI Order Partners

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (InputIntObjName);
   oCFDOrderObj = outputMsg.CreateIntObj (OutputIntObjName);
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oCFDOrderObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp = iOrderObj.GetPrimaryIntComp (""Order"");
      oCFDImportComp = oCFDOrderObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iOrderComp.NextRecord ())
      {
         /*
          * Return an error if Integration Id is not null
          */
         if (iOrderComp.GetFieldValue (""Integration Id"") != """")
         {
            EAIRaiseError (""This order has already been submitted to the external system."");
         }

         /*
          * Write ""Import Parameters"" component
          */
         oCFDImportComp.NewRecord ();
         oCFDImportComp.SetCopySource  (iOrderComp);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DOC_NUMBER"", null);
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DOC_TYPE"", 
                                        orderTypeLM.Translate (iOrderComp.GetFieldValue (""Order Type"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COLLECT_NO"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_ORG"",  ""SAP Sales Organization"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DISTR_CHAN"", ""SAP Distribution Channel"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DIVISION"",   ""SAP Division"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_OFF"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REQ_DATE_H"", ""Requested Ship Date"");
         oCFDImportComp.SetFieldValue  (""ORDER_HEADER_IN-DATE_TYPE"",  ""1"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_NO"",   ""Order Number"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PURCH_DATE"", ""Order Date"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_METHOD"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PO_SUPPLEM"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-REF_1"",      ""Account Order Number"");

         // Set NAME only if ""Contact Id"" is not null.
         if (iOrderComp.GetFieldValue (""Contact Id"") != null)
         {
            oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-NAME"",
                                          EAIFormatPersonName (iOrderComp.GetFieldValue (""Contact First Name""),
                                                               iOrderComp.GetFieldValue (""Contact Last Name"")));
         }

         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-TELEPHONE"",  ""Contact Work Phone #"");
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_GRP"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GROUP"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-SALES_DIST"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_LIST"", null);
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-INCOTERMS1"", 
                                       incotermsLM.Translate (iOrderComp.GetFieldValue (""Freight Terms"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-INCOTERMS2"", ""Freight Terms Info"");
         oCFDImportComp.SetFieldValue (""ORDER_HEADER_IN-PMNTTRMS"", 
                                       payTermsLM.Translate (iOrderComp.GetFieldValue (""Payment Term"")));
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-DLV_BLOCK"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-BILL_BLOCK"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-ORD_REASON"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-COMPL_DLV"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-PRICE_DATE"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-QT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_F"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CT_VALID_T"", null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP1"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP2"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP3"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP4"",  null);
         oCFDImportComp.CopyFieldValue (""ORDER_HEADER_IN-CUST_GRP5"",  null);

         /*
          * Write ""ORDER_PARTNERS"" component (pivot from values in iOrderComp!)
          */
         /*
           NOTES:
           1. one row each Sold-to, Ship-to and Bill-to account,
              so we must pivot S_ORDER columns into rows using a UNION.
              SAP BAPI will return error if required ones are missing
           2. SO partner types are stored in TPAR.
           3. RE is for Bill-to, but we map RG (payer) to S_ORDER.BL_OU_ID
           4. P Lim. 5/19/99. We must always pass a row for 'AG' partner role because
              for some reason, SAP reuses the last function call's values.
         */
         oCFDPartnerComp = oCFDImportComp.CreateIntComp (""ORDER_PARTNERS"", oCFDImportComp);

         // Sold to partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""AG"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Account Integration Id"");

         // Ship To partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""WE"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Ship To Account Integration Id"");

         // Payer partner
         oCFDPartnerComp.NewRecord ();
         oCFDPartnerComp.SetCopySource  (iOrderComp);
         oCFDPartnerComp.SetFieldValue  (""PARTN_ROLE"", ""RG"");
         oCFDPartnerComp.CopyFieldValue (""PARTN_NUMB"", ""Bill To Account Integration Id"");

         /*
          * Read ""Order Line Item"" component
          */
         iItemComp = iOrderComp.GetIntComp (""Order Line Item"");
         oCFDItemComp = oCFDImportComp.CreateIntComp (""ORDER_ITEMS_IN"", oCFDImportComp);
         while (iItemComp.NextRecord ())
         {
            /*
             * Write ""ORDER_ITEMS_IN"" component
             */
            oCFDItemComp.NewRecord ();
            oCFDItemComp.SetCopySource  (iItemComp);
            oCFDItemComp.CopyFieldValue (""ITM_NUMBER"",     ""Line Number"");
            oCFDItemComp.CopyFieldValue (""HG_LV_ITEM"",     null);
            oCFDItemComp.CopyFieldValue (""PO_ITM_NO"",      ""Line Number"");
            oCFDItemComp.CopyFieldValue (""MATERIAL"",       ""Product Integration Id"");
            oCFDItemComp.CopyFieldValue (""CUST_MAT"",       null);
            oCFDItemComp.CopyFieldValue (""BATCH"",          null);
            oCFDItemComp.CopyFieldValue (""DLV_GROUP"",      null);
            oCFDItemComp.CopyFieldValue (""PART_DLV"",       null);
            oCFDItemComp.CopyFieldValue (""REASON_REJ"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_BLOCK"",     null);
            oCFDItemComp.CopyFieldValue (""BILL_DATE"",      null);
            oCFDItemComp.CopyFieldValue (""PLANT"",          null);
            oCFDItemComp.CopyFieldValue (""STORE_LOC"",      null);
            oCFDItemComp.CopyFieldValue (""TARGET_QTY"",     null);
            oCFDItemComp.CopyFieldValue (""TARGET_QU"",      null);
            oCFDItemComp.CopyFieldValue (""REQ_QTY"",        ""Quantity Requested"");
            oCFDItemComp.SetFieldValue  (""SALES_UNIT"", 
                                         uomLM.Translate (iItemComp.GetFieldValue (""Product Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""ITEM_CATEG"",     null);
            oCFDItemComp.CopyFieldValue (""SHORT_TEXT"",     ""Description"");
            oCFDItemComp.CopyFieldValue (""REQ_DATE"",       ""Due Date"");
            oCFDItemComp.SetFieldValue  (""DATE_TYPE"",      ""1"");
            oCFDItemComp.CopyFieldValue (""REQ_TIME"",       null);
            oCFDItemComp.SetFieldValue  (""COND_TYPE"",      ""PB00"");
            // Item Price is price after discounts (i.e. net price)
            oCFDItemComp.CopyFieldValue (""COND_VALUE"",     ""Item Price"");
            oCFDItemComp.SetFieldValue  (""COND_P_UNT"",     ""1"");
            oCFDItemComp.SetFieldValue  (""COND_D_UNT"", 
                                         uomLM.Translate (iItemComp.GetFieldValue (""Product Unit of Measure"")));
            oCFDItemComp.CopyFieldValue (""PRC_GROUP1"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP2"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP3"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP4"",     null);
            oCFDItemComp.CopyFieldValue (""PRC_GROUP5"",     null);
            oCFDItemComp.CopyFieldValue (""PROD_HIERA"",     null);
            oCFDItemComp.CopyFieldValue (""MATL_GROUP"",     null);
         }
      }
   }
}
"
function GetSAPOrderStatus_BAPIToSiebel (inputMsg, outputMsg)
{
   /*
    * Input Objects' Integration Components
    *   BAPI Export (Order - Get SAP Order Status (BAPI Output))
    *     Export Parameters (output)
    *       Order Header (header)
    *         Order Item (item)
    *           Order Item Delivery Item (deliv)
    *
    * Output Object's Integration Components:
    *   Order Object (Order - Get SAP Order Status (Siebel))
    *     Order (oOrder)
    *       Get Status Output
    *       Get Status Header
    *         Get Status Item
    *           Get Status Item Delivery Item
    *       Order Line Item
    *         Order Line Item Action
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iGSOrderObj;   // BAPI Order instance
   var iGSExportComp; // BAPI Export Parameters
   var iGSHeaderComp; // BAPI Order Header
   var iGSItemComp;   // BAPI Order Item
   var iGSDelivComp;  // BAPI Order Item Delivery Item

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;     // Siebel Orderinstance
   var oOrderComp;    // Order
   var oItemComp;     // Order Line Item
   var oDelivComp;    // Order Line Item Action
   var oGSOutputComp; // Create Output
   var oGSHeaderComp; // Create Header
   var oGSItemComp;   // Create Item
   var oGSDelivComp;  // Create Item Delivery Item


   /*
    * Find and create top-level integration object
    */
   iGSOrderObj = inputMsg.GetIntObj(""Order - Get SAP Order Status (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""Order - Get SAP Order Status (Siebel)"");

   /*
    * Read int object instances from EAI message
    */

   while (iGSOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object in output message
       */
      oOrderObj.NewInstance ();
      
      /*
       * Create ""Order"" component
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      oOrderComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);
      
      /*
       * Read ""Export Parameters"" component
       */
      iGSExportComp = iGSOrderObj.GetPrimaryIntComp (""Export Parameters"");
      
      /*
       * Create the output component. Defer creation if the ""Export Parameters"" component
       * does not exist.
       *
       */
      oGSOutputComp = oOrderComp.CreateIntComp (""Get Status Output"", iGSExportComp.Exists());
      if (iGSExportComp.NextRecord())
      {
         /*
          * Write ""Create Output"" component
          */
         oGSOutputComp.NewRecord ();
         oGSOutputComp.SetCopySource  (iGSExportComp);
         oGSOutputComp.SetFieldValue  (""Input Id"",     inputId);
         oGSOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oGSOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oGSOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oGSOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oGSOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");
         
         /*
          * Read ""Order Header"" component
          */
         iGSHeaderComp = iGSExportComp.GetIntComp (""Order Header"");
         oGSHeaderComp = oOrderComp.CreateIntComp (""Get Status Header"", iGSHeaderComp.Exists());

         // Singleton entry in input - 'if' is symbolic of not looping
         if (iGSHeaderComp.NextRecord ())
         {
            /*
             * Write ""Get Status Header"" component
             */
            oGSHeaderComp.NewRecord ();
            oGSHeaderComp.SetCopySource  (iGSHeaderComp);
            oGSHeaderComp.SetFieldValue  (""Input Id"",    inputId);
            oGSHeaderComp.CopyFieldValue (""Currency"",        ""CURRENCY"");
            oGSHeaderComp.CopyFieldValue (""Delivery Block"",  ""DLV_BLOCK"");
            oGSHeaderComp.CopyFieldValue (""Delivery Status"", ""DLV_STAT_H"");
            oGSHeaderComp.CopyFieldValue (""Order Date"",      ""DOC_DATE"");
            oGSHeaderComp.CopyFieldValue (""Order Number"",    ""DOC_NUMBER"");
            oGSHeaderComp.CopyFieldValue (""Pricing Status"",  ""PRC_STAT_H"");
            oGSHeaderComp.CopyFieldValue (""Purchase Order"",  ""PURCH_NO"");
            oGSHeaderComp.CopyFieldValue (""Requested Date"",  ""REQ_DATE_H"");
            
            /*
             * Update ""Order"" component
             */
            oOrderComp.SetCopySource  (iGSHeaderComp);
            
            // EAI Lookup code ""SAP Currency""
            var currencyCode = currencyLM.Translate (iGSHeaderComp.GetFieldValue (""CURRENCY""));
            if (currencyCode != null && currencyCode != """")
               oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);
            
            oOrderComp.CopyFieldValue (""Requested Ship Date"",     ""REQ_DATE_H"");
            /* P Lim 6/9/99. 12-LGEKF. Removed mapping of SAP Purch_no to Siebel ORDER_NUM */
            // oOrderComp.SetFieldValue (""Order Number"",    ""PURCH_NO"");
            
            /*
             * Read ""Order Item"" component
             */
            iGSItemComp = iGSHeaderComp.GetIntComp (""Order Item"");
            
            oGSItemComp = oGSHeaderComp.CreateIntComp (""Get Status Item"", iGSItemComp.Exists());
            oItemComp   = oOrderComp.CreateIntComp (""Order Line Item"", iGSItemComp.Exists());
            while (iGSItemComp.NextRecord ())
            {
               /*
                * Write ""Get Status Item"" component
                */
               oGSItemComp.NewRecord ();
               oGSItemComp.SetCopySource  (iGSItemComp);
               oGSItemComp.SetFieldValue  (""Input Id"",                  inputId);
               oGSItemComp.CopyFieldValue (""Condition Pricing Unit"",        ""COND_P_UNT"");
               oGSItemComp.CopyFieldValue (""Condition Unit"",                ""COND_UNIT"");
               oGSItemComp.CopyFieldValue (""Cumulative Confirmed Quantity"", ""CUM_CF_QTY"");
               oGSItemComp.CopyFieldValue (""Delivery Status"",               ""DLV_STAT_I"");
               oGSItemComp.CopyFieldValue (""Item Number"",                   ""ITM_NUMBER"");
               oGSItemComp.CopyFieldValue (""Material Part #"",               ""MATERIAL"");
               oGSItemComp.CopyFieldValue (""Material Short Text"",           ""SHORT_TEXT"");
               oGSItemComp.CopyFieldValue (""Net Price"",                     ""NET_PRICE"");
               oGSItemComp.CopyFieldValue (""Net Value"",                     ""NET_VALUE"");
               oGSItemComp.CopyFieldValue (""Reference Quantity"",            ""REF_QTY"");
               oGSItemComp.CopyFieldValue (""Requested Quantity"",            ""REQ_QTY"");
               oGSItemComp.CopyFieldValue (""Requested Ship Date"",           ""REQ_DATE"");
               oGSItemComp.CopyFieldValue (""Sales Unit"",                    ""SALES_UNIT"");
               
               /*
                * Write ""Order Line Item"" component
                */
               /*
                 NOTES: 
                 1. REF_QTY stores QTY submitted to next document (in this case, the deliveries).
                 So, this is equivalent to sum(item.DLV_QTY)
                 2. P Lim 5/28/99. Force prices into SAP. Do not update S_ORDER_ITEM.UNI_PRI (discount price).
                 SAP Line Items view will show Siebel prices AND SAP prices on same list view.
                 item.NET_PRICE UNIT_PRI
                 3. SAP columns not mapped to S_ORDER_ITEM (and exposed in SAP Line Items applet):
                 CUM_CF_QTY    NUMBER(15)
                 COND_P_UNT    VARCHAR2(5)
                 COND_UNIT     VARCHAR2(3)
                 DLV_STAT_I    VARCHAR2(1)
               */
               //var itemMaterial = EAIGetProperty (item.source, ""MATERIAL"");
               var itemMaterial = iGSItemComp.GetFieldValue (""MATERIAL"");
               
               oItemComp.NewRecord ();
               oItemComp.SetCopySource  (iGSItemComp);
               oItemComp.SetFieldValue  (""Product Integration Id"", itemMaterial);
               oItemComp.CopyFieldValue (""Line Number"",            ""ITM_NUMBER"");
               oItemComp.CopyFieldValue (""Quantity Requested"",     ""REQ_QTY"");
               oItemComp.CopyFieldValue (""Quantity Shipped"",       ""REF_QTY"");
               oItemComp.CopyFieldValue (""Due Date"",               ""REQ_DATE"");
               oItemComp.CopyFieldValue (""Description"",            ""SHORT_TEXT"");
               // In 2K: Defaults from buscomp. In 99.5: {fn ifnull(S_ORDER_ITEM.STATUS_CD, 'Open')}
               // item.CopyFieldValue (""Status"",              Open);
               
               /*
                * Read ""Order Item Delivery Item"" component
                */
               iGSDelivComp = iGSItemComp.GetIntComp (""Order Item Delivery Item"");
               
               oGSDelivComp = oGSItemComp.CreateIntComp (""Get Status Item Delivery Item"", iGSDelivComp.Exists());
               oDelivComp   = oItemComp.CreateIntComp (""Order Line Item Action"", iGSDelivComp.Exists());
               
               while (iGSDelivComp.NextRecord ())
               {
                  /*
                   * Write ""Get Status Item Delivery Item"" component
                   */
                  oGSDelivComp.NewRecord ();
                  oGSDelivComp.SetCopySource  (iGSDelivComp);
                  oGSDelivComp.SetFieldValue  (""Input Id"",             inputId);
                  oGSDelivComp.CopyFieldValue (""Delivered Quantity"",   ""DLV_QTY"");
                  oGSDelivComp.CopyFieldValue (""Delivery Date"",        ""DELIV_DATE"");
                  oGSDelivComp.CopyFieldValue (""Delivery Item Number"", ""DELIV_ITEM"");
                  oGSDelivComp.CopyFieldValue (""Delivery Number"",      ""DELIV_NUMB"");
                  oGSDelivComp.CopyFieldValue (""Item Number"",          ""ITM_NUMBER"");
                  
                  /*
                   * Write ""Get Status Item Delivery Item"" component
                   */
                  oDelivComp.NewRecord ();
                  oDelivComp.SetCopySource  (iGSDelivComp);
                  
                  var delivNum  = iGSDelivComp.GetFieldValue (""DELIV_NUMB"");
                  var delivItem = iGSDelivComp.GetFieldValue (""DELIV_ITEM"");
                  if (delivNum == null || delivItem == null)
                  {
                     EAIRaiseError (""'DELIV_NUMB' and 'DELIV_ITEM' fields are not specified."");
                  }
                  var itemActionNum = delivNum + ""-"" + delivItem;
                  oDelivComp.SetFieldValue  (""Line Item Action Number"", itemActionNum);
                  oDelivComp.CopyFieldValue (""Quantity"",                ""DLV_QTY"");
                  oDelivComp.CopyFieldValue (""Actual Start Date"",       ""DELIV_DATE"");
                  oDelivComp.SetFieldValue  (""Product Integration Id"",  itemMaterial);

                  var shipValue = TheApplication().InvokeMethod (""LookupValue"", ""SAP_SO_PART_MOVEMENT_TYPE"", ""Ship"");
                  // TheApplication().MsgBox ("foo is: "" + foo);
                  oDelivComp.SetFieldValue  (""Line Item Action Type"",   shipValue);
               }
            }
         }
      }
   }
}
"
function GetSAPOrderStatus_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   Order Object (Order - Get SAP Order nStatus (Siebel))
    *     Order
    *
    * Output Object's Integration Components:
    *   BAPI Import (Order - Get SAP Order Status (BAPI Input))
    *     Import Parameters
    */

   /*
    * Set up EAI Lookup objects
    */

   /*
    * Set up EAI Input Message objects
    */
   var iOrderObj;    // Siebel Order instance
   var iOrderComp;   // Order

   /*
    * Set up EAI Output Message objects
    */
   var oGSObj;         // BAPI instance
   var oGSImportComp;  // Import Parameters

   /*
    * Find and create top-level integration object
    */
   iOrderObj = inputMsg.GetIntObj (""Order - Get SAP Order Status (Siebel)"");
   oGSObj    = outputMsg.CreateIntObj (""Order - Get SAP Order Status (BAPI Input)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iOrderObj.NextInstance ())
   {
      /*
       * Create ""Get Status"" object
       */
      oGSObj.NewInstance ();

      /*
       * Read ""Order"" component
       */
      iOrderComp = iOrderObj.GetPrimaryIntComp (""Order"");
      oGSImportComp = oGSObj.CreatePrimaryIntComp (""Import Parameters"");
      if (iOrderComp.NextRecord ())
      {
         /*
          * Write ""Import Parameters"" component
          */
         oGSImportComp.NewRecord ();
         oGSImportComp.SetCopySource  (iOrderComp);
         oGSImportComp.CopyFieldValue (""SALESDOCUMENT"", ""Integration Id"");
      }
   }
}
"
function Service_PreInvokeMethod (MethodName, Inputs, Outputs)
{
   return EAIExecuteMap (MethodName, Inputs, Outputs);
}
"
function SimulateSAPOrder_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Order - Simulate SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (Order - Simulate SAP Order (Siebel))
    *     Order (oOrder)
    *       Simulate Output
    *         Simulate Item
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = EAIGetValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iSimOrderObj;   // BAPI Order instance
   var iSimExportComp; // BAPI Export Parameters
   var iSimItemComp;   // BAPI Order Items

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oSimOutputComp; // Simulate Output
   var oSimItemComp;   // Simulate Item

   /*
    * Find and create top-level integration object
    */
   iSimOrderObj = inputMsg.GetIntObj (""Order - Simulate SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""Order - Simulate SAP Order (Siebel)"");
   
   /*
    * Read int object instances from EAI message
    */
   while (iSimOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      oOrderComp.NewRecord ();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iSimExportComp = iSimOrderObj.GetPrimaryIntComp (""Export Parameters"");
      oSimOutputComp = oOrderComp.CreateIntComp (""Simulate Output"", oOrderComp);
      if (iSimExportComp.NextRecord ())
      {
         /*
          * Write ""Simulate Output"" component
          */
         oSimOutputComp.NewRecord ();
         oSimOutputComp.SetCopySource  (iSimExportComp);
         oSimOutputComp.SetFieldValue  (""Input Id"",          inputId);
         oSimOutputComp.CopyFieldValue (""Bill To Customer"",  ""BILLING_PARTY-PAYER"");
         oSimOutputComp.CopyFieldValue (""Bill To Name"",      ""BILLING_PARTY-NAME"");
         oSimOutputComp.CopyFieldValue (""Order Number"",      ""SALESDOCUMENT"");
         oSimOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oSimOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oSimOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oSimOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oSimOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");
         oSimOutputComp.CopyFieldValue (""Ship To Customer"",  ""SHIP_TO_PARTY-SHIP_TO"");
         oSimOutputComp.CopyFieldValue (""Ship To Name"",      ""SHIP_TO_PARTY-NAME"");
         oSimOutputComp.CopyFieldValue (""Sold To Customer"",  ""SOLD_TO_PARTY-SOLD_TO"");
         oSimOutputComp.CopyFieldValue (""Sold To Name"",      ""SOLD_TO_PARTY-NAME"");

         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iSimExportComp);
         // P Lim. Do not set Order Integration Id: Simulate BAPI does not return an Order number
         // oOrderComp.CopyFieldValue (""Integration Id"",                 ""SALESDOCUMENT"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""SHIP_TO_PARTY-SHIP_TO"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""BILLING_PARTY-PAYER"");

         var currencyCode = currencyLM.Translate (iSimExportComp.GetFieldValue (""SOLD_TO_PARTY-CURRENCY""));
         if (currencyCode != null && currencyCode != """")
            oOrderComp.SetFieldValue  (""Currency Code"", currencyCode);

         /*
          * Read ""Simulate Item"" component
          */
         iSimItemComp = iSimExportComp.GetIntComp (""Simulate Item"");
         oSimItemComp = oOrderComp.CreateIntComp (""Simulate Item"", oOrderComp);
         while (iSimItemComp.NextRecord ())
         {
            oSimItemComp.NewRecord ();
            oSimItemComp.SetCopySource  (iSimItemComp);
            oSimItemComp.SetFieldValue  (""Input Id"",                   inputId);
            oSimItemComp.CopyFieldValue (""Currency Code"",              ""CURRENCY"");
            oSimItemComp.CopyFieldValue (""Delivery Date"",              ""DLV_DATE"");
            oSimItemComp.CopyFieldValue (""Item Number"",                ""ITM_NUMBER"");
            oSimItemComp.CopyFieldValue (""Material Entered"",           ""MAT_ENTRD"");
            oSimItemComp.CopyFieldValue (""Material Part #"",            ""MATERIAL"");
            oSimItemComp.CopyFieldValue (""Material Short Text"",        ""SHORT_TEXT"");
            oSimItemComp.CopyFieldValue (""Net Value"",                  ""NET_VALUE"");
            oSimItemComp.CopyFieldValue (""Purchase Order Item Number"", ""PO_ITM_NO"");
            oSimItemComp.CopyFieldValue (""Quantity Requested Date"",    ""QTY_REQ_DT"");
            oSimItemComp.CopyFieldValue (""Replenishment Time"",         ""REPL_TIME"");
            oSimItemComp.CopyFieldValue (""Unit"",                       ""SALES_UNIT"");
         }
      }
   }
}
"
function SimulateSAPOrder_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Uses same map as CreateFromData() */
   CreateSimulateSAPOrder_SiebelToBAPI (inputMsg, outputMsg, 
                                        ""Order - Simulate SAP Order (Siebel)"", 
                                        ""Order - Simulate SAP Order (BAPI Input)"");
}
"
"///////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 1999, Siebel Systems, Inc., All rights reserved.
//
//  $Revision: 4 $
//      $Date: 12/10/99 10:29a $
//    $Author: Achaudhr $ of last update
//
// CREATOR:    R.Lankinen
//
// DESCRIPTION
//    Multi-organization Javascript maps from Siebel Order to SAP entities
//
///////////////////////////////////////////////////////////////////////////////
#include ""eaisiebel.js""
/* This function shared by ""Simulate Order"" and ""Create Order"" */
"
function CreateSAPOrder_BAPIToSiebel (inputMsg, outputMsg)
{
   /* Input Objects' Integration Components
    *   BAPI Export (Order - Create SAP Order (BAPI Output))
    *     Export Parameters (output)
    *
    * Output Object's Integration Components:
    *   Order Object (Order - Create SAP Order (Siebel))
    *     Order (oOrder)
    *       Create Output
    */

   /*
    * Set up EAI Lookup objects
    */
   var currencyLM = new CSSEAIValueMap (""SAP Currency Code"", ""Siebel Inbound"");

   /*
    * Set up EAI Input Message objects
    */
   var iCFDOrderObj;   // BAPI Order instance
   var iCFDExportComp; // BAPI Export Parameters

   // Store inputId to be denormalized to all RFC table rows
   var inputId = inputMsg.GetArgument (""Siebel Order Id"");

   /*
    * Set up EAI Output Message objects
    */
   var oOrderObj;      // Siebel Order instance
   var oOrderComp;     // Order
   var oCFDOutputComp; // Create Output

   /*
    * Find and create top-level integration object
    */
   iCFDOrderObj = inputMsg.GetIntObj(""Order - Create SAP Order (BAPI Output)"");
   oOrderObj = outputMsg.CreateIntObj (""Order - Create SAP Order (MO)"");

   /*
    * Read int object instances from EAI message
    */
   while (iCFDOrderObj.NextInstance ())
   {
      /*
       * Create ""Order"" object
       */
      oOrderObj.NewInstance ();

      /*
       * Create ""Order"" component in output message
       */
      oOrderComp = oOrderObj.CreatePrimaryIntComp (""Order"");
      oOrderComp.NewRecord();
      // Set ""Id"" so Siebel Adapter can synchronize
      oOrderComp.SetFieldValue (""Id"", inputId);

      /*
       * Read ""Export Parameters"" component
       */
      iCFDExportComp = iCFDOrderObj.GetPrimaryIntComp (""Export Parameters"");
      oCFDOutputComp = oOrderComp.CreateIntComp (""Create Output"", oOrderComp);
      if (iCFDExportComp.NextRecord ())
      {
         /*
          * Write ""Create Output"" component
          */
         oCFDOutputComp.NewRecord ();
         oCFDOutputComp.SetCopySource  (iCFDExportComp);
         oCFDOutputComp.SetFieldValue  (""Input Id"",     inputId);
         oCFDOutputComp.CopyFieldValue (""Bill To Customer"",  ""BILLING_PARTY-PAYER"");
         oCFDOutputComp.CopyFieldValue (""Bill To Name"",      ""BILLING_PARTY-NAME"");
         oCFDOutputComp.CopyFieldValue (""Order Number"",      ""SALESDOCUMENT"");
         oCFDOutputComp.CopyFieldValue (""Return Code"",       ""RETURN-CODE"");
         oCFDOutputComp.CopyFieldValue (""Return Log Msg No"", ""RETURN-LOG_MSG_NO"");
         oCFDOutputComp.CopyFieldValue (""Return Log No"",     ""RETURN-LOG_NO"");
         oCFDOutputComp.CopyFieldValue (""Return Message"",    ""RETURN-MESSAGE"");
         oCFDOutputComp.CopyFieldValue (""Return Type"",       ""RETURN-TYPE"");
         oCFDOutputComp.CopyFieldValue (""Ship To Customer"",  ""SHIP_TO_PARTY-SHIP_TO"");
         oCFDOutputComp.CopyFieldValue (""Ship To Name"",      ""SHIP_TO_PARTY-NAME"");
         oCFDOutputComp.CopyFieldValue (""Sold To Customer"",  ""SOLD_TO_PARTY-SOLD_TO"");
         oCFDOutputComp.CopyFieldValue (""Sold To Name"",      ""SOLD_TO_PARTY-NAME"");

         /*
          * Update ""Order"" component
          */
         oOrderComp.SetCopySource  (iCFDExportComp);
         oOrderComp.CopyFieldValue (""Integration Id"",                 ""SALESDOCUMENT"");
         oOrderComp.CopyFieldValue (""Ship To Account Integration Id"", ""SHIP_TO_PARTY-SHIP_TO"");
         oOrderComp.CopyFieldValue (""Bill To Account Integration Id"", ""BILLING_PARTY-PAYER"");
         oOrderComp.SetFieldValue  (""Currency Code"", 
                                    currencyLM.Translate (iCFDExportComp.GetFieldValue (""SOLD_TO_PARTY-CURRENCY"")));
      }
   }
}

function CreateSAPOrder_SiebelToBAPI (inputMsg, outputMsg)
{
   /* Uses same map as CreateFromData() */
   CreateSimulateSAPOrder_SiebelToBAPI (inputMsg, outputMsg,
                                        ""Order - Create SAP Order (MO)"",
                                        ""Order - Create SAP Order (BAPI Input)"");
}
